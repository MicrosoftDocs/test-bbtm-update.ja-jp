{
    "Slug": "announcing-serverside-encryption-with-customermanaged-keys-for-azure-managed-disks",
    "Title": "Azure Managed Disks のカスタマー マネージド キーを使用したサーバー側暗号化の発表",
    "Summary": "Today, we are announcing the general availability for server-side encryption (SSE) with customer-managed keys (CMK) for Azure Managed Disks. Azure customers have benefited from server-side encryption with platform-managed keys for Managed Disks enabled by default.",
    "Content": "<p>今日&#39;、Azure Managed Disks のカスタマー マネージド キー (CMK) を使用したサーバー側暗号化 (SSE) の一般提供についてお知らせします。 Azure のお客様は、Managed Disksの<a href=\"https://azure.microsoft.com/en-us/blog/azure-managed-disks-sse/\" target=\"_blank\">プラットフォームで管理されるキー</a>&nbsp;が既定で有効になっている SSE の恩恵を既に受けています。 CMK を使用した SSE では、コンプライアンスのニーズに合わせて暗号化キーを制御できるようにすることで、プラットフォームで管理されるキーが向上します。</p>\n\n<p>現在、お客様は<a href=\"https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption-overview\" target=\"_blank\">、Windows</a> <a href=\"https://docs.microsoft.com/windows/security/information-protection/bitlocker/bitlocker-overview\" target=\"_blank\">BitLocker</a> 機能と Linux <a href=\"https://en.wikipedia.org/wiki/Dm-crypt\" target=\"_blank\">dm-crypt</a> 機能を利用して、ゲスト仮想マシン (VM) 内の CMK でManaged Disksを暗号化するAzure Disk Encryptionも使用できます。 CMK を使用した SSE では、AZURE STORAGE サービス内のデータを暗号化することで、VM に対して OS の種類とイメージ (カスタム イメージを含む) を使用できるため、Azure Disk 暗号化が向上します。</p>\n\n<p>CMK を使用した SSE は <a href=\"https://azure.microsoft.com/en-us/services/key-vault/\" target=\"_blank\">Azure Key Vault</a>と統合されています。これは、ハードウェア セキュリティ モジュールによってサポートされるキーに高可用性とスケーラブルなセキュリティで保護されたストレージを提供します。 <a href=\"https://docs.microsoft.com/azure/key-vault/key-vault-hsm-protected-keys\" target=\"_blank\">独自のキー (BYOK) をKey Vaultに持ち込</a>むか、Key Vaultで新しいキーを生成できます。</p>\n\n<h2>キー管理について</h2>\n\n<p>Managed Disksは、使用可能な最も強力なブロック暗号の 1 つである 256 ビットの Advanced Encryption Standard (AES) 暗号化を使用して透過的に暗号化および復号化されます。 Storage サービスは、エンベロープ暗号化を使用して、完全に透過的な方法で暗号化と暗号化解除を処理します。 <a href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\" target=\"_blank\">256 ビットの AES ベースのデータ暗号化キー</a>を使用してデータを暗号化します。これは、Key Vaultに格納されているキーを使用して保護されます。</p>\n\n<p>Storage サービスはデータ暗号化キーを生成し、RSA 暗号化を使用して CMK で暗号化します。 エンベロープ暗号化を使用すると、VM に影響を与えることなく、コンプライアンス ポリシーに従って定期的にキーをローテーション (変更) することができます。 キーをローテーションすると、Storage サービスは新しい CMK でデータ暗号化キーを再暗号化します。</p>\n\n<h2>キーのフル コントロール</h2>\n\n<p>Key Vaultでキーを完全に制御できます。 Managed Disksでは、Key Vaultのキーにアクセスするために、Azure Active Directory (Azure AD) の<a href=\"https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview\" target=\"_blank\">システム割り当てマネージド ID が</a>使用されます。 Key Vaultで必要なアクセス許可を持つ管理者は、データ暗号化キーの暗号化と暗号化解除にキーを使用するために、まずKey VaultのManaged Disksへのアクセス権を付与する必要があります。 キーを無効にするか、キーのアクセス制御&mdash;を取り消すことで、Managed Disksがキーにアクセスできないようにすることができます。そのため、実行中の VM に接続されているディスクでは VM が失敗します。 さらに、Key Vault監視を通じてキーの使用状況を追跡し、Managed Disksまたはその他の信頼された Azure サービスのみがキーにアクセスしていることを確認できます。</p>\n\n<h2>CMK を使用した SSE の可用性</h2>\n\n<p>CMK を使用した SSE は、Azure Virtual Machines および VM スケール セットにアタッチできる Standard HDD、Standard SSD、プレミアム SSD Managed Disksで使用できます。 Ultra Disk Storageのサポートは別途発表されます。 CMK を使用した SSE は、すべてのパブリックリージョンとAzure Governmentリージョンで有効になり、数週間後にドイツ (ソブリン) と中国のリージョンで利用できるようになります。</p>\n\n<p>Azure Backupを使用して、CMK で SSE で暗号化されたManaged Disksを使用して VM をバックアップできます。 また、既定で使用できるプラットフォームマネージド キーではなく、Key Vaultに格納されているキーを使用して Recovery Services コンテナー内のバックアップ データを暗号化することもできます。 <a href=\"https://docs.microsoft.com/en-us/azure/backup/backup-azure-security-feature-cloud#encryption-of-backup-data-using-customer-managed-keys\" target=\"_blank\">CMK を使用したバックアップの暗号化</a>の詳細については、ドキュメントを参照してください。</p>\n\n<p>Azure Site Recoveryを使用して、SSE と CMK で暗号化Managed Disks Azure 仮想マシンを、ディザスター リカバリーのために他の Azure リージョンにレプリケートできます。 また、オンプレミスの仮想マシンをレプリケートして、Azure の CMK を使用して SSE で暗号化Managed Disksすることもできます。 <a href=\"https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-how-to-enable-replication-cmk-disks\" target=\"_blank\">CMK を使用して SSE で暗号化されたManaged Disksを使用して仮想マシンをレプリケート</a>する方法について説明します。</p>\n\n<h2>はじめに</h2>\n\n<p>Managed Disksの CMK による暗号化を有効にするには、まず DiskEncryptionSet という名前の新しいリソースの種類のインスタンスを作成し、そのインスタンスに key Vault へのアクセス権を付与する必要があります。 DiskEncryptionSet は、Key Vault内のキーを表し、同じキーを使用して多数のディスク、スナップショット、イメージを暗号化するために同じキーを再利用できます。</p>\n\n<p>DiskEncryptionSet のインスタンスを作成する例を見てみましょう&rsquo;。</p>\n\n<p>1.Key Vaultでキーを指定して、DiskEncryptionSet のインスタンスを作成します。</p>\n\n<p><code>keyVaultId=$(az keyvault show --name yourKeyVaultName --query [id] -o tsv)</code></p>\n\n<p><code>keyVaultKeyUrl=$(az keyvault key show --vault-name yourKeyVaultName --name yourKeyName --query [key.kid] -o tsv)</code></p>\n\n<p><code>az disk-encryption-set create -n yourDiskEncryptionSetName -l WestCentralUS -g yourResourceGroupName --source-vault $keyVaultId --key-url $keyVaultKeyUrl</code></p>\n\n<p>2.インスタンスにKey Vaultへのアクセス権を付与します。 インスタンスを作成すると、システムによってAzure ADに<a href=\"https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview\" target=\"_blank\">システム割り当てマネージド ID が</a>自動的に作成され、その ID がインスタンスに関連付けられます。 ラップキー、ラップ解除、取得などの必要な操作を実行するには、ID がKey Vaultにアクセスできる必要があります。</p>\n\n<p><code>desIdentity=$(az disk-encryption-set show -n yourDiskEncryptionSetName -g yourResourceGroupName --query [identity.principalId] -o tsv)</code></p>\n\n<p><code>az keyvault set-policy -n yourKeyVaultName -g yourResourceGroupName --object-id $desIdentity --key-permissions wrapkey unwrapkey get</code></p>\n\n<p><code>az role assignment create --assignee $desIdentity --role Reader --scope $keyVaultId</code></p>\n\n<p>ディスク、スナップショット、イメージの暗号化を DiskEncryptionSet のインスタンスに関連付けて有効にする準備ができました。 同じ DiskEncryptionSet に関連付けることができるリソースの数に制限はありません。</p>\n\n<p>既存のディスクを有効にする例を見てみましょう&rsquo;。</p>\n\n<p>1. VM に接続されているディスクの暗号化を有効にするには、仮想マシンを停止 (割り当て解除) する必要があります。</p>\n\n<p><code>az vm stop --resource-group MyResourceGroup --name MyVm</code></p>\n\n<p>2. DiskEncryptionSet のインスタンスに関連付けることによって、接続されたディスクの暗号化を有効にします。</p>\n\n<p><code>diskEncryptionSetId=$(az disk-encryption-set show -n yourDiskEncryptionSetName -g yourResourceGroupName --query [id] -o tsv)</code></p>\n\n<p><code>az disk update -n yourDiskEncryptionSetName -g yourResourceGroupName --encryption-type EncryptionAtRestWithCustomerKey --disk-encryption-set $diskEncryptionSetId</code></p>\n\n<p>3. VM を起動します。</p>\n\n<p><code>az vm start -g MyResourceGroup -n MyVm</code></p>\n\n<p>Managed Disksに対して CMK を使用してサーバー側暗号化を有効にする方法の詳細については、Managed Disks<a href=\"https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disk-encryption\" target=\"_blank\">ドキュメント</a>を参照してください。</p>\n\n<h2>フィードバックを送信します</h2>\n\n<p>CMK を使用した SSE に関するフィードバックをお待ちしております。 こちらまでお問 <a href=\"mailto:AzureDisks@microsoft.com\">い合わせください</a>。&nbsp;</p>\n"
}