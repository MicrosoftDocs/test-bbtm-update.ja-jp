{
    "Slug": "advancing-safe-deployment-with-aiops-introducing-gandalf",
    "Title": "AIOps による安全なデプロイの推進 - Gandalf の導入",
    "Summary": "The continuous monitoring of health metrics is a fundamental part of this process, and this is where AIOps plays a critical role. In the post that follows, we introduce how AI and machine learning are used to empower DevOps engineers, monitor the Azure deployment process at scale, detect issues early, and make rollout or rollback decisions based on impact scope and severity.",
    "Content": "<p><em>&ldquo;Azure サービスと Azure プラットフォーム自体に対する変更は、更新プログラム、新機能、およびセキュリティ強化の継続的な配信を確保するために、避けられず有益です。ただし、変更はサービス回帰の主な原因でもあり、ハイパースケール クラウド プロバイダーの信頼性の問題&mdash;に寄与する可能性があります。実際には、どの IT サービス プロバイダーでも発生します。そのため、カスタマー エクスペリエンスへの影響を最小限に抑えるために、開発とデプロイのロールアウト中にできるだけ早くこのような問題をキャッチすることが重要です。現在進行中の <a href=\"https://www.aka.ms/AdvancingReliability\" target=\"_blank\">高次信頼性</a> ブログ シリーズの一環として、Ive&rsquo; は AIOps チームからプリンシパル プログラム マネージャー <strong>の Jian Zhang</strong> に、これらの変更のリスクを取り除くために機械学習をますます活用し、最終的に Azure の信頼性を向上させる方法&rsquo;を紹介するよう依頼しました。&rdquo;</em>&mdash;Mark Russinovich、CTO、Azure</p>\n\n<hr>\n<p><em>この投稿には、プリンシパル データ サイエンティストの Ken Hsieh と Ze Li、プリンシパル データ科学者 マネージャー Yingnong Dang、Partner Group Software Engineering Manager Murali Chintalapati からの投稿が含まれています。</em></p>\n\n<p>&nbsp;</p>\n\n<p>以前のブログ記事&ldquo;「<a href=\"https://azure.microsoft.com/blog/advancing-safe-deployment-practices/\" target=\"_blank\">安全なデプロイプラクティス</a>&rdquo;の推進」で、クリスティナ・デル・アモ・カサドは<a href=\"https://azure.microsoft.com/en-us/\" target=\"_blank\">、コード</a>と構成の変更の両方について、Azure プラットフォーム全体で運用環境に変更をリリースする方法について説明しました。 プロセスは変化を段階的に提供することで構成され、テスト中にほとんどの回帰が見逃される場合に、少量で検出できるように十分なベイク時間を組み込むフェーズがあります。</p>\n\n<p>正常性メトリックの継続的な監視は、このプロセスの基本的な部分であり、AIOps が重要な役割&mdash;を果たします。これにより、アラートをトリガーする異常の検出と、デプロイの停止やロールバックの開始などのアクションの修正の自動化が可能になります。</p>\n\n<p>次の投稿では、AI と機械学習を使用して、DevOpsエンジニアの能力を高め、大規模な Azure デプロイ プロセスを監視し、問題を早期に検出し、影響範囲と重大度に基づいてロールアウトまたはロールバックの決定を行う方法について説明します。</p>\n\n<h2>安全なデプロイのための AIOps の理由</h2>\n\n<p><a href=\"https://www.gartner.com/en/documents/3892967/market-guide-for-aiops-platforms\" target=\"_blank\">Gartner</a> によって定義されているように、AIOps は、ビッグ データ、機械学習、視覚化を組み合わせた分析情報を通じて IT 運用を強化し、イベントの相関関係、異常検出、因果関係の判断などの IT 運用プロセスを自動化します。 以前の投稿&quot;「<a href=\"https://azure.microsoft.com/en-us/blog/advancing-azure-service-quality-with-artificial-intelligence-aiops/\" target=\"_blank\">人工知能による Azure サービスの品質の向上: AIOps</a>」では、安全なデプロイを含め、&quot;AIOps を実際に既に使用しているビジョンといくつかの方法を共有しました。 AIOps は、特にサービス間の依存関係の複雑さ、ハイパースケール クラウド サービスの規模、サポートされるさまざまな顧客シナリオが原因で、デプロイのロールアウト中にエラーをキャッチするのに適しています。</p>\n\n<p>段階的なロールアウトと強化された正常性シグナルは、デプロイ プロセスでの監視と意思決定を容易にするために使用されますが、デプロイの意思決定に関連するシグナルの量と複雑さのレベルは、60 を超えるリージョンの 200 を超えるデータセンターにまたがる、進化し続ける何千ものサービス コンポーネントにわたって、人間が合理的に推論できる範囲を超えています。 一部の潜在的な問題はデプロイ後数日間明らかにならず&rsquo;、異なるクラスターにまたがるが、個々のクラスターでは分単位でのみマニフェストされるグローバルな問題は、ローカル ウォッチドッグだけで検出するのが困難です。 疎結合を使用すると、ほとんどのサービス コンポーネントを個別にデプロイできますが、それらのデプロイは相互に複雑な影響を及ぼす可能性があります。 たとえば、アップストリーム サービスの単純な変更は、2 つのサービス間の API 呼び出しのコントラクトを破ると、ダウンストリーム サービスに影響を与える可能性があります。</p>\n\n<p>これらの課題では、デプロイの意思決定を速く容易にするために、自動監視、異常検出、ロールアウト影響評価ソリューションが必要です。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ea272394-b78c-496a-a993-bc1c8733c6d0.png\"><img alt=\"Gandalf safe deployment – including pre-qualification test, safe deployment policy, local watchdog, and “Gandalf” the global and intelligent watchdog.\" border=\"0\" height=\"209\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/47cf1def-15ef-41dd-b9bb-69eb6ed10a44.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"gandalf img1\" width=\"240\"></a></p>\n\n<p><em>図 1: ガンダルフの安全なデプロイ</em></p>\n\n<h2>Gandalf の安全なデプロイ サービス: AIOps ソリューション</h2>\n\n<p>上記の課題に直面して、Azure Compute インサイト チームは、安全なデプロイのために Gandalf&rdquo; の安全なデプロイ サービス&mdash;のエンドツーエンドの継続的な監視システムを開発しました&ldquo;。 他のいくつかのインテリジェントな監視サービスを含む Gandalf AIOps ソリューション スイートのこの部分を検討します。 コード名 Gandalf は、図 1 に示すように、The Lord of the Rings の主人公に触発され、グローバル ウォッチドッグとして機能し、収集されたシグナルに基づいてインテリジェントなデプロイ決定を行います。 デプロイの安全性と速度を確保するために、ローカル ウォッチドッグ、安全な展開ポリシー、事前認定テストと連携して動作します。</p>\n\n<p>図 2 に示すように、Gandalf システムは Azure からの豊富で代表的なシグナルを監視し、異常検出と相関関係を実行した後、デプロイの意思決定とアクションをサポートするための分析情報を導き出します。</p>\n\n<p><strong><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6dcc2c12-e23a-44d1-905f-2a4a01da7ff2.png\"><img alt=\"Gandalf system overview – showing data sources, the detection/correlation/decision engine, result orchestration, consumers, and the deployment engine.\" border=\"0\" height=\"262\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7c1aa8d8-2f29-4752-bc86-b2eeecdd0a59.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"図 2\" width=\"1024\"></a></strong></p>\n\n<p><em>図 2: ガンダルフ システムの概要</em></p>\n\n<h3>データ ソース</h3>\n\n<p>Gandalf は、以下で説明するように、パフォーマンス、障害、およびイベント全体のシグナルを監視します。 ダウンストリーム データ分析をサポートするために、データを事前に処理して統合データ スキーマを構造化します。 また、仮想マシンの障害分類サービスやほぼリアルタイムの障害属性処理サービスなど、Azure 内の他のいくつかの分析サービスを正常性シグナルに利用します。 完全なカバレッジを確保するには、新しいサービス コンポーネントがオンボードされたときに Gandalf へのシグナル登録が必要です。</p>\n\n<ul>\n    <li><strong>パフォーマンス データ: </strong>Gandalf は、パフォーマンス カウンター、CPU 使用率、メモリ使用量などを &ndash; 監視して、ホストされるサービスのパフォーマンスとリソース消費パターンの概要を確認します。</li>\n    <li><strong>障害信号:</strong> Gandalf は、顧客&rsquo;の仮想マシン (データ プレーン) とテナント レベルのサービス (コントロール プレーン) の両方のホスティング環境を監視します。 データ プレーンでは、OS のクラッシュ、ノード障害、再起動などの障害シグナルを監視して、VM&rsquo; ホスティング環境の正常性を評価します。&nbsp; 同時に、API 呼び出しの失敗などのコントロール プレーンの障害シグナルを監視して、テナント レベルのサービスの正常性を評価します。</li>\n    <li><strong>イベントを更新します。</strong> 収集されたテレメトリ データに加えて、Gandalf はデプロイ イベントのパルスを指で保持し、デプロイの進行状況と問題を報告します。</li>\n</ul>\n\n<h3>検出、関連付け、および決定</h3>\n\n<p>Gandalf は、デプロイ&mdash;の影響範囲 (影響を受けるノード、クラスター、顧客&mdash;の数など) を評価し、動的にトレーニングされた決定基準を使用して Go/no-go の決定を行います。 速度とカバレッジのバランスを取るために、Gandalf はストリーミングとバッチ分析エンジンの両方を備えたアーキテクチャを利用します。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/040317ab-ee8f-4043-96f4-138476f62040.png\"><img alt=\"Gandalf correlation process (identifying which rollouts are suspicious) and decision process (assessing the customer impacts of the blamed components/failures).\" border=\"0\" height=\"431\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bac9753f-e782-4ece-987b-214cb2b012c9.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"gandalf img3\" width=\"841\"></a></p>\n\n<p><em>図 3: ガンダルフ異常検出と相関モード</em></p>\n\n<p>図 3 は、Gandalf Machine Learning (ML) モデルの概要を示しています。 これは、(疑わしいデプロイを識別するための) 2 つの部分&mdash;的な検出と関連付けプロセスと、(顧客の影響を評価するための) 決定プロセスで構成されています。</p>\n\n<h3>異常検出と関連付けプロセス</h3>\n\n<p>正確な検出を確実に行うために、Gandalf は入力信号から障害シグネチャを派生させます。これは、障害を一意に識別するために使用できます。 次に、障害シグネチャの発生に基づいて検出します。</p>\n\n<p>Azure のような大規模なクラウド システムでは、単純なしきい値ベースの検出は、ホストされるシステムとワークロードの動的な性質と、膨大な量の障害シグネチャのために、実用的ではありません。 Gandalf は、機械学習手法を適用して、履歴データに基づいてベースライン設定を自動的に見積もり、必要に応じてトレーニングを通じて設定を調整できます。</p>\n\n<p>Gandalf は異常を検出すると、観察された障害をデプロイ イベントと関連付け、その影響範囲を評価します。 これは、ランダムなファームウェアの問題など、展開以外の理由によって発生するエラーを除外するのに役立ちます。</p>\n\n<p>多くの場合、複数のシステム コンポーネントが同時にデプロイされるため、投票拒否メカニズムを使用して、障害とロールアウト コンポーネントの間の関係を確立します。 さらに、時間的および空間的な相関関係を使用して、障害のあるコンポーネントを識別します。 障害の発生期間は、障害シグネチャのロールアウトと検出の間の時間を測定するため、新しく観察された障害が古いロールアウトによってトリガーされる可能性が低いため、古いロールアウトよりも新しいロールアウトに重点を置くものと見なされます。</p>\n\n<p>このように、Gandalf は、プロセス&mdash;の早い段階でカスタマー エクスペリエンスの潜在的な回帰につながる異常を検出し、広範な顧客への影響を生み出すことができます。 詳細については、発行された論文 &ldquo;<a href=\"https://www.usenix.org/conference/nsdi20/presentation/li\" target=\"_blank\">「Gandalf: 大規模なクラウド インフラストラクチャでの安全なデプロイのためのインテリジェントなエンドツーエンドの分析サービス</a>」を参照してください。&rdquo;</p>\n\n<h3>決定プロセス</h3>\n\n<p>最後に、Gandalf は、影響を受けるクラスター/ノード/顧客の数など、デプロイの影響範囲を評価し、最終的には Go/no-go の決定を &quot;行います&quot; 。 &rsquo;Gandalf は、開発者が経験に基づいてシグナル&rsquo;の重みの割り当てをカスタマイズできるように設計されていることに注目してください。 このようにして、人間の専門家からのドメイン知識を組み込んで、機械学習ソリューションを補完することができます。</p>\n\n<h3>結果オーケストレーション</h3>\n\n<p>速度とカバレッジのバランスを取るために、Gandalf は受信信号のストリーミング処理とバッチ処理の両方を利用します。 ストリーミング処理では、高速で分析をサポートするクラウド ストレージ ソリューションである Azure Data Explorer からのデータが使用されます。 ストリーミング処理は、各ノードの各デプロイの前後 1 時間に発生する障害信号を処理するために使用され、迅速な応答のために軽量の分析アルゴリズムを実行します。</p>\n\n<p>バッチ処理では、非常に大量のデータをサポートする Hadoop のようなファイル システムである Cosmos からのデータが使用されます。 &rsquo;高度なアルゴリズムを使用して、より大きな時間枠 (通常は 30 日間) にわたって障害を分析するために使用されます。</p>\n\n<p>ストリーム処理とバッチ処理の両方が、5 分間隔で増分的に実行されます。 一般に、Gandalf の受信テレメトリ信号はどちらもKustoにストリーミングされ、1 時間/日Cosmosに格納されます。 同じデータ ソースでは、処理パイプラインの結果に一貫性がない場合があります。 バッチ処理は、より多くの情報に基づいた意思決定を行い、高速/ストリーミング プロセスで検出できない潜在的な問題をカバーするため、仕様です。</p>\n\n<h2>デプロイ エクスペリエンスの変換</h2>\n\n<p>Gandalf システムは現在、Azure 内の DevOps ワークフローに十分に統合されており、フリート全体のデプロイ正常性監視に広く採用されています。 不正なロールアウトを可能な限り迅速に防ぐだけでなく、ソフトウェアの変更を展開するエンジニア&rsquo; とリリース マネージャー&rsquo; の経験を変革しました。また、ソフトウェアの変更&mdash;を展開する際の経験を、アドホック診断から対話型の&mdash;トラブルシューティングの使用まで、単一の情報源を使用することまで、Gandalf とやり取りするエンジニアの多くもその意見を変えました。 は、懐疑論者から支持者へと進化しています。</p>\n\n<p>多くの Azure サービスでは、Gandalf はすべてのリリース検証の既定のベースラインとなっており、&rsquo;オンコール エンジニアがガンダルフをどれだけ信頼しているかは非常に魅力的です。</p>\n\n<h2>まとめ</h2>\n\n<p>この記事では、Azure サービスの安全なデプロイのためのインテリジェントなエンドツーエンドの分析サービスである <a href=\"https://www.usenix.org/conference/nsdi20/presentation/li\" target=\"_blank\">Gandalf</a> の安全なデプロイ サービスを紹介しました。 Gandalf の安全なデプロイ サービスは、最先端の異常検出、特別な時間的相関関係、結果オーケストレーションを通じて、DevOpsエンジニアが、Azure などのハイパースケール クラウド プラットフォームで必要な速度を正確に判断できます。</p>\n\n<p>私たちは、クラウド サービス管理を改善するために AI と機械学習ベースのテクノロジの適用に投資し続け、最終的にはカスタマー エクスペリエンスの向上を続けます。 さらに品質を左にプッシュするのに役立つ運用前分析など、AIOps ソリューションの詳細についてお知らせください。</p>\n"
}