{
    "Slug": "a-new-way-to-send-custom-metrics-to-azure-monitor",
    "Title": "カスタム メトリックを Azure Monitor に送信する新しい方法",
    "Summary": "In today’s world of modern applications, metrics play a key role in helping you understand how your apps, services, and the infrastructure they run on, are performing. They can help you detect, investigate, and diagnose issues when they crop up. To provide you this level of visibility Azure has made resource-level platform metrics available via Azure Monitor.",
    "Content": "<p>最新のアプリケーションの今日&rsquo;の世界では、メトリックは、アプリ、サービス、およびそれらが実行されているインフラストラクチャがどのように実行されているかを理解するのに重要な役割を果たします。 問題が発生したときに問題を検出、調査、診断するのに役立ちます。 このレベルの可視性を提供するために、Azure では、Azure <a href=\"https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview\">Monitor</a> を介して<a href=\"https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics\">リソース レベルのプラットフォーム メトリック</a>を使用できるようになりました。 ただし、多くのユーザーは、より多くのメトリックを収集し、ハイブリッド環境で実行しているリソースとアプリケーションに関するより深い洞察を得る必要があります。</p>\n\n<p>これを実現するために、<a href=\"https://docs.microsoft.com/azure/application-insights/app-insights-overview\">アプリケーション インサイト</a> SDK を介してアプリからカスタム メトリックを送信できました。 現在、Azure Monitor でカスタム メトリックのパブリック プレビューを発表し、任意の場所で収集された任意の Azure リソースに対してメトリックを送信できるようになりました。 これらのメトリックは、リソースに関するメモリ使用率などの追加のパフォーマンス インジケーターになる場合があります。ページの読み込み時間など、アプリケーションによって出力されるビジネス関連のメトリック。 <a href=\"https://aka.ms/AzureMonitor/FullStackMonitoring\">Azure Monitor の統合メトリック エクスペリエンス</a>の一環として、次のことができます。</p>\n\n<ul>\n <li>最大 10 個のディメンションでカスタム メトリックを送信する</li>\n <li>名前空間を使用してメトリックを分類および分離する</li>\n <li>Azure Monitor を使用して統合されたメトリックとアラートエクスペリエンスのセットを活用する <ul>\n  <li>Azure Portal のグラフとダッシュボードで、リソース&rsquo; プラットフォームのメトリックと共にカスタム メトリックをプロットする</li>\n  <li>プラットフォーム メトリックと同じ <a href=\"https://docs.microsoft.com/rest/api/monitor/metrics/list\">REST API</a> のセットを使用してカスタム メトリックにアクセスする</li>\n  <li>Azure Monitor に出力されるカスタム メトリックに対してアラート ルールを作成して構成する。メトリックが持つディメンションをフィルター処理できるようにサポートが追加されました</li>\n </ul>\n </li>\n <li>1 分の粒度で保持されるカスタム メトリックの 3 か月間のリテンション期間</li>\n</ul>\n\n<p>カスタム メトリックは、いくつかの方法で Azure Monitor に送信できます。</p>\n\n<ul>\n <li>新しい<a href=\"https://docs.microsoft.com/en-us/rest/api/monitor/metrics%20(data%20plane)\">カスタム メトリック REST API</a> を使用してメトリックを送信する</li>\n <li><a href=\"https://docs.microsoft.com/azure/monitoring-and-diagnostics/azure-diagnostics\">Windows診断拡張機能</a> (WAD) を使用してWindows VM からメトリックを発行する</li>\n <li><a href=\"https://docs.influxdata.com/telegraf\">InfluxData Telegraf エージェント</a>を使用して Linux VM からメトリックを発行する</li>\n <li><a href=\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics\">Application インサイト SDK</a> を使用してアプリケーションをインストルメント化する</li>\n</ul>\n\n<p>Azure Monitor へのカスタム メトリックの出力を開始する方法について説明します。</p>\n\n<h2>Windows VM からメトリックを出力する</h2>\n\n<p>多くのユーザーは、Azure VM とクラシック Cloud Services上の Azure Diagnostics 拡張機能 (Windows と Linux) を使用して、詳細なゲスト OS レベルのパフォーマンス データを収集します。 以前は、これらの診断拡張機能を使用すると、Storage テーブルにデータを送信でき、これらのゲスト OS メトリックに対する一連のメトリック エクスペリエンスが制限されています。</p>\n\n<p>本日&rsquo;のリリースの一環として、Windows診断拡張機能をアップグレードし、パフォーマンス カウンターを Azure Monitor に直接送信するオプションを提供しました。 つまり、Azure Monitor エクスペリエンスと REST API を使用して、Windowsゲスト OS メトリックのディメンションをグラフ化、アラート、クエリ、フィルター処理できます。 <a href=\"https://aka.ms/VM/Windows-DiagExt-to-AzureMonitor\">診断拡張機能をインストールして構成</a>する方法に関するチュートリアルを公開しました。 Linux 診断拡張機能を使用した Azure Monitor へのゲスト OS メトリックの送信は、現時点では利用できませんが、近日公開予定です。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0c7b2772-2bc9-4168-a10d-a2de073a8ddf.jpg\"><img alt=\"Azure%20Monitor%20-%20VM%20Guest%20and%20Platform%20Metrics\" border=\"0\" height=\"821\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3fa4face-8f47-422f-b3a6-1a5a674d72bd.jpg\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Azure%20Monitor%20-%20VM%20Guest%20and%20Platform%20Metrics\" width=\"1406\"></a></p>\n\n<p align=\"center\"><em>Windows仮想マシンのゲスト OS メトリック (&lsquo;Memory/% Committed Bytes&rsquo;) とプラットフォーム メトリック (&lsquo;CPU&rsquo; の割合) が横並びでプロットされていることを示すグラフ</em></p>\n\n<h2 align=\"left\">InfluxDatas&rsquo; Telegraf プラグイン エージェントを使用して Linux VM からメトリックを出力する</h2>\n\n<p>&rsquo;Linux VM で実行されているワークロードのメトリックを収集できる、オープンソース監視ツールの豊富なエコシステムがあります。 <a href=\"https://docs.influxdata.com/telegraf/v1.7/\">Telegraf は、</a> このような一般的なオープンソース エージェントの 1 つです。 そのため、このエージェントの背後にあるチームである <a href=\"https://www.influxdata.com/\">InfluxData</a> のパートナーと協力して、Azure Monitor との統合を構築しました。</p>\n\n<p>Telegraf は、(VM で実行されている内容&rsquo;に応じて) 150 を超えるソースからのメトリックの収集を可能にするオープンソースプラグイン駆動型エージェントです。 これらのプラグインのほとんどはコミュニティによって貢献されています。これは、今後数か月でさらに多くのコレクターエージェントが利用可能になることを期待できることを意味します。 その後、エージェントは、出力プラグインを使用して任意の宛先に書き込むことができます。 エージェントはカスタム メトリック REST API と直接統合され、新しい &ldquo;Azure Monitor 出力プラグイン&rdquo;がサポートされるようになりました。 これにより、Telegraf エージェントをインストールし、ワークロードに関するメトリックを収集できます (例: MySQL、NGINX など)Linux VM 上で実行され、カスタム メトリックとして Azure Monitor に発行されるようにします。 これを自分で設定する方法の <a href=\"https://aka.ms/AzureMonitor/Telegraf-to-AzureMonitor\">簡単なチュートリアル</a> を次に示します。</p>\n\n<h2>Application インサイト SDK によって出力されるメトリックの統合エクスペリエンス</h2>\n\n<p>アプリケーション インサイトの一部として、&rsquo;常に Application インサイト SDK を使用してコードをインストルメント化し、アプリケーションに関する分析情報を収集し、カスタム メトリックとして出力する機能がありました。 そこから、ディメンションを分割してフィルター処理する機能を使用して、これらのメトリックに関するアラートを生成し、グラフをプロットすることができました。 今日、私たちはあなたにもディメンションに関するアラートを可能にしています。これは、アプリケーション インサイトによって出力されるすべての標準メトリックで自動的に使用できます。 カスタム メトリックのディメンションに対してアラートを有効にするには、Application インサイト コンポーネントの<a href=\"https://aka.ms/AppInsights/DimensionalAlerting\">簡単なオプトイン エクスペリエンス</a>があります。</p>\n\n<h2>価格</h2>\n\n<p>すべてのリソース レベルのプラットフォーム メトリックは、引き続き無料で利用できます。 Azure リソースに対して出力されるカスタム メトリックは従量制課金されます。 カスタム メトリックは、1 か月あたり最初の 150 MB は無料になり、その後、取り込まれたデータの量に基づいて測定の対象になります。</p>\n\n<p>アプリケーション インサイトのお客様は、現在の Application インサイト 価格モデルに基づいて引き続き従量制課金され、変更はありません。 カスタム メトリックに対するディメンション アラートの有効化は完全に省略可能です。この機能を選択すると、カスタム メトリックの測定が適用されます。</p>\n\n<p><a href=\"https://azure.microsoft.com/pricing/details/monitor/\">これらの機能の価格の詳細については、こちらを参照してください</a>。</p>\n\n<h2>まとめ</h2>\n\n<p>Azure では、Azure Monitor を使用してプラットフォーム メトリックを使用してリソースがどのように実行されているかを既に把握できます。 これで、アプリケーションとリソースに関する独自のカスタム メトリックを Azure Monitor に出力することで、これらのメトリックを補完できます。 この最初のリリースに興奮しており、今後数か月以内に、より多くの Azure リージョンでこれを利用できるようにし、さらに多くの機能を追加し、Azure Monitor 全体の他の機能でカスタム メトリックを利用できるようにします。 あなたがこれを試してみると、私たちはあなたから聞いてみたいです。コメントをお寄せください。または <a href=\"https://feedback.azure.com/forums/231545-diagnostics-and-monitoring\">、User Voice</a> にアクセスして、ご意見をお聞かせください。</p>\n"
}