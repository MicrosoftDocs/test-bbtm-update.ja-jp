{
    "Slug": "advancing-azure-virtual-machine-availability-monitoring-with-project-flash",
    "Title": "Project Flash を使用した Azure 仮想マシンの可用性監視の推進",
    "Summary": "Today, we’re excited to announce the completion of the project’s first two milestones—the preview of VM availability data in Azure Resource Graph, and the private preview of a VM availability metric in Azure Monitor.",
    "Content": "<p>&ldquo;<em><a href=\"https://www.aka.ms/AdvancingReliability\" target=\"_blank\">「信頼性の向上」ブログ シリーズ</a>の 4 暦年を迎える中で、組織が Azure でワークロードを確実に実行できるようにすることは、引き続き最優先事項の 1 つです。Microsoft は、これを日常的に実現するために Azure プラットフォームの進化に継続的に投資しています。堅牢で包括的な方法で仮想マシン (VM) の可用性を監視する機能は、アプリケーションが利用可能で回復力があることを保証するために最も重要です。このシリーズの今日&rsquo;の投稿では、Azure Core Platform Fundamentals Engineering チームの Program Manager <strong>Pujitha Desiraju</strong> に、VM の可用性監視に関する最新の監視機能の強化と、最適な監視エクスペリエンスを提供するための計画的な投資について話を依頼</em>しました。&rdquo;&mdash;Mark Russinovich、CTO、Azure</p>\n\n<hr>\n<p>&nbsp;</p>\n\n<p><em>この投稿は、 <strong>Gaurav Jagtiani</strong> のプリンシパル ソフトウェア エンジニアリング マネージャーが共同で作成しました。</em></p>\n\n<p>プロジェクトが内部的に知られている Flash は、Azure Engineering 全体の取り組みのコレクションであり、Azures&rsquo; 仮想マシン (VM) の可用性監視エコシステムを、特定の監視ニーズを満たすために信頼できる一元的で包括的でわかりやすいソリューションに進化することを目的としています。 本日は、&rsquo;プロジェクト&rsquo;の完了を最初に発表することに興奮しています。最初の 2 つのマイルストーン&mdash;は、<a href=\"https://azure.microsoft.com/features/resource-graph/\">Azure Resource Graph</a> での VM 可用性データのプレビューと、<a href=\"https://azure.microsoft.com/en-us/services/monitor/\">Azure Monitor</a> での VM 可用性メトリックのプライベート プレビューです。</p>\n\n<h2>Project Flash とは</h2>\n\n<p>Project Flash は、仮想マシン (VM) の可用性を可能な限&mdash;り包括的に監視するための堅牢で迅速な方法を構築するというコミットメントからその名前を導き出し、効率的なアプリケーション パフォーマンスを実現するための重要な前提条件です。 私&rsquo;たちの使命は、次のことを可能にすることです。</p>\n\n<ul>\n    <li>VM の可用性の中断 (VM の再起動と再起動、ネットワーク ドライバーの更新によるアプリケーションのフリーズ、30 秒のホスト OS の更新など) に関する<strong>正確で実用的なデータ</strong>と、正確なエラーの詳細 (たとえば、プラットフォームとユーザーによる開始、再起動とフリーズ、計画済みと計画外の比較など) を使用します。</li>\n    <li><strong>VM の可用性の傾向を分析してアラート</strong> を生成し、迅速なデバッグと月単位のレポートを作成します。</li>\n    <li><strong>大規模なデータを定期的に監視</strong> し、カスタム ダッシュボードを構築して、すべてのリソースの最新の可用性状態を常に最新の状態に保つ。</li>\n    <li>影響を受けた VM、ダウンタイムの原因と期間、その結果の修正、および同様&mdash;の内容を詳しく説明する<strong>自動根本原因分析 (RCA) を受け取り</strong>、ターゲット調査と事後分析を有効にします。</li>\n    <li>VM の可用性の重大な変更に関する<strong>瞬時の通知を受け取り</strong>、修復アクションを迅速にトリガーし、エンドユーザーへの影響を防ぎます。</li>\n    <li>変化し続けるワークロードの機密性とフェールオーバーのニーズに基づいて、<strong>プラットフォームの回復ポリシーを動的に調整および自動化</strong>します。</li>\n</ul>\n\n<p>これらの目標を念頭に置いて、&rsquo;現在の重要なニーズを満たすために実行戦略を 2 つのフェーズ&mdash;に分割し、最適な VM 可用性監視エクスペリエンスを提供するための長期的なフェーズを用意しました。 この 2 段階のアプローチは、ギャップを継続的に埋め、サービス品質を反復処理し、途中のすべてのステップでフィードバックから学習するのに役立ちます。</p>\n\n<h2>新しい監視オプションの発表</h2>\n\n<p>最初のフェーズでは、さまざまな監視ニーズに対応するために VM 可用性データへの便利なアクセスを可能にするさまざまなオプションを提供しています。 <a href=\"https://docs.microsoft.com/en-us/azure/service-health/resource-health-overview\" target=\"_blank\">Resource Health</a>や<a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log\" target=\"_blank\">アクティビティ ログ</a>など、既存のすべての機能とソリューションで同様の厳格な品質基準を満たすデータ整合性を維持し、選択したソリューションに依存しない一貫したビューを提供することを目指しています。</p>\n\n<h3>VM の可用性に関する大規模な分析の概要</h3>\n\n<p>現在、大規模なプログラムを使用するために、&rsquo;Azure Resource Graph での VM 可用性状態のプレビュー リリースにより、初めてのProject Flash マイルストーン&mdash;に到達することに興奮しています。</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/azure/governance/resource-graph/overview\" target=\"_blank\">Azure Resource Graph</a> は Azure のサービスであり、一度に低待機時間で、多くのサブスクリプションにわたってクエリを実行する効率的な機能に幅広く採用されています。 &rsquo;現在、Azure Resource Graph の Health Resources テーブルに <a href=\"https://docs.microsoft.com/en-us/azure/service-health/resource-health-overview#health-status\" target=\"_blank\">VM の可用性状態</a> (使用可能、利用不可、不明) が出力されているため、大規模なデータセットを一度に調べるための複雑な<a href=\"https://docs.microsoft.com/en-us/azure/data-explorer/data-explorer-overview\" target=\"_blank\">Kusto 照会言語 (KQL) クエリ</a>を実行できます。 この機能は、VM の可用性の履歴変更を追跡したり、カスタム ダッシュボードを構築したり、複数のテーブルに分散された多数のリソース プロパティに対して詳細な調査を実行したりするために便利です。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f4377708-8c04-45d9-835d-d5c503b8db87.png\"><img alt=\"Azure Resource Graph Explorer Window with query and results, to demonstrate fetching data from the HealthResources table.\" border=\"0\" height=\"449\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/550dc050-72b4-40b0-a5e5-df5af79f169c.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"図 1 ARG エクスプローラー ウィンドウ\" width=\"1024\"></a></p>\n\n<p><em><strong>図 1:</strong>クエリと結果を含む Azure Resource Graph エクスプローラー ウィンドウ。HealthResources テーブルからデータをフェッチする方法を示します。</em></p>\n\n<ol>\n</ol>\n\n<p>今年後半に、Azure Resource Graph の Health Resources テーブルに障害の詳細と機能低下した VM シナリオを追加する予定です。 これらの詳細により、障害&mdash;の原因と影響を適切に把握できるため、フェールオーバー、再起動、または適切な軽減策を講じてエンドユーザーへの影響を防ぐことができます。</p>\n\n<p>Azure portalの <a href=\"https://ms.portal.azure.com/#blade/HubsExtension/ArgQueryBlade/resourceType/Microsoft.Resources%2Fresources\" target=\"_blank\">Azure Resource Graph エクスプローラー</a>に移動して、<a href=\"https://docs.microsoft.com/en-us/azure/governance/resource-graph/samples/samples-by-table?tabs=azure-cli#healthresources\" target=\"_blank\">正常性リソース テーブルに対して発行された</a>KQLクエリの使用を開始します。</p>\n\n<h3>Azure Monitor での VM 可用性メトリックの概要</h3>\n\n<p>また&rsquo;、Azure Monitor で既定の VM 可用性メトリックのプライベート プレビューを発表し、メトリックアラートと監視エクスペリエンスをキュレーションすることにも満足しています。</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/data-platform-metrics\" target=\"_blank\">Azure Monitor のメトリック</a> は、VM の可用性の時系列表現の監視と分析に適しており、迅速で簡単なデバッグ、傾向に関するスコープ付きアラートの受信、可用性の低下の早期指標の把握、他のプラットフォーム メトリックとの関連付けなどに役立ちます。</p>\n\n<p>このメトリックを使用すると、予想される動作を保証する VM の&mdash;パルスを追跡できます。メトリックには値 1 が表示されます。 VM の可用性の中断に応じて、影響を受ける間、メトリックは 0 に低下します。 Azure インフラストラクチャが停止した場合、ポータルで点線として表される null を出力します。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/682a713e-22d0-4f16-8c2a-637804d289ae.png\"><img alt=\"Screenshot of VM availability metric as seen on Metrics Explorer in the Azure portal, with occasional dips to reflect VM availability disruptions.\" border=\"0\" height=\"445\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6800f334-da66-4a18-8b2a-2a10a6b1345a.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"VM 可用性メトリックのスクリーンショット\" width=\"1024\"></a></p>\n\n<p><em><strong>図 2:</strong>Azure portalのメトリック ス エクスプローラーに表示される VM 可用性メトリックのスクリーンショット。VM の可用性の中断を反映する場合があります。</em></p>\n\n<p>ロールアウト計画のフェーズ 1 としてメトリックのプライベート プレビューをリリースし、現在、お客様からのフィードバックを収集して、オファリングをさらに改善しています。 メトリック ディメンションやプラットフォーム ログなどのエラーの詳細を来年追加して、影響を与える障害シナリオを正確にアラートできるようにする予定です。</p>\n\n<h2>近日公開予定</h2>\n\n<p>上記で紹介した 2 つの監視オプションは、Project Flash の始まりにすぎません。 データの品質とエラーの属性を改善することで、既存のソリューションに基づいて構築し続けます。 並行して、待機時間と軽減のニーズを満たすために 2 つの新しい監視オファリングを設計すると同時に、障害検出の回復力と包括的性を高めるために、基になるプラットフォームに多額の投資を行っています。</p>\n\n<h3>瞬時通知のAzure Event Grid</h3>\n\n<p>ビジネス クリティカルなアプリケーションを正常に実行するには、VM の可用性に影響を与えるイベントをハイパー認識する必要があるため、修復アクションを瞬時にトリガーしてエンドユーザーの影響を防ぐことができます。 日々の運用をサポートするために、<a href=\"https://docs.microsoft.com/en-us/azure/event-grid/overview\" target=\"_blank\">Azure Event Grid</a>の待機時間の短いテクノロジを活用する通知メカニズムを設計する予定です。 これにより、 <a href=\"https://docs.microsoft.com/en-us/azure/event-grid/system-topics\" target=\"_blank\">単に Event Grid システム トピック</a>をサブスクライブし、 <a href=\"https://docs.microsoft.com/en-us/azure/event-grid/event-handlers\" target=\"_blank\">イベント ハンドラー</a> を介してスコープ付きイベントをダウンストリーム ツールに瞬時にルーティングできます。</p>\n\n<h3>プラットフォームの回復ポリシーを自動化して調整する</h3>\n\n<p>VM の可用性監視エクスペリエンスを向上させるための多数の継続的な投資を考慮すると、Project Flash では、VM の可用性の中断が発生した場合に応じて、プラットフォームによってトリガーされる回復ポリシーをカスタマイズするためのノブを提供することで、さらに多くの支援を行う予定です。</p>\n\n<p>私たちが設計しているそのようなノブの1つは、予期しない可用性の中断の特定のセットに応答して、単一インスタンスの VM に対して <a href=\"https://azure.microsoft.com/en-us/blog/service-healing-auto-recovery-of-virtual-machines/\" target=\"_blank\">Service Healing</a> をオプトアウトする機能です。 このノブは、ポータルまたは VM のデプロイ時に使用可能になり、動的に更新できます。 この機能を利用すると、通常の Azure 仮想マシンの可用性 SLA が無効になります。</p>\n\n<p align=\"left\">今後は、変化し続ける軽減策のニーズに簡単に適応できるように、他の適用可能な復旧ポリシー ( <a href=\"https://azure.microsoft.com/en-us/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/\" target=\"_blank\">ライブ マイグレーション</a> や <a href=\"https://azure.microsoft.com/en-us/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/\" target=\"_blank\">Tardigrade</a> など) もオプトアウトするためのノブの導入について説明します。</p>\n\n<h3>継続的なプラットフォーム品質投資</h3>\n\n<p>最初のフェーズは現在の観測ニーズを満たすように設計されていますが、VM の可用性を取り巻く世界クラスの観測エクスペリエンスを提供するという長期的な目標に引き続き焦点を当てています。 このエクスペリエンスに貢献するすべてのデータエンリッチメントとテクノロジの進歩に非常に興奮しているので&rsquo;、計画投資のロードマップを早期に見ていきます。</p>\n\n<ol>\n    <li><strong>障害検出と属性:</strong> Microsoft では、基礎となるインフラストラクチャを継続的に進化させ、エラーを正確かつ瞬時に&mdash;検出して属性付けしています。これにより、不明または不足している正常性状態レポートを減らし、実行可能なエラーの詳細を出力し、プラットフォームの回復のカスタマイズを処理できます。 これは、すべてのサイクルを繰り返し続ける当社のトップ投資領域です。</li>\n    <li><strong>根本原因分析 (RCA) 自動化:</strong> 独自の VM ダウンタイムごとに簡単な追跡メカニズムを実装し、詳細なダウンタイムの自動構築と詳細なダウンタイムの RCA ステートメントの放出と共に、最後の手動追跡とチャーンを減らすことを計画しています。</li>\n    <li><strong>AIOps 統合:</strong> Microsoft では、VM の可用性に関する多数のデータ ポイントでスマートな分析情報と異常検出と診断を可能にするために、Microsoft 全体で <a href=\"https://azure.microsoft.com/en-us/blog/advancing-azure-service-quality-with-artificial-intelligence-aiops/\" target=\"_blank\">AIOps で行われている</a> 大きな進歩を活用することを目指しています。</li>\n    <li><strong>一元化されたまとまりのあるユーザー エクスペリエンス:</strong> 私たちは、近い期間のアプローチの結果として、異なるサービス間で複数の監視、アラート、および回復ツールが用意されているため、混乱を招き、異なるエクスペリエンスが発生する可能性があることを認識しています。 これは、最終的なフェーズで解決する予定の問題です。 私たちの北の目標は、エンドユーザーに VM の可用性の明確で必要な表現へのアクセスを提供し、 <a href=\"https://azure.microsoft.com/en-us/services/monitor/\" target=\"_blank\">Azure Monitor</a> 内に統合し、検出可能性、使いやすさ、直感的なオンボードのための一般的な使用パターンに従って分類することです。</li>\n</ol>\n\n<h2>詳細情報</h2>\n\n<p>長期的な戦略の一環として複数のエンリッチメントが計画されているため、このリストは確かに網羅的ではありません。 繰り返しになりますが、Project Flash の意図は、VM 可用性の監視を非常に直感的で包括的でシームレス&mdash;にすることです。そのため、ワークロードの正常性に関する変更に対して常に準備し、情報を得て、最終的には独自の SLA とビジネス上の約束を維持します。</p>\n\n<p>最新の状態を維持するために、このようなブログを通じてProject Flash の更新を引き続き共有します。 ご期待ください。</p>\n"
}