{
    "Slug": "ai-helped-troubleshoot-an-intermittent-sql-database-performance-issue-in-one-day",
    "Title": "AI は、断続的なSQL Databaseパフォーマンスの問題を 1 日でトラブルシューティングするのに役立ちます",
    "Summary": "In this blogpost, you will learn how Azure SQL Database intelligent performance feature Intelligent Insights has successfully helped a customer troubleshoot a hard to find 6-month intermittent database performance issue in a single day only. ",
    "Content": "<p>このブログ投稿では、インテリジェント なパフォーマンス機能Azure SQL Database<a href=\"https://docs.microsoft.com/en-us/azure/sql-database/sql-database-intelligent-insights\" target=\"_blank\">インテリジェント インサイト</a>が、1 日だけで 6 か月間の断続的なデータベース パフォーマンスの問題を見つけるのが困難なトラブルシューティングにどのように役立ったかについて説明します。 インテリジェント インサイトは、データベースフリート全体で関連するパフォーマンスの問題を特定することで、ISV が 60,000 データベースを運用するのにどのように役立つのかを確認します。 また、インテリジェント インサイトが、大規模な 35 TB データベースフリートでパフォーマンス低下の問題をトラブルシューティングするのが難しい場合を企業がシームレスに特定するのにどのように役立つかについても説明します。</p>\n\n<p>最もインテリジェントなクラウド データベースであるAzure SQL Databaseは、小規模および中規模のビジネスと大企業が、Azure が最小限の人間の操作または高度な技術スキル セットを使用して、実行、スケーリング、およびピーク パフォーマンスの維持を自律的に処理することを委託しながら、優れたアプリケーションの作成に集中できるようにします。</p>\n\n<p>インテリジェント インサイトは、人工知能 (AI) の能力を活用して、特定の精度で、かつ大規模な大規模なAzure SQL Databaseパフォーマンスの問題を継続的に監視およびトラブルシューティングする、新しい破壊的インテリジェント パフォーマンス テクノロジです。 数百万のAzure SQL データベースの大規模なワークロード プールからの学習に基づいて微調整および高度なソリューションのパフォーマンス <a href=\"https://docs.microsoft.com/en-us/azure/sql-database/sql-database-intelligent-insights-troubleshoot-performance\" target=\"_blank\">トラブルシューティング モデル</a>。</p>\n\n<p>2017年9月のパブリックプレビューデビュー以来、インテリジェントなインサイトでお客様の成功事例をいくつか目の当たりにしました。</p>\n\n<h2>断続的なSQL Databaseパフォーマンスの問題が見つからないトラブルシューティング</h2>\n\n<p><a href=\"https://neworbit.co.uk/\" target=\"_blank\">NewOrbit</a> は、英国に拠点を置く ISV であり、スタートアップ企業や企業向けに Azure でソフトウェアを構築および実行しています。これには、従業員とテナントのバックグラウンド チェックシステムが含まれます。 毎年何千人もの顧客が 40 万人以上のユーザーを確認しており、さまざまなサービスからの情報を統合することでシステムによって行われます。 NewOrbit は Azure 上で完全に実行され、約 200 SQL データベースを使用します。 NewOrbit には、開発者と顧客アカウント マネージャーのみで構成されるフラットな組織構造があります。 NewOrbit CTO Frans Lytzen が Azure&rdquo; を持っていると言&ldquo;っているので、DevOpsチームや DBA は組み込みのインテリジェンスSQL Database使用して自動的にチューニングし、トラブルシューティングを行います。</p>\n\n<p>NewOrbit では、約 6 か月間続く断続的なパフォーマンスの問題が発生し、運用環境で実行されている既存のシステムのタイムアウトが増加しました。 彼らの最初の反応は、より多くの容量を持つ Azure 上のより高い価格レベルにアップグレードすることでしたが、これは役に立たず、彼らには非常に奇妙に思えました。 &rsquo;Azure サブスクリプションで十分以上の予備の DTU が見られたため、NewOrbit は容量をダイヤルアップすると問題が解決されないことをすぐに理解しました。</p>\n\n<p>NewOrbit は、インテリジェント インサイトを試すことにしました。 ソリューションを起動するとすぐに、データベースにメモリ不足があるようです。 これはすぐには明らかではなく、NewOrbitはメモリ不足が原因ではなく、他の根本的な問題の影響である可能性が最も高いと理解していました。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d383494b-e8f2-4b32-a450-1eb5755f174d.png\"><img alt=\"image_000\" border=\"0\" height=\"622\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fba91a9f-1d3b-458b-a937-9e8eab00676a.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"image_000\" width=\"977\"></a></p>\n\n<p>インテリジェントなインサイトがオンになってから 1 日以内に、メモリ不足の根本原因として疑われるクエリがいくつか存在すると指摘されています。 NewOrbit は即座に修正され、次の日にメモリ不足が即座に減少することを監視する新しいクエリを運用環境にデプロイしました。</p>\n\n<p><em>&ldquo;以前の機会に、約 6 か月間のパフォーマンスの問題が発生しました。インテリジェントインサイトの前に、トラブルシューティングを開始する場所を把握する方法がありませんでした。インテリジェントなインサイトは、私たちにやっておくべきことのリストを与えました。Intelligent Insight の機能は、問題がどこにあるかを特定し、24 時間以内に修正プログラムをデプロイできることです。&rdquo;</em></p>\n\n<p align=\"right\">Frans Lytzen、CTO、NewOrbit。</p>\n\n<p>NewOrbit がサービスとして成長するにつれて、データベースとクエリが大きくなり、複雑さが増しています。 インテリジェントなインサイトに依存する継続的改善プログラムを実装し、アプリケーションのパフォーマンスを最大限に高めるためにデータベース クエリを定期的にレビューおよび最適化しました。</p>\n\n<h2>60,000 SQL データベースの海でのパフォーマンスの問題を特定する</h2>\n\n<p><a href=\"https://docs.microsoft.com/en-us/azure/sql-database/sql-database-implementation-snelstart\" target=\"_blank\">SnelStart</a>はオランダのISVで、記帳、請求、会計などの財務オンライン サービスを提供する中小企業向けの SaaS サービスを開発および実行しています。 SnelStart は、約 64,000 人の顧客にサービスを提供するために Azure に依存しています。 基になるインフラストラクチャは、主にエラスティック プール内で 60,000 以上のSQL データベースを採用しています。 大規模なデータベースを大規模に維持し、顧客の問題に迅速に対応することは、特にサービスの低下や停止の場合は、SnelStart にとって不可欠です。</p>\n\n<p>このような大量のデータベースを維持するには、通常、大規模な DBA チームとDevOps チームが必要です。 顧客が電話でサービスが遅いか利用できないという苦情を電話で呼び出したら、SnelStart チームは問題を迅速に特定し、解決に取り組む必要があります。 同社は、最初に顧客からパフォーマンスや利用できない問題について知るケースが数多くありました。 SnelStart は、応答時間の向上を期待して、インテリジェント インサイトをパフォーマンス監視ツールとして使用することを決定しました。</p>\n\n<p>SnelStart は、ソリューションを毎日使用して、CPU 制限に達しているエラスティック プールを特定します。 この組み込みインテリジェンスは、使用率が高いエラスティック プール内の上位の消費データベースを特定するのに役立ち、ホット データベースを移動できる十分な容量を備えた他のエラスティック プールの提案を提供します。 SnelStart は、DevOps戦略として、高消費データベースを移動する各論理サーバーに個別のエラスティック プールを作成しました。 これにより、会社は実行時間の遅いクエリやその他のデータベースの問題を、修復されるまで<a href=\"https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-sql\" target=\"_blank\">Azure SQL Analytics</a> の助けを借りて調査できます。 ホット データベースのパフォーマンスが向上すると、SnelStart は通常、元のエラスティック プールに戻します。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fb074cfc-683d-47f4-af35-603cf729ef2b.png\"><img alt=\"image_002\" border=\"0\" height=\"448\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a8d922da-0a18-4afb-9252-19f42d316f7a.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"image_002\" width=\"1085\"></a></p>\n\n<p>インテリジェント インサイトの助けを借りて、SnelStart はインスタンスの 1 つでも、開発者が問題の根本原因を手動でトラブルシューティングする前に、データベースロックの原因となっているアプリケーション クエリをすばやく特定できました。 問題の修正プログラムは数分以内に展開され、顧客が大規模な影響を受けます。 さらに、サービスのパフォーマンスに関する顧客の電話は受信されませんでした。</p>\n\n<p>これは、サービス監視がリアクティブからプロアクティブに移行し、組み込みのインテリジェントなパフォーマンスに依存するため、会社にとってまったく新しいタイプの機能SQL Databaseしました。</p>\n\n<p><em>&ldquo;インテリジェントなインサイトは、データベースのパフォーマンスの問題を人間よりもはるかに効率的かつ迅速に事前に見つけます。これを使用すると、問題の修正が完了するまで、お客様を積極的に支援できます。&rdquo;</em></p>\n\n<p align=\"right\">Bauke Stil、アプリケーション マネージャー、SnelStart。</p>\n\n<p>SnelStart は、60,000 SQL データベースの海でデータベース パフォーマンスの問題を自動的に検出する効率に感銘を受けました。 顧客データベースはすべて同じ構造であるため、このソリューションを使用して、データベースフリート全体の一般的なパフォーマンスの問題を特定して解決しています。 1 つのデータベースで問題が特定されると、すべての SnelStart のお客様にすぐに利益をもたらす修正プログラムがすべてのデータベースに展開されます。</p>\n\n<h2>大規模な 35 TB SQL Databaseフリートでのロックの問題の検出</h2>\n\n<p><a href=\"https://visualstudio.microsoft.com/tfs/\" target=\"_blank\">Microsoft TFS</a> は、開発者コミュニティとお客様をサポートするオンライン サービスを提供します。 これは、顧客ベース全体で数兆行のコードを処理する複雑なシステムです。 このサービスは、高度なレポート、ビルド、ラボ、テスト、チケット作成、リリース自動化管理、プロジェクト管理 &ndash; などを提供します。 TFS では、24 時間 365 日のサービスをグローバルに最高のパフォーマンスで提供することが不可欠です。 コードをクリックしてチェックインするか、TFS チケットを作成している場合は、サービスからのプロンプト応答が必要です。 TFS の大規模なインフラストラクチャは、約 900 SQL データベースで実行され、合計 35 TB のデータが格納されます。</p>\n\n<p>TFS は以前、低速のクエリと高い CPU 期間を監視できる独自の監視およびアラート ソリューションを使用してきました。 ある場合、既存のツールはパフォーマンスの問題を特定し、データベースに重いロックが存在するが、それ以外は何も存在しないという浅い分析のみを提供しました。 さらにトラブルシューティングを行った結果、ロックのスコープがテーブルであり、ロック パーティション分割に関連したことが示されています。 つまり、統計に表示される影響を受ける低速クエリは、通常、ロックの根本原因ではなく、ロックを引き起こしている他のブロック クエリの表面的な影響にすぎません。 このような場合のワークロードは積み上げ続けているため、大規模なリソース プールへのアップグレードは有効期間の短いソリューションに過ぎません。 これの唯一の方法は、ブロックしているクエリを見つけて修正することでした。</p>\n\n<p>このような場合のトラブルシューティングは、かなりの DBA スキルを必要とし、非常に時間がかかるため、通常は非常に困難です。 TFS は、パフォーマンスのトラブルシューティングの自動化に役立つインテリジェントなインサイトに変わりました。 この特定のケースでは、システムはワークロードの増加に関連するアプリケーションを特定し、影響を受けるクエリとブロックしているクエリの一覧を提供しています。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0c6bb9ff-07bc-40b6-a0d5-abbb8f7a85ae.png\"><img alt=\"image_003\" border=\"0\" height=\"382\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/63f54d00-ffce-4beb-b91c-9be439ad05c1.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"image_003\" width=\"974\"></a></p>\n\n<p>ブロック クエリの分析では、これは、未使用の添付ファイルを削除するために定期的にスケジュールされたメンテナンス クエリであることを確認しました。 さらにコードを分析すると、削除バッチのサイズが大きすぎることが問題の原因であると判断されました。 バッチ サイズが小さい新しいクエリが迅速にデプロイされ、負荷の高いロックを解決し、ワークロードの負荷を徐々に軽減する効果が即座に得られました。</p>\n\n<p>TFS の要求の厳しいインフラストラクチャを維持するには、このジョブに最適な Microsoft エンジニアの一部が必要です。 私たちは確かに彼が言う聞いて、TFSのプリンシパルソフトウェアエンジニア、Microsoft、Remi Lemarchandで最高のSQLパフォーマンスのトラブルシューティングツールの一つでバーに会いました:</p>\n\n<p><em>&ldquo;インテリジェントなインサイトは、データベースパフォーマンスの問題を見つけるのに最適な仕事をします。私はそれがその場で常に右見つけます!&rdquo;</em></p>\n\n<p align=\"right\">Remi Lemarchand、プリンシパル ソフトウェア エンジニア、Microsoft TFS。</p>\n\n<p>Remiは、インテリジェントなインサイトを使用してデータベースのパフォーマンスの問題をトラブルシューティングしてから、他のツールに移行する前に、それが提供する深さのレベルと必要な手動DBEAトラブルシューティング時間の大幅な短縮を優先すると結論付けます。 ブロッククエリに修正を適用するので、データベースはうまく機能しています。</p>\n\n<h2>まとめ</h2>\n\n<p>AI とAzure SQL Databaseの結婚により、これまで不可能であったインテリジェント パフォーマンスの破壊的新機能が生み出されました。 小規模および中規模のビジネスでは、小規模なクルーを含む大規模な Azure でより多くの作業を行えるようになり、独自のインフラストラクチャを実行する場合に比べて大幅に低コストになります。 大規模な企業や企業は、インテリジェントなパフォーマンスをSQL Database、1 日に数万のデータベースの運用上の問題を特定するのに役立ち、場合によっては数か月に比べて、DBA やDevOpsからの負担を軽減できます。</p>\n\n<p>SQL Databaseインテリジェント インサイトを使用してパフォーマンスの問題をトラブルシューティングするには、「<a href=\"https://docs.microsoft.com/en-us/azure/sql-database/sql-database-intelligent-insights\" target=\"_blank\">Log Analytics を使用したインテリジェントなインサイトのセットアップ</a>」を参照してください。</p>\n\n<p>インテリジェント パフォーマンス製品SQL Database関連する場合は、「<a href=\"https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-sql\" target=\"_blank\">Azure SQL Analytics を使用したAzure SQL データベースの監視</a>」および「<a href=\"https://docs.microsoft.com/en-us/azure/sql-database/sql-database-automatic-tuning\" target=\"_blank\">Azure SQL Databaseの自動チューニング</a>」を参照してください。</p>\n\n<p>インテリジェントなパフォーマンスが役立つSQL Databaseどのように思い描いているか教えてください。</p>\n"
}