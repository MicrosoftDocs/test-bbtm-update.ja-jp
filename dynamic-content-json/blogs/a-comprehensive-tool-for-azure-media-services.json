{
    "Slug": "a-comprehensive-tool-for-azure-media-services",
    "Title": "Azure Media Servicesのための包括的なツール",
    "Summary": "With most of the key components of Azure Media Services currently or soon to be in GA (General Availability), the author would like to share his comprehensive AMS tool.",
    "Content": "<a href=\"https://azure.microsoft.com/en-us/services/media-services/\">Azure Media Services</a> (AMS) でプロフェッショナル グレードのオンライン ビデオ ストリーミング ソリューションを構築する場合、さまざまなデータ フローがあります。 ライブ ストリーミングを例として見てみましょう。\n<ol>\n <li>最初に最も重要なのは、キャプチャ、フィードの長距離、エンコード、AMS への取り込み、アーカイブ、動的パッケージ化/保護、CDN、最終的にクライアント プレイヤーに到着するビデオ フローです。 画面にきれいな写真を置くことは最初の部分だけであり、最も難しい部分ではないかもしれません。 実際に画面上にきれいな写真を表示することは\"簡単\"であり、\"ハード\"とは、\"きれいな画像を表示しない\"方法(DRM保護)、およびユーザーがきれいな画像以外のものを見できるようにする方法です(動的に挿入された広告、CC、ゲームスコアやアスリート情報などのメタデータ、緊急のお知らせ、天気遅延メッセージなど)</li>\n <li>2つ目は、広告マーカーの挿入から、ストリーミング形式に基づいて広告マーカーを異なるSCTE形式に動的にパッケージ化すること、プレイヤーが広告マーカーを解析すること、次に広告の決定と広告配信、最後に広告の再生までです。</li>\n <li>CCフロー:テキストコンテンツが生成され、投稿フィードに追加され、ビデオコンテンツを含むパス全体を流れます。</li>\n <li>メタデータ フロー: 最初に、さまざまなサブシステムで生成されるメタデータ、Web ポータルに流れるコンテンツ管理ストレージ、およびクライアント プレーヤーに追加され、表示やその他の目的 (フェールオーバーなど) が行われます。 たとえば、AMS で資産を発行し、そのストリーミング URL を生成した後、URL はすべて自動化された統合された方法で、次の方向に流す必要があります。\n<ul>\n <li>URLは、エンドユーザーの閲覧、検索、再生のために顧客のビデオポータルをフィードするCMSデータベースに流される必要があります。</li>\n <li>URL は、メタデータの 1 つの部分として顧客の広告プロバイダーにフローする必要があります。</li>\n <li>URL は、配信元の問題が発生した場合にプレイヤーがフェールオーバーするためのプライマリ URL やセカンダリ URL など、ビデオ プレーヤー クライアントにメタデータを提供するエンドポイント (WebAPI サービスなど) にフローする必要があります。</li>\n</ul>\n</li>\n <li>コンテンツ保護フロー: コンテンツ キーの生成、動的コンテンツ保護の設定、認証トークンの発行、DRM ライセンスまたは復号化キーの配信、最後にクライアント プレーヤーでのコンテンツの暗号化解除まで。</li>\n <li>分析フロー: クライアント プレーヤーからクラウド内のデータ集計、その他のフローを制御する意思決定、または表示用のフロントエンドまで</li>\n <li>アカウントのプロビジョニング、課金、エンドユーザー向けのポータル、ユーザー認証、承認、EPG (電子プログラミング ガイド)、および OTT シナリオでより重要な EMS は含まれていません。</li>\n</ol>\nこれらのデータ \"フロー\" はすべて、(サブシステム間で) 適切な方向に(オーディエンス サイズ/需要、ネットワーク帯域幅、クライアント CPU に基づいて) 適切な速度で移動し、適切な時点 (秒またはフレーム精度レベルまで) に目的地に到着する必要があります。 したがって、これらすべての \"フロー\" を連携させるためには、これらの \"フロー\" を制御する \"コントローラー\" が必要です。 多くの場合、この \"コントローラー\" を CMS と大まかに呼びます。\n\nこのような CMS をより迅速かつ優れた方法で構築するにはどうすればよいでしょうか。 何か活用できるものはありますか?\n\nAzure Media Servicesでビデオ ソリューションを構築する場合、次のシナリオが発生する可能性があります。\n<ol>\n <li>顧客は、自動化されたワークフローのために既存のシステムと統合された CMS ツールを構築することを選択できます。</li>\n <li>Azure Media Servicesに基づいてビデオ ソリューションを構築するお客様を支援するシステム インテグレーター (SI) は、そのようなプロジェクトをゼロから開始する必要がないように、パッケージ化された SDK またはソフトウェア フレームワークを構築することを選択できます。 このアプローチにより、市場投入までの時間が短縮され、プロジェクトの配信が繰り返し可能になり、SI の市場競争力が高くなります。</li>\n</ol>\nこのような状況では、顧客/SIs に必要なものは、人間のためのスタンドアロン ツールではなく、自動化されたワークフローを使用して完全に統合されたソリューションを構築するためのより高速な方法である可能性があります。 作成者は、このようなソリューションで使用されているツールセットを共有したいと考えます。 コードは、シナリオ ベースの方法で構成されます。 このツールセットの値は、ソース コードを使用可能にすることです。 ソース コードは、サンプル コードとして使用することも、ソリューション内で直接使用することも、そのようなソリューションの設計と計画に活用することもできます。\n\nソース コードは、MIT ライセンスの下で OSS リリース用の Microsoft LCA によって承認されており、<a href=\"https://github.com/MicrosoftDX/AMSOpsTool\">GitHub</a>にあります。\n\nこれは包括的なツール セットであり、Azure Media Servicesのすべての重要な領域について説明します。\n<ol>\n <li>ライブ</li>\n <li>VOD</li>\n <li>Live-to-VOD 管理とライブ アーカイブ診断</li>\n <li>PlayReady 保護 (ライブと VOD の両方)</li>\n <li>AES-128 暗号化 (ライブと VOD の両方)</li>\n <li>広告の挿入 (Aventus ライブ エンコーダーの場合)</li>\n</ol>\nこのツールに含まれる機能は、実際のソリューション/ユース ケースに基づいています。 このツールは\"戦闘テスト済み\"です。\n<ol>\n <li>このツールは、Azure Media Servicesのリリース サインオフ テスト プロセスの一環として、NBC スポーツ ソリューションのシナリオをテストするために使用されます。</li>\n <li>このツールは、iStreamPlanet CMS ツールの準備が整う前に <a href=\"https://www.nbcsports.com/\">、NBC スポーツ イベントのライブ ストリーミング</a> に使用されました。</li>\n <li>このツールは、NBC スポーツと Deltatre (診断機能) の両方でソチ オリンピックストリーミングをサポートするために広く使用されました。</li>\n <li>このツールは、<a href=\"https://news.microsoft.com/2014/02/06/nbc-olympics-production-of-the-2014-olympic-winter-games-to-utilize-microsoft-for-live-and-on-demand-streaming/\">NBCスポーツ/ソチオリンピックプロジェクト</a>のエンジニアリングプロセスを通じて、北米、ヨーロッパ、アジアの15ベンダーが使用する24時間365日のライブストリーミングエンジニアリング環境を運営するために使用されました。</li>\n <li>このツールは、<a href=\"https://news.microsoft.com/2014/02/06/nbc-olympics-production-of-the-2014-olympic-winter-games-to-utilize-microsoft-for-live-and-on-demand-streaming/\">NBCスポーツ/ソチオリンピックプロジェクト</a>のVODサブシステムのために、<a href=\"https://msdn.microsoft.com/en-us/library/azure/dn673582.aspx\">Azure Media Processors</a>とカヤックメディアプロセッサの両方でのすべてのVODトランスコードワークフローパフォーマンステストに使用されました。</li>\n <li>このツールのソース コードの大部分は、<a href=\"https://news.microsoft.com/2014/02/06/nbc-olympics-production-of-the-2014-olympic-winter-games-to-utilize-microsoft-for-live-and-on-demand-streaming/\">NBC スポーツ/ソチ オリンピック ソリューション</a>を運用するための CMS ツールを開発するために <a href=\"https://www.istreamplanet.com/\">iStreamPlanet</a> と共有されています。</li>\n <li>このツールのソース コードの一部は、ソチ オリンピック プロジェクト中にいくつかの重要な機能について <a href=\"https://www.deltatre.com\">Deltatre</a> と共有されています。</li>\n <li>このツールは、 <a href=\"https://azure.microsoft.com/blog/2014/11/17/an-end-to-end-prototype-of-playready-protection-with-acs-authentication-and-acs-token-authorization/\">エンドツーエンドの PlayReady 保護プロトタイプ</a> とエンドツーエンド <a href=\"https://azure.microsoft.com/blog/2014/11/26/an-end-to-end-prototype-of-aes-encryption-with-acs-authentication-and-acs-token-authorization/\">の AES 暗号化プロトタイプ</a>を作成するためにも使用されました。</li>\n</ol>\n&nbsp;\n<h1>機能のハイライト</h1>\nこのツールの範囲と機能を強調するために、 <a href=\"https://news.microsoft.com/2014/02/06/nbc-olympics-production-of-the-2014-olympic-winter-games-to-utilize-microsoft-for-live-and-on-demand-streaming/\">NBC スポーツ/ソチ オリンピック ソリューション</a>などの実際のソリューションで使用されるこのツールの機能のサブセットを示します。これは、NBC スポーツが毎日のスポーツ ストリーミングに使用する基幹業務 (LOB) ソリューションです。\n<h2>ACS 冗長性</h2>\nREST または .NET API に関係なく、すべての AMS API 呼び出しには有効な ACS ベアラー トークンが必要であり、この ACS トークンは AMS ACS から取得されます。 当然ながら、重要なライブ イベント中に 1 つの ACS インスタンスに依存することは望まれません。 ライブ イベント中に ACS トークンを取得できない場合は、メディア サービスのすべてのアクセス権が失われます。これは悲惨です。 このツールは、複数の AMS ACS インスタンス間の自動フェールオーバーの実装を提供し、\"優先 ACS\" で \"スティッキネス\" を提供します。 具体的には、このツールの ACS 冗長性機能は、 <a href=\"https://news.microsoft.com/2014/02/06/nbc-olympics-production-of-the-2014-olympic-winter-games-to-utilize-microsoft-for-live-and-on-demand-streaming/\">2014 ソチ オリンピックのライブ ストリーミング</a>を実行するのに十分な、次のライブ生産要件を満たしています。\n<table border=\"1\" width=\"719\" cellspacing=\"0\" cellpadding=\"2\">\n<tbody>\n<tr>\n<td valign=\"top\" width=\"193\"><b>要件</b></td>\n<td valign=\"top\" width=\"524\"><b>要件の詳細</b></td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>ACS 自動フェールオーバー</b></td>\n<td valign=\"top\" width=\"524\">現在の ACS が失敗したときに、他の ACS に自動的に切り替えられる必要があります。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>ACS トークンの再利用</b></td>\n<td valign=\"top\" width=\"524\">Media Services SDK 3.0 の新機能を使用する必要があります。ACS トークンの有効期限が切れていない場合は、CloudMediaContext の作成で再利用します。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>ACS トークンの自動更新</b></td>\n<td valign=\"top\" width=\"524\">ACS トークンの有効期限が切れている場合は、まず ACS トークンを更新してから、CloudMediaContext を作成します。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>複数のコンテキスト インスタンスをサポートする</b></td>\n<td valign=\"top\" width=\"524\">複数のメディア サービスと対話する必要があるため、アプリケーションは CloudMediaContext の複数のインスタンスと対話できる必要があります。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>SDK の変更に関する将来の対応</b></td>\n<td valign=\"top\" width=\"524\">今後の AMS SDK リリースでは、CloudMediaContext コンストラクターで ACS トークンが更新されない可能性があります。 コードで ACS トークンの有効期限チェックと ACS トークンの更新を実行する必要があります (ACS トークンの手動更新)。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>ACS \"スティッキネス\"</b></td>\n<td valign=\"top\" width=\"524\">フェールオーバーを待機するのではなく、使用可能な限り\"優先\" ACS インスタンスを使用する必要があります。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>ACS インスタンスのサポート</b></td>\n<td valign=\"top\" width=\"524\">すべての AMS ACS インスタンスをサポートする必要があります。</td>\n</tr>\n<tr>\n<td valign=\"top\" width=\"193\"><b>単一 ACS のサポート</b></td>\n<td valign=\"top\" width=\"524\">SwitchACSEnabled と PreferredACSEnabled の設定を false に設定すると、1 つの ACS インスタンスを使用できます。 一部の環境では、1 つの AMS ACS インスタンスのみが使用できます。</td>\n</tr>\n</tbody>\n</table>\n&nbsp;\n<h2>Azure BLOB を AMS 資産に変換する</h2>\n多くの場合、物理ビデオ ファイルは Azure Storage に BLOB として格納されており、AMS IAsset に変換する必要があります。 このツールは、次のシナリオでの変換を提供します。\n<ol>\n <li>BLOB は、作業中のメディア サービスに関連付けられているストレージ内にあります。</li>\n <li>BLOB は、使用しているメディア サービスに関連付けられていないストレージ内にあります。</li>\n</ol>\n&nbsp;\n<h2>CDN用のデータ センター間での一貫性のある URL の作成</h2>\nAMS のライブ プログラムの URL は、次の形式です:https://[origin_name]-[media_service_name].streaming.mediaservices.windows.net/[locator_id]/[manifest_file_name].ism たとえば、 <a href=\"\"></a> ロケーター ID は生成された GUID です。 冗長性のために 2 つのデータ センターを使用する場合、同じライブ チャネルとプログラムの場合、2 つの URL はホスト名部分でのみ異なり、仮想パスでは同一である必要があります。 そのためには、2 つの異なるデータ センターに 2 つの対応するプログラムを作成する場合、ロケーター ID (そのため、ロケーター パス) がまったく同じで、マニフェスト ファイル名がまったく同じである必要があります。 このツールは、ライブ ストリーミング用のプログラムを作成する際にこの機能を提供します。\n<h4></h4>\n<h2>指定したStorageでのプログラムの作成</h2>\nAzure Media Servicesでは、1 つのメディア サービスに複数の Azure ストレージを使用できます。 信頼性を高める目的で、メディア サービスでは、ライブ アーカイブまたはオンデマンド資産を格納するために、基になる複数の Azure BLOB ストレージを使用できます。 このツールを使用すると、プログラムの作成時に使用するストレージを指定できます。 これにより、複数の同時チャネルが複数の BLOB ストレージにアーカイブ負荷を分散できます。\n<h4></h4>\n<h2>ライブ アーカイブ診断</h2>\nこのツールは、通常の操作に加えて、ライブ ストリーミングとライブ アーカイブの診断も提供します。 ライブ ストリーミング中およびライブ ストリーミング後に、ライブ アーカイブの問題をすばやく検出できます。 たとえば、ツールは次の問題を診断して報告できます。\n<ol>\n <li>ライブ アーカイブの \"ジャグド スタート\" と、最初のフラグメントが不足している品質レベル。 ライブ アーカイブは、多くの場合、\"ジャグスタート\" を持っています。 WAMS チームによると、これはバグはほとんどありませんが、フラグメントが別の時刻に到着するためです。</li>\n</ol>\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/01/26/tool01.jpg\"><img style=\"padding-top: 0px; padding-left: 0px; padding-right: 0px; border: 0px;\" title=\"tool01\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/tool01_thumb.jpg\" alt=\"tool01\" width=\"767\" height=\"153\" border=\"0\" /></a>\n<ol>\n <li>Aventus フィードと Azure の取り込みの間のネットワーク遅延: Aventus バッファーからの遅延とバースト。 通常、6 秒の GOP を使用する場合、連続する fragblob 書き込みの時間差は 6 秒の近傍に存在する必要があります。 次の 2 番目の列は、2 つの連続する fragblobs - 6 秒の間の実際の時間差を示しています。</li>\n</ol>\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/01/26/clip_image005.jpg\"><img style=\"padding-top: 0px; padding-left: 0px; padding-right: 0px; border: 0px;\" title=\"clip_image005\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image005_thumb.jpg\" alt=\"clip_image005\" width=\"761\" height=\"304\" border=\"0\" /></a>\n<ol>\n <li>ライブ アーカイブに fragblobs がありません。2 つの連続する fragblob の開始時刻の差は、約 6 秒である必要があります。 それよりも大きい場合は、fragblobs がありません。</li>\n</ol>\n<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/01/26/clip_image007.jpg\"><img style=\"padding-top: 0px; padding-left: 0px; padding-right: 0px; border: 0px;\" title=\"clip_image007\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image007_thumb.jpg\" alt=\"clip_image007\" width=\"758\" height=\"262\" border=\"0\" /></a>\n<h4></h4>\n<h2>Content Protection</h2>\n<ol>\n <li>オンデマンド ストリーミングの動的 PlayReady 保護。</li>\n <li>ライブ ストリーミングの動的 PlayReady 保護。</li>\n <li>ストレージ暗号化を使用しない資産のオンデマンド ストリーミング用の動的 AES 暗号化。</li>\n <li>ストレージ暗号化を使用した資産のオンデマンド ストリーミング用の動的 AES 暗号化</li>\n</ol>\nコンテンツ保護には、動的保護/暗号化、ライセンス/キー配信、プレイヤー クライアントを認証し、承認トークン、配信元、プレーヤーを発行するための STS という複数のサブシステムがソリューションに含まれます。 <a href=\"https://azure.microsoft.com/blog/topics/media-services/\">Azure ブログ - Media Services</a>で公開されている、エンド ツー エンドのコンテンツ保護の設計と実装については、次の 2 つのブログを参照してください。\n<ol>\n <li><a href=\"https://azure.microsoft.com/blog/2014/11/26/an-end-to-end-prototype-of-aes-encryption-with-acs-authentication-and-acs-token-authorization/\">ACS 認証と ACS トークン承認を使用した AES 暗号化のエンド ツー エンド プロトタイプ</a></li>\n <li><a href=\"https://azure.microsoft.com/blog/2014/11/17/an-end-to-end-prototype-of-playready-protection-with-acs-authentication-and-acs-token-authorization/\">ACS 認証と ACS トークン承認を使用した PlayReady Protection のエンド ツー エンド プロトタイプ</a></li>\n</ol>\n2 つのエンド ツー エンドのプロトタイプ/設計が、SWT に加えて JWT トークン認証にアップグレードされていることに注意してください。\n<h3></h3>\n<h1>制限事項</h1>\nこのツールには制限があります。 主な制限事項は、ユーザー フレンドリ UI の欠如です。 このツールは、WindowsコンソールタイプのVisual Studioプロジェクト(1つはライブ用、もう1つはオンデマンド用、もう1つは広告マーカー挿入用)で、色分けされたUI用のカラーコンソールカスタムクラスです。 私は個人的にツールを使用する最も便利な方法は、\"ユーザーインターフェイスとしてVisual Studioを使用する\"(入力パラメータを変更し、コンパイルして実行する)ことです。 もちろん、この場合、ユーザーは基本的な C# 構文を理解する必要があります。 理想的な UI は、次に示す Web UI です。\n<ul>\n <li>Azure Active Directoryによって提供される認証。</li>\n <li>異なる顧客が独自のメディア サービスに対して使用できるようにマルチテナント。</li>\n <li>ユーザーがインストール/セットアップする必要がないように、Azure で SaaS としてホストされる</li>\n</ul>\nこの日は遠くないと思います。\n\n<b>承認：</b>特別な確認は、長年にわたって彼らの助けと洞察のためにAzure Media Servicesチームの多くのメンバーに行きます。"
}