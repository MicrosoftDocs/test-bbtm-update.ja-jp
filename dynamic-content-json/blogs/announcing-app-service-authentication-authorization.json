{
    "Slug": "announcing-app-service-authentication-authorization",
    "Title": "App Service認証/承認の展開",
    "Summary": "Today we are expanding the Authentication/Authorization feature for Azure App Service to include new identity providers, new sign-in options and greater flexibility in access control.",
    "Content": "<p>昨年のこの頃、同僚 <a href=\"https://azure.microsoft.com/en-us/blog/author/byvinyal/\">の Byron Tardif</a> が <a href=\"https://azure.microsoft.com/en-us/blog/azure-websites-authentication-authorization/\">Azure Websites の認証/承認</a>を紹介する投稿を作成しました。 この機能により、ユーザーは数回クリックするだけでAzure Active Directoryを使用してサイトをすばやく保護できます。 Weve&rsquo;は使いやすさについて多くの素晴らしいことを聞きましたが、多くのお客様は、特にAPIシナリオに関して、より柔軟性を求めています。</p>\n\n<p>その後、3月にAzure App Serviceを導入 Web Appsしました。API アプリとロジック アプリを 1 つのオファリングに含む。 これには、サイト間で共有認証を許可し、Mobile Servicesからのログイン サポートを拡張した App Service ゲートウェイが含まれていました。 ただし、お客様から聞いた重要な要求の 1 つは、個々のアプリケーション レベルでの認証の柔軟性を高めるというものでした。</p>\n\n<p>現在、これらのアプローチをマージし、App Serviceの認証/承認機能を拡張して、新しい ID プロバイダー、新しいサインイン オプション、アクセス制御の柔軟性を高めています。 これにより、お客様はゲートウェイの豊かさをすべて得られますが、サイトごとに管理エクスペリエンスが向上します。 今後は、App Service ゲートウェイではなく、Web アプリケーションとモバイル アプリケーションでこの機能を使用することをお勧めします。</p>\n\n<h2>作業の開始</h2>\n\n<p>App Service認証/承認は、Azure プレビュー管理ポータルで公開されます。 これを有効にするには、Web アプリまたはモバイル アプリの <strong>[設定</strong>] ブレードに移動し、[<strong>認証/承認]</strong> を選択します。 スイッチを [オン] に切り替えると、サイトを保護するためのオプションが表示されます。</p>\n\n<p><img alt=\"Enabling Authentication / Authorization\" border=\"0\" height=\"414\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/31481b46-df1f-40ef-9b30-77e003f6a3a3.png\" style=\"border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto\" title=\"認証/承認の有効化\" width=\"610\"></p>\n\n<p>主な変更の 1 つは、Azure Active Directoryだけでなく、Facebook、Google、Microsoft アカウント、Twitter を含むようにプロバイダーの選択を拡大したことです。 これらのオプションのいずれかをクリックすると、ユーザーがそのプロバイダーにログインできるようにする設定を構成できます。 Facebook と Microsoft アカウントのブレードでは、ログイン時に要求できるオプションのスコープの一覧も公開され、アプリケーションはユーザーに関する詳細情報を取得できます。</p>\n\n<p><img alt=\"Facebook configuration settings\" border=\"0\" height=\"480\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/86a5fbae-f0c6-4b7a-8c25-ac6f23f56f0b.png\" style=\"border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto\" title=\"Facebook の構成設定\" width=\"460\"></p>\n\n<p>&nbsp;</p>\n\n<p>AADには複数のモードが用意されており、数回クリックするだけで <strong>Express</strong> オプションを使用して構成できます。 必要に応じて、[<strong>詳細設定</strong>] オプションを使用してAAD構成を手動で指定できます。 各プロバイダーの構成の詳細については、<a href=\"https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-active-directory-authentication/\">Azure Active Directory</a>、<a href=\"https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-facebook-authentication/\">Facebook</a>、<a href=\"https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-google-authentication/\">Google</a>、<a href=\"https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-microsoft-authentication/\">Microsoft アカウント</a>、<a href=\"https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-twitter-authentication/\">Twitter</a> の各トピックを参照してください。</p>\n\n<h2>遅延承認</h2>\n\n<p>多くのアプリケーションでは、アプリケーションのさまざまな部分に対してさまざまなアクセス制限があります。 おそらく、公開したい API もあればサインインを求める API もあるでしょう。 元の認証/承認の機能は、オール オア ナッシングで、すべてのサイトでログインを必要としています。 このオプションは引き続き存在しますが、アプリケーション コードでアクセスの決定をレンダリングすることもできます。 現時点では、これは、認証された場合にユーザー情報で ThreadPrincipal を設定するため、ASP.NET サイトで最適です。 その後、アプリケーションは保護が必要なアクションに対して [Authorize] 属性を使用できますが、他のアクションは許可されます。 他のプラットフォームを使用するアプリケーションでは、完全なサイト保護オプションを使用するか、Cookie またはトークンを手動で検証する必要があります。</p>\n\n<p>認証/承認を有効にすると、アプリケーション コードが既定でアクセスの決定を担当します。 サイトで認証されていないすべてのトラフィックを特定のプロバイダーにリダイレクトする場合 <strong>は、[要求が認証されていないときに実行するアクション</strong> ] ドロップダウンからそのプロバイダーを選択します。</p>\n\n<p><img alt=\"Selecting action for when client is unauthenticated\" border=\"0\" height=\"144\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/70dbfbc0-04f1-4fe2-99df-ba809e03d1c4.png\" style=\"border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto\" title=\"クライアントが認証されていない場合のアクションの選択\" width=\"480\"></p>\n\n<p>一度に複数の ID プロバイダーを構成することもできますが、完全なサイト保護用に構成できるのは 1 つだけです。 複数のプロバイダーを使用するほとんどのアプリケーションでは、認証されていない要求に対して [アクション&rdquo;なし] オプションを使用&ldquo;して、アプリケーションがユーザーのサインインのタイミングと方法を決定できるようにする必要があります。</p>\n\n<h2>サインイン オプション</h2>\n\n<p>元の認証/承認は、認証されていない要求がサイトに到達したときにブラウザーをリダイレクトすることによってのみログインを許可しました。 これで、開発者はこの動作を利用するか、ログイン フローを明示的に開始できます。</p>\n\n<p>アプリケーションは、サイトの /.auth/login/&lt;provider&gt; エンドポイント (<em>プロバイダー&gt;が&lt;</em> <em>aad、facebook、google、microsoftaccount</em>、<em>twitter</em> のいずれか) にユーザーを移動することで、同じリダイレクト自体をトリガーできます。 このオプションは、ログイン ボタンを備えたサイトや多くのモバイル アプリケーションに最適です。</p>\n\n<p>または、クライアントはプロバイダー SDK を使用してトークンを取得し、セッション トークンと交換することもできます。 キー &ldquo;access_token (または &ldquo;Microsoft アカウントの authenticationToken&rdquo;) の下にある JSON 本文のプロバイダー トークンを使用して、同じエンドポイントに HTTP POST&rdquo; を送信するだけです。 これは、プロバイダー SDK がプラットフォームで利用でき、多くの Web アプリケーションや API アプリケーションでも機能する場合に、モバイル アプリケーションに適したソリューションです。</p>\n\n<p>実際、このサポートは、App Serviceがヘッドレス認証を許可できることを意味します。 インターフェイスを使用せずに API へのアクセスを必要とするデーモン プロセスまたはその他のクライアントがある場合は、AAD サービス プリンシパルを使用してトークンを要求し、アプリケーションでの認証に使用できます。 AADの場合は、ベアラー トークンの仕様に従って、セッション トークンをバイパスし、承認ヘッダーにAADトークンを含めるだけです。</p>\n\n<p>今日の更新の時点で、Mobile Apps クライアント SDK では、LoginAsync() メソッドで前述の両方のフローがサポートされるようになりました。</p>\n\n<h2>トークン ストア</h2>\n\n<p>ポータルのもう 1 つのオプション&rsquo;は、トークン ストアを有効または無効にする機能です。 この機能を使用すると、基になるプロバイダー トークンをアプリケーションに格納し、関連付けられているユーザーのコンテキスト内でのみアクセスできます。 このオプションは現在既定でオンであり、モバイル シナリオに必要です。</p>\n\n<p>グラフ呼び出しに必要な追加のユーザー情報とトークンを取得するには、サイトの /.auth/me エンドポイントに GET を発行するだけです。 要求に有効なセッション Cookie またはセッション トークンが含まれている場合は、現在のユーザーに関する情報が返されます。 Mobile Apps サーバー SDK には、この API を簡単に使用するための GetAppServiceIdentityAsync() メソッドが用意されています。</p>\n\n<h2>前に進んで認証する</h2>\n\n<p>これで、App Service アプリケーションで認証を開始するために必要なものがすべて揃っている必要があります。 この&rsquo;機能とその API に関連するドキュメント セットの拡張に取り組んでいるので、追加の機能の改善については、ここに戻って確認してください。</p>\n\n<p>App Service認証/承認を試して、お気に入りまたはご不明&rsquo;な内容をお知らせください。 <a href=\"https://feedback.azure.com/forums/34192--general-feedback\">Azure フィードバック サイト</a>と <a href=\"https://social.msdn.microsoft.com/Forums/azure/en-US/home\">MSDN フォーラム</a>でいつでもチームに連絡することも、以下のコメントに返信を残すこともできます。</p>\n"
}