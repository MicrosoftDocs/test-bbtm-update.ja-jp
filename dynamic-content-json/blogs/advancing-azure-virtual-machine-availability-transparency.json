{
    "Slug": "advancing-azure-virtual-machine-availability-transparency",
    "Title": "Azure 仮想マシンの可用性の透明性の推進",
    "Summary": "Now, in addition to getting a fast notification when a VM’s availability is impacted, customers can expect a root cause to be added at a later point once our automated Root Cause Analysis (RCA) system identifies the failing Azure platform component that led to the VM failure.",
    "Content": "<p><em>&ldquo;<a href=\"https://www.aka.ms/AdvancingReliability\" target=\"_blank\">「向上する信頼性」ブログ シリーズ</a>では&rsquo;、技術的な問題が、お客様&rsquo;の仮想マシン (VM) やその他のリソース&mdash;のような<a href=\"https://azure.microsoft.com/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/\" target=\"_blank\">ホストの回復性に Project Tardigrade</a>、<a href=\"https://azure.microsoft.com/blog/advancing-safe-deployment-with-aiops-introducing-gandalf/\" target=\"_blank\">ML ベースの AIOps 分析情報</a><a href=\"https://azure.microsoft.com/blog/advancing-safe-deployment-practices/\" target=\"_blank\"></a><a href=\"https://azure.microsoft.com/blog/advancing-failure-prediction-and-mitigation-introducing-narya/\" target=\"_blank\">を活用した慎重な安全なデプロイプラクティスに影響を与えないようにするために、Azure プラットフォームで使用されるさまざまな手法について説明しました。Project Narya を使用したハードウェア障害の予測と軽減</a>。これらの取り組みにもかかわらず、Azure の規模で運用する場合、顧客リソース&mdash;に影響を与える障害が必然的に発生することがわかっています。そうすると、影響を受けるお客様とどのように通信するかについて透明性を確保するよう努めています。そのため、シリーズの今日&rsquo;の投稿では、プリンシパル ソフトウェア エンジニアリング マネージャー<strong>のニック・スワンソン</strong>に、特に、Azure リソース正常性を介してより詳細な根本原因ステートメントを表示する方法について、スペース&mdash;の最近の改善を強調するよう依頼しました。&rdquo;</em>&mdash;Mark Russinovich、CTO、Azure</p>\n\n<hr>\n<p>&nbsp;</p>\n\n<p>既存の Azure リソース正常性機能は、Azure リソースに影響を与えるサービスの問題を診断してサポートを受けるのに役立ちます。 リソースの現在と過去の正常性がレポートされ、各リソースが使用できなくなった時間範囲が表示されます。 しかし、お客様とパートナーは、根本的な技術的な問題の原因を理解する理由&rdquo;と、監視プロセスにフィードする問題&mdash;に関するコミュニケーションを受け取る方法を改善し、他の利害関係者にしゃっくりを説明し、最終的にビジネス上の意思決定を通知する方法に特に関心&ldquo;を持っていることを知っています。</p>\n\n<h2>Azure リソース正常性における VM の問題&mdash;の根本原因の概要</h2>\n\n<p>最近、VM の障害に関するお客様と共有する情報を強化するリソース正常性エクスペリエンスが改善され、問題の原因となった根本原因に関する追加のコンテキストが提供されました。 VM の可用性が影響を受けた場合&rsquo;に迅速な通知を受け取るだけでなく、自動化された根本原因分析 (RCA) システムが VM 障害の原因となった Azure プラットフォーム コンポーネントを特定すると、後で根本原因が追加されることをお客様が期待できます。 例を見て、これが実際にどのように機能するかを見てみましょう&rsquo;。</p>\n\n<ol>\n    <li>時刻 T1 では、ネットワークの問題が原因でサーバー ラックがオフラインになり、ラック上の VM の接続が失われます。 (ネットワーク アーキテクチャに関連する最近の信頼性の向上は、将来の <a href=\"https://www.aka.ms/AdvancingReliability\" target=\"_blank\">信頼性向上</a> ブログのポスト&mdash;ウォッチで共有される予定です)。</li>\n    <li>時間 T2 では、Azures&rsquo; の内部監視は、ラック上の VM に到達できないことを認識し、影響を受ける VM を新しいラックに再デプロイすることで軽減を開始します。 この間、VM が現在影響を受け、使用できないことを顧客に通知する注釈がリソース正常性に送信されます。\n    <p>&nbsp;</p>\n    <a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/12785145-3b38-495b-84c2-8d0d9ee927be.png\"><img alt=\"A screenshot of the Azure portal “resource health” blade showing the health history of a resource.\" border=\"0\" height=\"974\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/993840fc-e567-46bc-a3d1-c89e1f36cb51.png\" style=\"border-image: none; display: inline; background-image: none;\" title=\"図 1: 正常性の履歴\" width=\"1430\"></a>\n\n    <p><em><strong>図 1</strong>: リソースの正常性履歴を示す Azure portal &ldquo;リソース正常性&rdquo;ブレードのスクリーンショット。</em></p>\n    </li>\n    <li>時刻 T3 では、ラック スイッチの上部、ホスト コンピューター、および内部監視システムからのプラットフォーム テレメトリはすべて、障害の根本原因を導き出すために RCA エンジンで相互に関連付けられます。 計算後、RCA はリソースの正常性に戻り、関連するアーキテクチャの回復性に関する推奨事項と共に発行されます。この推奨事項は、将来の影響の可能性を最小限に抑えるためにお客様が実装できます。</li>\n</ol>\n\n<p>&nbsp;</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9392bf23-e34d-4352-a9bc-a9738d21af02.png\"><img alt=\"A screenshot of the Azure portal &quot;health history&quot; blade showing root cause details for an example of a VM issue.\" border=\"0\" height=\"944\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0e155d0b-d963-4495-bbcc-b2ee2c690b3a.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"図 2\" width=\"1430\"></a></p>\n\n<p><em><strong>図 2:</strong>VM の問題の例の根本原因の詳細を示すAzure portal&quot;正常性履歴&quot;ブレードのスクリーンショット。</em></p>\n\n<p>初期ダウンタイム通知機能は数年前から存在してきましたが、根本原因ステートメントの公開は新たに追加されました。 次に、&rsquo;これらの根本原因を導き出す方法の詳細について説明します。</p>\n\n<h2>根本原因分析エンジン</h2>\n\n<p>&rsquo;前の例を詳しく見て、RCA エンジンのしくみとその背後にあるテクノロジの詳細について説明します。 VM 用 RCA エンジンの中核となるのは、大量のログ テレメトリ分析用に最適化されたビッグ データ サービスである <a href=\"https://docs.microsoft.com/en-us/azure/data-explorer/data-explorer-overview\" target=\"_blank\">Azure Data Explorer</a> (ADX) です。 Azure Data Explorerを使用すると、Azure プラットフォームを構成するデバイスとサービスから数テラバイトのログ テレメトリを簡単に解析し、それらを結合し、関連付けられた情報ストリームを解釈して、さまざまな障害シナリオの根本原因を導き出すことができるようになります。 これは、最終的にマルチステップのデータ エンジニアリング プロセスになります。</p>\n\n<h3>フェーズ 1: ダウンタイムの検出</h3>\n\n<p>根本原因分析の最初のフェーズは、分析を実行するトリガーを定義することです。 Virtual Machinesの場合、VM が予期せず再起動するたびに根本原因を特定する必要があるため、トリガーはアップ状態からダウン状態に移行する VM です。 プラットフォーム テレメトリからのこれらの移行の識別は、ほとんどのシナリオでは簡単ですが、デバイスの障害や電力損失によってプラットフォームテレメトリが失われる可能性がある特定の種類のインフラストラクチャ障害に関してより複雑になります。 これらのクラスの障害を処理するには、VM の正常性遷移を示す可能性のあるデータ損失を追跡する他の手法が必要&mdash;です。 Azure Data Explorerは、このシリーズ分析の時点で優れています。この問題に関する手法の詳細については、「Microsoft Tech Community: <a href=\"https://techcommunity.microsoft.com/t5/azure-data-explorer/calculating-downtime-using-window-functions-and-time-series/ba-p/1345430\" target=\"_blank\">Azure Data Explorer のウィンドウ関数とタイム シリーズ関数を使用してダウンタイムを計算する</a>」を参照してください。</p>\n\n<h3>フェーズ 2: 相関関係分析</h3>\n\n<p>トリガー イベントが定義されたら (この場合、異常な状態に移行する VM)、次のフェーズは相関分析です。 この手順では、トリガー イベントの存在を使用して、Azure プラットフォーム全体のポイントからのテレメトリを関連付けます。次に例を示します。</p>\n\n<ul style=\"margin-left: 40px;\">\n    <li>Azure ホスト: VM をホストする物理ブレード。</li>\n    <li>TOR: ラック ネットワーク スイッチの上部。</li>\n    <li>Azure Storage: Azure Virtual Machines の Virtual Disks をホストするサービス。</li>\n</ul>\n\n<p>これらの各システムには、VM のダウンタイム トリガー イベントと解析および関連付ける必要がある独自のテレメトリ フィードがあります。 これは、VM の依存関係グラフと、VM の障害を引き起こす可能性がある基になるシステムを理解し、これらの依存システム&rsquo; の正常性テレメトリをすべて結合して、VM の移行に比較的近いイベントでフィルター処理することで行われます。 Azure Data Explorer&rsquo;直感的で強力なクエリ言語は、テンポラル テレメトリ ストリームを相互に関連付ける<a href=\"https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/join-timewindow\" target=\"_blank\">時間枠結合</a>などの文書化されたパターンで、これに役立ちます。 この関連付けプロセスの最後には、VM 障害の原因を特定するのに役立つ情報を持つ可能性がある、または原因となる可能性があるすべての依存システムからの相関プラットフォーム テレメトリを使用した VM ダウンタイムの遷移を表すデータセットがあります。</p>\n\n<h3>フェーズ 3: 根本原因の属性</h3>\n\n<p>プロセスの次の手順は属性です。 &rsquo;これで、関連するすべてのデータが 1 つのデータセットにまとめられ、属性ルールが適用され、情報が解釈され、顧客向けの根本原因ステートメントに変換されます。 TOR エラーの元の例に戻ると、相関関係分析の後に、解釈する興味深い情報が多数ある可能性があります。 たとえば、Azure ホストを監視しているシステムには、この期間中にホストへの接続が失われたことを示すログが含まれている場合があります。 また、仮想ディスク接続の問題に関連するシグナルや、障害に関する TOR デバイスからの明示的なシグナルが発生する可能性もあります。 これらのすべての情報がスキャンされ、明示的な TOR 障害信号が根本原因として他の信号よりも優先されます。 この優先順位付けプロセスとその背後にあるルールは、ドメインの専門家と共に構築され、Azure プラットフォームの進化に合わせて変更されます。 機械学習と異常検出メカニズムは、これらの属性付き根本原因の上に配置され、これらの分類ルールを改善する機会を特定し、これらの失敗率のパターン変化を検出して <a href=\"https://azure.microsoft.com/blog/advancing-safe-deployment-with-aiops-introducing-gandalf/\" target=\"_blank\">安全なデプロイ パイプライン</a>に戻すことができます。</p>\n\n<h3>フェーズ 4: RCA の発行</h3>\n\n<p>最後の手順では、根本原因を Azure リソース正常性に発行します。この場合、顧客に表示されます。 これは、Azure <a href=\"https://azure.microsoft.com/en-us/services/functions/\" target=\"_blank\">Data Explorer</a> で処理された根本原因データを定期的に照会し、結果をリソース正常性バックエンドに出力する、非常に単純なAzure Functions アプリケーションで行われます。 情報ストリームにはさまざまなデータ遅延が発生する可能性があるため、このプロセスで R CA を更新して、到着したより良い情報源を反映して、最初に公開されたものをより具体的な根本原因にすることができます。</p>\n\n<h2>今後の予定</h2>\n\n<p>お客様やパートナーに影響を与える問題の根本原因を特定し、パートナーに伝えることが始まりにすぎません。 お客様は、これらの RCA を取得し、顧客や同僚と共有することが必要になる場合があります。 ここでは、リソースの RCA の識別と追跡を容易にし、簡単に共有できるように、この作業に基づいて構築したいと考えています。これを実現するために、バックエンドの変更に取り組み、お客様に公開できる一意のリソースごとおよびダウンタイムごとの追跡 ID を生成し、ダウンタイムを R CA に簡単に一致させることができます。 また、RCA のメール送信を容易にし、最終的には VM の RCA をサブスクライブできるようにするための新機能にも取り組んでいます。 これにより、利用不可イベントが発生した後に、追加のアクションを必要とせず、受信トレイで直接 RCA にサインアップできるようになります。</p>\n"
}