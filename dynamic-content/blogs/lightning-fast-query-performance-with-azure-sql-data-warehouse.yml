### YamlMime:Yaml
ms.openlocfilehash: 98801c10991500a34e27fcc3c8b77f7cb83e484c
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893922"
Slug: lightning-fast-query-performance-with-azure-sql-data-warehouse
Title: 'Azure SQL Data Warehouse を使用した非常に高速なクエリ パフォーマンス '
Summary: Azure SQL Data Warehouseは、すべてのサイズの企業向け、高速で柔軟で安全な分析プラットフォームです。 本日、分散クエリ実行レイヤーの機能強化によって有効にされた Azure SQL Data Warehouse (SQL DW) のお客様に対するクエリ パフォーマンスの大幅な向上を発表しました。
Content: >-
  <p>Azure SQL Data Warehouseは、すべてのサイズの企業向け、高速で柔軟で安全な分析プラットフォームです。 本日、分散<a href="https://azure.microsoft.com/en-us/blog/azure-sets-new-performance-benchmarks-with-sql-data-warehouse/" target="_blank">クエリ実行レイヤー</a>の機能強化により、Azure SQL Data Warehouse (SQL DW) のお客様向けクエリ パフォーマンスの大幅な向上を発表しました。</p>


  <p>分析ワークロードのパフォーマンスは、ストレージへの I/O 帯域幅とパーティション分割速度 (シャッフル速度とも呼ばれる) の 2 つの主要な要因によって決まります。 この前の<a href="https://azure.microsoft.com/en-us/blog/adaptive-caching-powers-azure-sql-data-warehouse-performance-gains/" target="_blank">ブログ記事</a>では、DW を使用SQL NVMe ベースのローカル ストレージを利用するために関連するデータをキャッシュする方法について説明しました。 このブログ記事では、DW のSQLし、シャッフル速度がどのように向上したのかについて説明します。</p>


  <p>データ移動とは、クエリの実行中に分散テーブルの一部が別のノードに移動される操作です。 この操作は、ターゲット ノードでデータを使用できない場合 (テーブル間でディストリビューション キーが共有されない場合が最も多い) に必要です。 最も一般的なデータ移動操作はシャッフルです。 シャッフル中に、入力行ごとに、SQL DW は結合列を使用してハッシュ値を計算し、そのハッシュ値を所有するノードにその行を送信します。 結合の片方または双方をシャッフルに含めることができます。 以下の図は、テーブル T1 と T2 の間の結合を実装するシャッフルを示しています。ここでは、それらのテーブルのどちらも結合列 col2 には分散されません。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b746cc2d-47c4-42fc-af9c-0c7184246ef1.png"><img alt="image" height="363" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f5828a06-ec14-4e85-8652-2e3ad8304823.png" style="margin-right: auto; margin-left: auto; float: none; display: block;" title="イメージ" width="623"></a></p>


  <p>もう 1 つの従来のデータ移動操作は、ディメンションとファクト テーブルを結合する場合など、ソース ノードから他のすべての SQL DW ノードにテーブル パーツがコピーされるブロードキャストです。 SQL DW クエリ オプティマイザーでは、転送される行の数を最小限に抑えるために、適切なデータ移動の種類が選択されます。</p>


  <p>これまで、データ移動操作は、次の図SQL DW Data Movement Service (DMS) コンポーネントによって実行されています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/abd2a5eb-bc90-46f8-9859-ba45bdb916a8.png"><img alt="image" height="335" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/abc30cb9-1fd0-48d2-b7ea-39324dc7067b.png" style="margin-right: auto; margin-left: auto; float: none; display: block;" title="イメージ" width="595"></a></p>


  <p>シャッフルを実装するために、Data Movement Service は SQL Server エンジンから行をコピーし、その行をハッシュし、他のノード上の DMS の適切なインスタンスに送信します。この場合、DMS は SQL Server BulkCopy API を使用して行をローカル一時テーブルにコピーします。 1 つのスレッドSQL Server行を読み取る操作であり、ボトルネックになる可能性があります。</p>


  <p>SQL DW では、データ移動がデータ エンジンに直接SQL Serverされます。 この統合によりSQL DW データ移動を利用して、使用可能な完全なマルチコア並列処理の恩恵を受け、データ移動操作にもバッチ モードの実行を使用できます。</p>


  <p><a href="https://azure.microsoft.com/en-us/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/" target="_blank">azure Accelerated Networking</a> の使用と組み合わせると、SQL DW はノードごとに 1 秒あたり最大 1 ギガバイトのデータを移動できます。分散キーに合わせて配置されていないテーブルからデータを結合するクエリが大幅に向上します。 次の図は、SQL DW インスタント データ移動モードを使用した DW SQLシャッフルを示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/22ef9724-d41b-411d-87ae-6bdfc4e2461d.png"><img alt="image" height="254" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1930f069-9565-4e9b-ad2a-3f64aa9ce79f.png" style="margin-right: auto; margin-left: auto; float: none; display: block;" title="イメージ" width="581"></a></p>


  <p>DW SQLデータをインスタント モードで移動すると、中間結果が生成され、使用可能なすべての CPU コアを使用して必要なすべてのノードに送信され、マルチコア傾向が利用されます。 &rsquo;データは、データ検証を実行する SQL Server エンジンのフロント ドアを越えるのではなく、行ごとのオーバーヘッドを最小限に抑えたコンパクトなバッチ指向の行形式でリモート ノードの一時データベースに直接書き込まれます。この場合、コストが大幅に増加します。</p>


  <p>この機能は、現在、DW の Compute Optimized Gen2 レベルのすべての既存および新規のお客様SQLされています。 SQL DW インスタント データ移動は、外部データを使用しないクエリに使用されます。PolyBase クエリは、Data Movement Service を引き続き使用します。 データ量とより迅速な分析情報の必要性が増えるにつれて、すべてのお客様に対して可能な限り最高のクエリ パフォーマンスを提供するためにイノベーションに取り組み続けています。</p>


  <ul>
   <li>この GigaOm レポートで、Azure SQL Data Warehouseが業界をリードするクエリ パフォーマンスを提供する<a href="https://gigaom.com/report/data-warehouse-in-the-cloud-benchmark/" target="_blank">方法の詳細を確認してください</a>。</li>
   <li>概要 Azure SQL Data Warehouse無料で<a href="https://azure.microsoft.com/en-us/services/sql-data-warehouse/" target="_blank">使用できます</a>。</li>
  </ul>
