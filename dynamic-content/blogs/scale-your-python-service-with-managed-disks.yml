### YamlMime:Yaml
ms.openlocfilehash: beb695220a4088949d88e8bb8a70a582f221dc54
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892706"
Slug: scale-your-python-service-with-managed-disks
Title: Managed Disks を使用した Python サービスのスケーリング
Summary: .Azure Python SDK で Azure Managed Disks がサポートされるようになりました。 &nbsp; スケールセット内の Azure Managed Disks と 1000 Vm が一般公開されました。 Azure Managed Disks は、シンプルなディスク管理を提供,...
Content: >-
  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">Azure Python SDK で Azure Managed Disks がサポートされるようになりました。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">スケールセット内の Azure Managed Disks と 1000 Vm が <a href="https://azure.microsoft.com/en-us/blog/announcing-general-availability-of-managed-disks-and-larger-scale-sets/">一般公開</a>されました。 Azure Managed Disks は、ディスク管理の簡素化、拡張性の強化、セキュリティの強化を実現します。 ディスクのストレージアカウントの概念がなくなるため、開発者はストレージアカウントに関連する制限事項を気にせずに拡張できます。 この記事では、Python の主要なサービス機能を使用するための簡単な概要とリファレンスを提供します。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">開発者の視点から見ると、Azure CLI の Managed Disks エクスペリエンスは、他のクロスプラットフォーム ツールの CLI と比べて独特です。 <a href="https://azure.microsoft.com/develop/python/">Azure PYTHON SDK</a>と<a href="https://pypi.python.org/pypi/azure-mgmt-compute">0.33.0 パッケージ</a>を使用して、Managed Disks を管理できます。 このチュートリアルを使用して、コンピューティング クライアントを作成できます。 完全な API ドキュメントについては、ReadTheDocs を参照してください。</p>


  <h2>スタンドアロンの管理ディスク</h2>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">Managed Disks する前に、開発者は、ディスク領域が不足するリスクを回避するために、複数のストレージアカウントで Vm のイメージを維持する必要があります。 この方法では、多数の Vm を迅速に必要とし、複数のリージョン間で利用できる必要があるサービスについて、アーキテクチャと開発操作が複雑になる可能性がわかります。 Managed Disks では、新しいストレージアカウントへのイメージのレプリケートについて心配する必要はありません。 リージョンごとに1つのイメージを作成できます。サービスは、1つのサブスクリプションで最大1万の Vm でそれらを使用できるようにします。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">Python コードの行を使用して、さまざまな開始点から新しいディスクを作成できます。 具体的な例をいくつか次に示します。</p>


  <ul>
   <li>空のマネージド ディスクを作成する</li>
   <li>Blob Storage から管理ディスクを作成する</li>
   <li>独自のイメージから管理ディスクを作成する</li>
  </ul>


  <p>&nbsp;</p>


  <p>次 &rsquo; の例では、Python で空の管理ディスクを作成し、数行のコードを記述しています。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">from azure. モデルインポート DiskCreateOption</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">from azure. モデルインポート DiskCreateOption</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; async_creation = compute_client create_or_update (</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;my_resource_group&#39;、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;my_disk_name&#39;、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;の場所&#39;: &#39;westus&#39;、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;disk_size_gb&#39;:20、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;creation_data&#39;: {</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;create_option&#39;: DiskCreateOption。空</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; disk_resource = async_creation。結果 ()</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <h2>管理ディスクを使用した仮想マシン</h2>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">ここまでで、管理ディスクの作成の基本について説明しましたが、管理ディスクに保存されているイメージから Vm を作成するようにサービスを構成するにはどうすればよいでしょうか。 このサービスでは、さまざまな種類の Managed Disks から Vm を柔軟に作成できます。 特定のディスクイメージに対して、暗黙的な管理ディスクを使用して VM を作成できます。 マネージド ディスクを暗黙的に作成することで、作成が簡素化されます。ディスクの詳細をすべて指定する必要はありません。 ストレージ アカウントの作成と管理についても気にする必要はありません。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">管理ディスクは、Azure Marketplace の OS イメージから VM をプロビジョニングするときにも暗黙的に作成されます。 ここで &rsquo; は、UBUNTU VM の例を示します。 VM 定義でストレージアカウントパラメーターを省略できることに注意してください。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">storage_profile = azure. model. model. StorageProfile (</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; image_reference = ImageReference (の場合)。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; publisher =&#39;正規&#39;、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; プラン =&#39;UbuntuServer&#39;、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sku =&#39;16.04.0-LTS&#39;、</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; version =&#39;latest&#39;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">次に示すように、以前にプロビジョニングされた管理ディスクを簡単に接続できます。 Python で VM を作成する方法 (ネットワークを含む) の完全な例と、Python で完全な <a href="https://github.com/Azure-Samples/virtual-machines-python-manage">vm チュートリアル</a> を確認する方法について説明します。</p>


  <h2>Managed Disks を使用する Virtual Machines スケール セット</h2>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">非常に大規模なサービスの場合は、Virtual Machine Scale Sets (VMSS) を使用することをお勧めします。 VMSS を使用すると、開発者は同じ構成の Vm のプールを作成できます。 このサービスにより &ldquo; 、自動スケール &rdquo; &ndash; の開発者は vm を事前にプロビジョニングする必要がなくなります。 Managed Disks する前に、開発者は効率的なディスク IO を実現するために慎重に設計を検討する必要があり、最大20個の Vm に1つのストレージアカウントを使用するのが理想的です。 この制限により、開発者は、より大きなスケールをサポートするために追加のストレージアカウントを作成および管理する必要があります。 管理ディスクを使用する &rsquo; と、ストレージアカウントを管理する必要はありません。 VMSS Python SDK を使用している場合、storage_profile は VM の作成に使用したものとまったく同じになります。 また、この機能によりプログラミングが簡素化され、ストレージアカウントを管理する必要がなくなります。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">この <a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-convert-template-to-md">記事</a>では、ユーザー管理型ストレージから Managed Disks への移行に関する公式のガイドを提供しています。 クイックサンプルはプレビューでも使用できます。</p>


  <h2>Azure CLI で生産性を向上させる</h2>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">CLI が任意の管理ツールである場合は、さまざまなシナリオで使用できる便利なコマンドがいくつかあります。 たとえば、1つのコマンドを使用して Azure CLI からスタンドアロンの管理ディスクを作成するには、次の手順を &rsquo; 実行します。</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">az disk create-n myDisk-g Mydisk--size-gb 20</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">&nbsp;</p>


  <p class="MsoNoSpacing" style="margin: 0in 0in 0pt">Managed Disks プログラミングの CLI コマンドの詳細については、Aaron Roney &rsquo; s の <a href="https://azure.microsoft.com/en-us/blog/azure-cli-managed-disks/">ブログ</a> 記事をご覧ください。</p>


  <h2>その他の操作</h2>


  <p>Managed Disks の使用を開始するには、他にも多くのクイック管理操作が必要になることがあります。 次の操作については、サンプルコードを参照してください。</p>


  <ul>
   <li>Azure CLI からの管理ディスクのサイズ変更</li>
   <li>
   <div class="MsoNoSpacing" style="margin: 0in 0in 0pt">Managed Disks の Storage アカウントの種類の更新</div>
   </li>
   <li>
   <div class="MsoNoSpacing" style="margin: 0in 0in 0pt">Blob Storage からのイメージの作成</div>
   </li>
   <li>
   <div class="MsoNoSpacing" style="margin: 0in 0in 0pt">仮想マシンに現在接続されている管理ディスクのスナップショットを作成する</div>
   </li>
  </ul>


  <h2>まとめ</h2>


  <p>Managed Disks を使用すると、ワークフローの堅牢性を高め、サービスアーキテクチャを簡素化し、拡張性の高い Python クラウドサービスを実行する際の安心感を得ることができます。 また、可用性セット内の Vm のディスクが、単一障害点を回避するために相互に十分に分離され、リソースへのきめ細かいロールベースのアクセスによってセキュリティが強化されるようにすることで、可用性セットの信頼性が向上します。 Azure CLI を使用して、Managed Disks を作成および管理できます。 このブログの投稿は、お客様自身で Managed Disks を試してみると、クイックリファレンスとして機能します。 サービスの詳細については、Azure の <a href="https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview">ドキュメント</a>を参照してください。 Python SDK に関するフィードバックについては、に <a href="https://mailto:azurepysdk@microsoft.com">azurepysdk@microsoft.com</a> 電子メールをお送りください。</p>
