### YamlMime:Yaml
ms.openlocfilehash: 68847f8046ff012848d3dc0af99c6024e879ca9a
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139894664"
Slug: analysis-of-network-connection-data-with-azure-monitor-for-virtual-machines
Title: 仮想マシンのネットワーク接続データAzure Monitorの分析
Summary: Azure Monitorマシン (VM) の場合、VM の依存関係とネットワーク トラフィックを分析するために使用できるネットワーク接続データが収集されます。
Content: >-
  <p>Azure Monitorマシン (VM) の場合、VM の依存関係とネットワーク トラフィックを分析するために使用できるネットワーク接続データが収集されます。 ライブ接続と失敗した接続の数、送信および受信したバイト数、VM の接続の依存関係をプロセス レベルまで分析できます。 悪意のある接続が検出されると、それらの IP アドレスと脅威レベルに関する情報が含まれます。 新しくリリース <strong>された VMBoundPort</strong> データ セットを使用すると、開いているポートとその接続を分析してセキュリティ分析を行います。</p>


  <p>このデータの分析を開始するには、データの収集に<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-onboard" target="_blank">Azure Monitor for VMs。</a></p>


  <h2>Workbooks</h2>


  <p>事前構築済みの編集可能なレポートを使用して分析を開始する場合は、レポートに含めるブックの一部を試Azure Monitor for VMs。 ボードに乗り込み、Azure Monitor[分析情報] メニュー セクションVirtual Machines <strong>(プレビュー)</strong> を選択します。 ここから、[パフォーマンス] タブまたは [マップ<strong></strong>] タブに移動して、ブックの表示<strong></strong>ギャラリーを開くリンクを表示できます。これには、ネットワーク データを分析する次のブックが含まれます。</p>


  <ul>
   <li>接続の概要</li>
   <li>失敗した接続</li>
   <li>TCP トラフィック</li>
   <li>トラフィックの比較</li>
   <li>［アクティブなポート］</li>
   <li>ポートを開く</li>
  </ul>


  <p>これらの編集可能なレポートを使用すると、1 つの VM、VM のグループ、および仮想マシン スケール セットの接続データを分析できます。</p>


  <h2>Log Analytics</h2>


  <p>Log Analytics を使用してデータを分析する場合は、 [ログ] に移動Azure Monitor[ログ] <strong></strong> を選択してデータのクエリを開始できます。 ログ ビューには、選択されているワークスペースの名前と、そのワークスペース内のスキーマが表示されます。 <strong> ServiceMap データ型の下</strong>には、次の 2 つのテーブルがあります。</p>


  <ul>
   <li>VMBoundPort</li>
   <li>VMConnection</li>
  </ul>


  <p>以下のクエリをコピーして Log Analytics クエリ ボックスに貼り付け、実行できます。 以下のいくつかの例を編集して、クエリを実行するコンピューターの名前を指定する必要があります。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f4803989-7e95-431a-8ec0-7487f2499176.png"><img alt="Screenshot of copying and pasting queries into the Log Analytics query box" border="0" height="859" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3bba4bf7-c087-4d77-84b1-547fcc9174ba.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Log Analytics クエリ ボックスへのクエリのコピーと貼り付けのスクリーンショット" width="1583"></a></p>


  <h2>一般的なクエリ</h2>


  <p>VM で開いているポートの数を確認します。これは、どの VM の構成とセキュリティの脆弱性を評価するときに役立ちます。</p>


  <pre>

  VMBoundPort

  | where Ip != &quot;127.0.0.1&quot;

  | summarize by Computer, Machine, Port, Protocol

  | summarize OpenPorts=count() by Computer, Machine

  | order by OpenPorts desc</pre>


  <p>VM のバインドされたポートを一覧表示します。これは、どの VM の構成とセキュリティの脆弱性を評価するときに役立ちます。</p>


  <pre>

  VMBoundPort

  | distinct Computer, Port, ProcessName</pre>


  <p>アプリケーションまたはサービスがどのように構成されているかを判断するために、ポート別にネットワーク アクティビティを分析します。</p>


  <pre>

  VMBoundPort

  | where Ip != &quot;127.0.0.1&quot;

  | summarize BytesSent=sum(BytesSent), BytesReceived=sum(BytesReceived), LinksEstablished=sum(LinksEstablished), LinksTerminated=sum(LinksTerminated), arg_max(TimeGenerated, LinksLive) by Machine, Computer, ProcessName, Ip, Port, IsWildcardBind

  | project-away TimeGenerated

  | order by Machine, Computer, Port, Ip, ProcessName</pre>


  <p>VM の送信および受信した傾向のバイト数。</p>


  <pre>

  VMConnection

  | summarize sum(BytesSent), sum(BytesReceived) by bin(TimeGenerated,1hr), Computer

  | order by Computer desc

  //| limit 5000

  | render timechart</pre>


  <p>ワークスペースに多くのコンピューターがある場合は、上の例の limit ステートメントの使用を解除できます。 グラフ ツールを使用すると、送信または受信したバイトを表示したり、特定のコンピューターにフィルター処理したりできます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f88791f3-002a-464a-8fdb-74a468153a2e.png"><img alt="Screenshot of chart tools being used to view Bytes sent or received" border="0" height="575" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/59117028-f2a7-4e56-8dde-082fea7321bc.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="送信または受信したバイト数を表示するために使用されているグラフ ツールのスクリーンショット" width="1046"></a></p>


  <p>時間の過ぎた接続エラー。障害率が安定または変化しているかどうかを判断します。</p>


  <pre>

  VMConnection

  | where Computer == &lt;replace this with a computer name, e.g. &lsquo;acme-demo&rsquo;&gt;

  | extend bythehour = datetime_part(&quot;hour&quot;, TimeGenerated)

  | project bythehour, LinksFailed

  | summarize failCount = count() by bythehour

  | sort by bythehour asc

  | render timechart</pre>


  <p>マシンの動作と接続状態を分析するために、状態の傾向をリンクします。</p>


  <pre>

  VMConnection

  | where Computer == &lt;replace this with a computer name, e.g. &lsquo;acme-demo&rsquo;&gt;

  | summarize  dcount(LinksEstablished), dcount(LinksLive), dcount(LinksFailed), dcount(LinksTerminated) by bin(TimeGenerated, 1h)

  | render timechart</pre>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e3ff4bd7-e708-426d-a35f-b8622593c2f8.png"><img alt="Screenshot of line chart showing query results from the last 24 hours" border="0" height="570" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b308be9d-4320-43ec-b2cf-e153ebf2db98.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="過去 24 時間のクエリ結果を示す線グラフのスクリーンショット" width="1047"></a></p>


  <h2>ログ クエリの使用を開始する方法Azure Monitor for VMs</h2>


  <p>アプリケーションの詳細についてはAzure Monitor for VMs概要(プレビュー) &ldquo; Azure Monitor for VMs<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-overview" target="_blank">を参照してください</a>。&rdquo;Log Analytics を使用してデータAzure Monitor for VMsクエリを実行する場合は、ドキュメントで追加のサンプル クエリ<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/insights/vminsights-log-search" target="_blank">を参照できます</a>。</p>
