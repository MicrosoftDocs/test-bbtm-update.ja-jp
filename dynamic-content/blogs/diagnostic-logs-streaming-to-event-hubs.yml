### YamlMime:Yaml
ms.openlocfilehash: f7e14b5ee5f3a07066a6fef93e3f9df8db3ec0ab
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895125"
Slug: diagnostic-logs-streaming-to-event-hubs
Title: Event Hubs への Azure 診断ログのストリーミングを提供開始
Summary: '本日は、Azure 診断ログを使用するための改善された拡張された方法を発表します。Event Hubs。 '
Content: "<p>本日は、Azure 診断ログを使用するための改善された拡張された方法を発表します。Event Hubs。 <strong>Azure 診断ログは</strong> 、リソースによって出力されるログであり、そのリソースの操作に関する分析情報を提供します。 これらのログの内容は、リソースの種類によって異なります。たとえば、Windowsシステム ログは VM の診断ログの 1 つのカテゴリであり、BLOB、テーブル、キューのログはストレージ アカウントの診断ログのカテゴリです。 これらは、サブスクリプション <strong><a href=\"https://azure.microsoft.com/en-us/documentation/articles/resource-group-audit/\">内のリソース</a></strong>に対して実行された操作に関する分析情報を提供する監査ログとは異なります。 以前は、監査用のこれらのログのみを、アカウント内のStorageしました。 これで、ポータルまたは Event Hubs コマンドレットを使用して、ストリーミング診断ログをAzure PowerShellできます。</p>\n\n<h2>診断ログと診断ログを使用Event Hubs?</h2>\n\n<p>診断ログでストリーミング機能を使用する場合、次のような方法があります。</p>\n\n<ul>\n <li><strong>サードパーティのログとテレメトリ システムにログをストリーミングする</strong> &ndash; 時間のEvent Hubsは、診断ログをサードパーティの SIEM とログ分析ソリューションにパイプ処理するメカニズムになります。</li>\n <li><strong>&ldquo;&rdquo; Power BI</strong> &ndash; Event Hubs、Stream Analytics、および PowerBI を使用してホット パス データをストリーミングしてサービスの正常性を表示すると、診断データを Azure サービスに関するほぼリアルタイムの分析情報に簡単に変換できます。 <a href=\"https://azure.microsoft.com/en-us/documentation/articles/stream-analytics-power-bi-dashboard/\">このドキュメント記事では、Event Hubs を設定し、Stream Analytics を使用してデータを処理し、出力として Power BIを使用する方法の概要を説明します。</a> 診断ログを使用してこれを設定するためのヒントを次に示します。 <ul>\n  <li>ポータルでオプションをオンにするか、PowerShell を使用して有効にすると、診断ログのカテゴリの Event Hubs が自動的に作成されます。そのため、Service Bus 名前空間の Event Hubs &ldquo;を分析情報で始まる名前で選択します。&rdquo;</li>\n  <li>ここでは&rsquo;、すべてのログ Stream Analytics単純に PowerBI テーブルに解析するために使用できるクエリのサンプルを示します。 <pre class=\"prettyprint\">\nSELECT\n    records.ArrayValue.[Properties you want to track]\nINTO\n    [OutputSourceName &ndash; the PowerBI source]\nFROM\n    [InputSourceName] AS e\nCROSS APPLY GetArrayElements(e.records) AS records</pre>\n  </li>\n </ul>\n </li>\n <li><strong>カスタム テレメトリとログ プラットフォームを構築する</strong> &ndash; 既にカスタム構築されたテレメトリ プラットフォームがある場合、または単に構築することを考えている場合は、Event Hubs の高度にスケーラブルな発行/サブスクライブの性質により、診断ログを柔軟に取り込む可能性があります。 <a href=\"https://azure.microsoft.com/en-us/documentation/videos/build-2015-designing-and-sizing-a-global-scale-telemetry-platform-on-azure-event-Hubs/\">グローバル 規模のテレメトリ プラットフォームでデータ を使用Event Hubs Dan Telemetrnovas&rsquo; ガイドについては、こちらを参照してください。</a></li>\n</ul>\n\n<h2>操作方法ログのストリーミングを有効にしますか?</h2>\n\n<p>診断ログのストリーミングは、プログラムまたはポータルを使用して有効にできます。 どちらの場合も、有効にするログ カテゴリService Bus名前空間を選択し、Event Hubs名前空間に作成される名前空間を選択します。 診断 <strong>ログ カテゴリは</strong> 、リソースが収集できるログの一種です。 Azure Portal の [&rsquo;診断] ブレードで、特定のリソースに対して収集するログ カテゴリを選択できます。</p>\n\n<p><img alt=\"\" border=\"0\" height=\"442\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/316dd282-e7b7-41f7-95e6-1d252e56ce98.png\" style=\"border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px\" title=\"\" width=\"640\"></p>\n\n<h3>PowerShell コマンドレットの使用</h3>\n\n<p>Azure PowerShell コマンドレットを使用してストリーミングを有効にするには、次のパラメーターで Set-AzureRmDiagnosticSetting コマンドレットを使用できます。</p>\n\n<pre class=\"prettyprint\">\nSet-AzureRmDiagnosticSetting -ResourceId [your resource Id] -ServiceBusRuleId [your service bus rule id] -Enabled $true</pre>\n\n<p>次Service Bus規則 ID は、{service bus リソース ID}/authorizationrules/{キー名} という形式の文字列になります。</p>\n\n<blockquote>\n<p>注: このオプションは、次の更新プログラムでAzure PowerShellされます。</p>\n</blockquote>\n\n<h3>Azure CLI の使用</h3>\n\n<p>次のように、Azure CLIを使用してストリーミングを有効にするには、insights 診断セット コマンドを使用します。</p>\n\n<pre class=\"prettyprint\">\nazure insights diagnostic set --resourceId &lt;resourceId&gt; --serviceBusRuleId &lt;serviceBusRuleId&gt; --enabled true</pre>\n\n<blockquote>\n<p>注: このオプションは、次の更新プログラムAzure CLIされます。</p>\n</blockquote>\n\n<p>PowerShell コマンドレットの説明に従って、Service Bus ID に同じ形式を使用する必要があります。</p>\n\n<h3>Azure Portal の使用</h3>\n\n<p>Azure Portal を使用してストリーミングを有効にするには、 &lsquo;リソースの診断設定に移動し、[エクスポート] を選択して [Event Hubs。&rsquo;</p>\n\n<p><img alt=\"\" height=\"444\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/470e59a0-2cfa-4ff4-ba6f-4c9e3289c8a8.png\" style=\"display: inline\" title=\"\" width=\"640\"></p>\n\n<p>構成するには、既存の名前空間を選択Service Busします。 選択した名前空間は、Event Hubs が作成される場所 (診断ログのストリーミングが初めての場合) または (この名前空間にログ カテゴリをストリーミングしているリソースが既にある場合) にストリーミングされ、ストリーミング メカニズムが持つアクセス許可がポリシーによって定義されます。 現在、管理、読み取りEvent Hubs<strong>、および送信</strong>アクセス許可<strong></strong>が必要なリソースへのストリーミング。 <strong></strong> クラシック ポータルで、Service Bus名前空間&ldquo;&rdquo;の [構成] タブで、名前空間共有アクセス ポリシーを作成または変更Service Busできます。 これらの診断証明書のいずれかを更新するには設定承認規則に対する <strong>ListKey</strong> アクセス許可Service Bus必要があります。</p>\n\n<h2>Event Hubs からログ データを使用する方法</h2>\n\n<p>Event Hubs からのサンプル出力データを次に示します。</p>\n\n<pre class=\"prettyprint\">\n{\n    &quot;records&quot;: \n    [\n        {\n             &quot;time&quot;: &quot;2016-07-15T18:00:22.6235064Z&quot;,\n             &quot;workflowId&quot;: &quot;/SUBSCRIPTIONS/DF602C9C-7AA0-407D-A6FB-EB20C8BD1192/RESOURCEGROUPS/JOHNKEMTEST/PROVIDERS/MICROSOFT.LOGIC/WORKFLOWS/JOHNKEMTESTLA&quot;,\n             &quot;resourceId&quot;: &quot;/SUBSCRIPTIONS/DF602C9C-7AA0-407D-A6FB-EB20C8BD1192/RESOURCEGROUPS/JOHNKEMTEST/PROVIDERS/MICROSOFT.LOGIC/WORKFLOWS/JOHNKEMTESTLA/RUNS/08587330013509921957/ACTIONS/SEND_EMAIL&quot;,\n             &quot;category&quot;: &quot;WorkflowRuntime&quot;,\n             &quot;level&quot;: &quot;Error&quot;,\n             &quot;operationName&quot;: &quot;Microsoft.Logic/workflows/workflowActionCompleted&quot;,\n             &quot;properties&quot;: {\n                 &quot;$schema&quot;:&quot;2016-04-01-preview&quot;,\n                 &quot;startTime&quot;:&quot;2016-07-15T17:58:55.048482Z&quot;,\n                 &quot;endTime&quot;:&quot;2016-07-15T18:00:22.4109204Z&quot;,\n                 &quot;status&quot;:&quot;Failed&quot;,\n                 &quot;code&quot;:&quot;BadGateway&quot;,\n                 &quot;resource&quot;:{\n                     &quot;subscriptionId&quot;:\n                     &quot;df602c9c-7aa0-407d-a6fb-eb20c8bd1192&quot;,\n                     &quot;resourceGroupName&quot;:&quot;JohnKemTest&quot;,\n                     &quot;workflowId&quot;:&quot;243aac67fe904cf195d4a28297803785&quot;,\n                     &quot;workflowName&quot;:&quot;JohnKemTestLA&quot;,\n                     &quot;runId&quot;:&quot;08587330013509921957&quot;,\n                     &quot;location&quot;:&quot;westus&quot;,\n                     &quot;actionName&quot;:&quot;Send_email&quot;\n                },\n                &quot;correlation&quot;:{\n                    &quot;actionTrackingId&quot;:&quot;29a9862f-969b-4c70-90c4-dfbdc814e413&quot;,\n                    &quot;clientTrackingId&quot;:&quot;08587330013509921958&quot;\n                }\n            }\n        }\n        ,\n        {\n             &quot;time&quot;: &quot;2016-07-15T18:01:15.7532989Z&quot;,\n             &quot;workflowId&quot;: &quot;/SUBSCRIPTIONS/DF602C9C-7AA0-407D-A6FB-EB20C8BD1192/RESOURCEGROUPS/JOHNKEMTEST/PROVIDERS/MICROSOFT.LOGIC/WORKFLOWS/JOHNKEMTESTLA&quot;,\n             &quot;resourceId&quot;: &quot;/SUBSCRIPTIONS/DF602C9C-7AA0-407D-A6FB-EB20C8BD1192/RESOURCEGROUPS/JOHNKEMTEST/PROVIDERS/MICROSOFT.LOGIC/WORKFLOWS/JOHNKEMTESTLA/RUNS/08587330012106702630/ACTIONS/SEND_EMAIL&quot;,\n             &quot;category&quot;: &quot;WorkflowRuntime&quot;,\n             &quot;level&quot;: &quot;Information&quot;,\n             &quot;operationName&quot;: &quot;Microsoft.Logic/workflows/workflowActionStarted&quot;,\n             &quot;properties&quot;: {\n                 &quot;$schema&quot;:&quot;2016-04-01-preview&quot;,\n                 &quot;startTime&quot;:&quot;2016-07-15T18:01:15.5828115Z&quot;,\n                 &quot;status&quot;:&quot;Running&quot;,\n                 &quot;resource&quot;:{\n                     &quot;subscriptionId&quot;:&quot;df602c9c-7aa0-407d-a6fb-eb20c8bd1192&quot;,\n                     &quot;resourceGroupName&quot;:&quot;JohnKemTest&quot;,\n                     &quot;workflowId&quot;:&quot;243aac67fe904cf195d4a28297803785&quot;,\n                     &quot;workflowName&quot;:&quot;JohnKemTestLA&quot;,\n                     &quot;runId&quot;:&quot;08587330012106702630&quot;,\n                     &quot;location&quot;:&quot;westus&quot;,\n                     &quot;actionName&quot;:&quot;Send_email&quot;\n                },\n                &quot;correlation&quot;:{\n                    &quot;actionTrackingId&quot;:&quot;042fb72c-7bd4-439e-89eb-3cf4409d429e&quot;,\n                    &quot;clientTrackingId&quot;:&quot;08587330012106702632&quot;\n                }\n            }\n        }\n    ] \n}</pre>\n\n<table border=\"0\" cellpadding=\"2\" cellspacing=\"0\" width=\"400\">\n <tbody>\n  <tr>\n   <td valign=\"top\" width=\"200\"><strong>要素名</strong></td>\n   <td valign=\"top\" width=\"200\"><strong>説明</strong></td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">records</td>\n   <td valign=\"top\" width=\"200\">このペイロード内のすべてのログ イベントの配列。</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">time</td>\n   <td valign=\"top\" width=\"200\">イベントが発生した時刻。</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">category</td>\n   <td valign=\"top\" width=\"200\">このイベントのログ カテゴリ。</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">resourceId</td>\n   <td valign=\"top\" width=\"200\">このイベントを生成したリソースのリソース ID。</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">operationName</td>\n   <td valign=\"top\" width=\"200\">操作の名前。</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">level</td>\n   <td valign=\"top\" width=\"200\">省略可能。 ログ イベントのレベル。</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"200\">properties</td>\n   <td valign=\"top\" width=\"200\">イベントのプロパティ。 イベントの詳細の大部分は、この JSON オブジェクトに含まれる予定です。</td>\n  </tr>\n </tbody>\n</table>\n\n<p>診断ログを診断ログにストリーム配信Event Hubs数か月間に展開される予定です。 現在は、次のリソースを使用できます。</p>\n\n<ul>\n <li>ネットワーク セキュリティ グループ</li>\n <li>ソフトウェア ロード バランサー</li>\n <li>App Service ゲートウェイ</li>\n <li>Logic Apps</li>\n <li>Data Lake</li>\n <li>検索</li>\n <li>Key Vault</li>\n</ul>\n\n<p>今すぐ試して、以下のコメント セクションでフィードバックをお寄せください。</p>"
