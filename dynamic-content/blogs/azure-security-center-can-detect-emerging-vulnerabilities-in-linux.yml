### YamlMime:Yaml
ms.openlocfilehash: fbb395da02cf63867c19e231652735ea87314242
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889580"
Slug: azure-security-center-can-detect-emerging-vulnerabilities-in-linux
Title: Azure Security Center で Linux の新たな脆弱性を検出可能
Summary: 最近、Unix に似た OS でシステム全体の特権を制御するコンポーネントであるPolKit で新しい欠陥が発見されました。 この脆弱性により、特権のないアカウントにルート アクセス許可が付与される可能性があります。
Content: "<p>最近、Unix に似た OS でシステム全体の特権を制御するコンポーネントであるPolKit で新しい欠陥が発見されました。 この脆弱性により、特権のないアカウントにルート アクセス許可が付与される可能性があります。 このブログ記事では、最近の脆弱性に焦点を当て、攻撃者が簡単に悪用して悪用する方法を示します。 さらに、脅威の検出にAzure Security Center方法を事前に設定し、軽減手順に関する推奨事項を提供します。</p>\n\n<h2>PolKit の脆弱性</h2>\n\n<p>PolKit (旧称 PolicyKit) は、Unix に似た OS でポリシーを定義および処理し、システム全体の特権を制御する一元的な方法を提供するコンポーネントです。 脆弱性 <a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19788\" target=\"_blank\">CVE-2018-19788</a> は、アクセス許可要求の不適切な検証が原因で発生しました。 これにより、ユーザー ID が最大整数を超える特権を持つユーザーが、ルート コンテキストで任意のコードを正常に実行できます。</p>\n\n<p>この脆弱性は、0.115 より前のバージョンのPolKits&rsquo; 内に存在します。これは、最も一般的な Linux ディストリビューションの一部によってプレインストールされています。 修正プログラムがリリースされましたが、関連するパッケージ マネージャーの発行者が手動でインストールする必要があります。<br>\n&ldquo;コマンド pkttyagent -version&rdquo; を実行して、マシンが脆弱な状態にあるか確認し、PolKits&rsquo; のバージョンが脆弱でなされていないことを確認できます。</p>\n\n<h2>攻撃者がこの脆弱性を悪用して環境にアクセスする方法</h2>\n\n<p>以前に公開された概念実証 (POC) からインスパイアされた単純な悪用 <a href=\"https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2018-19788.sh\" target=\"_blank\">を示します</a>。 悪用は、攻撃者がこの脆弱性を利用して特権エスカレーション手法を実現し、ファイルにアクセスを制限する方法を示しています。 このデモでは、現在最も人気のある Linux ディストリビューションの 1 つを使用します。</p>\n\n<p>まず、PolKit のバージョンを確認して、脆弱なマシン上にあると確認します。 次に、ユーザー ID が最大整数値より大きいか確認します。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3e2ee96a-7d3d-4736-a9bc-e78d83983a76.png\"><img alt=\"Code verification that a user ID is greater than the maximal integer value screenshot\" border=\"0\" height=\"62\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/83126b24-2cc3-430d-8f26-95592e6561bc.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"ユーザー ID が最大整数値を超えるコード検証のスクリーンショット\" width=\"548\"></a></p>\n\n<p>これで、脆弱なマシン上にあるとわかっているのは、アクセス許可ポリシーの適用子としてPolKit を使用し、任意のコードを実行する機能を備える、別のプレインストール済みツール Systemctl を使用して、この欠陥を活用できます。 <a href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19788\" target=\"_blank\">CVE-2018-19788</a> について詳しく見ると、Systemctl は脆弱性の影響を受けていると思います。 Systemctl は Systemd ユーティリティの 1 つであり、Linux を使用して構築するための新しい基盤になりつながっているシステム マネージャーです。</p>\n\n<p>Systemctl を使用すると、悪意のあるコマンドをルート コンテキストで実行するために、新しいサービスを作成できます。 PolKit の欠陥のため、アクセス許可チェックをバイパスして systemctl 操作を実行できます。 それを&rsquo;行う方法を見てみしましょう。</p>\n\n<h3>Bash スクリプトコンテンツ:</h3>\n\n<pre>\n#!/bin/bash\ncat &lt;&lt;EOF &gt;&gt; /tmp/polKitVuln.service\n[Unit]\nDescription= Abusing PolKit Vulnerability\n[Service]\nExecStart=<strong>/bin/bash -c &#39;cat /etc/sudoers &gt; /tmp/sudoersList.txt&#39;</strong>\nRestart=on-failure\nRuntimeDirectoryMode=0755\n \n[Install]\nWantedBy=multi-user.target\nAlias= polKitVuln.service\nEOF\n \nsystemctl enable /tmp/polKitVuln.service\nsystemctl start polKitVuln.service</pre>\n\n<p>最初に、新しいサービスを定義し &ldquo;、必要な情報を /tmp/polkitVuln.service に提供します&rdquo;。 ExecStart ディレクティブには、コマンド (上記の太字) が含まれているので、sudoers ファイルにアクセスして、その内容を共有フォルダーにコピーします。 この共有フォルダーには、特権のないユーザーがアクセスできます。 Sudoers ファイルは、マシンのユーザーとグループの特権情報が含まれているので、システム内で最も重要なファイルの 1 つです。 スクリプトの最後の部分で、新しいサービスを作成して開始するための systemctl ツールの実際の呼び出しを行います。</p>\n\n<h3>スクリプトを実行します。</h3>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9cf9266a-6ef4-43d2-83b7-23f3cb9d8f40.png\"><img alt=\"Screenshot of code showing errors regarding Polkit failing to handle uid field\" border=\"0\" height=\"105\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/73b5e3e6-8146-4f13-a7b1-a49829704e46.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Polkit が uid フィールドの処理に失敗した場合のエラーを示すコードのスクリーンショット\" width=\"640\"></a></p>\n\n<p>Polkit が uid フィールドを処理できなかった場合のエラーに注意してください。 Sudoers ファイルは悪用を使用してコピーされたので、その内容を読み取る可能性があります。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8e37e6e7-7405-4af8-91c4-20237aee2d24.png\"><img alt=\"Screenshot of code proving Sudoers file is copied using the exploitation\" border=\"0\" height=\"375\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3de5e801-cfe3-4281-ac85-3af2c5f79b4f.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"悪用を使用して Sudoers ファイルがコピーされるコードのスクリーンショット\" width=\"640\"></a></p>\n\n<p>この脆弱性により、攻撃者はアクセス許可をバイパスして環境を確認し、ルート アクセスを取得できます。 別のブログ&ldquo;記事「Azure Security Center を使用して <a href=\"https://azure.microsoft.com/en-us/blog/how-azure-security-center-helps-detect-attacks-against-your-linux-machines/\" target=\"_blank\">Linux</a>&rdquo; マシンに対する攻撃を検出する方法」では、攻撃者が暗号マイナーをインストールしたり、他のリソースを攻撃したりするためにホストを悪用する方法を示しました。</p>\n\n<h2>脅威から保護し、脅威に対応Azure Security Center</h2>\n\n<p>Azure Security Center、PolKit の脆弱性などの脅威を検出し、これらのリスクを迅速に軽減するのに役立ちます。 Azure Security Centerアラートを 1 つのダッシュボードに統合すると、環境内の脅威を簡単に確認し、脅威への対応に優先順位を付けやすくなります。 各アラートには、インシデントの詳細な説明と、問題を修復する方法に関する手順が示されます。</p>\n\n<p>ホストの影響Azure Security Center調査する一方で、マシンが攻撃を受けている頻度と行動検出手法を使用して、攻撃を受けた場合に顧客に通知することができます。 次に示すのは、前のアクティビティに基づくセキュリティ アラートです。このアクティビティは、Security Center。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/49cfdc85-1286-45ad-891a-a4b3c37af921.png\"><img alt=\"Screenshot of security alert in Azure Security Center\" border=\"0\" height=\"480\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dc29e0a5-e53d-4d39-9db8-4fbbaa68650d.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Azure Security Center のセキュリティ アラートのスクリーンショット\" width=\"603\"></a></p>\n\n<p>さらに、次Azure Security Center、お客様が問題を迅速に修復できる一連の手順が提供されます。</p>\n\n<ul>\n <li>システム管理では、ユーザー ID またはユーザー ID が負の値を超えるユーザー ID を許可2147483646。\n <ul style=\"margin-left: 40px;\">\n  <li>/etc/login.defs でユーザー ID の最大値 &ldquo;と最小値を確認します。&rdquo;</li>\n </ul>\n </li>\n <li>パッケージ マネージャーによってポリシーキット パッケージを事前にアップグレードします。</li>\n</ul>\n\n<h2>Azure Security Center の概要</h2>\n\n<p>現在、 <a href=\"https://azure.microsoft.com/en-us/free/\" target=\"_blank\">Azure Security Center&rsquo; Standard レベルの使用</a> を無料で開始できます。</p>"
