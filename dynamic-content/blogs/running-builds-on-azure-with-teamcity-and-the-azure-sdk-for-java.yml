### YamlMime:Yaml
ms.openlocfilehash: 3445532fa8bffbcbc8b0a708fc9fd9b99d828dd7
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139910359"
Slug: running-builds-on-azure-with-teamcity-and-the-azure-sdk-for-java
Title: TeamCity と Azure SDK for Java を使用した Azure でのビルドの実行
Summary: JetBrains では、Java、.NET、その他多くのプラットフォーム用の強力な継続的インテグレーションサーバーである TeamCity を構築します。 ビルドサーバーは、可変のワークロードの典型的な例です。特定の日に、2つのビルドエージェントを実行するだけで十分な場合があります。
Content: >-
  <img class="alignnone size-full wp-image-217031" style="margin-right: 8px; margin-bottom: 2px;" alt="TeamCity Logo" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/01-tc-post-logo.png" width="110" height="99" align="left" />


  JetBrains では、Java、.NET、その他多くのプラットフォーム用の強力な継続的インテグレーションサーバーである <a href="https://www.jetbrains.com/teamcity/">Teamcity</a>を構築します。 ビルドサーバーは、可変のワークロードの典型的な例です。特定の日に、2つのビルドエージェントを実行するだけで十分な場合があります。 また、たとえば、リリース日の近くに、アプリケーションのコンパイル、テスト、およびデプロイの負荷に対応できるように、10個のビルドエージェントが必要になります。 そのため、 <a href="https://blog.jetbrains.com/teamcity/2014/11/introducing-teamcity-azure-plugin-run-builds-in-the-cloud/">Teamcity Azure plugin</a>を構築しました。これにより、teamcity はビルドエージェントを自動的にプロビジョニングおよびプロビジョニング解除できるようになり、ビルドファームの実行コストが削減され、開発者からのフィードバックを迅速に得ることができます。


  teamcity サーバーにプラグインをインストールした後、新しい Microsoft Azure クラウドプロファイルを追加し、管理証明書と、teamcity でビルドエージェントを作成するサブスクリプション ID を渡すことができます。 次に、TeamCity でプロビジョニングする仮想マシンイメージの選択や、仮想マシンのサイズなど、いくつかのオプションを提供できます。 サブスクリプションでサポートされている任意の仮想マシンのサイズを起動することができます。これは、いくつかのリソースを使用する追加の小規模なコンピューターからハイエンドの D シリーズコンピューターまで、SSD のビルドを実行できます。 ビルドエージェントは Windows または Linux のいずれかになります。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/11/11/02-tc-post-tc-window.png"><img class="alignnone size-medium wp-image-217041" alt="02-tc-post-tc-window" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/02-tc-post-tc-window-529x369.png" width="529" height="369" /></a>


  保存されると、TeamCity はまず、クラウド以外のエージェントでビルドを開始しようとします。 使用可能な通常のエージェントがない場合、TeamCity は、互換性のあるエージェントを使用して仮想マシンまたは仮想マシンイメージを検索し、Azure で起動します。 TeamCity では、構成されているインスタンスの最大数を超えないようにし、仮想マシンを適切にシャットダウンしてコストを削減します。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/03-tc-post-portal.png"><img class="alignnone size-medium wp-image-217051" alt="03-tc-post-portal" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/03-tc-post-portal.png" width="605" height="214" /></a>


  teamcity は Java で構築されているため、Microsoft Azure Management API と通信する方法を選択する必要がありました。 これに対して未加工の REST 呼び出しを記述するか、java<a href="https://github.com/Azure/azure-sdk-for-java">用 Microsoft Azure SDK</a>(java で記述されたすぐに使用できるクライアントライブラリ) を使用して<a href="https://blog.jetbrains.com/teamcity/2014/11/introducing-teamcity-azure-plugin-run-builds-in-the-cloud/">teamcity Azure プラグイン</a>を構築することができます。 ここでは、 <a href="https://search.maven.org/#browse%7C1671162511">Maven から簡単に</a>使用でき、すべての REST 内部をカプセル化できるため、Java 用 Microsoft Azure SDK を使用することにしました。 また、完全に <a href="https://github.com/Azure/azure-sdk-for-java">オープンソース</a>でもあります。これにより、内部を簡単に確認したり、追加の機能で拡張したりすることができます。


  Microsoft Azure SDK for Java の上に構築することは、快適なエクスペリエンスでした。 Microsoft Azure 管理ポータルから実行できるすべての操作は、SDK を使用して行うことができます。 この機能を使用して、既存の仮想マシンを開始および停止するだけでなく、仮想マシンイメージから新しい仮想マシンを作成して起動し、必要な数のビルドエージェントを作成できるようにします。 おまけとして、Microsoft Azure SDK for Java は、長時間実行される操作の非同期メソッドを提供します。管理 API の呼び出しをブロックすることはありません。


  私たちは<a href="https://github.com/JetBrains/teamcity-azure-plugin">GitHub でプラグインをオープン</a>にしています。これにより、私たちが何を実装したかについて投稿したり、簡単に見たりすることができます。 Java 用の Microsoft Azure SDK を使用しているため、仮想ネットワークのサポートなどの多くの機能を使用してプラグインを拡張できます。 <a href="https://blog.jetbrains.com/teamcity/2014/11/introducing-teamcity-azure-plugin-run-builds-in-the-cloud/">Teamcity Azure plugin</a>を試してみる場合は、 <a href="https://www.jetbrains.com/teamcity/">teamcity の無料エディション</a>をダウンロードできます。 TeamCity サーバーと Microsoft Azure でホストされているエージェントの両方を用意することをお勧めします。
