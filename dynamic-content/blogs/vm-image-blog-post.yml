### YamlMime:Yaml
ms.openlocfilehash: 8e216047d8eee20490fe8f3a432f9bb8dd599599
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893787"
Slug: vm-image-blog-post
Title: VM イメージ
Summary: ロールロールをお願いします。最新の Microsoft Azure ランタイム リリースでは、新しい VM イメージ エンティティである OS イメージの後継となる機能をお知らせします。ちょっと待ってください。。。 はい、お客様の中には、次の場合があります。...
Content: >-
  ロールロールをお願いします。最新の Microsoft Azure ランタイム リリースでは、新しい VM イメージ エンティティである OS イメージの後継となる機能をお知らせします。ちょっと待ってください。。。 はい。おなじみと思っている方もいます。この機能は、サンフランシスコの <a href="https://www.buildwindows.com/">//build</a> カンファレンスで 1 週間ほど前に取り上がった多くの新しい項目の 1 つでした。エンジニアリング チームは、この新しいエンティティのリリースに向け取り組んでいて、その内容、その使い方、小さな実用的な詳細を説明する一連の投稿を開始して満足しています。


  1 つの文で、VM イメージは、仮想マシンのより包括的なイメージと考Microsoft Azure Virtual Machines。新しく改善された VM イメージには、OS ディスクとすべてのデータ ディスクを含む仮想マシンのストレージの完全な定義が含まれます。再利用可能なユニットに VM をデプロイするために必要なディスク プロパティ (ホスト キャッシュなど) がキャプチャされます。OS イメージと同様に、VM イメージはメタデータのコレクションであり、Azure Storage にページ BLOB として格納される VHD のセット (ディスクごとに 1 つの VHD) へのポインターです。


  今のところ、VM イメージと OS イメージは同等と考えている可能性があります。本当に正解です。一般化されたオペレーティング システムを備え、単一の VHD を含む VM イメージは、基本的に、現在使い慣れた OS イメージです。時間がたつ間に、VM イメージが仮想マシンのメイン イメージ コンストラクトMicrosoft Azure Virtual Machines。


  VM イメージには、それぞれ独自の目的を提供する、一般化されたイメージと特殊化された VM イメージの 2 種類があります。一般化された VM イメージには OS ディスクが含まれます。OS ディスクは、名前が示すように一般化されています (Windows の場合は Sysprep を実行し、Linux <code>‘waagent –deprovision’</code>の場合は を実行しています)、デプロイ時にプロビジョニングする必要があります。現在の OS イメージは一般化されています。この種類の VM イメージは、同様の仮想マシンを迅速にスタンプアウトする "モデル" として使用することを意図しています。例: 実稼働環境でのアプリケーションへのフロントエンドのスケールアウトや、同様の開発およびテスト環境の迅速なスピンアップと取り壊しなど。


  特殊化された VM イメージには、既にプロビジョニングされている OS ディスクが含まれます。現在のディスクは "すぐに使用できる" ディスクに似ていますが、ディスクとは異なり、VM イメージの VHD は読み取り専用として扱われるので、新しい仮想マシンをデプロイするときにコピーされます。特殊化された VM イメージは、問題が発生して仮想マシンを使用しない可能性があるタスクを実行する前に、開発者マシンのチェックポイント処理など、既知の適切な時点に VM をデプロイするための "スナップショット" として使用することを意図しています。イメージ レプリケーションの Sysprep の要件が満たされたので、同じ仮想ネットワーク内の複数の同一の仮想マシンを複製Windowsメカニズムではありません。

  <h4><strong>VM イメージを作成する方法</strong></h4>

  仮想マシンを設定し、必要に合って構成したら、インスタンスを VM イメージとしてキャプチャできます。キャプチャ プロセス中に、仮想マシンとディスクのすべての関連プロパティが格納され、バッキング VHD ページ BLOB のコピーが作成されます。各 VHD のコピーは、コピーする元の VHD と同じストレージ アカウントとコンテナーに格納されます。Azure Storage でコピーした VHD の検索に関心がある場合は、次の名前付け規則を使用してページ BLOB を検索します。OS VHD には VM &lt;&gt;イメージ名 os-YYYY-MM-DD-ZZ &lt;&lt;&gt; を使用し、コピーされたデータ VHD には VM イメージ&gt;名-datadisk-Lun-YYYY-MM-DD&lt;&gt;(-ZZ) を使用します。日付は、VM イメージがキャプチャされ、-ZZ が数値であり、競合がある場合にのみ追加され、名前を一意にします。キャプチャ中、メモリ内の状態は保存されません。そのため、この機能は、現在のバックアップオプションと復元オプションを置き換Microsoft Azure。バックアップと復元の詳細については、 を参照してください <a href="https://msdn.microsoft.com/library/azure/jj573031.aspx">https://msdn.microsoft.com/library/azure/jj573031.aspx</a>。


  OS が一般化またはプロビジョニング解除されている場合は、仮想マシンを VM イメージとしてキャプチャするためにシャットダウンする必要があります。VM が VM イメージとしてキャプチャされた後、仮想マシンは自動的に削除されます。OS が特殊化されている場合、仮想マシンは実行中またはシャットダウン中にキャプチャできます。キャプチャされた仮想マシンは変更されません。アプリケーション整合性またはディスク間キャプチャが必要な場合は、VM イメージをキャプチャする前に仮想マシンをシャットダウンすることをお勧めします。

  <h4><strong>VM イメージを使用する方法</strong></h4>

  新規または既存のデプロイの一部として仮想マシンを作成するときに、VM イメージを使用できます。新しい VM をデプロイするには、仮想マシンと VM イメージの場所が同じことを確認してから、使用する VM イメージの名前を指定します。VM イメージが一般化されている場合は、現在の OS イメージと同様に、プロビジョニング情報とネットワーク構成も提供する必要があります。仮想マシンがデプロイされると、OS イメージまたは OS ディスクから作成された他の VM と同じように動作します。ロールを更新したり、追加のディスクを接続したり、既存のディスクをデタッチしたりすることができます。


  VM イメージが特殊化されている場合、現在の OS ディスクなど、プロビジョニング情報は必要はありません。VM イメージから仮想マシンをデプロイすると、新しい VM に対して、その VM のコピーが作成されます。つまり、既存の VHD は直接アタッチされません。特殊化された VM イメージから仮想マシンをデプロイした後、VM は起動し、デプロイ後に非常に迅速に実行状態に見えるので、プロビジョニングは必要ありません。ただし、仮想マシンが起動し続ける可能性があります。リモート デスクトップ/SSH の準備には数分かかります。 もう一度、仮想マシンをデプロイして実行した後は、OS イメージまたは OS ディスクから作成された他の VM と同じように動作します。このステートメントに関する小さな注意点の 1 つは、実行中の VM からキャプチャされた特殊な Windows VM イメージから新しい仮想マシンをデプロイする場合です。 このような VM イメージを使用すると、新しくデプロイされた VM にリモート デスクトップを初めてインストールするときに VM が正しくシャットダウンされていないというダイアログがポップアップ表示される場合があります。

  <h2>PowerShell</h2>

  VM イメージを作成して使用する方法を説明する PowerShell スニペットをいくつか用意しました。これでさらに多くが必要な場合は心配しないでください。 VM Image PowerShell に関する包括的な 「方法」ブログ投稿で、まもなくフォローアップします。

  <h4><strong>Save-AzureVMImage</strong></h4>

  "myAwesomeVMImage" という名前の VM イメージとして "myVMToCapture" という名前の既存の仮想マシンをキャプチャするには、次のコマンドレットSave-AzureVMImageします。

  <table width="576" border="1" cellspacing="0" cellpadding="2">

  <tbody>

  <tr>

  <td width="574"><span style="font-size: 9.5pt; font-family: 'Lucida Console'; color: blue; line-height: 107%;">Save-AzureVMImage</span><span style="font-size: 9.5pt; font-family: 'Lucida Console'; line-height: 107%;"> <span style="color: navy;">–ServiceName</span> <span style="color: darkred;">"myServiceName"</span> <span style="color: navy;">–Name</span> <span style="color: darkred;">"myVMtoCapture"</span> <span style="color: navy;">–OSState</span> <span style="color: darkred;">"Generalized"</span> <span style="color: navy;">–ImageName</span> <span style="color: darkred;">"myAwesomeVMImage"</span> <span style="color: navy;">–ImageLabel</span> <span style="color: darkred;">"This is my Virtual Machine Image"</span></span></td>

  </tr>

  </tbody>

  </table>

  これは、VM を OS イメージとしてキャプチャするために使用するのと同じコマンドレットです。VM を OS イメージまたは VM イメージとしてキャプチャする方法を決定できる追加のパラメーター セットが追加されています。OSState パラメーターは、VM イメージをキャプチャするために必要な新しいパラメーターです。

  <h4><strong>Get-AzureVMImage</strong></h4>

  イメージ リポジトリ内のすべての VM イメージを一覧表示するには、次のコマンドレットGet-AzureVMImageします。

  <table width="571" border="1" cellspacing="0" cellpadding="0">

  <tbody>

  <tr>

  <td width="569"><span style="font-size: 9.5pt; font-family: 'Lucida Console'; color: blue; line-height: 107%;">Get-AzureVMImage</span></td>

  </tr>

  </tbody>

  </table>

  このコマンドレットは、OS イメージと VM イメージの組み合わせリストを返します。OS イメージが最初に返され、その後に VM イメージが返されます。


  VM イメージにのみ関心がある場合は、OS イメージをフィルターで除去するために、OS イメージに対して常に null になるいくつかのプロパティを使用して、OS イメージを削除できます。

  <table width="571" border="1" cellspacing="0" cellpadding="2">

  <tbody>

  <tr>

  <td width="569"><span style="font-size: 9pt; font-family: 'Lucida Console'; color: blue;"><span style="font-size: small;">Get-AzureVMImage</span></span><span style="font-size: 9pt; font-family: 'Lucida Console';"><span style="font-size: small;"> <span style="color: darkgray;">|</span> <span style="color: blue;">where</span> {(<span style="color: blue;">gm</span> <span style="color: navy;">–InputObject</span> <span style="color: orangered;">$_</span> <span style="color: navy;">-Name</span> <span style="color: blueviolet;">DataDiskConfigurations</span>) <span style="color: darkgray;">-ne</span> <span style="color: orangered;">$null</span>} <span style="color: darkgray;">|</span> <span style="color: blue;">Select</span> <span style="color: navy;">-Property</span> <span style="color: blueviolet;">Label</span><span style="color: darkgray;">,</span> </span><span style="color: blueviolet;"><span style="font-size: small;">ImageName</span> </span></span></td>

  </tr>

  </tbody>

  </table>

  <h4><strong>New-AzureVMImage</strong></h4>

  VM イメージ 'myAwesomeVMImage' を使用して米国西部に VM をデプロイするには

  <table width="564" border="1" cellspacing="0" cellpadding="2">

  <tbody>

  <tr>

  <td width="562"><span style="font-size: 9.5pt; font-family: 'Lucida Console'; color: blue; line-height: 107%;">New-AzureQuickVM</span><span style="font-size: 9.5pt; font-family: 'Lucida Console'; line-height: 107%;"> <span style="color: navy;">–Windows</span> <span style="color: navy;">–Location</span> <span style="color: darkred;">"West US"</span> <span style="color: navy;">–ServiceName</span> <span style="color: darkred;">"MySvc1"</span> <span style="color: navy;">–Name</span> <span style="color: darkred;">"myVM1"</span> <span style="color: navy;">–InstanceSize</span> <span style="color: darkred;">"Medium"</span> –<span style="color: navy;">ImageName</span> <span style="color: darkred;">"myAwesomeVMImage"</span> <span style="color: navy;">–AdminUsername</span> <span style="color: darkred;">"admin"</span><span style="color: navy;">–Password</span> <span style="color: darkred;">"adminPassword123"</span> <span style="color: navy;">-WaitForBoot </span></span></td>

  </tr>

  </tbody>

  </table>

  ご質問がある場合は、お知らせください。


  Christine


  2014 年 5 月 20 日の更新: PowerShell スニペットを使用して OS イメージをフィルター処理Get-AzureVMImage変更されました。
