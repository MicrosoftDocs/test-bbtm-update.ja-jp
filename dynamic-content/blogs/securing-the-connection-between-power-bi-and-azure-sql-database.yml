### YamlMime:Yaml
ms.openlocfilehash: daae9d80ab1bc5bc32f56167117a4620a72214be
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892634"
Slug: securing-the-connection-between-power-bi-and-azure-sql-database
Title: 接続と接続のセキュリティ保護Power BI接続Azure SQL Database
Summary: セキュリティで保護された方法でAzure SQL DatabaseサービスPower BI接続する方法 データベースへのアクセスを制限する最も簡単な方法は、[Azure サービスへのアクセスを許可する] オプションを選択する方法です。
Content: >-
  <p>セキュリティで保護された方法<a href="https://docs.microsoft.com/en-gb/azure/sql-database/">でAzure SQL Database</a>サービス<a href="https://docs.microsoft.com/en-us/power-bi/power-bi-overview">Power BI接続</a>する方法 データベースへのアクセスを制限する最も簡単な方法は &ldquo;、[Azure サービスへのアクセスを許可する] オプションを選択&rdquo; する方法です (図 1)。 これは、 のデータベース サーバー オプションで確認Azure portal。 これにより、Power BIデータベースにアクセスできます。 ただし、仮想マシンなど、Azure 内にデプロイされている任意のコンポーネントにデータベースが表示されます。 多くの組織では、これはセキュリティとコンプライアンスの要件には十分ではありません。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/44b10a1d-56eb-4ebc-a894-140999c6b8c2.png"><img alt="Figure1" border="0" height="808" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2cd162d8-3ceb-4a30-a30a-4606f807fe9c.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="図 1" width="1558"></a><br>

  <em>図 1: Azure Portal でのデータベース アクセスの設定</em></p>


  <p align="left">&nbsp; 組織のセキュリティ目標の達成を検討する必要がある提案の一覧を次に示します。</p>


  <p>開始するには、 <a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview">VNet サービス エンドポイントを使用</a> してアクセスをさらにセキュリティで保護します。 この <a href="https://azure.microsoft.com/en-us/blog/vnet-service-endpoints-for-azure-sql-database-now-generally-available/">機能</a> は、2018 年の初めに導入されました。 これは簡単に構成できます。 次のAzure portal新しい仮想ネットワークを作成するか、既存の VNet を編集し、VNet 内の SQLサービス エンドポイントを有効にしてください (図 2)。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/46a46cb5-a121-48c5-83fd-81aad9f58b8e.png"><img alt="Figure2" border="0" height="888" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/89cc3d85-e571-4dd3-ae71-7bf268b19ddc.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="図 2" width="2084"></a></p>


  <p align="center"><em>図 2: 仮想ネットワークでのサービス エンドポイントの作成</em></p>


  <p>完了したら、次のタスクは、データベース サーバーに仮想ネットワーク規則を設定します。 これにより、そのデータベース サーバー上のすべてのSQLへのアクセスを、仮想ネットワーク内のサブネットに制限できます。 これは少し制限が厳しすぎる可能性があります。さらに、アクセス権を持つ可能性のある特定の IP アドレスを追加することもできます。 次の例 (図 3) は、newVnetRule1 という vnet 規則がサブネット内のオブジェクトへのアクセスを制限し、さらに IP アドレス 80.90.100.110 を使用して外部アクセスをマシンに付与するシナリオを示しています。 後者は、デスクトップを使用してデータベースに接続するオンプレミスのマシンからのアクセスも許可<a href="https://powerbi.microsoft.com/en-us/desktop/">する必要がある場合Power BIです</a>。 企業の IP アドレス範囲への外部アクセスを制限するだけでも問題はありません。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/47571480-da4f-4805-8565-001f96bbff60.png"><img alt="Figure3" border="0" height="853" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d437529d-294f-4a9f-acc2-ad2e3b3eba7b.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="図 3" width="2107"></a></p>


  <p align="center"><em>図 3: 仮想ネットワーク規則とクライアント IP をデータベース サーバーに追加する。</em></p>


  <p>また、データベース サーバーへのアクセスを制限することで、Power BIサービスがデータベースに接続されるのを防ぐ必要があります。 解決策は、サブネット内 <a href="https://powerbi.microsoft.com/en-us/gateway/">に存在する</a> 仮想マシンにオンプレミス データ ゲートウェイをインストールすることです。 ゲートウェイの <a href="https://docs.microsoft.com/en-us/power-bi/service-gateway-onprem">サーバーの</a> サイズ設定に関する推奨事項については、ドキュメントを参照してください。 これには 2 つの手順があります。まず、サブネット内の VM にゲートウェイをインストールして構成します。 その後、Power BI ポータルを使用して、接続するデータベースと適用するセキュリティを認識するためにゲートウェイを構成します。 このプロセスには優れた書き込み <a href="https://docs.microsoft.com/en-us/power-bi/service-gateway-onprem">があります</a>。 ゲートウェイは、TCP または HTTPS を介して通信できます。 前者の方が効率的ですが、ポート 443 (既定値)、5671、5672、9350 から 9354 を送信トラフィック用に開く必要がありますが、HTTPS ではポート 80 だけが必要です。 TCP を使用するには、ネットワークの下のゲートウェイ構成画面で、Azure Service Bus 接続モードが正しく選択されていることを確認します (図 4)。 注: ゲートウェイでは、受信ポートを開く必要があります。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2b22e191-3a47-4a52-988d-5675d5a8f8e6.png"><img alt="Figure4" border="0" height="516" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3da67df8-9599-4246-90bc-9e636b1bbeca.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="図 4" width="953"></a></p>


  <p align="center"><em>図 4: TCP を使用して接続するためのオンプレミス ゲートウェイの設定</em></p>


  <p>ゲートウェイ コネクタでは、現時点で使用する必要があるコネクタが SQL Serverです。 これにより、基本認証と Windows 認証の両方がサポートされます。 つまり、ゲートウェイは単一のユーザー名とパスワードを使用してバックエンド <u>SQL Server</u>&rsquo; データベースに接続できるだけでなく、Windows 認証を使用して、データベースにクエリを直接発行するときに現在のユーザーの資格情報をパススルーすることもできます。 これにより、ユーザーがデータにアクセスPower BI&rsquo; DBA によってデータ サブセットに制限できるソリューションSQL Serverされます。 同じコネクタを使用して、同じコネクタにアクセスAzure SQL Database。 両方のデータベースに共通する唯一の認証方法は、データベース認証です。 そのため、ゲートウェイを構成するときに基本認証に制限されるため、ユーザーの資格情報をゲートウェイ経由でデータベースに渡す必要があります。 これは時間の経つ間に変更される可能性がありますが、この記事の執筆時点では、これは現在の制限です。</p>


  <p>ゲートウェイを介してデータベースにアクセスする単一障害点を回避するために、クラスターに複数のゲートウェイをインストールして回復性を提供することもできます。 2 つ目の仮想マシンを作成し、2 つ目のゲートウェイをインストールします。 インストール中に、ゲートウェイをクラスター化する <a href="https://docs.microsoft.com/en-us/power-bi/service-gateway-high-availability-clusters">オプションを選択できます</a>。</p>


  <p>最後の手順では、戻って仮想ネットワークに次の変更を加えます。サブネットに適用できるネットワーク セキュリティ グループを作成します。 そのセキュリティ グループは、許可する受信ポート上のリソースへのアクセスを制限します。 上記のシナリオでは、ネットワークSQLデータベースのみを使用する場合は、ポートを上記の IP ポートにのみ制限します。 仮想ネットワークが他のリソースによって共有されている場合は、追加のポートを開く必要がある場合があります。 最後に注意する必要がある点は、他の Azure サービスからデータベースへのアクセスを意図的に防止した点です。 その結果、特定の機能の使用<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-vnet-service-endpoint-rule-overview#impact-of-removing-allow-all-azure-services">Azure SQL Databaseされます。</a>&nbsp;</p>


  <p>すべてが設定され、機能する状態になれたので、ゲートウェイのパフォーマンスの監視に関心がある可能性があります。 <a href="https://insightsquest.com/2016/08/08/monitor-on-premises-data-gateways/">Brett Powell</a> のホワイトペーパーでは、使用可能なゲートウェイ パフォーマンス カウンターと、ログ ファイルの出力を Power BI レポートに読み込み、詳細な分析を行う方法について説明しています。</p>
