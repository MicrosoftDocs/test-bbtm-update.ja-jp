### YamlMime:Yaml
ms.openlocfilehash: e5fba28f9ea8cb24c38c56c3f1819dbe6e2519d1
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895363"
Slug: mission-critical-performance-with-ultra-ssd-for-sql-server-on-azure-vm
Title: Azure VM 上のアプリケーションUltra SSDをSQL Serverミッション クリティカルなパフォーマンス
Summary: 最近、Premium Storage Storageで TPC-E プロファイル テスト ワークロードを実行した場合のテスト結果を要約した、Azure VM での SQL Server の構成ガイドラインに関するページを公開しました。 このテストは、次の例を含めてUltra SSD。
Content: >-
  <p><em>このブログ記事は、MINE Tokus、シニア プログラム マネージャー、COGS Data - SQL DB によって作成されました。</em></p>


  <p>&ldquo;最近、Premium Storage <a href="https://blogs.msdn.microsoft.com/sqlserverstorageengine/2018/09/25/storage-configuration-guidelines-for-sql-server-on-azure-vm/" target="_blank">構成 Storageオプションで TPC-E プロファイル</a> テスト ワークロードを実行した場合のテスト結果を要約した SQL Database エンジン ブログで、Azure VM &rdquo; 上の SQL Server の構成ガイドラインに関するページを公開しました。 このテストは、次の例を含めてUltra SSD。 <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/disks-ultra-ssd" target="_blank">Ultra SSD</a>は、ミッション クリティカルなワークロードに対して Microsoft Azure で使用できる新しいストレージ オファリングで、高スループットでミリ秒未満の待機時間が発生します。 このブログでは、テストの詳細と結果をまとめています。</p>


  <p>このテストDS14_v2 16 コア、112 GB メモリ、224 GB のローカル SSD を持つ VM を使用しました。 この仮想マシン (VM) は、最大 51,200 のキャッシュされていない IOPS と 64,000 のキャッシュされた一時的な IOPS までスケールアップできます。 テスト ワークロードとして、eコマース/トレードスペースで TPC-E ワークロードの代表的な OLTP アプリを選択しました。 テスト ワークロードは、読み取り/書き込み IO アクティビティの同様の割合を駆動します。</p>


  <table border="1" cellpadding="1" cellspacing="0">
      <tbody>
          <tr>
              <td valign="top"><strong>[サイズ]</strong></td>
              <td valign="top"><strong>vCPU</strong></td>
              <td valign="top"><strong>メモリ:GiB</strong></td>
              <td valign="top"><strong>一時ストレージ (SSD) GiB</strong></td>
              <td valign="top"><strong>キャッシュが有効な場合および一時ストレージの最大スループットIOPS/MBps (キャッシュ サイズは GiB 単位)</strong></td>
              <td valign="top"><strong>キャッシュされていないディスクの最大スループット: IOPS/MBps</strong></td>
          </tr>
          <tr>
              <td valign="top">Standard_DS14_v2</td>
              <td valign="top">16</td>
              <td valign="top">112</td>
              <td valign="top">224</td>
              <td valign="top">64,000/512 (576)</td>
              <td valign="top">51,200/768</td>
          </tr>
      </tbody>
  </table>


  <h2>プレミアム Storage構成</h2>


  <p>構成プレミアム Storage、10 -P30 ディスクを追加し、すべてのディスクに対して RO キャッシュを有効にしました。 VM の 50,000 IOPS を可能にする 10 台のディスクすべてで 1 つの記憶域プールを作成しました。 データ、SQL Server、Temp DB ファイルを 10 -P30 ディスクの単一の記憶域プールに配置しました。 これは、Storage 構成機能を使用して Storage イメージから作成された SQL Azure Marketplace <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-storage-configuration" target="_blank"></a> VM に対して SQL ファイルを配置する方法とまったく同じです。</p>


  <h2>Ultra SSD構成</h2>


  <p>このUltra SSD、最大 50,000 IOPS Ultra SSDできる 1 TB のディスクを 1 つしか必要とできません。 Ultra SSD柔軟に構成できます。サイズと IOPS は個別にスケーリングできます。 プレミアム Storage Configuration では、10 台の P30 ディスクを使用して 50,000 IOPS を取得する必要があったので、データベースは 1 TB 未満です。 このUltra SSD、正確なサイズ、IOPS、スループットの要件でディスクをプロビジョニングできます。また、プロビジョニングされた容量に対してだけ料金を支払います。 また、1 つの Ultra SSD ディスクで最大 50,000 IOPS (最大 160,000) までスケールアップできるので、記憶域プールを作成する必要はなかった。単一ディスクは、データSQL Server Temp DB を含むすべてのファイルをホストします。 Ultra SSDにキャッシュ構成を必要としない場合、新しいアーキテクチャとハードウェアを使用して、すべての読み取りと書き込みに対してミリ秒未満の待機時間が既に提供されています。そのため、ディスクのキャッシュは構成されません。</p>


  <h2>テスト結果</h2>


  <p>TPC-E プロファイルのテスト ワークロードを 1 時間実行し、最初の 10 分間に負荷を積み上げ、ピークを 40 分間実行しました。 Ultra SSD プールの場合、プレミアム Storage プールの平均書き込み待機時間は 4 ミリ秒、読み取り待機時間は 1 ミリ秒の実行中に、ディスクの読み取りおよび書き込みの平均待機時間が 1 ミリ秒を下回っているのを確認しました。 同じ VM 上の 10 -P30 ディスクを単一の Ultra SSD ドライブに置き換え、SQL Server とテスト ワークロードのまったく同じ構成にすることで、SQL Server スループットを 33% 向上させることができます。 テスト中の CPU 使用率は約 70% でした。ワークロードが重い場合、スループットの向上は大きくなる可能性があります。</p>


  <table border="1" cellpadding="1" cellspacing="0">
      <tbody>
          <tr>
              <td valign="top">&nbsp;</td>
              <td valign="top"><strong>プレミアム Storage プール</strong></td>
              <td valign="top"><strong>Ultra SSD</strong></td>
          </tr>
          <tr>
              <td valign="top"><strong>ディスクの数</strong></td>
              <td valign="top">10</td>
              <td valign="top">1</td>
          </tr>
          <tr>
              <td valign="top"><strong>読み取り専用キャッシュ</strong></td>
              <td valign="top">すべてのディスク</td>
              <td valign="top">該当なし</td>
          </tr>
          <tr>
              <td valign="top"><strong>読み取り/書き込みキャッシュ</strong></td>
              <td valign="top">どのディスクも存在しない</td>
              <td valign="top">該当なし</td>
          </tr>
          <tr>
              <td valign="top"><strong>データ、ログ、一時 DB ファイル</strong></td>
              <td valign="top">Storageプールが 10 を超える&ndash;P30 ディスク</td>
              <td valign="top">シングル Ultra SSD ディスク</td>
          </tr>
          <tr>
              <td valign="top"><strong>赤の平均待機時間</strong></td>
              <td valign="top">1 ミリ秒</td>
              <td valign="top">&lt;1 ミリ秒</td>
          </tr>
          <tr>
              <td valign="top"><strong>平均書き込み待機時間</strong></td>
              <td valign="top">4 ミリ秒</td>
              <td valign="top">&lt;1 ミリ秒</td>
          </tr>
          <tr>
              <td valign="top"><strong>1 秒あたりの平均転送数</strong></td>
              <td valign="top">3 ミリ秒</td>
              <td valign="top">&lt;1 ミリ秒</td>
          </tr>
          <tr>
              <td valign="top"><strong>平均転送サイズ</strong></td>
              <td valign="top">9.5 KB</td>
              <td valign="top">10.7 KB</td>
          </tr>
          <tr>
              <td valign="top"><strong>1 秒あたりのバッチ要求数</strong></td>
              <td valign="top">13.1K</td>
              <td valign="top">17.5K</td>
          </tr>
          <tr>
              <td valign="top"><strong>1 秒あたりのビジネス トランザクション数</strong></td>
              <td valign="top">1,688</td>
              <td valign="top">1,980</td>
          </tr>
      </tbody>
  </table>


  <p>このテストが示すように、一般的なSQL Serverは、待機時間の違いによってUltra SSDと比較プレミアム Storageスループットが大幅に向上します。 Azure VM 上の <a href="https://azure.microsoft.com/en-us/services/sql-database/campaign">SQL Server</a> ワークロードに対して最も効果的なストレージ構成を見つけるには、まず、ワークロードに十分なストレージ スケール制限がある適切な VM サイズを選択することをお勧めします。 Temp DB をローカル SSD に配置すると、ストレージの追加コストを発生させる必要が生じ、パフォーマンスが最大に向上します。 プレミアム BLOB キャッシュを使用するストレージでは、低待機時間のキャッシュされた読み取りが提供されます。 大きな一時的な IOPS 制限とキャッシュされた IOPS 制限を持つ VM を使用して、RO キャッシュが有効な プレミアム Storage プールにデータ ファイルを配置する方法は、待機時間の短い読み取り要件を持つワークロードに対してコスト効率の高いオプションです。</p>


  <p>Ultra SSDは、読み取りおよび書き込みの待機時間が非常に短く、優れたストレージ パフォーマンスを提供します。 データUltra SSDログ ファイルの待機時間とスループットの要件に従って、データ を使用します。 ワークロードSQL Server、特にインメモリ OLTP を使用する場合、ログの書き込み待機時間が重要になります。 ログ ファイルをディスク上Ultra SSDすると、ストレージの待機時間が非常に短SQL Serverパフォーマンスが高くなる可能性があります。 Azure Ultra SSD、Azure プレミアム Storage、メモリとストレージに最適化された仮想マシンの種類を組み合わせることで、Azure Virtual Machines は、SQL Server ワークロードに対してエンタープライズ レベルのパフォーマンスを提供します。</p>
