### YamlMime:Yaml
ms.openlocfilehash: 610bc363a6876c164d0c41c739b54301c88624e0
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139894170"
Slug: ai-helped-troubleshoot-an-intermittent-sql-database-performance-issue-in-one-day
Title: AI は、1 日で断続的SQL Databaseパフォーマンスの問題のトラブルシューティングに役立ちます
Summary: 'このブログ記事では、Azure SQL Database インテリジェント パフォーマンス機能 Intelligent インサイト が、1 日に 6 か月間の断続的なデータベース パフォーマンスの問題を見つけるのが難しい問題のトラブルシューティングに成功した方法について説明します。 '
Content: >-
  <p>このブログ記事では、Azure SQL Database インテリジェント パフォーマンス機能 <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-intelligent-insights" target="_blank">Intelligent インサイト</a> が、1 日に 6 か月間の断続的なデータベース パフォーマンスの問題を見つけるのが難しい問題のトラブルシューティングに成功した方法について説明します。 データベース フリート全体で関連するパフォーマンスの問題を特定することで、ISV が 60,000 のデータベースインサイトを操作するのにインテリジェント サービスがどのように役立つのかについて説明します。 また、インサイト 大規模な 35 TB のデータベース フリートで、企業がパフォーマンスの低下の問題をトラブルシューティングする難しい問題を企業がシームレスに特定するのに、インテリジェント サービスがどのように役立ったかについて学習します。</p>


  <p>Azure SQL Database、最もインテリジェントなクラウド データベースは、小規模から中規模のビジネスを支援し、大企業は、実行、スケーリング、ピーク時のパフォーマンスの維持を最小限の人的操作、または必要な高度な技術スキル セットで自律的に行う Azure を任せながら、優れたアプリケーションの作成に集中します。</p>


  <p>Intelligent インサイト は、人工知能 (AI) の機能を活用した新しい破壊的インテリジェント パフォーマンス テクノロジです。これは、正確な正確度と大規模な Azure SQL Database パフォーマンスの問題を継続的に監視およびトラブルシューティングするために使用されます。 数<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-intelligent-insights-troubleshoot-performance" target="_blank">百万</a>の Azure SQL Databases の大規模なワークロード プールからの学習に基づいて微調整され、高度なソリューションのパフォーマンス トラブルシューティング モデル。</p>


  <p>2017 年 9 月にパブリック プレビューが登場して以来、Intelligent インサイト でお客様の成功事例を目にし、お客様と共有してみたいと思っています。</p>


  <h2>見つけにくいパフォーマンスの問題のSQL Databaseトラブルシューティング</h2>


  <p><a href="https://neworbit.co.uk/" target="_blank">NewOrbit</a> は、英国に拠点を置く ISV であり、スタートアップ企業や企業向けソフトウェアを Azure 上で構築して実行しています。従業員やテナントのバックグラウンド チェック用のシステムも含めてです。 何千もの顧客が毎年 400,000 人を超えるユーザーをチェックしています。システムでは、さまざまなサービスからの情報を統合して確認しています。 NewOrbit は Azure 上で完全に実行され、約 200 SQL使用されます。 NewOrbit には、開発者と顧客アカウント マネージャーだけで構成されるフラットな組織構造があります。 SQL Database の組み込みインテリジェンスに依存してデータベースのパフォーマンスを自動的に調整およびトラブルシューティングするために、DevOps チームまたは DBA を採用しません。これは、NewOrbit CTO の Lytzen &ldquo;&rdquo;が Azure を持っていることに関して言っている通りです。</p>


  <p>NewOrbit では、約 6 か月間の間欠的なパフォーマンスの問題が発生し、その結果、実稼働環境で実行されている既存のシステムのタイムアウトが増加しました。 最初の反応は、容量が多い Azure のより高い価格レベルにアップグレードする方法ですが、これは役立たなかったので、非常に変なように見えました。 Azure サブスクリプション&rsquo;で十分な予備の DTC が見られたので、NewOrbit は、容量をダイヤルアップして問題が解決しないのをすぐ理解しました。</p>


  <p>NewOrbit は、Intelligent インサイト。 ソリューションを起動するとすぐに、データベースにメモリの圧力があるようです。 これはすぐには明らかではなく、NewOrbit はメモリの圧力が原因ではなく、他の基になる問題の影響である可能性が最も高いという理解を示しました。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d383494b-e8f2-4b32-a450-1eb5755f174d.png"><img alt="image_000" border="0" height="622" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fba91a9f-1d3b-458b-a937-9e8eab00676a.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="image_000" width="977"></a></p>


  <p>インテリジェントインサイト有効になってから 1 日以内に、メモリの圧力の根本原因として疑われるクエリがいくつかあると指摘されています。 NewOrbit では、直ちに修正され、次の日のメモリの低下を監視する新しいクエリが実稼働環境にデプロイされました。</p>


  <p><em>&ldquo;以前の機会に、約 6 か月間続くパフォーマンスの問題が発生しました。インテリジェント なインサイト前は、トラブルシューティングを開始する場所を見分ける方法すら持ってはいきでした。インテリジェント インサイト、実行する操作の一覧が提供されます。Intelligent Insight が行うのは、問題の場所を特定し、24 時間以内に修正プログラムをデプロイできる点です。&rdquo;</em></p>


  <p align="right">フランス語 Lytzen、CTO、NewOrbit。</p>


  <p>NewOrbit がサービスとして大きくなるにつれて、データベースとクエリは大きくなって、複雑さを増しています。 現在は、Intelligent インサイト に依存して継続的な改善プログラムを実装し、アプリケーションのパフォーマンスを最大限に高め、データベース クエリを定期的に確認して最適化しています。</p>


  <h2>60,000 データベースのデータベースのパフォーマンスの問題SQL特定する</h2>


  <p><a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-implementation-snelstart" target="_blank">SnelStart</a> は、小規模および大規模な企業向け SaaS サービスを開発および実行するオランダの ISV であり、帳簿処理、請求、会計などの財務オンライン サービスを提供しています。 SnelStart は、約 64,000 人の顧客にサービスを提供するために Azure に依存しています。 基になるインフラストラクチャでは、主にエラスティック プールで、60,000 以上SQLデータベースを使用します。 大量のデータベースを大規模に維持し、顧客の問題に迅速に対応する (特にサービスの低下や停止が発生した場合) SnelStart には不可欠です。</p>


  <p>このような大量のデータベースを維持するには、通常、大規模な DBA とデータベース チームをDevOpsがあります。 顧客がサービスが遅い、または利用できないことを通知する電話を呼び出したら、SnelStart チームは、問題を迅速に特定して解決に取り組む必要があります。 この会社には、最初に顧客からパフォーマンスや利用不能の問題が見つかられるケースが多数存在しました。 SnelStart は、応答時間の向上を期待して、パフォーマンス監視ツールとしてインテリジェント インサイトを使用することを決定しました。</p>


  <p>SnelStart では、ソリューションを毎日使用して、CPU 制限に達しているエラスティック プールを特定します。 組み込みのインテリジェンスは、会社が過剰使用されたエラスティック プール内の上位の消費データベースを識別するのに役立ち、ホット データベースを移動できる十分な容量を持つ他のエラスティック プールの提案を提供します。 SnelStart は、DevOps使用するデータベースを移動する各論理サーバーに個別のエラスティック プールを作成しました。 これにより、Azure SQL Analytics が修復されるまで、実行速度の遅いクエリや他のデータベース<a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-sql" target="_blank">の問題</a>を調査できます。 ホット データベースのパフォーマンスが向上すると、SnelStart は通常、元のエラスティック プールに戻します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fb074cfc-683d-47f4-af35-603cf729ef2b.png"><img alt="image_002" border="0" height="448" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a8d922da-0a18-4afb-9252-19f42d316f7a.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="image_002" width="1085"></a></p>


  <p>また、Intelligent インサイト の支援を受け、SnelStart はインスタンスの 1 つで、データベースロックの原因となっているアプリケーション クエリをすばやく特定できたので、開発者は問題の根本原因を手動でトラブルシューティングする前に行う必要があります。 問題の修正プログラムは数分以内にデプロイされ、お客様が大規模に影響を受ける前にデプロイされました。 さらに良い点として、サービスのパフォーマンスに関する顧客の電話は受信されていませんでした。</p>


  <p>これは、サービス監視がリアクティブからプロアクティブに移行し、組み込みのインテリジェント なパフォーマンスにSQL Database、会社の全く新しい種類の機能でした。</p>


  <p><em>&ldquo;インテリジェント インサイト、人間よりもはるかに効率的で高速な方法で、データベースのパフォーマンスの問題を事前に見つける必要があります。この方法を使用すると、問題の修正が完了するまで、お客様を積極的に支援できます。&rdquo;</em></p>


  <p align="right">Bauke Stil、Application Manager、SnelStart。</p>


  <p>SnelStart は、データベースのパフォーマンスの問題を自動的に検出し、60,000 データベースの規模で検出する効率にSQLされました。 すべての顧客データベースが同じ構造を持つ場合、会社はソリューションを使用して、データベース フリート全体で一般的なパフォーマンスの問題を特定して解決しています。 1 つのデータベースで問題が特定されると、修正プログラムがすべてのデータベースにデプロイされ、すべての SnelStart のお客様にすぐにメリットが生まれます。</p>


  <h2>大規模な 35 TB のフリートでのロックのSQL Database見つける</h2>


  <p><a href="https://visualstudio.microsoft.com/tfs/" target="_blank">Microsoft TFS は</a> 、開発者コミュニティと顧客をサポートするオンライン サービスを提供します。 これは、顧客ベース全体で数兆行のコードを処理する複雑なシステムです。 このサービスでは、高度なレポート、ビルド、ラボ、テスト、チケット作成、リリース自動化管理 &ndash; 、プロジェクト管理などが提供されます。 TFS では、24 時間 365 日のサービスをグローバルに提供し、最高のパフォーマンスを提供する必要があります。 クリックしてコードをチェックインした後、または TFS チケットを作成する場合は、サービスからのプロンプト応答が必要です。 TFS の大規模なインフラストラクチャは、約 900 台のデータベースSQL 35 TB のデータが格納されたデータベースで実行されます。</p>


  <p>TFS では、以前は、低速クエリと高い CPU 期間を監視できる独自の監視およびアラート ソリューションを使用しました。 ある場合、既存のツールはパフォーマンスの問題を特定し、データベースに対して大きなロックが存在するという浅い分析のみを提供しますが、それ以外は何もありません。 さらにトラブルシューティングを行った結果、ロックがテーブルスコープであり、ロックのパーティション分割に関連している可能性が示されています。 つまり、統計に表示される影響を受ける低速クエリは、通常、ロックの根本原因ではなく、ロックを引き起こす他のブロック クエリの表面的な影響に限定されます。 このような場合のワークロードは積み上がり続けるので、より大きなリソース プールへのアップグレードは、短期間のソリューションにしかならないほどです。 この問題を解決する唯一の方法は、ブロッキング クエリを見つけて修正することでした。</p>


  <p>このような場合のトラブルシューティングは、通常、DBA のかなりのスキルが必要であり、非常に時間がかかるので、非常に困難です。 TFS は、パフォーマンスのインサイトに役立つインテリジェント な機能に変更しました。 この特定のケースでは、ワークロードの増加に関連するアプリケーションの増加がシステムによって特定され、影響を受けるクエリとブロックしているクエリの一覧が提供されています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0c6bb9ff-07bc-40b6-a0d5-abbb8f7a85ae.png"><img alt="image_003" border="0" height="382" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/63f54d00-ffce-4beb-b91c-9be439ad05c1.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="image_003" width="974"></a></p>


  <p>ブロック クエリの分析により、これは未使用の添付ファイルを削除するために定期的にスケジュールされたメンテナンス クエリだったと確認されました。 コードをさらに分析すると、削除バッチのサイズが大きすぎて問題が発生したと判断しました。 バッチ サイズが小さい新しいクエリが迅速にデプロイされました。このクエリは、負荷の高いロックを解決し、ワークロードの負荷を徐々に軽減するのに即座に影響を与えました。</p>


  <p>TFS の要求の厳しいインフラストラクチャを維持するには、最適な Microsoft エンジニアが必要です。 Microsoft の最高の SQL パフォーマンス トラブルシューティング ツールの 1 つ、TFS のプリンシパル ソフトウェア エンジニアである Remi Lemarchand 氏が、次の話を聞いて、このバーに確実に会いました。</p>


  <p><em>&ldquo;インテリジェント インサイトは、データベースのパフォーマンスの問題を見つけるのに最適な仕事です。その場で常に正しいと思います。&rdquo;</em></p>


  <p align="right">Remi Lemarchand、Microsoft TFS のプリンシパル ソフトウェア エンジニア。</p>


  <p>Remi は、Intelligent インサイト を使用してデータベースのパフォーマンスの問題をトラブルシューティングしてから、提供される深さのレベルが原因で他のツールに移行し、手動の DBA トラブルシューティング時間を大幅に短縮することを優先すると結論付けしました。 ブロッキング クエリに修正を適用した後、データベースはうまく機能しています。</p>


  <h2>まとめ</h2>


  <p>AI とクラウドのAzure SQL Database、以前は実現できないインテリジェントなパフォーマンスの破壊的な新機能が生み出されました。 小規模および中規模のビジネスでは、小規模なスタッフで大規模に Azure を使用して、インフラストラクチャを独自に実行する場合と比べて大幅に低コストで、より多くのことを行える状態になりました。 SQL Database インテリジェントなパフォーマンスは、場合によっては数か月に比べて、1 日で数万のデータベースの運用上の問題を特定するのに役立つ可能性があるので、大企業や企業は、DBA や DevOps からのストレスを軽減し、ストレスを軽減できます。</p>


  <p>パフォーマンスの問題のトラブルシューティングSQL Databaseインテリジェント インサイトの使用を開始する方法については、「<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-intelligent-insights" target="_blank">Log Analytics</a> を使用してインテリジェント なデータをインサイトする」を参照してください。</p>


  <p>インテリジェントなパフォーマンス製品SQL Databaseについては、「<a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-sql" target="_blank">Azure SQL データベースを Azure SQL Analytics</a> で監視する」および「Azure SQL Database での自動チューニング」<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-automatic-tuning" target="_blank">を参照してください</a>。</p>


  <p>インテリジェントなパフォーマンスを実現する方法をSQL Databaseをお知らせください。</p>
