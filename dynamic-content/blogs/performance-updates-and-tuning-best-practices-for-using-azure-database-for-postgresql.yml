### YamlMime:Yaml
ms.openlocfilehash: 7d15a2866bd567b8f8c23c8f8da0018451d37f26
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139903989"
Slug: performance-updates-and-tuning-best-practices-for-using-azure-database-for-postgresql
Title: Azure Database for PostgreSQL を使用するためのパフォーマンスの更新とチューニングのベスト プラクティス
Summary: 2018年3月に、マイクロソフトは Azure Database for PostgreSQL の一般提供を発表しました。 インフラストラクチャ管理、データの可用性、保護、およびスケールに関する複雑性を排除する、シンプルで完全に管理された PostgreSQL 用データベースサービス。
Content: >-
  <p>2018年3月に、Microsoft は Azure Database for PostgreSQL の一般提供を発表しました。これは、インフラストラクチャの管理、データの可用性、保護、およびスケールに関する複雑性を排除する、完全に管理された PostgreSQL 用データベースサービスです。 このサービスでは、今後も大幅な成長が見られます。また、Amit it が <a href="https://azure.microsoft.com/en-us/blog/performance-best-practices-for-using-azure-database-for-postgresql/" target="_blank">Azure Database for PostgreSQL を使用するためのパフォーマンスのベストプラクティスについ</a> て説明してから、サービスのパフォーマンスがさらに向上しています。 さらに、お客様の&#39; ワークロードに関するハンズオンエクスペリエンスを通じて、ワークロードをチューニングするためのベストプラクティスをいくつか決定しました。 この記事では、ワークロードの特性に基づいて考慮する必要があるサービスのパフォーマンス向上とパフォーマンスチューニングのベストプラクティスについて説明します。 &nbsp; これらのベストプラクティスは、それぞれに関連付けられている可能性があるため、すべてテストすることをお勧めします。</p>


  <h2>サービスの機能強化</h2>


  <p>最近のサービスの改善は、ストレージと CPU の最適化に関連しており、IO 待機時間と CPU 効率が向上しています。 <strong>I/o 集中型のワークロード</strong> と読み取り負荷の <strong>高いワークロード</strong> では、これらの機能強化によって最も大きなメリットが得られます。</p>


  <h2>チューニングのベストプラクティス</h2>


  <p>パフォーマンスを向上させるために、PostgreSQL データベースとアプリケーションを最適化するにはさまざまな方法があります。 この投稿では、次のように、最適化に関するアイデアを共有しています。</p>


  <ul>
   <li>自動バキューム</li>
   <li>一括挿入</li>
   <li>クライアント アプリケーション</li>
  </ul>


  <h3>自動バキュームの最適化</h3>


  <p>PostgreSQL は、MVCC を使用して、データベースの同時実行の強化を実現しています。 すべての更新は結果として挿入と削除になり、すべての削除は結果として、削除対象のためにソフト マークされている行になります。 これにより、後で削除する必要がある dead タプルが生成されます。 PostgreSQL は、vacuum ジョブを実行してこれを実現します。</p>


  <p>Vacuum ジョブは手動または自動でトリガーできます。 データベースの更新操作や削除操作が大量に発生し、アイドル時により少なくなると、負荷が高い状態で vacuum をより頻繁に実行する必要がある場合に、デッドタプルが増加します。 これにより、vacuum ジョブの実行が手動で不便になります。</p>


  <p>一方、自動バキュームは構成でき、チューニングによってメリットがあります。 PostgreSQL 出荷時の既定値は、Raspberry Pi など、どのような種類のデバイスでも製品が確実に機能するようになっていて、理想的な構成値は、以下のようにいくつかの要因に左右されます。</p>


  <ul>
   <li>使用可能な合計リソース - SKU とストレージ サイズ。</li>
   <li>リソースの使用状況。</li>
   <li>個々のオブジェクトの特性。</li>
  </ul>


  <p>自動バキュームのコストの使用、構成、監視、および評価の詳細については、 <a href="https://docs.microsoft.com/en-us/azure/postgresql/howto-optimize-autovacuum" target="_blank">Azure Database for PostgreSQL サーバー</a> &quot; での自動バキュームの最適化に関するページを参照してください &quot; 。</p>


  <h4>リファレンス</h4>


  <p>PostgreSQL ドキュメント<a href="https://www.postgresql.org/docs/9.5/static/runtime-config-autovacuum.html" target="_blank">では、サーバーの構成に関する</a> &ndash; 第18章を参照してください。</p>


  <p>PostgreSQL のドキュメント &ndash; <a href="https://www.postgresql.org/docs/9.6/static/routine-vacuuming.html" target="_blank">では、24章で定期的なデータベースメンテナンスタスクを</a>行います。</p>


  <h3>一括挿入の最適化</h3>


  <p><strong>一時的なデータ</strong>を含むワークロード操作がある場合や、<strong>大量のデータセットを一括で挿入</strong>する場合は、 <strong>unlogged テーブル</strong>の使用を検討してください。</p>


  <p>Unlogged テーブルの使用方法の詳細については<a href="https://docs.microsoft.com/en-us/azure/postgresql/howto-optimize-bulk-inserts" target="_blank">、「Azure Database for PostgreSQL サーバーでの一時的なデータの一括挿入と使用の最適化</a>」を参照してください &quot; 。 &quot;</p>


  <h4>リファレンス</h4>


  <p>PostgreSQL ドキュメント &ndash; <a href="https://www.postgresql.org/docs/current/static/sql-createtable.html" target="_blank">Create Table SQL コマンド</a></p>


  <h3>クライアントアプリケーションの最適化</h3>


  <h4>TCP_NODELAY</h4>


  <p>既定では、TCP では、送信パケットのバッチ処理によって最適化される Nagle&#39;s アルゴリズムが使用されます。 これは、送信が減ることを意味し、アプリケーションがパケットを頻繁に送信し、待機時間が最高の優先順位ではない場合に適しています。 待機時間の増加は、TCP_NODELAY オプションを有効にして作成されたソケットで送信することで実現できます。 この結果、待機時間は短くなりますが、送信が多くなります。 &nbsp; TCP_NODELAY は、クライアントの仮想マシン (VM) で考慮する必要があるクライアント側の設定です。 通常、TCP_NODELAY オプションの恩恵を受けるアプリケーションは、少量の書き込みを低頻度で行い、待機時間に特に影響されやすい傾向があります。 たとえば、この設定では、待機時間を15-40 ミリ秒から2-3 ミリ秒に減らすことができます。</p>


  <h4>CPU の枯渇</h4>


  <p>Azure Database for PostgreSQL サーバーの CPU 使用率/CPU 使用率が100% で飽和状態になっている場合は、最初に PostgreSQL で <strong>pg_stat_statements</strong> を使用して、どのクエリの実行に時間がかかっているかを判断します。 実行時間の長いクエリを最適化した後、CPU の使用率が依然として高い場合は、次の仮想コア レベルへのスケールアップを検討します。 たとえば、General Purpose の 4 仮想コアで CPU 使用率が常に 100% 付近になっている場合は、General Purpose の 8 仮想コアにスケールアップします。</p>


  <p>高い CPU 使用率は、CPU のボトルネックを示すだけではありません。 シングルスレッド アプリケーションの場合、1 つの CPU だけ最大限に使用され、他の CPU の使用率は低いままになることがあります。 使用可能なすべての仮想コアを利用するには、ワークロードの並列化を検討します。</p>


  <h4>Pg_stat_statements の最適化</h4>


  <p>Pg_stat_statemetns とクエリストアの使用方法の詳細については、 <a href="https://docs.microsoft.com/en-us/azure/postgresql/howto-optimize-query-stats-collection" target="_blank">Azure Database for PostgreSQL server</a> &quot; のクエリ統計の最適化のコレクションに関するページを参照してください &quot; 。</p>


  <h4>トーストテーブルストレージ戦略によるクエリ時間の最適化</h4>


  <p>TOAST 可能な列をディスクに格納するための戦略には、圧縮と行外の格納のさまざまな組み合わせを表す 4 つの異なる戦略があります。 データ型のレベルと列のレベルで戦略を設定できます。</p>


  <p>トーストテーブルストレージ戦略の詳細については、「<a href="https://docs.microsoft.com/en-us/azure/postgresql/howto-optimize-query-time-with-toast-table-storage-strategy" target="_blank">トーストテーブルストレージ戦略</a> &quot; によるクエリ時間の最適化」を参照してください &quot; 。</p>


  <h4>リファレンス</h4>


  <p>PostgreSQL ドキュメント &ndash; <a href="https://www.postgresql.org/docs/10/static/storage-toast.html" target="_blank">の章66、データベースの物理 Storage</a>。</p>


  <h2>謝辞</h2>


  <p>Saikat は、Sunil Kamath、Fady Sedrak、Raymond Martin、Sameer Arora、Kamil/、Rachel Agyemang、Gop Ini Gupta、Jan Engelsberg、Bhavin Gandhi、Arora Sundaram、および Michal Primke を使用して、この投稿への投稿に感謝します。</p>


  <p><a href="https://azure.microsoft.com/en-us/services/postgresql/" target="_blank">Azure Database for PostgreSQL サービス</a>を利用できることを願っています。 次に参照する <a href="https://feedback.azure.com/forums/597976-azure-database-for-postgresql" target="_blank">機能についてのフィードバック</a> を引き続き提供してください。 <a href="https://azure.microsoft.com/en-us/free/" target="_blank">無料の Azure アカウント</a>を作成し、 <a href="https://ms.portal.azure.com/#create/Microsoft.PostgreSQLServer" target="_blank">Azure Database for PostgreSQL のインスタンスを作成</a>して、今すぐ開始してください。 ヘルプが必要な場合、または質問がある場合は、 <a href="https://docs.microsoft.com/en-us/azure/postgresql/" target="_blank">Azure Database for PostgreSQL のドキュメント</a>を参照してください。 また、Ask Azure DB for PostgreSQL エイリアスを使用して microsoft に連絡することもできます。また、最新のニュースと発表については、Twitter <a href="https://twitter.com/AzureDBPostgres" target="_blank">@AzureDBPostgres</a> および<a href="https://twitter.com/search?q=%23PostgreSQL&amp;f=images&amp;src=tyah" target="_blank"> # PostgreSQL</a>についてご確認ください。</p>
