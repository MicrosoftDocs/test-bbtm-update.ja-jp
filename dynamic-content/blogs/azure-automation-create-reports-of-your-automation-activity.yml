### YamlMime:Yaml
ms.openlocfilehash: 9b18c077335a4f84b4532d3c2102008e5b956db9
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891192"
Slug: azure-automation-create-reports-of-your-automation-activity
Title: 'Azure Automation: Automation アクティビティのレポートを作成する'
Summary: Runbook とジョブが Azure Automation アカウントでどのように実行されているかを最新の状態に保つために、runbook AutomationReport を紹介します。
Content: >-
  DevOps と IT プロフェッショナルにとって、 <a href="https://azure.microsoft.com/en-us/services/automation/" target="_blank">Azure Automation</a>を使用すると、runbook を作成して起動し、重要なリソースに対して繰り返し、複雑で時間のかかるタスクを自動化することができます。自動化されたタスクの重要性により、自分とチームが runbook の実行方法を最新の状態にすることが重要です。以前の日または週、実行した runbook、ジョブの状態、調査が必要な問題、および runbook が変更されたかどうかを知りたいと思いますか。最新の状態を維持する方法の1つとして、Azure Automation 自体を使用してレポートを作成および送信する方法があります。この記事では、runbook New-AutomationReport を紹介します。 runbook とジョブに関する情報を、定期的なスケジュールに基づいて電子メールで送信できるレポートに作成します。

  <h2>キーデータ</h2>

  Runbook とジョブは、追跡する Azure Automation の重要なオブジェクトです。Runbook は、重要なプロセスを自動化するためのロジックを含む PowerShell ワークフローであり、ジョブは runbook の個別の実行です。このため、システム上のすべてのレポートが、runbook とそのジョブに重点を置いていることは驚くことではありません。

  <h2>レポート</h2>

  <h3>一般情報</h3>

  レポートの上部には、レポートの範囲を示す情報が表示されます (期間、サブスクリプション、および Automation アカウント)。


  この期間は、レポートの runbook が開始された時点で常に終了します。構成によっては、開始時刻が1日またはそれ以前の1日以上になります。


  各レポートは、1つの Automation アカウント用であることに注意してください。複数のアカウントがある場合は、アカウントごとに New-AutomationReport runbook をインポートして構成する必要があるすべてのアカウントのレポートを取得します。


  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="一般情報" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/GeneralInfo.png" alt="General information" width="480" height="219" border="0" />

  <h3>ジョブのある runbook</h3>

  最初に知りたい情報の1つは、どの runbook が実行されているかということです。 期間中にジョブがあった runbook の一覧をすばやくスキャンし、各ジョブがどのように機能しているかを確認します。


  Runbook にはビジネスプロセスのロジックが含まれているため、各 runbook の名前 (各 runbook の内部動作に関する知識も含む) によって、実行されたプロセスと、Azure またはサードパーティシステムで行われた変更が通知されます。1つまたは複数のジョブの状態が "失敗"、"中断"、"停止"、"エラーが発生しました"、または "キューに登録済み" の場合、調査対象として強調表示されます。


  この情報は、レポート期間中に1つ以上のジョブがあった runbook ごとに1行のテーブルに表示されます。Runbook ごとに、特定の状態のジョブの数を確認できます。


  次の表では、runbook ジョブの正常性の概要を説明し、さらに調査が必要なジョブがあるかどうかをすばやく確認できるようにします。


  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="ジョブのある runbook" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/RunbooksWithJobs.png" alt="Runbooks With Jobs" width="610" height="195" border="0" />

  <h3>ジョブ</h3>

  レポート期間中にジョブを含む runbook の概要を確認すると、レポートには、特にジョブに焦点を当てたセクションが表示されます。このセクションでは、発生した問題のあるジョブをドリルダウンするのに役立ちます。レポートのこのセクションには、最初に、実行されたジョブの合計数と、各ジョブの状態におけるジョブの数の概要が表示されます。"完了したエラー"、"失敗"、"キューに登録済み"、"停止"、または "中断" という状態のジョブがある場合は、レポートによってそれらのジョブの詳細がサブセクションに表示されます。Azure Automation ポータルで runbook 名とジョブ id を使用してジョブを検索し、ジョブの詳細にドリルダウンして問題のトラブルシューティングを行うことができます。

  <blockquote>注: 表示されているジョブの状態は、レポートの実行時にデータベースに存在していたものです。 そのため、キューに登録されたジョブは、レポートの表示時に開始および完了した可能性があり、実行中のジョブが最終的な状態になっている可能性があります。 これらはいずれも、次のレポートには最終的な状態と共に表示されます。</blockquote>

  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="ジョブ" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Jobs.png" alt="Jobs" width="610" height="572" border="0" />

  <h3>変更された Runbook</h3>

  レポートの最後のセクションには、変更された runbook、またはレポートの期間中に状態が変更された runbook が表示されます。これには、作成された "新しい" runbook、期間中に発行されたすべての runbook、および変更されている "編集中" の runbook が含まれます。 Azure Automation の runbook で動作するチームがある場合は、runbook が動作している runbook と、最近公開された runbook のタブを維持するのに役立ちます。


  &nbsp;


  <img style="margin-left: 0px; margin-right: 0px; border: 0px;" title="ModifiedRunbooks" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ModifiedRunbooks.png" alt="ModifiedRunbooks" width="480" height="196" border="0" />


  &nbsp;

  <h2>New-AutomationReport Runbook のインポートと構成</h2>

  Automation ギャラリーから Automation アカウントに New-AutomationReport runbook をインポートできます。Azure portal の [ <strong>+ 新規</strong> ] をクリックするだけで、新しい Automation Runbook を作成できます。クリックして <strong>ギャラリーから</strong>インポートし、ウィザードで [New-AutomationReport] を選択します。


  Runbook をインポートしたら、いくつかのアセットを設定する必要があります (これは、他の多くの runbook でも役に立ちます)。

  <ol>
   <li>Azure サブスクリプションへの管理アクセス権を持つ Azure AD 資格情報を含む資格情報資産。 詳細については、こちらの <a href="https://aka.ms/runbookauthor/authentication" target="_blank">投稿</a>を参照してください。</li>
   <li>Azure サブスクリプション名を含む変数資産。</li>
   <li>Automation アカウント名を含む変数資産。</li>
   <li>SMTP サービスの資格情報を含む資格情報資産。</li>
  </ol>

  &nbsp;


  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="作成する必要のあるアセット" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Assets.png" alt="Assets that you need to create" width="610" height="88" border="0" />


  &nbsp;


  また、レポートを電子メールで送信するには、runbook を編集し、いくつかの SMTP メールプロパティを構成する必要があります。<a href="https://technet.microsoft.com/en-us/library/hh849925.aspx" target="_blank">Send-mailmessage</a>とそのパラメーターの詳細については、こちらを参照してください。


  &nbsp;


  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="SMTP 電子メールの構成" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/emailinfo.png" alt="Configuration for SMTP email" width="610" height="186" border="0" />


  &nbsp;

  <h2>スケジュールに基づくオートメーションレポートの実行</h2>

  この runbook を自動的に開始する定期的なスケジュールを設定することが必要になる場合があります。たとえば、毎日 automation を確認する場合は、日単位のスケジュールを作成し、runbook をリンクします。Runbook をスケジュールにリンクするウィザードでは、runbook が入力に使用する3つのパラメーターを設定する必要があります。 <strong>NumberOfDaysForReport</strong> は、レポートの日数を示す整数です。 <strong>OutputHtml</strong> は、レポートを HTML またはプレーンテキストとして書式設定するかどうかを示すブール値です。また、送信された <strong>Reportbyemail</strong> は、レポートを SMTP 経由で送信するか、ジョブ出力に格納するかを示すブール値です。次のスクリーンショットでは、この点を説明します。


  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="スケジュールなし" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule1.png" alt="No schedules" width="610" height="159" border="0" />

  <p align="center">1</p>

  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="スケジュールを選択します" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule2.png" alt="Select the schedule" width="610" height="357" border="0" />

  <p align="center">2</p>

  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="Runbook の入力パラメーターを設定する" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule3.png" alt="Set input parameters for the runbook" width="610" height="343" border="0" />

  <p align="center">3</p>

  <img style="float: none; margin-left: auto; margin-right: auto; border-width: 0px;" title="スケジュールが runbook に関連付けられるようになりました" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule4.png" alt="Schedule is now associated with the runbook" width="610" height="116" border="0" />

  <p align="center">4</p>


  <h2>まとめ</h2>

  各 Azure Automation アカウントで New-AutomationReport runbook を使用すると、runbook とジョブの正常性に関するレポートを自動的に受け取ることができます。Runbook をスケジュールにリンクして、電子メールでレポートを受信するように設定することによって、ハンズフリーのレポートを設定し、毎日受信トレイにキー情報を受信することができます。


  この runbook は進行中の作業であることに注意してください。さらに多くのレポートを今後追加するためのアイデアがあります。更新プログラムについては、ときどきギャラリーを確認し、独自のレポートアイデアでコメントを残しておきます。


  Azure Automation を使い始めたばかりですか? <a href="https://aka.ms/Q2p1ap" target="_blank">ここでサービスについて説明</a>し、 <a href="https://twitter.com/AzureAutomation" target="_blank">Twitter の Azure Automation</a>に従います。
