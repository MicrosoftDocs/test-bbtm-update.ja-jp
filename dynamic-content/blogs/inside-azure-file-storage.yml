### YamlMime:Yaml
ms.openlocfilehash: 8103fa2ec7f1b587cfdc6c4eba0423a749f7a3c6
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139908952"
Slug: inside-azure-file-storage
Title: Inside Azure File Storage (Azure File Storage の内部)
Summary: microsoft では、AzureCon 2015 で Azure File Storage、クラウドで完全に管理されたファイル共有 Microsoft Azure の一般提供を発表しました。また、サービスの構築方法についての内部ビューを提供したいと考えています。
Content: >-
  <p>今週は、 <a href="https://azure.microsoft.com/en-us/blog/azure-file-storage-now-generally-available/">Azure File Storage の一般提供</a>を発表し、AzureCon 2015 のクラウドで完全に管理されたファイル共有を Microsoft Azure &rsquo; しました。 現在、サービスの構築方法についての内部ビューを提供したいと思っ &rsquo; ています。</p>


  <p>Windows のファイルサーバーを使用するだけではなく、Azure File Storage で非常に異なるアプローチを採用しました。 Azure Storage のスケーラビリティを活用するために、azure File Storage では、azure のハイパースケールで特に実行する SMB 3.0 プロトコルが実装されています。 内部的には、azure File Storage は<a href="https://msdn.microsoft.com/en-us/magazine/dn166928.aspx">azure Table Storage</a>インフラストラクチャを使用して、従来のファイルシステムで管理されている SMB 3.0 クラスターソリューションのファイルとディレクトリのメタデータを格納します。 同様に、azure File Storage は各ファイル &rsquo; のデータを<a href="https://msdn.microsoft.com/en-us/library/azure/ee691964.aspx">azure ページ Blob</a>に格納します。 azure のテーブルと Blob Storage は、非常にスケーラブルで信頼性が高く、持続性があるため、azure File Storage ストアはこれらのプロパティを継承し、実際に有効でアクティブな継続的に使用可能なファイル共有を提供します。</p>


  <p>これらの内部 azure テクノロジを使用して azure File Storage を実装する利点は、azure ファイル共有に<a href="https://msdn.microsoft.com/en-us/library/azure/dn167006.aspx">REST インターフェイス</a>を提供できることです。 Smb クライアントの場合と同様に、アプリケーションでは、クライアントが smb インターフェイスを呼び出すときに、ファイルの REST インターフェイスを使用できます。これは、smb の <a href="https://msdn.microsoft.com/en-us/library/hh536501.aspx">リース</a>、バイト範囲のロック、変更通知などが REST API によって受け入れされるためです。</p>


  <p>一般公開バージョンの Azure File Storage の smb 3.0 サポートのリリースで追加された2つの主な機能は、プレビューで実装されている、シームレスな暗号化と永続的なハンドルである smb 2.1 プロトコルでは利用できません。 送信中の SMB 暗号化では、クライアントとサーバーの両方で SMB &rsquo; s バージョン3.0 プロトコル以降をサポートする必要があります。 セッションごとの暗号化キーが自動的に生成されるように共同作業を行うため、クライアントアプリケーションは機能を使用するために変更を加える必要がありません。 SMB 3.0 では、クライアント/サーバー通信の機密性と整合性を保証するために、[<a href="https://www.ietf.org/rfc/rfc4309.txt">RFC4309</a>] で指定されている実証済みの AES 128 CCM 暗号化アルゴリズムを使用します。</p>


  <p>暗号化を追加することにより、Azure データセンターの外部のクライアントは、man-in-the-middle 攻撃による盗聴や改ざんを心配せずに Azure ファイル共有を使用できます。 ユーザーまたはアプリケーションは、内部設置型クライアントからクラウドでホストされている共有を文字どおり &lsquo; 使用 &rsquo; できます。 これにより、オンプレミスのファイル共有を使用するように構成を Azure File Storage 共有に変更するだけで、アプリケーションの一部をオンプレミスに保持できるようになったため、リフトアンドシフト &rdquo; のプロジェクトを加速 &ldquo; させることができます。 azure の外部から azure File Storage を使用する場合は、待機時間がより高くなりますが、 <a href="https://azure.microsoft.com/en-us/services/expressroute/">ExpressRoute</a>ネットワークを使用して、専用帯域幅を使用した高可用性接続を保証できます。 Azure の外部から共有をマウントするには、ポート 445 (TCP 送信) が ISP またはファイアウォールによってブロックされていないことが必要です。</p>


  <p>次の図は、1つのオンプレミスと azure データセンター内の2つのクライアントを示しています。これは、同じ共有に接続しており、同時に同じファイルの読み取り/書き込みを行うことができます (実際に別の Azure File Storage フロントエンドに接続されている場合でも)。 分散型整合性アルゴリズムを使用すると、Azure File Storage は同じ物理 SMB サーバーに接続されているかのように、同じ一貫性を保証します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/28f018a8-63c0-421a-af8f-c0fbe5dd5e63.png"><img alt="Two client diagram" border="0" height="449" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/03c54412-b227-417d-89f0-9250c01facb2.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; border-left: 0px; display: block; padding-right: 0px; margin-right: auto" title="2つのクライアント図" width="775"></a></p>


  <p>SMB 3.0 サポートで導入された2番目の機能は、永続的なハンドルです。 永続ハンドルは、永続的なハンドルの<a href="https://msdn.microsoft.com/en-us/library/cc246790.aspx">制限</a>の一部を削除する SMB 2.1 永続ハンドルの拡張機能です。また、ネットワークの中断後に Azure File Storage が使用するクライアントによって管理され、接続が切断される前に永続的にがどのデータをコミットするかを認識しているクライアントによって送信される追加の状態が含まれます。 これは、べき等ではない要求では特に重要です。これは、既に正常にコミットされている場合に Azure File Storage によって再生されると、アプリケーションレベルのデータが破損する可能性があるためです。 永続ハンドルは、永続ハンドルとは異なり、透過的な再接続を可能にします。</p>


  <p>azure File Storage の使用方法の詳細については、「azure <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-how-to-use-files/">File Storage for Windows</a> 」と「azure<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-how-to-use-files-linux/">はじめに for Linux</a>のはじめに」を参照してください。</p>
