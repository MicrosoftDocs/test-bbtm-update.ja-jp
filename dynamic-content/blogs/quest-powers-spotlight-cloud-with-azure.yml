### YamlMime:Yaml
ms.openlocfilehash: bf35d48bc89a1e6c1eb8f21f1fdc53d203f50f3f
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889055"
Slug: quest-powers-spotlight-cloud-with-azure
Title: Azure でのスポットライトクラウドのパワー
Summary: スポットライトクラウドは、SQL Server のお客様を対象とした Azure database performance monitoring ソリューションを初めて構築したものです。 Microsoft Azure Cosmos DB のスケーラビリティ、パフォーマンス、グローバル分散、高可用性、および組み込みのセキュリティを活用して、スポットライトクラウドは、クラウドの最高レベルと Quest ソフトウェアのエンジニアリングに関する洞察を、長年にわたるデータベースパフォーマンス管理ツールを構築しています。
Content: >-
  <p><em>このブログ投稿は、Liz Yu (Marketing)、Bryden Oliver (アーキテクト)、iain Shepherd (シニアソフトウェアエンジニア)、スポットライトクラウド、Deborah Chen (program manager)、スリランカ (program manager) を Azure Cosmos DB で共同作成しました。</em></p>


  <p>&nbsp;</p>


  <p><img height="54" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1Zal06uUBAicxYjxGfVMcCxG7v-lROUk3a4CLfPtxmc-d_EK-bxSKK7-yPgAdiFBV0yZdjwtM-GHIJn8S-sCZg56p9m-smhwwZ81yHqdADJBnKwBQPE7Ah-qeZI6pDnczg" style="margin: 6px 12px 0px 0px; float: left; display: inline;" width="200"><a href="https://www.spotlightcloud.io/" target="_blank">スポットライトクラウド</a>は、SQL Server のお客様を対象とした Azure database performance monitoring ソリューションを初めて構築したものです。 Microsoft Azure Cosmos DB のスケーラビリティ、パフォーマンス、グローバル分散、高可用性、および組み込みのセキュリティを活用して、スポットライトクラウドは、クラウドの最高レベルと Quest ソフトウェア &rsquo; のエンジニアリングに関する洞察を、長年にわたるデータベースパフォーマンス管理ツールを構築しています。</p>


  <p>お客様が SQL ソリューションをより高い可用性、スケーラビリティ、および迅速に解決できるようにするためのデータベースインサイトを提供するツールとして、スポットライトクラウドでは、バックエンドにも正確な要件を提供するデータベースサービスが必要でした。</p>


  <p><a href="https://azure.microsoft.com/services/cosmos-db/" target="_blank">Azure Cosmos DB</a>と<a href="https://azure.microsoft.com/services/functions/" target="_blank">Azure Functions</a>を使用することで、Quest は2か月以内に概念実証を構築し、運用環境に8か月以内にデプロイできるようになりました。</p>


  <p><em>&ldquo;Azure Cosmos DB によって、アプリケーションの規模に応じて拡張が可能になります。より多くの顧客をオンボードすると、パフォーマンス、待機時間、および Azure Cosmos DB から得られる可用性に関して予測可能性が高まります。&rdquo;</em></p>


  <p align="right">- パトリック O &rsquo; Keeffe、ソフトウェアエンジニアリング担当副社長、Quest ソフトウェア</p>


  <h2>スポットライトクラウドの要件</h2>


  <p>ビジネスをサポートするために必要なデータの量が継続的に増大します。 データの規模が変化するにつれて、すべてのデータを分析する必要があるため、スポットライトがクラウドになります。 Quest &rsquo; の開発者は、次の要件と手頃な価格で高可用性データベースサービスを必要としていました。</p>


  <ul>
   <li>さまざまな種類のデータを収集して格納し、Azure ベースのストレージサービスに送信します。 データは SQL Server dmv、OS パフォーマンスカウンター統計、SQL プラン、およびその他の有用な情報から取得されます。 収集されるデータは、サイズ (100 バイトから複数メガバイト) と形に大きく異なります。</li>
   <li>スポットライトクラウドを使用するよりも多くのお客様を対象にして、データに対して1200操作/秒を受け入れることができます。</li>
   <li>SQL Server パフォーマンスの問題を迅速に診断および分析するために、データのクエリと返送を行うことができます。</li>
  </ul>


  <p>多くの製品を十分に評価した後、Quest はソリューションのバックボーンとして Azure Functions を選択し、Azure Cosmos DB しました。 スポットライトクラウドは、Azure Function app と Azure Cosmos DB の両方を利用してコストを削減し、パフォーマンスを向上させ、顧客により優れたサービスを提供してきました。</p>


  <h2>ソリューション</h2>


  <p><img alt="Diagram displaying data flow in Spotlight Cloud" height="875" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/uvSU7EtTTmOkBc8NpsiW3h1WTU5015wTQvG0D6sF4SHXfivupXeLsEDp2Yyk66lydDihQPch7X8iZe3y3Y90HUwapYfaDKXMQ_80GX1DgUyu8s2UpfrdOBJLes6GaeQv7A" title="スポットライトクラウドのデータフロー" width="1299"></p>


  <p align="center"><em>スポットライトクラウドのコアデータフローの一部。表示されていないその他のテクノロジには、Event Hub、Application Insights、Key Vault、Storage、DNS が含まれます。</em></p>


  <p>スポットライトクラウド内のコアデータ処理フローは Azure Functions と Azure Cosmos DB に基づいて構築されています。 このテクノロジスタックは、必要な高スケールとパフォーマンスを追求しています。</p>


  <table border="1" cellpadding="2">
   <tbody>
    <tr>
     <td>
     <p>スケール</p>

     <p>&nbsp;</p>
     </td>
     <td>
     <p>インジェストアプリは、1秒あたり1000の顧客監視データのセットを処理 &gt; します。 これをサポートするために、Azure Functions 従量課金プランでは、最大100個の Vm に自動スケールアップできます。</p>

     <p>Azure Cosmos DB は、データベースとコンテナーのスループットを保証し、要求ユニット/秒 (RU/秒) で測定し、sla によって支えます。 ワークロードの必要なスループットを見積もり、RU/秒に変換することで、Quest は Azure Cosmos DB に対する読み取りと書き込みの予測可能なスループットを任意のスケールで実現できました。</p>
     </td>
    </tr>
    <tr>
     <td>
     <p>パフォーマンス</p>

     <p>&nbsp;</p>
     </td>
     <td>
     <p>Azure Cosmos DB は、スポットライト &rsquo; s データの書き込み操作と読み取り操作を60ミリ秒で &lt; 処理します。 これに SQL Server より &rsquo; 、データを迅速に取り込まれたし、ほぼリアルタイムで分析することができます。</p>
     </td>
    </tr>
    <tr>
     <td>
     <p>高可用性</p>

     <p>&nbsp;</p>
     </td>
     <td>
     <p>Azure Cosmos DB は、2つ以上のリージョンを使用する場合に、読み取りと書き込みに対して99.999% の高可用性 SLA を提供します。 スポットライトクラウド &rsquo; のお客様にとって可用性は非常に重要です。多くの場合、医療、小売、金融サービス業界で、データベースのダウンタイムやパフォーマンスの低下を経験する余裕はありません。 フェールオーバーが必要な場合、Azure Cosmos DB は手動による介入なしで自動フェールオーバーを行い、ビジネス継続性を実現します。</p>

     <p>ターンキーグローバル分散を使用すると、Azure Cosmos DB は、リージョン間でのデータの自動レプリケーションと非同期レプリケーションを処理します。 プロビジョニングされたスループットを最大限に活用するために、では1つのリージョンで書き込み (データ取り込み) を処理し、もう1つは読み取り用に指定しています。 このため、ユーザー &rsquo; の読み取り応答時間は書き込みボリュームの影響を受けません。</p>
     </td>
    </tr>
    <tr>
     <td>
     <p>柔軟なスキーマ</p>

     <p>&nbsp;</p>
     </td>
     <td>
     <p>Azure Cosmos DB は、さまざまなサイズとスキーマの JSON データを受け入れます。 これにより、SQL Server dmv や OS パフォーマンスカウンターの統計など、さまざまなソースからさまざまなデータを格納し、固定スキーマやスキーマ管理について心配する必要がなくなりました。</p>
     </td>
    </tr>
    <tr>
     <td>
     <p>開発者の生産性</p>

     <p>&nbsp;</p>
     </td>
     <td>
     <p>Azure Functions ツールを使用すると、開発とコーディングのプロセスが非常にスムーズになり、開発者はすぐに生産性を向上させることができました。 また、開発者は、SQL クエリ言語を使いやすくして、増加時間を短縮する Azure Cosmos DB &rsquo; を見つけることもできました。</p>
     </td>
    </tr>
    <tr>
     <td>
     <p>コスト</p>

     <p>&nbsp;</p>
     </td>
     <td>
     <p>Azure Functions 従量課金モデルは、各関数呼び出しで使用される計算とメモリに対してのみ課金されます。 特に、低ボリュームのマイクロサービスの場合、ユーザーは低コストで運用できます。 さらに、従量課金プランで Azure Functions を使用すると、フェールオーバーインスタンスを常にスタンバイ状態にすることができ、フェールオーバーインスタンスが実際に使用されている場合にのみコストが発生します。</p>

     <p><a href="https://docs.microsoft.com/azure/cosmos-db/total-cost-ownership" target="_blank">総保有コスト (tco)</a>の観点からは、Azure Cosmos DB と Azure Functions は両方とも管理ソリューションであり、管理と運用にかかる時間が短縮されます。 これにより、チームは顧客に直接価値を提供するサービスの構築に専念できるようになりました。</p>
     </td>
    </tr>
    <tr>
     <td>
     <p>サポート</p>
     </td>
     <td>
     <p>Microsoft のエンジニアは、問題の解決、ガイダンスの提供、ベストプラクティスの提供を直接行うことができます</p>
     </td>
    </tr>
   </tbody>
  </table>


  <p>スポットライトクラウドを使用すると、Quest &rsquo; のお客様は、オンプレミスの SQL Server データベースではなく、Azure にデータを格納できるという利点があります。 また、お客様は、Quest がクラウドで提供するすべての分析機能にアクセスできます。 たとえば、顧客は、SQL Server の SQL ワークロードとパフォーマンスを詳細に調査して、ユーザーのデータとクエリを最適化することができます。つまり、Azure Cosmos DB 上で実行されているスポットライトクラウドを利用しています。</p>


  <p><em>&quot;Microsoft は、お客様のビジネスニーズに合わせてストレージソリューションをアップグレードすることを検討しています。Azure Cosmos DB には、高可用性と低待機時間が組み込まれており、アップタイムとパフォーマンスを向上させることができました。お客様がリアルタイムのデータに迅速にアクセスできるようにするために、スポットライトクラウドで重要な役割を果たす Azure Cosmos DB と考えています。&quot;</em></p>


  <p align="right">- Efim Dimenstein、チーフクラウドアーキテクト、Quest ソフトウェア</p>


  <p><img alt="Deployment Diagram of Spotlight Cloud’s Ingest and Egress app" height="1012" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5JYt_NL4dcsGWbUV3lFDdkU0fe10V60ZwuFYDd4Lkv_n_UiIaIGRhxgkUH_wQW0pj3XKwiL21Bu1M_7kwn-U6mZYeJYpxXn7QT0z06do3eMFwJGsLES08TB-g-q1Kio_2Q" title="スポットライトクラウドの取り込みと Egress アプリ" width="1600"></p>


  <p align="center"><em>スポットライトクラウド &rsquo; の取り込みと Egress アプリのデプロイ図</em></p>


  <p><strong>上の図は説明しました。</strong> データは、Traffic Manager によって利用可能な取り込みアプリにルーティングされます。 インジェストアプリは Azure Cosmos DB 書き込みリージョンにデータを書き込みます。 データコンシューマーは Traffic Manager 経由で Egress アプリにルーティングされ、その後 Azure Cosmos DB 読み取りリージョンからデータが読み取られます。</p>


  <h2>学習とベストプラクティス</h2>


  <p>スポットライトクラウドの構築では、最も効果的な方法で Azure Cosmos DB を使用する方法について深く理解しています。&nbsp;</p>


  <p>&nbsp;</p>


  <table border="1" cellpadding="2">
   <tbody>
    <tr>
     <td valign="top">
     <p>Azure Cosmos DB &rsquo; のプロビジョニング済みスループットモデル (RU/秒) について</p>

     <p>&nbsp;</p>
     </td>
     <td valign="top">
     <p>各操作のコスト、操作数/秒を測定し、Azure Cosmos DB に必要なスループットの合計をプロビジョニングしました。</p>

     <p>Azure Cosmos DB コストはストレージとプロビジョニングされたスループットに基づいているため、<a href="https://docs.microsoft.com/azure/cosmos-db/optimize-cost-throughput" target="_blank">適切な ru 数を選択</a>することは、コスト効果の高い方法で Azure Cosmos DB を使用するための鍵でした。</p>
     </td>
    </tr>
    <tr>
     <td valign="top">
     <p>適切なパーティション戦略を選択する</p>

     <p>&nbsp;</p>
     </td>
     <td valign="top">
     <p>Quest は、要求のボリュームとストレージのバランスを取るために、データの <a href="https://docs.microsoft.com/azure/cosmos-db/partitioning-overview#choose-partitionkey" target="_blank">パーティションキー</a> を選択しました。 これは、データを水平方向にシャードし、プロビジョニングされた ru の合計をデータのパーティション間で均等に分散 Azure Cosmos DB ため、非常に重要です。</p>

     <p>開発段階では、実験はパーティションキーをいくつか選択し、パフォーマンスへの影響を測定します。 パーティションキー戦略が不均衡な場合、負荷分散されたパーティション戦略よりも多くの Ru が必要になります。</p>

     <p>Quest は、サーバー Id と格納されるデータの種類を組み込んだ <a href="https://docs.microsoft.com/azure/cosmos-db/synthetic-partition-keys" target="_blank">合成パーティションキー</a> を選択しました。 これにより、多数の個別の値 (高カーディナリティ) が与えられ、データが均等に分散され、書き込みの負荷が高い場合に非常に重要になります。</p>
     </td>
    </tr>
    <tr>
     <td valign="top">
     <p>インデックス作成ポリシーの調整</p>

     <p>&nbsp;</p>
     </td>
     <td valign="top">
     <p>Quest &rsquo; の書き込み負荷の高いワークロードの場合、 <a href="https://docs.microsoft.com/azure/cosmos-db/index-overview" target="_blank">インデックスポリシー</a> のチューニングと書き込み時の RU コストは、優れたパフォーマンスを実現するための鍵でした。 これを行うには、Azure Cosmos DB インデックス作成ポリシーを変更して、ドキュメント内の一般的にクエリされるプロパティを明示的にインデックスを作成し、残りを除外します。 また、Quest では、ドキュメントの本文に一般的に使用されるいくつかのプロパティが含まれており、残りのデータは1つのプロパティにエンコードされています。</p>
     </td>
    </tr>
    <tr>
     <td valign="top">
     <p>データアクセスパターンに基づいて Ru をスケールアップおよびスケールダウンする</p>

     <p>&nbsp;</p>
     </td>
     <td valign="top">
     <p>スポットライトクラウドでは、お客様は古いデータよりも頻繁に最近のデータにアクセスする傾向があります。 同時に、新しいデータは継続的に安定したストリームで書き込まれ、書き込みが多いワークロードになります。</p>

     <p>ワークロードのプロビジョニングされた Ru 全体をチューニングするために、Quest はデータを複数のコンテナーに分割します。 新しいコンテナーは、高い Ru を使用して定期的に (たとえば、毎週、数か月に1回) 作成され、書き込みを受け取る準備ができています。</p>

     <p>次の新しいコンテナーの準備が整うと、以前のコンテナー &rsquo; の ru は、予想される読み取り操作を行うために必要なものに限定されます。 書き込みは、多数の Ru を持つ新しいコンテナーに送られます。</p>
     </td>
    </tr>
   </tbody>
  </table>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/13c564fa-fbe9-4147-a5c7-30d424131b62.gif"><img alt="Tour of Spotlight Cloud’s user interface" border="0" height="367" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6a3e3fb9-3700-4d3d-919a-77ffeee17a0e.gif" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="スポットライトクラウドのユーザーインターフェイス" width="700"></a></p>


  <p align="center"><em>スポットライトクラウド &rsquo; s のユーザーインターフェイスのツアー</em></p>


  <h2>Quest について</h2>


  <p>Quest は、1987以来、企業 IT の急速なペースでのソフトウェアソリューションを提供しています。 これは、Fortune 500 の95% やグローバルな90の1000% など、100の国にわたる13万企業のグローバルプロバイダーです。</p>


  <p><a href="https://twitter.com/spotlightcloud" target="_blank">Twitter</a>、 <a href="https://www.facebook.com/SpotlightCloud/" target="_blank">Facebook</a>、 <a href="https://www.linkedin.com/company/spotlight-cloud/" target="_blank">LinkedIn</a>のスポットライトクラウドの詳細をご確認ください。</p>
