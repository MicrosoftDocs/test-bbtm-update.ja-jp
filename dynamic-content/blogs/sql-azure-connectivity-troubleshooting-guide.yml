### YamlMime:Yaml
ms.openlocfilehash: f06e2e3b2e6fb048bb16e3383883c8fa272e5e42
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892294"
Slug: sql-azure-connectivity-troubleshooting-guide
Title: SQL Azure接続のトラブルシューティング ガイド
Summary: '[この記事は、チームによってSQL Azureされました。]この投稿は、一般的な接続エラーのトラブルシューティングに役立つ、Abi Iyer というすばらしいサポート エンジニアの 1 人によってまとめました。'
Content: "<p>[この記事は、チームによってSQL Azureされました。]</p><p>この投稿は、以下に示す SQL Azure への接続中に表示される一般的な接続エラー メッセージのトラブルシューティングに役立つ、Abi Iyer というすばらしいサポート エンジニアの 1 人によってまとめました。</p>  <ul>   <li>サーバーから結果を受信しているときに、トランスポート レベルのエラーが発生しました。 (プロバイダー: TCP プロバイダー、エラー: 0 - 既存の接続がリモート ホストによって強制的に閉じられました)。) </li>    <li>System.Data.SqlClient.SqlException: Timeout expired.&#160; 操作が完了する前にタイムアウト期間が経過しました。または、サーバーが応答しません。 ステートメントは終了されました。 </li>    <li>サーバーへの接続を確立中にエラーが発生しました。 2005 SQL Server に接続する場合、このエラーは、既定の設定ではリモート接続が許可SQL Serverが許可されていないという事実が原因で発生する可能性があります。 </li>    <li>エラー:Microsoft SQL Native Client: サーバー接続を開くのが遅れているので、ログイン プロセスを完了できません。 </li>    <li>接続されたホストが応答できなかったため、接続されたパーティが一時間後に正しく応答しなかったか、確立された接続が失敗したことが理由で、接続の試行に失敗しました。 </li> </ul>  <h3></h3>  <h2>セクション 1: サービスの可用性Azure Firewall 設定確認する</h2>  <p>1.SQL Azure ポータルにログインし、プロジェクトを選択し、[ファイアウォール設定] タブに切り替えます。接続する IP アドレスからのリモート接続を許可するように SQL Azure ファイアウォールが構成されていることを確認します。</p>  <p><a href=\"\"><img style=\"border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px\" title=\"clip_image002\" border=\"0\" alt=\"clip_image002\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image002_thumb.jpg\" width=\"452\" height=\"247\"></a></p>  <p>コンピューターがインターネットから SQL Azure サーバーに接続しようとすると、SQL Azure ファイアウォールは、要求の発信元 IP アドレスをファイアウォール設定の完全なセットに対してチェックします。 要求の IP アドレスが、指定された範囲内に存在しない場合、接続試行はブロックされ、SQL Azureされません。 サービスが次SQL Azureのような特定のエラー メッセージを返すので、通常、ファイアウォールによるブロックは自明です。</p>  <p>&#160;</p>  <blockquote>   <p><font face=\"Segoe UI\">C:\\&gt;SQLCMD –Uuserserver&lt;&gt;@&gt;&lt; -Ppassword&gt;&lt; -Sserver.database.windows.net&lt;&gt;</font></p> </blockquote>  <blockquote>   <p><font face=\"Segoe UI\">ログインによって要求されたサーバー 'vt54v9zo' を開くことができません。IP アドレスが '131.107.0.111' のクライアントは、サーバーへのアクセスを許可されません。アクセスを有効にするには、SQL Azure ポータルを使用するか、master データベースで sp_set_firewall_rule を実行して、この IP アドレスまたはアドレス範囲のファイアウォール規則を作成します。この変更が有効には、最大で 5 分かかる場合があります。</font></p> </blockquote>  <p><em>リファレンス: SQL Azure ファイアウォール -</em><a href=\"https://msdn.microsoft.com/en-us/library/ee621782.aspx\"><em>https://msdn.microsoft.com/en-us/library/ee621782.aspx</em></a></p>  <h3>&#160;</h3>  <p>2. ポータルの [データベース] タブで、アクセスしようとしているデータベースを選択し、[接続のテスト] ボタンをクリックします。 これにより、接続時にユーザー名とパスワードを使用するように求められます。</p>  <h3></h3>  <blockquote>   <p>注: Microsoft サービス ファイアウォールが有効になっていない場合は、有効にして、ファイアウォール設定が有効にするまで最大 5 分待つ必要があります。 5 分より早くエラーが発生した場合、サービスが使用可能かどうかの有効なテストではありません。</p> </blockquote>  <blockquote>   <p>a. 接続が成功すると、バックエンド サービスSQL Azureサーバーとデータベースがオンラインになります。 セクション 2 に進みます。</p> </blockquote>  <blockquote>   <p>b. 接続できない場合は、サーバーの [場所] の一覧に注意し、Azure サービス ダッシュボードでSQL Azureサービスの状態を確認します。 既知の停止が発生した場合は、そこで詳細を確認できます。 ダッシュボードに障害が反映されない場合は、Microsoft を 1-800- 642-7676 に呼び出して問題を報告し、サポートを受けてください。</p> </blockquote>  <p><em>リファレンス: Microsoft カスタマー サービスとサポートに問い合わせする方法と条件 - </em><a href=\"https://support.microsoft.com/kb/295539\"><em>https://support.microsoft.com/kb/295539</em></a></p>  <p>&#160;</p>  <h2>セクション 2: 仮想 IP に到達可能な点を確認する</h2>  <p>1. コマンド プロンプト ウィンドウを開き、PING コマンドを使用して、名前解決によって論理サーバー名が IP アドレスに正常に変換されたことを確認します。 次に示す \"Request timed out\" メッセージは、ping 要求SQL Azure応答しないので予期されます。</p>  <blockquote>   <p><font face=\"Segoe UI\">C:\\&gt;ping &lt;myserver.database.windows.net&gt;</font></p> </blockquote>  <h3></h3>  <blockquote>   <p><font face=\"Segoe UI\">Ping data.sn1-1.database.windows.net 32 バイトのデータを含む [65.55.74.144] を実行します。</font></p>    <p><font face=\"Segoe UI\">要求がタイムアウトしました。</font></p>    <p><font face=\"Segoe UI\">要求がタイムアウトしました。</font></p>    <p><font face=\"Segoe UI\">要求がタイムアウトしました。</font></p>    <p><font face=\"Segoe UI\">要求がタイムアウトしました。</font></p>    <p><font face=\"Segoe UI\">65.55.74.144 の Ping 統計:</font></p>    <p><font face=\"Segoe UI\">パケット: Sent = 4、Received = 0、Lost = 4 (100% loss)</font></p> </blockquote>  <h3></h3>  <h3></h3>  <p>a. サーバー名が IP アドレスに解決される場合は、値をメモし、手順 2 に進みます。</p>  <p>b. この手順が失敗した場合は、ネットワーク管理者またはインターネット サービス プロバイダーに連絡して、名前解決の問題の修正に関するサポートを受けてください。 </p>  <p>&#160;</p>  <p>2. コマンド プロンプト ウィンドウで、前の手順で返された IP アドレスを使用して、ポート 1433 に telnet 接続してみてください。 これにより、ポート 1433 へのトラフィックをブロックしているファイアウォール/ルーターが 1 つも含まれるかどうかをテストします。</p>  <blockquote>   <p><font face=\"Segoe UI\">C:\\&gt;telnet 65.55.74.144 1433</font></p>    <p><font face=\"Segoe UI\">65.55.74.144... への接続</font></p> </blockquote>  <p>a. Telnet が成功すると、ウィンドウは完全に空白の画面に変わります。 終了し、次の手順に進みます。</p>  <p>b. 成功しない場合は、出力をキャプチャし、手順 4 に進みます。</p>  <p>&#160;</p>  <p><em>リファレンス: Telnet トラブルシューティング ガイド - </em><a href=\"https://technet.microsoft.com/en-us/library/cc753360(WS.10).aspx\"><em>https://technet.microsoft.com/en-us/library/cc753360(WS.10).aspx</em></a></p>  <p>&#160;</p>  <p>3. コマンド プロンプト ウィンドウで、IP アドレスではなく DNS 名に telnet 接続しようとしているテストを繰り返します。</p>  <blockquote>   <p><font face=\"Segoe UI\">C:\\&gt;telnet &lt;myserver.database.windows.net&gt; 1433</font></p> </blockquote>  <p>注: Telnet が既定の Windows インストールの一部ではない場合は、[コンポーネントの追加と削除] Windowsできます。</p>  <p>&#160;</p>  <p>4. tracert ユーティリティを使用し、サーバーに到達しようとして実行された中間手順を示す出力をキャプチャします。 この情報は、ネットワーク エンジニアが問題のトラブルシューティングを行う必要がある場合に役立ちます。</p>  <blockquote>   <p><font face=\"Segoe UI\">C:\\&gt;tracert 65.55.74.144</font></p>    <p><font face=\"Segoe UI\">最大 30 ホップで 65.55.74.144 へのトレース ルート</font></p>    <p><font face=\"Segoe UI\">1 2 ms 1 ms 1 ms 192.168.0.1</font></p>    <p><font face=\"Segoe UI\">2 6 ミリ秒 5 ミリ秒 5 ミリ秒 10.33.34.50</font></p>    <p><font face=\"Segoe UI\">3 5 ms 4 ms 5 ms 4-1-753.DLLSTX-LCR-07.verizon-gni.net [130.81.107.26]</font></p>    <p><font face=\"Segoe UI\">4 8 ms 5 ms 5 ms so-6-2-0-0.DFW01-BB-RTR1.verizon-gni.net [130.81.28.208]</font></p>    <p><font face=\"Segoe UI\">5 44 ms 43 ms 44 ms so-11-0-0-0.LCC1-RES-BB-RTR1-RE1.verizon-gni.net [130.81.17.40]</font></p>    <p><font face=\"Segoe UI\">6 49 ms 44 ms 44 ms so-6-0-0-0.ASH-PEER-RTR1-re1.verizon-gni.net [130.81.10.90]</font></p> </blockquote>  <p><em>リファレンス: TRACERT を使用して TCP/IP の問題をトラブルシューティングする方法 - Windows</em><a href=\"https://support.microsoft.com/kb/314868\"><em>https://support.microsoft.com/kb/314868</em></a></p>  <p>&#160;</p>  <h3></h3>  <h2>セクション 3: 仮想 IP に到達しない:</h2>  <p>  <p>セクション 2 で問題が発生した場合は、VIP に到達していないので、代わりにクライアントと VIP の間でブロックされます。 次の手順は役に立つ場合がありますが、この時点で、ISP またはネットワーク エンジニアによるネットワーク調査が必要です</p>  <p>多くのファイアウォール製品では、個々のユーザーとドメイン管理者が、特定のポートまたは宛先 IP アドレスでの送信アクセスをブロックまたは制限できます。 そのため、ローカル コンピューターで定義されている送信規則と、ネットワーク パス内のすべてのルーターまたはプロキシを確認する必要があります。 規則では、ポート 1433 から宛先 IP アドレス範囲 65.55 への送信アクセスを許可する必要があります。*.*.ほとんどのファイアウォールでは、DNS 名の指定も許可されます。 アクセスをブロックする可能性があるネットワーク製品は次のとおりです。</p>  <p>&#160;</p>  <h3>1.Windowsコンピューター上のファイアウォールを使用する</h3>  <blockquote>   <p><em>よく寄せられる質問 - </em><a href=\"https://msdn.microsoft.com/en-us/library/bb736261(VS.85).aspx\"><em>https://msdn.microsoft.com/en-us/library/bb736261(VS.85).aspx</em></a><em> </em></p>    <p><em>Windowsセキュリティが強化されたファイアウォール はじめに ガイド - </em><a href=\"https://technet.microsoft.com/en-us/library/cc748991(WS.10).aspx\"><em>https://technet.microsoft.com/en-us/library/cc748991(WS.10).aspx</em></a><em> </em></p> </blockquote>  <p>ファイアウォール規則は、ドメイン ポリシーの一部として構成することもできます。そのため、ドメイン ポリシーを使用して、接続をブロックできるそのような規則が設定されていないか確認してください。</p> <b></b>  <p>&#160;</p>  <h3>2. その他のファイアウォール製品</h3>  <p>&#160;</p>  <h3>3. ネットワーク内のプロキシとルーター、その他のコンポーネント: プロキシもファイアウォールとして機能するため、ネットワーク管理者と一緒にポート 1433 が送信アクセス用に開いているか確認してください。</h3>  <p>ソフトウェア (Windows ファイアウォールを含む) とハードウェアの両方を確認する必要があります。</p>  <p>正しいファイアウォール規則を適用するためにこれが必要になる可能性がある場合は、外部 IP アドレスを確認してください。 この Web サイトを使用して IP アドレスを検索できます <a href=\"\"></a></p>  <p>ポータルの [ファイアウォール設定] タブSQL Azureの [AddFirewallRule] ダイアログ ボックスにも IP アドレスが一覧表示されます。 </p>  <p>&#160;</p>  <p>  <h3>4.可能であれば、ISP SQL Azure接続されているファイアウォールの外部にあるコンピューターから接続してみてください。 </h3>  <p>セクション 1 のすべての手順を繰り返してください。 このテストでは、ネットワーク内のアクセスをブロックしている可能性のあるファイアウォールや他のポリシーが排除されます。 このテストは、ネットワーク内またはネットワークの外部でトラフィックがブロックされているのか確認するのに役立ちます。 </p>  <p>&#160;</p>  <h3>5. 次のツールを使用してネットワーク トレースをMicrosoft ネットワーク モニターする </h3>  <blockquote>   <p><em>リファレンス: データ を使用してネットワーク トラフィックをキャプチャするネットワーク モニター - </em><a href=\"https://support.microsoft.com/kb/148942\"><em>https://support.microsoft.com/kb/148942</em></a></p> </blockquote>  <p>TCP ポート 1433 でメッセージを表示するフィルター TCP.port==1433 を追加して、トレースを確認します。 サーバーから ACK が戻って表示されない場合は、ネットワークまたはインターネットを使用して接続がブロックされている可能性が高い可能性があります。</p>  <p>成功しなかった接続からのネットワーク スニペット:</p>  <p>&#160;</p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:27.007&#160;&#160;&#160;&#160;&#160; 25&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:7, IPv4:6}&#160;&#160; 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP&#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:Flags=.....S., SrcPort=49411, DstPort=1433, PayloadLen=0, Seq=2375502765, Ack=0, Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:30.007&#160;&#160;&#160;&#160;&#160; 26&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:7, IPv4:6}&#160;&#160; 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[<b>SynReTransmit #25</b>]Flags=.....S., SrcPort=49411, DstPort=1433, PayloadLen=0, Seq=2375502765, Ack=0, Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:36.007&#160;&#160;&#160;&#160;&#160; 29&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:7, IPv4:6}&#160;&#160; 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[<b>SynReTransmit #25</b>]Flags=.....S., SrcPort=49411, DstPort=1433, PayloadLen=0, Seq=2375502765, Ack=0, Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:48.014&#160;&#160;&#160;&#160;&#160; 40&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:12, IPv4:6} 111.11.11.1111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:Flags=.....S.、SrcPort=49412、DstPort=Microsoft-DS(445)、PayloadLen=0、Seq=3206081271、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:49.015&#160;&#160;&#160;&#160;&#160; 41&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:13, IPv4:6} 111.11.11.1111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP&#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:Flags=.....S.、SrcPort=49413、DstPort=Microsoft-DS(445)、PayloadLen=0、Seq=1361088072、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:49.019&#160;&#160;&#160;&#160;&#160; 42&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {IPv4:6} 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; ICMP:Echo 要求メッセージ、111.11.11.11.111 から 65.55.74.144</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:50.769&#160;&#160;&#160;&#160;&#160; 45&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {IPv4:6} 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160; ICMP:echo 要求メッセージ、111.11.11.111 から 65.55.74.144</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:51.014&#160;&#160;&#160;&#160;&#160; 46&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:12, IPv4:6} 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[SynReTransmit #40]Flags=.....S.、SrcPort=49412、DstPort=Microsoft-DS(445)、PayloadLen=0、Seq=3206081271、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:52.015&#160;&#160;&#160;&#160;&#160; 47&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:13, IPv4:6} 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[SynReTransmit #41]Flags=.....S.、SrcPort=49413、DstPort=Microsoft-DS(445)、PayloadLen=0、Seq=1361088072、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:52.771&#160;&#160;&#160;&#160;&#160; 48&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:14, IPv4:6} 111.11.11.1111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:Flags=.....S.、SrcPort=49414、DstPort=NETBIOS Session Service(139)、PayloadLen=0、Seq=265110652、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:55.771&#160;&#160;&#160;&#160;&#160; 49&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:14, IPv4:6} 111.11.11.1111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[SynReTransmit #48]Flags=.....S.、SrcPort=49414、DstPort=NETBIOS Session Service(139)、PayloadLen=0、Seq=265110652、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:57.021&#160;&#160;&#160;&#160;&#160; 52&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:12, IPv4:6} 111.11.11.111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[SynReTransmit #40]Flags=.....S.、SrcPort=49412、DstPort=Microsoft-DS(445)、PayloadLen=0、Seq=3206081271、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:12:58.016&#160;&#160;&#160;&#160;&#160; 53&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:13, IPv4:6} 111.11.11.1111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[SynReTransmit #41]Flags=.....S.、SrcPort=49413、DstPort=Microsoft-DS(445)、PayloadLen=0、Seq=1361088072、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11:13:01.771&#160;&#160;&#160;&#160;&#160; 56&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {TCP:14, IPv4:6} 111.11.11.1111&#160;&#160;&#160; data.sn1-1.database.windows.net&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP:[SynReTransmit #48]Flags=.....S.、SrcPort=49414、DstPort=NETBIOS Session Service(139)、PayloadLen=0、Seq=265110652、Ack=0、Win=8192 ( ネゴシエート スケール ファクター 0x8 ) = 8192</font></p>  <p>&#160;</p>  <p>ここでは、クライアントがクライアントへの接続を確立しようとして、SQL Azureを 3 回送信し続け、失敗しているのを確認できます。 このトレースは、接続が VIP にも到達しなかったため、クライアントのネットワークまたはインターネットを使用して接続がブロックされている可能性が高いことを示します。</p>  <p>&#160;</p>  <p>正常な接続からのトレースのスニペット:</p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 14:50:01.512&#160;&#160;&#160;&#160;&#160; 84&#160;&#160;&#160;&#160;&#160;&#160;&#160; SQLCMD.EXE&#160;&#160;&#160;&#160;&#160;  7&#160;&#160;&#160;&#160;&#160; {TCP:428, IPv4:427}&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 99.99.999.99&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 157.54.118.18&#160;&#160;&#160; TCP&#160;&#160;&#160;&#160;&#160;&#160;&#160; :Flags=.S., SrcPort=13415, DstPort=1433, PayloadLen=0, Seq=4009972475, Ack=0, Win=8192 ( ネゴシエート スケール ファクター 0x2 ) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 14:50:01.515&#160;&#160;&#160;&#160;&#160; 848&#160;&#160;&#160;&#160;&#160;&#160;&#160; SQLCMD.EXE&#160;&#160;&#160;&#160;&#160; {TCP:428, IPv4:427}&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 157.54.118.18.18&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 99.99.999.99&#160;&#160;&#160; TCP&#160;&#160;&#160;&#160;&#160;&#160;&#160; :TCP フラグ=..99.A。。S.、SrcPort=1433、DstPort=13415、PayloadLen=0、Seq=2117383693、Ack=4009972476、Win=8192 ( スケール ファクターはサポートされていません) = 8192</font></p>  <p><font face=\"Segoe UI\">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 14:50:01.516&#160;&#160;&#160;&#160;&#160; 849&#160;&#160;&#160;&#160;&#160;&#160;&#160; SQLCMD.EXE&#160;&#160;&#160;&#160;&#160; {TCP:428, IPv4:427}&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 99.99.999.99&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 157.54.118.18&#160;&#160;&#160; TCP&#160;&#160;&#160;&#160;&#160;&#160;&#160; :Flags=...A..., SrcPort=13415, DstPort=1433, PayloadLen=0, Seq=4009972476, Ack=2117383694, Win=17040 (スケール ファクター 0x0) = 17040</font></p>  <p>&#160;</p>  <p>上のスニペットは、成功した 3 ウェイ ハンドシェイクを表しています。</p>  <p>&#160;</p>  <h3>6. <b>SQL Azureサービス拒否 (DOS) ガード</b>:</h3>  <p>SQL Azureは、サービス拒否攻撃を防ぐための手法を利用します。 DOS 攻撃の可能性が原因で接続がサービスによってリセットされる場合は、3 つの方法でハンドシェイクが確立された後、ネットワーク トレースで RESET を確認できます。</p>  <p>&#160;</p>  <h2>セクション 4: リソースへのアクセス</h2>  <p>1. 次の SQLCMD からの完全な出力を指定します (スクリーンショット)。</p>  <blockquote>   <p><font face=\"Segoe UI\">SQLCMD -S bd1mgcqz5f.database.windows.net -U &lt;userid@bd1mgcqz5f&gt; -P &lt;password -q &quot;select&gt; 1&quot;</font></p> </blockquote>  <p>2.Connectを使用SSMS</p>  <p>2008 R2 SQL Server 2008 R2 を使用して、SQL Azure に対して多くの機能が有効になっているので、SQL Azure。</p>"
