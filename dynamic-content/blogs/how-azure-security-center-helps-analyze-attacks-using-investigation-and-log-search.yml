### YamlMime:Yaml
ms.openlocfilehash: 8665b7c120445836b2036d1e80667a8ac5bed82e
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896760"
Slug: how-azure-security-center-helps-analyze-attacks-using-investigation-and-log-search
Title: 調査Azure Security Centerログ検索を使用して攻撃を分析する方法
Summary: 攻撃を受けた場合、1 秒ごとにカウントされます。 Azure Security Center (ASC) では、高度な分析とグローバルな脅威インテリジェンスを使用して悪意のある脅威を検出し、新しい機能を使用して...
Content: >-
  <p>攻撃を受けた場合、1 秒ごとにカウントされます。 Azure Security Center (ASC) は、高度な分析とグローバル脅威インテリジェンスを使用して悪意のある脅威を検出し、新しい機能を使用して迅速に対応できます。 このブログ記事では、アナリストが Azure Security Center の調査とログ検索の機能を活用して、アラートがセキュリティ侵害を表すかどうかを判断し、その侵害の範囲を理解する方法を紹介します。</p>


  <p>ASC 調査機能の詳細については、「インシデントとアラートを調査する (プレビュー)Azure Security Center <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-investigation" target="_blank"><em>を参照してください</em></a>。 アラート&rsquo;を詳しく確認し、これらの新機能を使用してさらに学習できる情報を確認します。</p>


  <p>Security Center Standard レベルのユーザーは、次の図のようなダッシュボードを表示できます。 Standard レベルまたは無料の 90 日間試用版は、サービス ポリシーの [価格レベル] ブレード <a href="https://portal.azure.com/?feature.customportal=false#blade/Microsoft_Azure_Security/SecurityMenuBlade/1" target="_blank">Security Centerできます</a>。 次の画面で、[セキュリティ アラート] グラフをクリックしてアラートの一覧を表示します。 このビューには、他のセキュリティ ソリューションからの統合Security Center検出によってトリガーされるアラートが含まれます。 可能であれば、Security Centerアクティビティの一部であるアラートをインシデントに結合します。 次のスクリーンショットで強調表示されている 3 つの相互接続されたドット アイコンはインシデントを示し、青いシールド アイコンは 1 つのアラートを示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a002cb33-ab92-4622-aed4-fc384a1d4aff.png"><img alt="Security Center - Overview" border="0" height="371" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8fad260b-3e49-4c4d-82de-415804371f97.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Security Center - 概要" width="1002"></a></p>


  <p>インシデントをクリックすると、インシデントの詳細ウィンドウが開き、その一部であるすべてのアラートが表示されます。 特定のアラートを選択すると、そのアラートに関する詳細が表示されます。 アラートの詳細ブレードには、このアラートの <strong>調査プロセス</strong> を開始する [調査] ボタン (以下で強調表示) も含まれています。 この例のアラートでは、PowerShell は呼<em></em>び出し式を使用して、疑わしい外観のバッチ ファイルをインターネットからダウンロードしています。 このアラートとセキュリティ インシデントのコンテキストの詳細を理解するには、[調査] ボタンをクリックして調査 <strong>を開始</strong> できます。 調査が既に開始されている場合は、このボタンをクリックすると、その既存の調査が再開されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3e8b205e-1f59-49a4-b074-8bcd3e76e646.png"><img alt="Investigate button" border="0" height="525" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/82571629-9d15-4bcd-93aa-62d56fba7a68.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="[調査] ボタン" width="1010"></a></p>


  <p>調査ダッシュボードには、最初のアラートまたはインシデントに関連する、アカウント、マシン、その他のアラートなどのエンティティの視覚的で対話型のグラフが含まれている。 エンティティを選択すると、他の関連エンティティが表示されます。 たとえば、アラートが発生したマシンにログオンしているユーザー アカウントを選択すると、そのアカウントがログオンしている他のマシンと、そのアカウントに関連するその他のアラートが表示されます。 グラフ上の関連エンティティ間を移動し、エンティティに関するコンテキストを探索し、セキュリティ侵害に関連して表示される何かをタグ付けして、調査用のドシエを構築できます。 この段階で、グラフには最初のアラートから 1 ホップまたは 2 ホップ離れた項目が表示されますが、グラフ内の他のノードをクリックすると、新しく選択したノードに関連する項目が表示されます。</p>


  <p>通常、調査は、アラートがトリガーされた時間の周りに発生したイベントの論理的なシーケンスに焦点を当て、インシデントの時系列を理解しようとして開始されます。 分析の期間を設定するには、グラフの左上にある時間スコープ セレクターのドロップダウンを使用できます。 これを使用して、事前設定された時間範囲またはカスタム範囲を使用して、フォーカスする正確な時間範囲を指定できます。 現在の例では、最初のアラートは午前 9 時 47 分頃にトリガーされました。 9:40 から 9:53 など、カスタムの時間範囲が開始範囲として最適です。 選択した時間範囲によって、グラフに追加されるアラートとエンティティが制限されます。 グラフ内を移動すると、この時間範囲内でリレーションシップが発生した場合にのみ、関連エンティティが追加されます。 たとえば、この時間範囲内でホストにログオンしたアカウントが表示されます。 また、[探索] タブでクエリを実行するイベントは、現在の時間範囲内で発生しているイベントに制限されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6fcbd437-a960-4b64-9039-8de8cf9ce8ff.png"><img alt="Time range" border="0" height="511" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/254c7938-bee4-4095-a2b8-c3f0090e913e.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="時間の範囲" width="1244"></a></p>


  <p>このダッシュボードでは、選択したエンティティに関する関連情報が一連のタブの画面の右側 (下のスクリーンショット) に表示されます。 [ <strong>情報]</strong> タブには、エンティティに関する概要情報が表示されます。たとえば、マシンを選択すると、OS の種類、IP アドレス、地理的な場所が表示されます。 [ <strong>エンティティ] タブ</strong> には、選択した項目に直接関連するエンティティ、アラート、インシデントが表示されます。 この例では、アラート (SAIPROD) で識別されたマシンを選択すると、疑わしい PowerShell アクティビティ、疑わしいアカウントの作成、AppLocker バイパスの試行、重要なサービスの無効化に関連するアラートが表示されます。 これらのアラートをクリックすると、アラートの詳細が表示されます。 [ <strong>検索]</strong> タブには、選択したエンティティに関連するイベントを含む使用可能なイベント ログが表示されます。 この例のホストでは、SecurityEvent、SecurityDetection、および Heartbeat が表示されます。</p>


  <p>[検索] タブからログを使用して独自の検索を実行することもできます<strong></strong>が、[探索] <strong></strong> タブを使用すると、関連するイベントにすばやくアクセスし、調査プロセスを高速化できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e985d920-5e93-4476-b1b7-fbca4a1e4a0e.png"><img alt="Investigation path" border="0" height="637" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f7bae2ee-63f5-4b64-83a4-1743fa14e6e2.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="調査パス" width="1560"></a></p>


  <p>[探索&#39;詳細については、もう少し詳しく説明します。</p>


  <p>[ <strong>探索]</strong> タブには、特定のエンティティのアクティビティを調査するための最も関連性の高いデータの一部を強調表示する一連のクエリが含まれており、簡単に使用できる方法でデータが表示されます。 たとえば、下のスクリーンショットの [ <strong>アカウント</strong> のログオンに失敗しました] クエリには、ユーザー名が存在しないログオン試行が 2 回表示されています。 この一覧の個々の項目をクリックすると、特定のイベントの詳細が表示されます。または、虫眼鏡アイコンをクリックすると、ログ検索画面にこれらのすべてのイベントが表示されます。 探索クエリは、関連するイベント データがある場合にのみ表示されます。 クエリはエンティティの種類によっても異なっています。そのため、グラフ内のエンティティ間を移動する場合は、このタブに異なる内容が表示されます。</p>


  <p>また、攻撃者によって頻繁に採用 <strong>される、めったに使用されないプロセスのデータも表示されます</strong>。 これは、攻撃者がよく使用するオペレーティング システム実行可能ファイルのプロセスとコマンド ラインを示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/663f23a1-38b0-4d29-a057-3ee556595bf4.png"><img alt="Rarely used process" border="0" height="607" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2dceb36b-417d-4d58-ab30-40d18f497357.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ほとんど使用されないプロセス" width="1454"></a></p>


  <p>この場合、めったに使用されないプロセスで表示されるコマンド ライン アクティビティ (上) &ldquo;を見て、攻撃者が最初に whoami&rdquo; コマンドを発行し、現在ログオンしているユーザーが表示されるのを確認できます。 また、ユーザー アカウントの追加、Windows 実行キーへのレジストリ値の追加、バッチ ファイルのダウンロードに使用される PowerShell、Windows サービスのインストールと起動など、さまざまな不審なアクティビティも表示されます。 このクエリのタブ ビューには、使用可能なデータのサブセットのみが表示される場合があります。 データが多い場合は、クエリ <strong>結果の下部</strong> に [すべて表示] リンクが表示されます。 これをクリックすると、ログ検索が表示され、すべてのデータが表示されます。 <strong>TimeGenerated 列ヘッダーをクリック</strong>して時間順に順序付けし、真の時系列画像を取得します。</p>


  <p>調査グラフに戻る場合は、ログ検索画面の<strong></strong>上部にある [調査ダッシュボード] 階層リンク項目を<strong>クリック</strong>してください。 ブラウザーの [ <strong>戻る]</strong> ボタンを使用すると、調査から完全に削除されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8b48b4a1-3604-4c7f-9fe8-008182229b68.png"><img alt="Investigation dashboard (preview)" border="0" height="110" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0cd80b5a-adec-4334-b732-62d4845007e3.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="調査ダッシュボード (プレビュー)" width="414"></a></p>


  <p>インシデントに関連する興味深い成果物を見つけたら、その成果物を追加できます。 たとえば、新しいユーザー アカウントの adninistrator を作成すると、疑わしいアカウントの作成に関するアラートが生成されます。 コマンド ラインのシーケンスを見て、これは現在のインシデントに関連しているようです。そのため、次のスクリーンショットに示すように、これらを追加できます。 インシデントに成果物を追加すると、攻撃がどのように進行したのかについてのより良い概要が得られるという考え方です。 このアカウントを追加すると、攻撃者が横移動に使用した場合や、そのアカウントによって他の VM&rsquo; で通常とは異なるプロセスが実行されている場合に備えて、グラフを 2 番目の仮想マシン (VM)&rsquo; に拡張するのに役立ちます。 検出されたこのような VM&rsquo; はすべて、インシデントに追加のマシンとして追加できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/06f568ef-3a88-4ea4-acea-e8cb9f0da51d.png"><img alt="Investigation dashboard (preview) 2" border="0" height="545" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5c5a5692-9377-457b-b749-4e11400bda3c.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="調査ダッシュボード (プレビュー) 2" width="1061"></a></p>


  <p>この展開されたビューから抜け出す興味深い点の 1 つは、すべての攻撃者コマンドの Logonid (<strong>0x144a52</strong>) が同じことです。つまり、これらのコマンドはすべて、同じログオン セッションで同じアカウントによって実行されました。 これは、調査でよく使用される優れた分析データ ポイントです。 アラートの発生元である特定のログオン セッション内のアクティビティに焦点を当てると、攻撃者が他に何をしていたかについて多くの情報が表示されます。あるいは、追加の疑わしいアクティビティがない場合に、アラートが誤検知である可能性を迅速に判断できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d5c3e2da-b6c0-401a-8cc4-ba14b32424df.png"><img alt="Log search" border="0" height="247" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fc6029c8-0e10-4f26-a5a8-b9533c94fc8b.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ログ検索" width="1171"></a></p>


  <p>ログ検索 <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-search" target="_blank">機能を</a> 使用するとAzure Security Center詳細を確認するのに役立ちます。</p>


  <h2>ログ検索</h2>


  <p>Security Center Log Analytics 検索を使用して、セキュリティ データを取得および分析します。 Log Analytics には、データをすばやく取得して統合するためのクエリ言語が用意されています。 このSecurity Center、Log Analytics 検索を使用してクエリを作成し、収集されたデータを分析できます。 クエリの開始点として、探索クエリの 1 つ (&ldquo;&rdquo;[すべて表示] または拡大鏡アイコンをクリックしてログ検索にアクセスする) を使用する方が簡単な場合があります。</p>


  <p>ログ検索 <strong>に入った</strong>後は、検索するイベントの種類を設定できます。 この例では、プロセス作成&ldquo;イベントのイベント ID == 4688&rdquo; Windows使用しました。 これらには、関心のある CommandLine データが含まれている。 さらに絞り込み、SubjectLogonId == が含まれるイベントのみを表示 &quot;0x144a52&quot;。&nbsp; プロジェクト コマンドを追加すると、関心のあるフィールドだけが表示されます。 検索では、次のような結果が得られます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/02bbc273-4515-4927-a020-f21681541ff7.png"><img alt="Log Search 2" border="0" height="528" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7070e76e-a68b-42ca-9a53-ee2ccc366fb6.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ログ検索 2" width="1259"></a></p>


  <p>検索結果を見て、次の情報が表示されます。</p>


  <ul>
   <li>攻撃者はブルート フォース手法を使用してログインを試み、成功しました。 これは 4688 イベントには表示されませんが、前に見たログオン試行の失敗によって提案されます。</li>
   <li>ログインすると、攻撃者はコマンド &ldquo;プロンプトを起動し、whoami&rdquo; コマンドを発行し、現在ログオンしているユーザーを表示します。 その後、攻撃者は &quot;systeminfo を&quot; 実行して、ホスト VM に関する詳細な構成情報を取得しました。 VM &quot;上の RDP セッションや他のセッションに関する情報を取得するために、qwinsta&quot; コマンドも発行されました。</li>
   <li>PowerShell は、インターネットからバッチ ファイルをダウンロードする呼び出し式を実行するために使用されています。 後続のコマンドは、9:49:07 に実行されたバッチ ファイルに含まれている可能性があります。これは、次のプロセスの実行時間が同じ秒内に発生しているのを確認できます。</li>
   <li>バッチ ファイルは、最初にファイアウォールを無効にします。 これは既知の攻撃者の手法です。 最初の侵害が達成された後、ファイアウォール、ウイルス対策、共有アクセスの無効化など、システムのセキュリティ設定を下げる手順を実行する場合が多くなります。</li>
   <li>次に、adninstrator という名前の新しいユーザー &#39;が追加&#39;。 アカウント名は、人間の管理者に気付かされるのを避けるために、標準の Windows アカウントによく似た名前です。</li>
   <li>その後、svvchost という疑 &quot;わしいサービスが&quot; 作成され、開始されます。</li>
   <li>検索には、自動実行コマンドをインストールするレジストリの追加も表示されます。 詳細な分析では、これは AppLocker の制限をバイパスする試みのように見えます。 AppLocker は、アプリケーション システムで実行できる実行可能ファイルを制限Windowsできます。 コマンド ライン パターンは、攻撃者が信頼されていないコードを実行するために regsvr32.exeを使用して AppLocker ポリシーを回避しようとしたように見えます。 AppLocker の実行可能ファイルとスクリプトの規則が厳しく適用されているホストでは、攻撃者は多くの場合、regsvr32 とインターネット上にあるスクリプト ファイルを使用してスクリプトバイパスを取得し、悪意のあるスクリプトを実行しています。</li>
  </ul>


  <p>要約すると、この投稿では、セキュリティ インシデントの性質と範囲を理解するために、Azure Security Center の新しい調査機能とログ検索機能を使用する方法を示しています。</p>


  <p>Microsoft Ignite では、Security Centerチームは、Azure のお客様がセキュリティ上の脅威をよりよく理解、調査、管理するのに役立ついくつかの新機能を発表しました。 これらの機能の詳細については、ブログ記事「Azure Security Center Threat <a href="https://azure.microsoft.com/en-us/blog/azure-security-center-extends-advanced-threat-protection-to-hybrid-cloud-workloads/" target="_blank"><em>Protection</em></a> をハイブリッド クラウド ワークロードに拡張する」を参照してください。<br>

  &nbsp;<br>

  Security Center、アラートとインシデントの調査エクスペリエンスを自動化することで、セキュリティ上の脅威に対応するために必要な時間と専門知識を短縮できます。</p>


  <p>次のブログ記事では、次の機能を使用して回答できる他のいくつかの質問に対処します。</p>


  <ul>
   <li>環境内で実行可能ファイルのフラグが設定されているアラートはまれですか?</li>
   <li>このプロセスには異常な親プロセスがありますか?</li>
   <li>アラートの時刻頃にマシンにログオンしたユーザーは何でしたか?</li>
   <li>この頃に AV アラートがトリガーされたのですか? プロセスのクラッシュはいかがですか?</li>
  </ul>


  <h2>参照する内容</h2>


  <ul>
   <li>サイバー攻撃を検出する方法の実際の例を含む他のブログSecurity Centerを参照してください。
   <ul>
    <li><a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-unveils-suspicious-powershell-attack/" target="_blank">疑Azure Security Center PowerShell 攻撃を検出する方法</a>&nbsp;</li>
    <li><a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-helps-reveal-a-cyberattack/" target="_blank">サイバー Azure Security Centerを明らかにする方法</a></li>
   </ul>
   </li>
   <li>高度な <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities" target="_blank">Security Center&rsquo;機能について説明します</a>。</li>
   <li>セキュリティ アラートを <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-managing-and-responding-alerts" target="_blank">管理して対応する方法については</a> 、Azure Security Center。</li>
   <li>サービス <a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-faq" target="_blank">の使用に関してよく</a> 寄せられる質問を見つける。</li>
  </ul>


  <p>Azure セキュリティブログを読んで、最新の Azure セキュリティニュース <a href="https://blogs.msdn.com/b/azuresecurity/" target="_blank">と情報を取得します</a>。 詳細については、ブログ記事をご覧ください。調査機能の詳細については、以下をご覧Security Center。</p>
