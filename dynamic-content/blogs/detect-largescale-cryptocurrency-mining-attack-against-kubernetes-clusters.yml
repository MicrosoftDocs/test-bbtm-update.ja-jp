### YamlMime:Yaml
ms.openlocfilehash: b6842617d914b3c1d65b915ac9bfd2aa4cde098e
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896007"
Slug: detect-largescale-cryptocurrency-mining-attack-against-kubernetes-clusters
Title: Kubernetes クラスターに対する大規模な暗号化マイニング攻撃を検出する
Summary: Azure Security Centerの脅威保護を使用すると、サービスとしてのインフラストラクチャ (IaaS) レイヤーからサービスとしてのプラットフォーム (PaaS) まで、さまざまなサービスの脅威を検出して防止できます。
Content: >-
  <p>Azure Security Center&#39;の脅威保護を使用すると、サービスとしてのインフラストラクチャ (IaaS) レイヤーから Azure のサービスとしてのプラットフォーム (PaaS) リソース (IoT、App Service、オンプレミス仮想マシンなど) まで、さまざまなサービスにわたる脅威を検出して防止できます。</p>


  <p>Ignite 2019&nbsp; では、<a href="https://docs.microsoft.com/en-us/azure/security-center/azure-kubernetes-service-integration" target="_blank">Security Center での Azure Kubernetes Service (AKS)</a> サポートの脅威保護のプレビュー、<a href="https://docs.microsoft.com/en-us/azure/security-center/azure-container-registry-integration" target="_blank">Azure Container Registry (ACR)</a> イメージの脆弱性評価のプレビューなど、クラウド プラットフォーム上の高度な脅威に対処する新しい脅威保護機能を発表しました。<a href="https://techcommunity.microsoft.com/t5/azure-security-center/ignite-2019-releases-for-azure-security-center-and-azure/ba-p/975570" target="_blank"></a></p>


  <h2>Azure Security Center Kubernetes クラスター&nbsp;</h2>


  <p>このブログでは、Kubernetes&nbsp; クラスターに対する最近の大規模な暗号化マイニング攻撃について説明します。この攻撃は、最近<a href="https://azure.microsoft.com/en-us/services/security-center/" target="_blank">Azure Security Center。</a> これは、Kubernetes クラスターを脅威Azure Security Center保護するのに役立つ多くの例の 1 つです。</p>


  <p>コンテナー化された環境での暗号化マイニング攻撃は新&rsquo;しい攻撃ではない。 このAzure Security Center、コンテナー内で実行されるさまざまなマイニング アクティビティを定期的に検出します。 通常、これらのアクティビティは、Web アプリケーションなどの脆弱なコンテナー内で実行され、既知の脆弱性が悪用されます。</p>


  <p>最近、Azure Security Center Kubernetes 環境を対象とする新しい暗号化マイニング キャンペーンが検出されました。 この攻撃が他の暗号マイニング攻撃と異なるのは、その規模です。2 時間以内に、悪意のあるコンテナーが数十の Kubernetes クラスターにデプロイされました。</p>


  <p>コンテナーは、パブリック リポジトリ ( <strong>kannix/monero-マイナー) からイメージを実行しました</strong>。&nbsp;このイメージは、非常に人気のあるオープン ソースの Monero マイナーである XMEro を実行します。</p>


  <p>テレメトリでは、 という名前の <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank">Kubernetes デプロイによってコンテナーがデプロイされたと示</a> されました <code>kube-control</code>。</p>


  <p>以下のデプロイ構成に示すように、デプロイでは、この場合、ポッドの 10 レプリカが各クラスターで確実に実行されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d7792131-5294-4eb1-9488-c983c2f7e1d7.png"><img alt="KB cluster2" border="0" height="768" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d8b54b28-e0d9-4ceb-9b70-d62a3667d974.png" style="margin: 0px; border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="KB cluster2" width="435"></a></p>


  <p><br>

  さらに、暗号化マイニング コンテナーをデプロイしたのと同じアクターも、Kubernetes シークレットを含むクラスター リソースを列挙しました。 これにより、接続文字列、パスワード、その他のシークレットが露出し、横移動が可能になる可能性があります。</p>


  <p>興味深い点は、このアクティビティの ID が <code>system:serviceaccount:kube-system:kubernetes-dashboard</code> ダッシュボード サービス アカウントである&rsquo;点です。<br>

  この事実は、悪意のあるコンテナーが Kubernetes ダッシュボードによってデプロイされたかどうかを示しています。 リソースの列挙は、ダッシュボード サービス アカウントによって&rsquo;も開始されました。</p>


  <p>攻撃者が Kubernetes ダッシュボードを利用する方法には、次の 3 つのオプションがあります。</p>


  <ol>
      <li>公開されたダッシュボード: クラスター所有者がダッシュボードをインターネットに公開し、攻撃者がスキャンしてそれを見つけた。</li>
      <li>攻撃者はクラスター内の 1 つのコンテナーにアクセスし、クラスターの内部ネットワークを使用してダッシュボードにアクセスしました (Kubernetes の既定の動作によって可能です)。</li>
      <li>クラウドまたはクラスターの資格情報を使用してダッシュボードを正当に閲覧する。</li>
  </ol>


  <p>問題は、上記の 3 つのオプションの 1 つが、この攻撃に関与したのはどちらですか? この質問に回答するには、Kubernetes ダッシュボードの露出に関するセキュリティ アラートAzure Security Centerヒントを使用できます。 Azure Security Center Kubernetes ダッシュボードがインターネットに公開されている場合にアラートを生成します。 このセキュリティ アラートが攻撃を受けたクラスターの一部でトリガーされたという事実は、ここでのアクセス ベクターがインターネットに公開されているダッシュボードを意味します。</p>


  <p><a href="https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/" target="_blank">Kubernetes</a> 攻撃マトリックスに対するこの攻撃の表現は次のように表示されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/95215dd8-f603-4ae6-a36c-423df556a0b0.png"><img alt="kb cluster3" border="0" height="386" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4bf8211f-e625-4912-8925-0fb84b90e257.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="kb cluster3" width="1067"></a></p>


  <h2>暗号化マイニング攻撃の回避</h2>


  <p>これを回避するにはどうすれば良いでしょうか。</p>


  <ol>
      <li>Kubernetes ダッシュボードをインターネットに公開しない: ダッシュボードをインターネットに公開すると、管理インターフェイスが公開されます。</li>
      <li>クラスターで RBAC を適用する: RBAC&rsquo;&rsquo; を有効にすると、ダッシュボード サービス アカウントのアクセス許可が既定で非常に制限され、新しいコンテナーのデプロイなどの機能は許可されません。</li>
      <li>サービス アカウントに必要なアクセス許可のみを付与する: ダッシュボードを使用する場合は、必要なアクセス許可のみをダッシュボード サービス アカウントに&rsquo;適用してください。 たとえば、ダッシュボードを監視にのみ使用 &ldquo;する場合は、サービス アカウントに対する get&rdquo; アクセス許可のみを付与します。</li>
      <li>[信頼されたイメージのみを許可する]: 信頼されたレジストリからの信頼されたコンテナーのデプロイのみを適用します。</li>
  </ol>


  <h2>詳細情報</h2>


  <p>Kubernetes は、ソフトウェアをクラウドにデプロイして管理するための新しい標準になりつつあります。 Kubernetes の豊富な経験を持つ人はほとんどおらず、多くの人が一般的なエンジニアリングと管理にのみ注目し、セキュリティ面を見落としています。 コンテナーに焦点を合わせた攻撃対象領域が無防備な状態で攻撃者にさらされないように、Kubernetes 環境のセキュリティを慎重に構成する必要があります。 Azure Security Centerは次の機能を提供します。</p>


  <ol>
      <li>検出と可視性: 登録されているサブスクリプション内のマネージド AKS Security Center&rsquo;継続的な検出。</li>
      <li>セキュリティ スコアの推奨事項: ロールベースの Access Control など、お客様が顧客のセキュリティ スコアの一部として AKS&rsquo;&quot; のセキュリティのベスト プラクティスに準拠するのに役立つアクション可能な項目は、Kubernetes サービス クラスターへのアクセスを制限するために使用する必要があります。&quot;</li>
      <li>脅威の検出: ホストとクラスターベースの分析 ( &ldquo;特権コンテナーなど) が検出されました。&quot;</li>
  </ol>


  <p>AKS サポートの詳細については、Azure Security Centerドキュメント <a href="https://docs.microsoft.com/en-us/azure/security-center/azure-kubernetes-service-integration" target="_blank">を参照してください</a>。</p>
