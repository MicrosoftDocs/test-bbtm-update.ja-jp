### YamlMime:Yaml
ms.openlocfilehash: 1ae42ca05326487bf181a80ff77f2a1f52bcef64
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139910425"
Slug: retraining-and-updating-azure-machine-learning-models-with-azure-data-factory
Title: Azure Data Factory を使用した Azure Machine Learning モデルの再トレーニングと更新
Summary: 傾向や変数は時間の経過と共に変化するため、最新のトレーニングデータを使用して、の自動再トレーニングと更新を行うのが理想的です。 Azure Data Factory は、新しくリリースされた AzureMLUpdateResource アクティビティを使用してのみ処理を行います。
Content: >-
  <p>Azure Machine Learning モデルを使用しているお客様は、Azure Data Factory パイプラインと共に組み込みの<strong>azuremlbatchexecution</strong>アクティビティを利用して、運用環境の ML モデルを運用化し、大規模な事前トレーニング済みのモデルに対して新しいデータをスコア付けします。 ただし、モデル &rsquo; のパラメーターに影響を与える傾向や変数は時間の経過と共に変化するので、このパイプラインでは、最新のトレーニングデータを使用して定期的に自動再トレーニングとモデルの更新をサポートする必要があります。 現在、Azure Data Factory では、新しくリリースされた <strong>Azuremlupdateresource </strong>アクティビティを使用してこれを行うことができます。</p>


  <p>Azure ML は、通常、スコアリングとトレーニングの実験を設定し、次に各実験に対して2つの個別の web サービスエンドポイントを設定します。 次に、 <b>Azuremlbatchexecution</b> アクティビティを Data Factory と共に使用して、スコア付け web サービスによってホストされる最新のモデルに対する受信データのスコアリングと、最新のトレーニングデータを使用した再トレーニングの両方を行うことができます。 スコア付け web サービスエンドポイントは、スコア付け web サービスによって使用されるモデルを <b>更新</b> するために使用できる更新リソースメソッドも公開します。 ここでは、新しい <b>Azuremlupdateresource</b> アクティビティを図に示します。 このアクティビティを使用すると、トレーニングアクティビティによって生成されたモデルを取得し、スコア付け web サービスに提供することで、スケジュールに基づいて、既存の data factory パイプラインを使用して自動でモデルを更新することができます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/74b0abd0-d90b-402c-aa56-960c3807f014.png"><img alt="Retrain Pipeline" border="0" height="198" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1efc657b-d487-4ae9-bee5-5eea1e22f919.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="再トレーニングパイプライン" width="1024"></a></p>


  <h2>実験のエンドポイントを設定する</h2>


  <p>次に示すのは、Azure ML のトレーニングエンドポイントとスコア付けエンドポイントの関係の概要です。 どちらも Azure ML Studio の実験から生成され、両方ともバッチ実行サービスとして使用できます。 トレーニング web サービスは、トレーニングデータを受け取り、トレーニング済みのモデルを作成します。 スコア付け web サービスは、ラベルのないデータの例を受け取り、予測を行います。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/482fc9b1-1f2f-46de-a800-e2c1a1abcf6f.png"><img alt="AML Retaining Diagram" border="0" height="480" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/07a0374f-f9d6-4bce-909c-ab9ad1d96f8e.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="ダイアグラムを保持する AML" width="556"></a></p>


  <p>再トレーニングと更新のシナリオを作成するには、次の一般的な手順を実行します。</p>


  <ul>
   <li><a href="https://studio.azureml.net/">Azure ML Studio</a>で実験を作成します。</li>
   <li>モデルに問題がなければ、Azure ML Studio を使用して、トレーニング実験とスコア付け実験の両方に対して web サービスを発行します。</li>
   <li>スコア付け web サービスエンドポイントは、新しいデータの例に関する予測を行うために使用されます。 予測の出力には、実験の構成に応じて、Azure SQL データベースの .csv ファイルや行など、さまざまな形式があります。</li>
   <li>トレーニング web サービスは、新しいトレーニングデータからトレーニング済みの新しいモデルを生成するために使用されます。 再トレーニングの出力は、Azure Blob storage の ilのようなファイルです。</li>
  </ul>


  <p>再トレーニングのために web サービスエンドポイントを作成する方法の詳細については、microsoft の <a href="https://azure.microsoft.com/en-us/documentation/articles/machine-learning-retrain-models-programmatically/">ドキュメント</a>を参照してください。</p>


  <p>Web サービスエンドポイントは、Azure 管理ポータルで確認できます。 これらは、ADF のリンクされたサービスとアクティビティで参照されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c26ec6d5-e73a-4a11-8a22-487fb6836982.png"><img alt="ML Endpoints" border="0" height="185" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a388ad64-9304-4a24-8a4a-27c306efa0d5.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; float: none; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="ML エンドポイント" width="591"></a></p>


  <h2>ADF を使用した Azure ML モデルの再トレーニングと更新</h2>


  <p>ADF で運用可能な再トレーニングと更新のシナリオは、次の要素で構成されています。</p>


  <ul>
   <li>トレーニングデータ用の1つ以上のストレージのリンクされたサービスとデータセット。ストレージの種類をトレーニング実験の入力と照合します。 たとえば、実験が Web サービス入力で構成されている場合、トレーニングデータは Azure Blob ストレージから取得する必要があります。 データが Azure SQL テーブルからプルされる場合は、リーダーモジュールを使用して実験を構成する必要があります。 シナリオでは、Hadoop プロセスやコピーアクティビティなど、ADF アクティビティによってトレーニング入力が生成される場合があります。 または、何らかの外部プロセスによって生成される場合もあります。</li>
   <li>1つ以上のストレージのリンクされたサービスと Azure Blob データセットで、新しくトレーニングを受けたモデルを受け取ることができます。</li>
   <li>AzureML のリンクされたサービスと AzureMLBatchExecution アクティビティを実行して、トレーニング web サービスのエンドポイントを呼び出します。 トレーニングデータセットは、入力と、このアクティビティの出力のデータセットです。</li>
   <li>AzureML のリンクされたサービスと、スコアリング実験のエンドポイントを更新するための AzureMLUpdateResource Activity。 Ilのデータセットは、このアクティビティへの入力となります。 更新するモデルが複数ある場合は、それぞれに1つのアクティビティが存在します。 更新するエンドポイントが複数ある場合は、リンクされたサービスとそれぞれのアクティビティが存在します。</li>
   <li>アクティビティ出力のリンクされたサービスとデータセットを Storage します。 Azure ML Update Resource API 呼び出しでは出力は生成されませんが、現在 ADF では、パイプラインのスケジュールを設定するために出力データセットが必要です。&nbsp;</li>
  </ul>


  <p>データセットと LinkedServices の作成の詳細については、以下を参照してください。</p>


  <ul>
   <li><a href="https://azure.microsoft.com/documentation/articles/data-factory-create-datasets/">Data Factory データセットの作成</a></li>
   <li><a href="https://azure.microsoft.com/documentation/articles/data-factory-data-movement-activities/">データ移動アクティビティ</a>&nbsp;</li>
   <li><a href="https://azure.microsoft.com/documentation/articles/data-factory-data-transformation-activities/">Azure Data Factory での変換アクティビティ</a></li>
  </ul>


  <p>JSON の例で、モデルのスコア付け、再トレーニング、および更新のアクティビティを設定する詳細な手順については、 <a href="https://azure.microsoft.com/en-us/documentation/articles/data-factory-create-predictive-pipelines/">予測パイプラインのドキュメント</a>をご覧ください。</p>


  <h2>まとめ</h2>


  <p>このブログでは、Azure ML web サービスモデルの再トレーニングと更新を行うためのエンドツーエンドのシナリオについて説明しました。</p>


  <p>Data Factory と azure ML チームは、ADF で Azure ML を運用するシナリオについてお客様からのご意見をお待ちしております。 具体的には、次の例を集めたいと思います。</p>


  <ul>
   <li>トレーニングデータの生成方法と ADF パイプラインへの取り込まれた方法</li>
   <li>運用環境に配置する前に再トレーニングモデルを評価する方法</li>
   <li>再トレーニングモデルの評価がまたは不要なシナリオ</li>
   <li>他の Azure ML エンドポイント管理 (作成、削除) が運用パイプラインに含まれるシナリオ</li>
  </ul>


  <p>コメントを残すか、 <a href="https://social.msdn.microsoft.com/Forums/en-US/home">Data Factory フォーラム</a>に投稿してください。</p>
