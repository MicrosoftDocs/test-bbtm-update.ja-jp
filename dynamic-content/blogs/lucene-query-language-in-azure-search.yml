### YamlMime:Yaml
ms.openlocfilehash: d8ae9fc35b2d93ccb40eb4af3995e0f0dca4d138
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139909710"
Slug: lucene-query-language-in-azure-search
Title: Azure Search の Lucene クエリ言語
Summary: こんにちは、私は、検索機能に取り組む Azure Search チームのエンジニアである Nate です。 今日は、サービスの新しい検索モードに関するブログを投稿したいと思います。  検索のコンテキストでは、異なる...
Content: >-
  <p>検索のコンテキストでは、さまざまなアプリケーションで、検索の実行方法を正確に制御する必要があります。 多くの場合、関連性の個別の省略可能な制御を使用して、簡単なキーワード検索が必要です。 これは&rsquo;、Azure Search が従来提供している機能であり、ユーザー入力を取得して検索サービスに直接送信するだけの場合に、非常にうまく機能します。 ただし、検索&rsquo;される項目、フィールド、用語レベルの重みなどについて、アプリが正確に制御する必要があるケースが多く見られます。これらのより高度なシナリオを可能にするために、開発者が詳細な制御が必要な場合に完全な Lucene クエリ言語を使用できる新しい検索モードのサポートを導入しました。</p>


  <p>Lucene クエリ言語は Apache <a href="https://lucene.apache.org/core/">Lucene で開発されました</a>。 これは、表現力と柔軟性のために検索ドメインで広く採用されています。 サービスの既知のクエリ言語のサポートが追加されたので、既に使い慣れた構文を使用して、Azure Search に対してより広範なクラスの質問を作成できます。 また、既存の Lucene ベースのオンプレミス ソリューションから Azure Search に移行する顧客の負担が軽減される可能性もあります。</p>


  <h1>検索クエリで Lucene クエリ構文を有効にする方法</h1>


  <p>Search 要求で queryType パラメーターを使用して、2 つの検索モードを切り替えることができます。</p>


  <ol>
      <li><strong>単純</strong> なクエリ言語の使用が簡単</li>
      <li><strong>完全な</strong> Lucene クエリ言語の完全な</li>
  </ol>


  <p>queryType パラメーターの既定値は単純検索モードなので、新しい機能を使用しない場合は何もする必要はありません。 パラメーターが full に設定されている場合、検索テキストは Lucene クエリ パーサーを使用して解釈されます。</p>


  <p>Lucene クエリ言語の機能と構文の完全なセットについては、 <a href="https://msdn.microsoft.com/library/mt589323.aspx">MSDN のページを参照してください</a>。 Azure Search User Voice で一般的な顧客の要求に対応する機能の一部を次に示します。</p>


  <h1>フィールド スコープ検索</h1>


  <p>単純なクエリ言語では、 <a href="https://msdn.microsoft.com/library/azure/dn798927.aspx">searchFields</a> パラメーターを使用してクエリのスコープが特定の検索可能フィールドに設定されていない限り、クエリで指定された検索用語は常にすべての検索可能フィールドで検索されます。 Lucene クエリ言語を使用すると、検索句の前にフィールド名を配置することで、検索範囲を特定のフィールドに設定できます。 たとえば、次の例では、city フィールド内でのみ Leavenworth という単語を検索します。</p>


  <p>city:LeavenworthqueryType&amp;=full</p>


  <p>この機能は、無関係なフィールドからの一致が検索結果に影響を与える、または汚染されない用語または語句の検索空間を制限する場合に特に便利です。 多くの場合、検索スペースを制限することで、応答のパフォーマンスと品質が向上すると予想されます。 フィールドの用語のフィールドは、検索可能として構成する必要があります。</p>


  <h1>用語ブースト</h1>


  <p>検索クエリの用語の重要度と関連性が異なる場合があります。 たとえば、ホテルを検索する場合、特定の側面は顧客にとってより重要であり、検索クエリに反映する必要があります。 完全な Lucene クエリ言語では、必要に応じてブースト係数 (正の数値) を検索語句または語句に割り当て、検索クエリ内の他の用語に対する関連性を制御できます。 ブースト値のない用語には、ニュートラル ブースト値 1 が自動的に割り当てられます。 この例では、clean という単語にブースト値 3 を指定し、"quiet" という単語にブースト値 2 を指定します。これは、検索クエリの他の中立的な用語よりもそれぞれ 3 回、2 倍重要な値を示します。</p>


  <p>search=quiet^2 clean^3 +hotels city:Leavenqueryquerytype&amp;=full</p>


  <h1>スコアリング プロファイルでの用語ブーストとフィールド ブースト</h1>


  <p>Lucene クエリ言語でのブーストという用語は、スコアリング プロファイルで提供されるフィールド ブーストとは異<a href="https://msdn.microsoft.com/library/azure/dn798928.aspx">なります。</a> スコアリング プロファイルのフィールドの重み付けは、特定のフィールドからの一致にのみ適用され、アプリ デザイナーによってのみ構成できます。 一方、クエリでのブーストという用語は、すべての検索可能フィールドに適用され、エンド ユーザーが使用できます。 2 種類のコントロールは、互いに独立して適用され、検索クエリのブースト用語がブースト フィールドで一致する場合に組み合わされます。</p>


  <h1>正規表現を使用した検索</h1>


  <p>Lucene クエリ言語では、1 つの用語内で正規表現がサポートされています。 これにより、Azure Search User Voice: Infix クエリとサフィックス クエリのサポートに対して高度に要求されたシナリオが可能になります。 正規表現パターンで検索するには、スラッシュ /の間にパターンを配置する必要 &quot;があります。&quot; パターンはインデックスのボキャブラリ全体と一致するため、多くの場合、正規表現パターンをパフォーマンスと精度に対して可能な限り制限し続けるのが良い方法です。 この例では、Leaven という&ldquo;&rdquo;文字で始&ldquo;まる都市で hotel と motel&rdquo; を探します。</p>


  <p>search=/[hm]スコア/ city:/Leaven.*/&amp;queryType=full</p>


  <h1>あいまい検索</h1>


  <p>Lucene クエリ言語では、 <a href="https://en.wikipedia.org/wiki/Levenshtein_distance">Levenshtein Distance</a> アルゴリズムに基づく 1 つの用語に対するあいまい検索がサポートされています。 あいまい検索を &quot;~&quot; 有効にするには、一致に許可される最大編集距離を指定する省略可能なパラメーターを 0 ~ 2 に指定して、用語の末尾にチルダ記号を配置します。 たとえば、編集距離が 1 の下の検索クエリでは、一致条件を満たす単語を含むドキュメントがインデックスに含まれている場合、結果が返されます。</p>


  <p>search=+hotel city:Levenworth~1queryType&amp;=full</p>


  <p>Lucene クエリ構文のほとんどの機能は Azure Search に実装され、範囲検索が唯一の例外です。 OData 型の式を使用$filterできます。</p>


  <p>現在、新しい検索モードは、新しい検索モードを使用REST API。 .NET SDK でのサポートは近日公開予定です。ご期待ください。</p>


  <p>新しい機能が役に立つ場合は、サポートされている新しい構文の使い方をお待ちしています。 Lucene クエリ言語の詳細については、 <a href="https://msdn.microsoft.com/library/mt589323.aspx">MSDN のドキュメント ページを参照してください</a>。 ご質問がある場合は、Azure Search User Voice に関するフィードバック <a href="https://feedback.azure.com/forums/263029-azure-search">をお寄せください</a>。</p>
