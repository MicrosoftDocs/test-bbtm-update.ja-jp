### YamlMime:Yaml
ms.openlocfilehash: 6db7b6a1195ce5485f7dad927f5e5c62ed4a63d1
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139894396"
Slug: dynamic-manifest
Title: 動的マニフェストを使用したカスタマイズされた表示とアセットのトリミング
Summary: この投稿では、動的マニフェスト (資産フィルター) Azure Media Servicesと詳細に関するページを確認します。
Content: >-
  先月の動的マニフェスト機能に関する <a href="https://azure.microsoft.com/blog/2015/04/14/dynamic-manifests-and-rendered-sub-clips/" target="_blank">Jason</a> の発表のフォローアップとして、ストリーミング アプリケーションで使用を開始できると発表して、お知らせします。 Jason の投稿では、一般的な使用シナリオの多くについて説明しました。ここでは主に技術的な実装の詳細に焦点を当てるので、動的マニフェストについて初めて読む場合は、ここから開始してください。 その動作の詳細を確認する前に、次の用語の背景を提供する必要があります。

  <ul>
   <li><strong>アダプティブ ビット レート オーバー HTTP (ABR)</strong>、アダプティブ ビット レート ストリーミングは、ソース コンテンツが複数のビット レートでエンコードされ、小さなマルチ秒部分にチャンクされる HTTP を使用したビデオ ストリーミングの方法です。 ストリーミング クライアントは、異なるビット レートで使用可能なストリームと、マニフェスト ファイルによってストリームのチャンクを認識します。 マルチスクリーンに対するサブスクライバーの需要を満たし、任意のネットワーク上の任意のデバイスにビデオを配信するために、オペレーターは、Apple HLS、Microsoft Smooth、Adobe HDS、MPEG-DASH などのマルチスクリーン実装でアダプティブ ビット レート (ABR) プロトコルを使用します。</li>
   <li><strong>マニフェスト 。</strong>"プレイリスト" とも呼ばれます。 このファイルには、品質、オーディオ言語、プレゼンテーション ウィンドウなどのストリーミング メタデータが含まれています。また、プレーヤーは現在利用できるだけでなく、それぞれの場所で次の再生可能なフラグメントも提供します。 これは、形式に応じて特定の属性を持つテキストベースまたは XML ファイルです。以下で説明する "資産フィルター" を使用すると、次のプロパティと属性に基づいて動的マニフェストを作成できます。
  <strong>•</strong> トラックの種類 - オーディオ、ビデオ、またはテキスト <strong>• </strong>トラック名 <strong>• </strong>開始時刻と終了時刻 <strong>• </strong>プレゼンテーション ウィンドウ - 固定期間のスライディング ウィンドウ。ライブ位置から固定されます。

  <strong>• </strong>ビットレート (品質) <strong>• 言語 </strong>の追跡 <strong>• </strong>FourCC<!--EndFragment--></li>
   <li><strong>フラグメント/セグメント、</strong>ビデオ、オーディオ、またはテキスト コンテンツの実際のチャンク。</li>
  </ul>

  <h2>フィルターとは</h2>

  資産フィルターは、出力プレイリスト (マニフェスト) を操作する方法をストリーミング エンドポイント (バックエンド サービス) に記述するマニフェスト属性とタイムラインに基づくルールの組み合わせです。

  <h2>フィルターの種類</h2>

  アセット フィルターには、次の 2 種類があります。グローバルおよびローカル (資産レベル)。 どちらのフィルターの種類もまったく同じ特徴を持ち、同じ属性を使用してフィルターを定義します。 2 つの主な違いは、適切なシナリオと格納場所です。

  <ul>
   <li>グローバル フィルターは通常、デバイス プロファイル (追跡フィルター処理) に適しています。一方、ほとんどの時間トリミングは資産に固有の時間切り捨てであるので、ローカル フィルターは範囲フィルター (トリミング) に適しています。</li>
   <li>グローバル フィルターはアカウント レベルで格納され、作成時にアカウントのすべての資産に適用できます。 ローカル フィルターは資産単位であり、作成される資産にのみ使用できます。 ローカル フィルターの有効期間は資産の有効期間に関連付け、つまり、資産が削除されると、その上に作成されたローカル フィルターもすべて削除されます。</li>
  </ul>

  <h2>動作のしくみ</h2>

  フィルターは、複数のルールで構成できます。 たとえば、スレートの削除を定義し、ライブ プレイリスト (マニフェスト) にバックオフを適用したり、組み合わせに品質を削除したりすることもできます。 複数のフィルター処理規則の場合、結果はルールの合成 (交差部分のみ) になります。


  <img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="dynamic_manifest8" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dynamic_manifest8.png" alt="dynamic_manifest8" width="500" height="210" border="0" />

  <h2>API を使用したフィルターの作成</h2>

  資産フィルター API は、Azure Media Service REST バージョン &gt;= 2.11 で使用できます。 このリリースには REST API だけが含まれています。対応する .NET SDK は数週間後に対象とされています。

  REST の使用に関する詳細については、AssetFilterhere" href="https://msdn.microsoft.com/en-us/library/azure/mt149053.aspx"> Azure Media Services参照<a title="してください</a>。


  資産フィルターは、2 つのセクション (グループ) で構成されます。PresentationTimeRange とトラック。


  <strong>PresentationTimeRange:</strong>

  <table border="1" width="994" cellspacing="0" cellpadding="2">

  <tbody>

  <tr>

  <td valign="top" width="105"><strong>属性</strong></td>

  <td valign="top" width="410"><strong>説明</strong></td>

  <td valign="top" width="221"><strong>適用対象</strong></td>

  <td valign="top" width="256"><strong>制約</strong></td>

  </tr>

  <tr>

  <td valign="top" width="111"> StartTimestamp</td>

  <td valign="top" width="407">このタイムスタンプの後に開始されるメディアは、プレイリスト (マニフェスト) に含まれます。</td>

  <td valign="top" width="220">ライブおよび VOD</td>

  <td valign="top" width="254">絶対時間。 最も近い次の GOP 開始に丸められた値。</td>

  </tr>

  <tr>

  <td valign="top" width="116">EndTimestamp</td>

  <td valign="top" width="405">このタイムスタンプの前に終了するメディアは、プレイリスト (マニフェスト) に含まれます。</td>

  <td valign="top" width="219">VOD ライブ プレゼンテーションの場合は、サイレント モードで無視され、プレゼンテーションが終了すると適用されます (Live2VOD)</td>

  <td valign="top" width="253">絶対時間。 最も近い次の GOP 開始に丸められた値。</td>

  </tr>

  <tr>

  <td valign="top" width="121">PresentationWindowDuration</td>

  <td valign="top" width="403">プレゼンテーションのライブエッジまたは端にあるスライディング ウィンドウを定義します。 このスライディング ウィンドウ内のメディアは、プレイリスト (マニフェスト) に含まれます。</td>

  <td valign="top" width="218">ライブですが、プレゼンテーションの終了時にスムーズな切り替えを可能にする VOD にも適用されます。</td>

  <td valign="top" width="252">最小プレゼンテーション ウィンドウ期間は 120 秒です。</td>

  </tr>

  <tr>

  <td valign="top" width="125">LiveBackoffDuration</td>

  <td valign="top" width="401">ライブ プレゼンテーションバックオフ (遅延) をメディアに適用します。</td>

  <td valign="top" width="217">ライブのみ。ただし、VOD ではサイレント モードで無視され、プレゼンテーションの終了時にスムーズな切り替えが可能になります。</td>

  <td valign="top" width="251">最大ライブ バックオフ期間は 60 秒です。</td>

  </tr>

  <tr>

  <td valign="top" width="128">タイムスケール</td>

  <td valign="top" width="399">上記のタイムスタンプと期間によって使用されるタイムスケールです。 既定のタイムスケールは 10000000 です。</td>

  <td valign="top" width="220">ライブおよび VOD</td>

  <td valign="top" width="256">既定値は 10000000 (HNS) です</td>

  </tr>

  </tbody>

  </table>

  <strong>トラック：</strong>

  <table border="1" width="999" cellspacing="0" cellpadding="2">

  <tbody>

  <tr>

  <td valign="top" width="190"><strong>プロパティ</strong></td>

  <td valign="top" width="366"><strong>説明</strong></td>

  <td valign="top" width="205"><strong>適用対象</strong></td>

  <td valign="top" width="235"><strong>制約</strong></td>

  </tr>

  <tr>

  <td valign="top" width="190">型</td>

  <td valign="top" width="366">トラックの種類。値には、ビデオ、オーディオ、またはテキストを指定できます。</td>

  <td valign="top" width="205">ライブおよび VOD</td>

  <td valign="top" width="235">ビデオ、オーディオ、またはテキスト</td>

  </tr>

  <tr>

  <td valign="top" width="190">名前</td>

  <td valign="top" width="366">トラックの名前</td>

  <td valign="top" width="205">ライブおよび VOD</td>

  <td valign="top" width="235"></td>

  </tr>

  <tr>

  <td valign="top" width="190">言語</td>

  <td valign="top" width="366">言語の追跡</td>

  <td valign="top" width="205">ライブおよび VOD</td>

  <td valign="top" width="235">RFC 5646 で指定された形式</td>

  </tr>

  <tr>

  <td valign="top" width="190">FourCC</td>

  <td valign="top" width="366">FourCC 値を追跡する</td>

  <td valign="top" width="205">ライブおよび VOD</td>

  <td valign="top" width="235">RFC 6381 で指定されたコーデック形式の最初の要素</td>

  </tr>

  <tr>

  <td valign="top" width="190">Bitrate</td>

  <td valign="top" width="366">トラックのビットレート。</td>

  <td valign="top" width="205">ライブおよび VOD</td>

  <td valign="top" width="235">範囲の値または正確な値を指定できます</td>

  </tr>

  </tbody>

  </table>

  &nbsp;

  <blockquote><em><strong>注:</strong> Azure Media Services<a href="https://azure.microsoft.com/en-us/documentation/articles/media-services-dynamic-packaging-overview/" target="_blank">ダイナミック パッケージラーは</a>、マルチビットレートの MP4 と複数のファイルからソースSmooth Streamingできます。動的マニフェスト (資産フィルター) では、フィルター処理<a href="https://msdn.microsoft.com/en-us/library/ff436055(v=vs.90).aspx" target="_blank">Smooth Streamingサーバーマニフェストデータとクライアント マニフェスト</a> データが使用されます。また、この機能を使用するには、少なくとも 1 <a href="https://azure.microsoft.com/en-us/documentation/articles/media-services-manage-origins/#scale_streaming_endpoints" target="_blank">つの</a>ストリーミング ユニットが必要です。</em></blockquote>

  <strong>グローバル フィルター REST 要求のサンプル:</strong>

  <pre class="prettyprint">&lt;?xml version="1.0" encoding="utf-8"?&gt;

  &lt;entry xmlns=https://www.w3.org/2005/Atom xmlns:d="" xmlns:m="/metadata" xmlns:georss="" xmlns:gml="https://www.opengis.net/gml"&gt;

  &lt;id /&gt;&lt;title /&gt;

  &lt;updated&gt;2015-04-03T20:50:34Z&lt;/updated&gt;

  &lt;author&gt;&lt;name /&gt;&lt;/author&gt;

  &lt;content type="application/xml"&gt;


  &lt;m:properties&gt;&lt;d:Name&gt;MyGlobalFilter&lt;/d:Name&gt;


  &lt;d:PresentationTimeRange&gt;

  &lt;d:EndTimestamp m:type="Edm.Int64"&gt;9223372036854775807&lt;/d:EndTimestamp&gt;

  &lt;d:LiveBackoffDuration m:type="Edm.Int64"&gt;0&lt;/d:LiveBackoffDuration&gt;

  &lt;d:PresentationWindowDuration m:type="Edm.Int64"&gt;800000000&lt;/d:PresentationWindowDuration&gt;

  &lt;d:StartTimestamp m:type="Edm.Int64"&gt;0&lt;/d:StartTimestamp&gt;

  &lt;d:Timescale m:type="Edm.Int64"&gt;10000000&lt;/d:Timescale&gt;

  &lt;/d:PresentationTimeRange&gt;


  &lt;d:Tracks /&gt;&lt;/m:properties&gt;


  &lt;/content&gt;

  &lt;/entry&gt;</pre>

  <strong>ローカル (資産レベル) フィルター REST 要求のサンプル:</strong>

  <pre class="prettyprint">&lt;?xml version="1.0" encoding="utf-8"?&gt;

  &lt;entry xmlns=https://www.w3.org/2005/Atom xmlns:d="" xmlns:m="/metadata" xmlns:georss="" xmlns:gml="https://www.opengis.net/gml"&gt;

  &lt;id /&gt;&lt;title /&gt;

  &lt;updated&gt;2015-04-03T20:53:34Z&lt;/updated&gt;

  &lt;author&gt;&lt;name /&gt;&lt;/author&gt;

  &lt;content type="application/xml"&gt;

  &lt;m:properties&gt;&lt;d:Id&gt;&lt;/d:Id&gt;


  &lt;d:Name&gt;MyLocalFilter&lt;/d:Name&gt;


  &lt;d:ParentAssetId&gt;nb:cid:UUID:fcef555d-1500-80c4-def5-f1e4d721ea68&lt;/d:ParentAssetId&gt;


  &lt;d:PresentationTimeRange&gt;


  &lt;d:EndTimestamp m:type="Edm.Int64"&gt;9223372036854775807&lt;/d:EndTimestamp&gt;

  &lt;d:LiveBackoffDuration m:type="Edm.Int64"&gt;300000000&lt;/d:LiveBackoffDuration&gt;

  &lt;d:PresentationWindowDuration m:type="Edm.Int64"&gt;3000000000&lt;/d:PresentationWindowDuration&gt;

  &lt;d:StartTimestamp m:type="Edm.Int64"&gt;400000&lt;/d:StartTimestamp&gt;

  &lt;d:Timescale m:type="Edm.Int64"&gt;10000000&lt;/d:Timescale&gt;


  &lt;/d:PresentationTimeRange&gt;


  &lt;d:Tracks&gt;


  &lt;d:element&gt;


  &lt;d:PropertyConditions&gt;


  &lt;d:element&gt;


  &lt;d:Operator&gt;Equal&lt;/d:Operator&gt;&lt;d:Property&gt;Type&lt;/d:Property&gt;&lt;d:Value&gt;audio&lt;/d:Value&gt;


  &lt;/d:element&gt;


  &lt;d:element&gt;


  &lt;d:Operator&gt;Equal&lt;/d:Operator&gt;&lt;d:Property&gt;Language&lt;/d:Property&gt;&lt;d:Value&gt;en&lt;/d:Value&gt;


  &lt;/d:element&gt;


  &lt;/d:PropertyConditions&gt;


  &lt;/d:element&gt;


  &lt;d:element&gt;


  &lt;d:PropertyConditions&gt;


  &lt;d:element&gt;


  &lt;d:Operator&gt;NotEqual&lt;/d:Operator&gt;&lt;d:Property&gt;Type&lt;/d:Property&gt;&lt;d:Value&gt;video&lt;/d:Value&gt;


  &lt;/d:element&gt;


  &lt;d:element&gt;


  &lt;d:Operator&gt;Equal&lt;/d:Operator&gt;&lt;d:Property&gt;Bitrate&lt;/d:Property&gt;&lt;d:Value&gt;0-2427000&lt;/d:Value&gt;


  &lt;/d:element&gt;


  &lt;/d:PropertyConditions&gt;


  &lt;/d:element&gt;


  &lt;/d:Tracks&gt;


  &lt;/m:properties&gt;


  &lt;/content&gt;&lt;/entry&gt;

  </pre>

  <pre class="prettyprint"></pre>

  &nbsp;


  フィルターが作成された後は、次の例に示すマニフェスト要求にフィルター パラメーターを追加することで、URL 要求にフィルター名を追加することで、フィルターの使用を開始できます。


  <a href="(filter=MyLocalFilter)">(<span style="background-color: #ffff00;">filter=MyLocalFilter</span>)</a>


  フィルターは、動的パッケージ化および動的暗号化<a href="https://azure.microsoft.com/en-us/documentation/articles/media-services-dynamic-packaging-overview/" target="_blank">と組み合</a><a href="https://msdn.microsoft.com/en-us/library/azure/dn783457.aspx" target="_blank">わせて使用することもできます</a>。 例として、上記と同じストリームに対する要求を HLS v4 形式で示します。


  <a href="(format=m3u8-aapl,filter=MyLocalFilter)">(format=m3u8-aapl,filter<span style="background-color: #ffff00;">=MyLocalFilter</span>)</a>

  <blockquote><strong>メモ：</strong> グローバル フィルターは、資産ストリーミング URL にフィルター名を追加することで、同じメディア サービス アカウント内のすべての資産で使用できます。 ローカル フィルターは、関連付けられている資産でのみ使用できます。 ローカル フィルター資産の例を参照してください。 ("<span style="color: #ff0000; font-family: Consolas;">ParentAssetId</span>")</blockquote>

  <h2>舞台裏では何が起こっているのか?</h2>

  フィルターを含む要求がストリーミングエンドポイントによって受信されると、元の再生リスト (マニフェスト) はフィルタールールを使用して処理され、フィルター選択された再生リストは応答で提供されます。 複数のフィルター規則がある場合、規則の積集合は出力を定義します。 プレゼンテーション範囲 (時間) のルールは、GOP (画像キーフレームのグループ) の境界で実行され、最も近い次のフラグメントに丸められます。

  例を次に示します。

  <img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="dynamic_manifest9" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dynamic_manifest9.png" alt="dynamic_manifest9" width="640" height="327" border="0" />


  フィルターは、再生リスト (マニフェスト) 要求にのみ適用され、実際のフラグメントは処理されません。そのため、プレーヤーは、既にキャッシュされているフラグメントをプロキシと CDNs に利用できます。

  元の再生リスト (マニフェスト) とフィルター処理されたものを示す例を次に示します。プレゼンテーション範囲フィルターを適用した後。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/05/26/dynamic_manifest10.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="dynamic_manifest10" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dynamic_manifest10_thumb.png" alt="dynamic_manifest10" width="640" height="482" border="0" /></a>


  上に示したように、出力マニフェストには、定義されたフィルターの開始時刻と終了時刻に含まれるセグメントだけが含まれます。

  <h2>既知の問題と制限</h2>

  <ul>
   <li>動的マニフェストは GOP 境界 (キー フレーム) で動作するため、トリミングの正確度は GOP に応じます。 フレームの正確なサブクリップを作成する場合は、表示されたサブクリップ機能を使用できます。</li>
   <li>ローカル フィルターとグローバル フィルターに同じフィルター名を使用できます。 この場合は、ローカルフィルターが優先され、グローバルが上書きされます。</li>
   <li>フィルターを更新する場合、ストリーミング エンドポイントでルールを更新するのに最大 2 分かかります。 また、フィルターを更新すると、コンテンツが既に古いフィルターで処理され、プロキシおよび CDN キャッシュにキャッシュされている場合に、プレーヤーで障害が発生する可能性があることに注意してください。 フィルターを更新した後でキャッシュを消去することをお勧めします。 このオプションが不可能な場合は、別のフィルターを使用することを検討してください。</li>
   <li>このリリースでは、URL 内の複数のフィルターの組み合わせはサポートされていません。 適用できるフィルターは一度に1つだけです。</li>
   <li>オンデマンド再生リストとライブ再生リストの両方に対して "EndTimestamp" 規則を設定できます。 ただし、プレゼンテーションがライブである場合、このルールは警告なしで無視され、ライブプレゼンテーションがオンデマンドでに変換されるときにプレゼンスが付きます。</li>
   <li>オンデマンドとライブの両方のプレゼンテーションに "プレゼンテーション Windowduration" ルールと "LiveBackoffDuration" ルールを設定できます。 ただし、オンデマンドプレゼンテーションの場合、この規則は警告なしで無視されます。</li>
  </ul>

  <h2>まとめ</h2>

  動的マニフェスト (資産フィルター) は、実稼働後や同じ資産の複数のコピーを保持することなく、複数のエンドポイントに接続するのに役立つ強力な新機能です。 これにより、複数のレンディションとビューを数秒で作成できます。


  すばらしい機能をご利用いただけます。 機能に関するご要望や全般的なフィードバックをお寄せください。 以下のコメントセクションをご利用ください。できるだけ早く対応いたします。
