### YamlMime:Yaml
ms.openlocfilehash: c19200d3c9bcd2525b57d7fb6a0c1e84c5949011
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889290"
Slug: azure-analysis-services-integration-with-azure-diagnostic-logs
Title: Azure 診断ログとの Azure Analysis Services 統合
Summary: Azure Analysis Services が Azure Monitor リソース診断ログに統合されていることをお知らせします。 診断ログは、IT によって所有されている BI 実装の重要な機能です。 実行しました...
Content: >-
  <p>Azure Analysis Services が <a href="https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs">Azure Monitor リソース診断ログ</a>に統合されていることをお知らせします。 診断ログは、IT によって所有されている BI 実装の重要な機能です。 パフォーマンスが低下することなく、運用 Azure Analysis Services サーバーで診断ログを確実に実行できるようにするための手順を実行しました。</p>


  <p>次のようなさまざまなシナリオがサポートされています。</p>


  <ul>
   <li>監査</li>
   <li>サーバーの正常性の監視</li>
   <li>使用状況メトリックの派生</li>
   <li>どのユーザーグループがどのデータセットを使用しているかを理解する</li>
   <li>実行時間の長いクエリまたは問題のあるクエリの検出</li>
   <li>エラーが発生したユーザーの検出</li>
  </ul>


  <p>これまで、お客様は、オンプレミスで SSAS <a href="https://docs.microsoft.com/sql/analysis-services/instances/monitor-analysis-services-with-sql-server-extended-events">拡張イベント</a> (xevent) を使用してきました。 これには通常、xEvent セッションの管理、バイナリの XEL ファイルへの出力、ファイル内のデータにアクセスするための SQL Server での特殊なシステム関数の使用、XML 出力の複雑な解析などが含まれます。 すべての処理が完了したら、データをどこかに格納し、その後で分析に使用することができます。 多くの場合、パフォーマンスカウンターのメトリックや、アーキテクチャの他のコンポーネントからのログなど、他の使用状況データと自動的に統合されませんでした。 Azure 診断ログを使用すると、このプロセスを簡単かつ簡単に Azure Analysis Services できます。</p>


  <h2>診断ログの設定</h2>


  <p>これを設定するには、Azure portal で Azure Analysis Services サーバーの [診断ログ &rdquo; ] ブレードを選択 &ldquo; します。 次に、[ <strong>診断設定の追加</strong> ] リンクをクリックします。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4cc05fdd-380b-466e-81a3-30aa5433fb20.png"><img alt="01 Azure Portal" border="0" height="1187" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e8e9e5a4-65e3-4b48-817a-db166a409caf.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="01 Azure Portal" width="2278"></a></p>


  <p>[診断設定] ブレードが表示されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/37f7ab3c-4c5b-4b7e-a229-1acc9a6a03f8.png"><img alt="02 Diagnostic Settings" border="0" height="486" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/402f815a-7ecb-489b-ac8b-c6c27f874364.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="02診断設定" width="485"></a></p>


  <p>ここでは、診断ログに対して最大3つのターゲットを定義できます。</p>


  <ol>
   <li>ストレージアカウントへのアーカイブ: ログファイルは (XEL ファイルではなく) JSON 形式で格納されます。</li>
   <li>Event hub へのストリーム: これにより、ビッグデータシステムなど、広範な統合が可能になります。</li>
   <li>Log Analytics への送信: これは、組み込みの分析、ダッシュボード、通知機能を提供する、特に便利な <a href="https://azure.microsoft.com/en-us/services/log-analytics/">Azure Log Analytics</a>を活用します。</li>
  </ol>


  <p>次のログカテゴリを選択できます。</p>


  <ul>
   <li>エンジンカテゴリは、次の Xevent をログに記録するように Azure Analysis Services に指示します。 SSAS の Xevent とは異なり、個別の Xevent を選択することはできません。 Log Analytics モデルでは、すべてのイベントをログに記録し、後で質問することが比較的安価であると想定しています。 コミュニティからのフィードバックにより、これらが最も重要な Xevent であることがわかりました。また、サーバーのパフォーマンスに影響する可能性のある詳細なイベントは除外されています。 今後、特に新機能をリリースするときに、さらに Xevent が追加される可能性があります。</li>
  </ul>


  <table border="1" cellpadding="0" cellspacing="0" width="910">
   <tbody>
    <tr>
     <td valign="top" width="291">
     <p><b>XEvent別</b></p>
     </td>
     <td valign="top" width="617">
     <p><b>イベント名</b></p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>セキュリティ監査</p>
     </td>
     <td valign="top" width="617">
     <p>Audit Login</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>セキュリティ監査</p>
     </td>
     <td valign="top" width="617">
     <p>Audit Logout</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>セキュリティ監査</p>
     </td>
     <td valign="top" width="617">
     <p>Audit Server Starts And Stops</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>進行状況レポート</p>
     </td>
     <td valign="top" width="617">
     <p>Progress Report Begin</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>進行状況レポート</p>
     </td>
     <td valign="top" width="617">
     <p>Progress Report End</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>進行状況レポート</p>
     </td>
     <td valign="top" width="617">
     <p>Progress Report Current</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ</p>
     </td>
     <td valign="top" width="617">
     <p>Query Begin</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ</p>
     </td>
     <td valign="top" width="617">
     <p>Query End</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>コマンド</p>
     </td>
     <td valign="top" width="617">
     <p>Command Begin</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>コマンド</p>
     </td>
     <td valign="top" width="617">
     <p>Command End</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>エラー &amp; 警告</p>
     </td>
     <td valign="top" width="617">
     <p>エラー</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>発見</p>
     </td>
     <td valign="top" width="617">
     <p>Discover End</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>Notification</p>
     </td>
     <td valign="top" width="617">
     <p>Notification</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>Session</p>
     </td>
     <td valign="top" width="617">
     <p>Session Initialize</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>Locks</p>
     </td>
     <td valign="top" width="617">
     <p>Deadlock</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ処理</p>
     </td>
     <td valign="top" width="617">
     <p>VertiPaq SE Query Begin</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ処理</p>
     </td>
     <td valign="top" width="617">
     <p>VertiPaq SE Query End</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ処理</p>
     </td>
     <td valign="top" width="617">
     <p>VertiPaq SE Query Cache Match</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ処理</p>
     </td>
     <td valign="top" width="617">
     <p>Direct Query Begin</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="291">
     <p>クエリ処理</p>
     </td>
     <td valign="top" width="617">
     <p>Direct Query End</p>
     </td>
    </tr>
   </tbody>
  </table>


  <ul>
   <li>サービスカテゴリには、次のサービスレベルイベントが含まれます。</li>
  </ul>


  <table border="1" cellpadding="0" cellspacing="0" width="1197">
   <tbody>
    <tr>
     <td valign="top" width="338">
     <p><b>操作名</b></p>
     </td>
     <td valign="top" width="857">
     <p><b>発生するタイミング</b></p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>CreateGateway</p>
     </td>
     <td valign="top" width="857">
     <p>ユーザーがサーバー上にゲートウェイを構成するとき</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>ResumeServer</p>
     </td>
     <td valign="top" width="857">
     <p>サーバーを再開するとき</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>SuspendServer</p>
     </td>
     <td valign="top" width="857">
     <p>サーバーを一時停止するとき</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>DeleteServer</p>
     </td>
     <td valign="top" width="857">
     <p>サーバーの削除</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>RestartServer</p>
     </td>
     <td valign="top" width="857">
     <p>ユーザーが SSMS または PowerShell を経由してサーバーを再起動するとき</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>GetServerLogFiles</p>
     </td>
     <td valign="top" width="857">
     <p>ユーザーが PowerShell を通じてサーバー ログをエクスポートするとき</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="338">
     <p>ExportModel</p>
     </td>
     <td valign="top" width="857">
     <p>ユーザーは、Azure Portal でモデルをエクスポートします。 たとえば、 &quot; Power BI Desktop &quot; &quot; で開くには、でを開き Visual Studio&quot;</p>
     </td>
    </tr>
   </tbody>
  </table>


  <ul>
   <li>[すべてのメトリック] カテゴリでは、メトリックの読み取りに関するイベントをログに記録します。 これらは、Azure Analysis Services サーバーの Azure portal のメトリックブレードに表示されるメトリックと同じです。</li>
  </ul>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/60ae0a21-8895-429d-bd11-41ccc30c9812.png"><img alt="03 Metrics" border="0" height="840" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/44109d92-1807-4552-9a49-f3b89e141f2a.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="03メトリック" width="1789"></a></p>


  <p>メトリックとサーバーのイベントは、並列して分析するために Log Analytics の xEvents と統合されます。 また Log Analytics は、他のさまざまな Azure サービスからイベントを受信するように構成することもできます。これにより、顧客のアーキテクチャ全体で診断ログデータを総合的に把握することができます。 診断設定の追加は、 <a href="https://docs.microsoft.com/powershell/module/azurerm.insights/set-azurermdiagnosticsetting">Set-AzureRmDiagnosticSetting コマンドレットを使用して PowerShell から実行</a> できます。</p>


  <h2>Log Analytics で診断ログを使用する</h2>


  <p>一部のログ データが既に生成されている場合は、Azure portalの Log Analytics セクションに移動し、ターゲット OMS ワークスペース &ldquo;を選択します&rdquo;。 次に、[ログ検索 <strong>] をクリックします</strong>。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/546af022-7403-4859-a69d-4438f662dda4.png"><img alt="04 Log Analytics" border="0" height="1339" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/50feecb5-c593-4f30-b8b5-ede7d6b0e9bd.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="04 Log Analytics" width="2788"></a></p>


  <p>収集された <strong>データをクリックして</strong> 開始します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1ec55035-049a-4475-a6a3-02460c76058e.png"><img alt="05 Log Search" border="0" height="140" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5b299c5c-91fa-4986-93a2-38b17dd04210.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="05 ログ検索" width="389"></a></p>


  <p>次に、[<strong>AzureDiagnostics] と [適用] を</strong><strong>クリックします</strong>。 AzureDiagnostics には、エンジンイベントとサービス イベントが含まれます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/53c2c314-5d35-4e71-b732-047c59fac55a.png"><img alt="06 Azure Diagnostics" border="0" height="1229" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/18e18b7e-1b91-4b48-b6c0-e622251cbac0.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="06 Azure Diagnostics" width="2005"></a></p>


  <p>Log Analytics クエリがオンザフライで構築されているのに注意してください。 [EventClass_sには xEvent 名が含まれます。これは、オンプレミスで xEvents を使用している場合は見慣れたものに見えます。 [EventClass_sクリックするか、イベント名の 1 つをクリックすると、Log Analytics はユーザー インターフェイスでの操作に基づいてクエリを作成し続ける必要があります。 Log Analytics には、後で再利用するために検索を保存する機能があります。</p>


  <p>この投稿では、Log Analytics データの使用に関する iceberg のヒントのみを説明します。 たとえば、 <a href="https://www.microsoft.com/cloud-platform/operations-management-suite">Operations Management Suite は、</a> Log Analytics データに対するクエリ、ダッシュボード、アラート機能を強化した Web サイトを提供します。</p>


  <h2>検索クエリのサンプル</h2>


  <p>次のサンプル クエリは、完了に 5 分 (300,000 ミリ秒) 以上かかった Azure Analysis Services に送信されたクエリを返します。 通常、汎用 xEvent 列は文字列として格納されるため、末尾はサフィックス_s&ldquo;&rdquo;されます。 5 分以上かかったクエリをフィルター処理するには、数値にDuration_sする必要があります。 これは、toint() 構文を使用して実現できます。</p>


  <p>search * |where ( Type == &quot;AzureDiagnostics&quot; ) | where ( EventClass_s == &quot;QUERY_END&quot; ) | where toint(Duration_s) &gt; 300000</p>


  <h2>クエリのスケールアウト</h2>


  <p>スケールアウトを使用すると、読み取り専用レプリカを識別できます。ServerName_s フィールドの値には、名前にレプリカ インスタンス番号が追加されています。 リソース フィールドには、ユーザーに表示されるサーバー名に一致する Azure のリソース名が含まれています。 さらに、レプリカの場合IsQueryScaleoutReadonlyInstance_sフィールドは true に等しくなります。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0b7420d3-d71f-49f4-850d-fb1e2eb59547.png"><img alt="08 Scale out" border="0" height="421" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/269f613f-484c-4a4d-889b-0fdc8930d1fa.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="08 スケールアウト" width="571"></a></p>


  <h2>診断ログを使用してPower BI</h2>


  <p>ほとんどの BI プロフェッショナル向け Log Analytics データのロックを解除する可能性がある機能は、Power BIです。 クリックするだけで、M 式を含むテキスト ファイルがダウンロードされます。このファイルは、次のページの空のクエリに貼りPower BI Desktop。 式には現在の Log Analytics クエリが含まれているので、Log Analytics クエリから使用REST API。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b6629a3f-4ea0-426b-bb67-fb2b1d72941d.png"><img alt="09 Power BI button" border="0" height="118" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/06de35ee-7151-4974-8119-9203813a33a3.png" style="border: 0px currentcolor; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="09 Power BI ボタン" width="694"></a></p>


  <p>これにより、次のようなさまざまな分析レポートが可能になります。次の情報が表示されます。</p>


  <ul>
   <li>S4 サーバーが 100 GB のメモリ制限に達していない。</li>
   <li>時間の範囲内では、QPU は最大で切り取されます。S4 サーバーは 400 の QPUs に制限されています。</li>
   <li>実行時間の長いクエリは、処理/データ更新操作中に発生しました。</li>
   <li>実行時間の長いクエリと処理操作の間の問題が原因でタイムアウト エラーが発生しました。</li>
   <li>サーバーは、クエリの<a href="https://microsoft-my.sharepoint.com/personal/chwade_microsoft_com/Documents/Microsoft/Blog Posts/Diagnostic Logs/#_msocom_1" name="_msoanchor_1">&nbsp;</a>スケールアウトに対する候補として優れた場合があります。</li>
  </ul>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9ebdf502-5cc3-4722-9ef0-a84ddd85e7cd.png"><img alt="10 Power BI report" border="0" height="1359" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3cfe04a1-73c9-4fdc-82af-913307565947.png" style="padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;" title="10 Power BI レポート" width="2179"></a></p>


  <p>&rsquo;Azure Analysis Services と Azure Monitor リソース診断ログの統合により、監査と監視のための豊富な機能が提供され、メトリック データなどの他のデータと xEvent データのサイド バイ サイド分析が提供され、オンプレミスの xEvents よりも簡単に設定できます。 それではお楽しみください。</p>
