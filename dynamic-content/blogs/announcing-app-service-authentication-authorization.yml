### YamlMime:Yaml
ms.openlocfilehash: eef1b3e29e5ab544f0b18c05e23ce58bb811176b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895684"
Slug: announcing-app-service-authentication-authorization
Title: 認証App Serviceの拡張
Summary: 現在、Azure App Service の認証/承認機能を拡張して、新しい ID プロバイダー、新しいサインイン オプション、およびアクセス制御の柔軟性を高める取り組みです。
Content: >-
  <p>昨年のこの頃、同僚の <a href="https://azure.microsoft.com/en-us/blog/author/byvinyal/">Byron Tardif</a> が <a href="https://azure.microsoft.com/en-us/blog/azure-websites-authentication-authorization/">、Azure Websites</a> の認証/承認を紹介する投稿を作成しました。 この機能を使用すると、ユーザーは数回のクリックAzure Active Directoryを使用してサイトをすばやく保護できます。 使&rsquo;いやすさについて多くの優れたことを聞いたことがありますが、多くのお客様は、特に API シナリオに関して、より柔軟に対応したいと考えています。</p>


  <p>その後、3 月に、Azure App Service、2 つのWeb AppsをMobile Apps。API AppsサービスLogic Apps 1 つのオファリングに含め、 これには、App Serviceゲートウェイが含まれていました。これにより、サイト間での共有認証が許可され、Mobile Services からのログイン サポートが拡張されました。 ただし、お客様から聞いた重要な要求の 1 つは、個々のアプリケーション レベルでの認証の柔軟性を高め、でした。</p>


  <p>現在、これらのアプローチを統合し、App Service の認証/承認機能を拡張して、新しい ID プロバイダー、新しいサインイン オプション、およびアクセス制御の柔軟性を高める取り組みです。 これにより、お客様はゲートウェイのすべての豊富さを提供しますが、サイトごとに、管理エクスペリエンスが向上します。 Web アプリケーションとモバイル アプリケーションでは、今後のゲートウェイではなく、このApp Service使用することをお勧めします。</p>


  <h2>作業の開始</h2>


  <p>App Service認証/承認は、Azure Preview 管理ポータル で公開されています。 有効にするには、任意の Web または<strong></strong>モバイル アプリの 設定 ブレードに移動し、[認証<strong>/承認] を選択します</strong>。 スイッチを [オン] に切り替えて、サイトを保護するためのオプションを表示します。</p>


  <p><img alt="Enabling Authentication / Authorization" border="0" height="414" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/31481b46-df1f-40ef-9b30-77e003f6a3a3.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="認証/承認の有効化" width="610"></p>


  <p>主な変更の 1 つは、Azure Active Directory だけでなく、Facebook、Google、Microsoft アカウント、Twitter も含まれるプロバイダーの選択を拡張した点です。 これらのオプションのいずれかをクリックすると、ユーザーがプロバイダーでログインできる設定を構成できます。 [Facebook と Microsoft アカウント] ブレードでは、ログイン時に要求できるオプションのスコープの一覧も公開され、アプリケーションでユーザーに関する詳細を取得できます。</p>


  <p><img alt="Facebook configuration settings" border="0" height="480" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/86a5fbae-f0c6-4b7a-8c25-ac6f23f56f0b.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="Facebook の構成設定" width="460"></p>


  <p>&nbsp;</p>


  <p>複数のモードをAAD、Express オプションを使用して数回のクリックで構成できます<strong></strong>。 必要に応じて、詳細オプションを使用AAD構成を手動<strong>で指定</strong>できます。 各プロバイダーの構成の詳細については、Azure Active Directory、<a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-facebook-authentication/">Facebook</a>、<a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-google-authentication/">Google</a>、<a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-microsoft-authentication/">Microsoft アカウント</a>、Twitter の各トピックを<a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-twitter-authentication/">参照</a>してください。<a href="https://azure.microsoft.com/en-us/documentation/articles/app-service-mobile-how-to-configure-active-directory-authentication/"></a></p>


  <h2>遅延承認</h2>


  <p>多くのアプリケーションでは、アプリケーションの各部分に対してさまざまなアクセス制限があります。 おそらく、公開したい API もあればサインインを求める API もあるでしょう。 元の認証/承認の機能は、オール オア ナッシングで、すべてのサイトでログインを必要としています。 このオプションはまだ存在しますが、アプリケーション コードでアクセスの決定をレンダリングすることもできます。 現在は、認証されている場合にユーザー情報を使用して ThreadPrincipal を設定 ASP.NET サイトでこれを行うのが最適です。 その後、アプリケーションは保護が必要なアクションに対して [Authorize] 属性を使用できます。他のアクションは許可されます。 他のプラットフォームを使用するアプリケーションでは、完全なサイト保護オプションを使用するか、Cookie またはトークンを手動で検証する必要があります。</p>


  <p>認証/承認を有効にした場合、アプリケーション コードは既定でアクセスの決定を担当します。 サイトで認証されていないすべてのトラフィックを特定のプロバイダーにリダイレクトする場合は、[要求が認証されていないときに実行するアクション] ドロップダウンからそのプロバイダーを <strong>選択</strong> します。</p>


  <p><img alt="Selecting action for when client is unauthenticated" border="0" height="144" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/70dbfbc0-04f1-4fe2-99df-ba809e03d1c4.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="クライアントが認証されていない場合のアクションの選択" width="480"></p>


  <p>一度に複数の ID プロバイダーを構成できますが、完全なサイト保護用に構成できるのは 1 つのみです。 複数のプロバイダーを&ldquo;&rdquo;使用するほとんどのアプリケーションでは、認証されていない要求に対して [アクションなし] オプションを使用する必要があります。そのため、アプリケーションはユーザーをサインインする場合と方法を決定できます。</p>


  <h2>サインイン オプション</h2>


  <p>元の認証/承認では、認証されていない要求がサイトに到達した場合にブラウザーをリダイレクトすることでのみログインが許可されます。 これで、開発者は、この動作を利用するか、ログイン フローを明示的に開始できます。</p>


  <p>アプリケーションは、サイトの /.auth/login/&lt;provider <em>&lt;&gt;</em>&gt; エンドポイントにユーザーを移動することで、同じリダイレクト自体をトリガーできます。プロバイダーは <em>aad、facebook、google、microsoftaccount</em>、<em>twitter</em> の 1 つになります。 このオプションは、ログイン ボタンを備えたサイトや多くのモバイル アプリケーションに最適です。</p>


  <p>または、クライアントはプロバイダー SDK を使用してトークンを取得し、それをセッション トークンと交換できます。 単に、JSON 本文のプロバイダー トークンを使用して、キー access_token (&ldquo;または Microsoft アカウントの場合は authenticationToken&rdquo;) を使用して、同じエンドポイントに HTTP POST &ldquo;&rdquo; を送信します。 これは、プロバイダー SDK がプラットフォーム上で利用できる場合にモバイル アプリケーションに推奨されるソリューションであり、多くの Web アプリケーションや API アプリケーションでも機能します。</p>


  <p>実際、このサポートは、ヘッドレス認証App Service可能な機能も意味します。 デーモン プロセスがある場合、またはインターフェイスのない API へのアクセスを必要とする他のクライアントがある場合は、AAD サービス プリンシパルを使用してトークンを要求し、アプリケーションでの認証に使用できます。 AAD の場合は、ベアラー トークンの仕様に従って、セッション トークンをバイパスし、Authorization ヘッダーに AAD トークンを含めすることもできます。</p>


  <p>現在、更新が行Mobile Appsクライアント SDK では、LoginAsync() メソッドで前述のフローの両方がサポートされています。</p>


  <h2>トークン ストア</h2>


  <p>ポータルでメモする&rsquo;もう 1 つのオプションは、トークン ストアを有効または無効にする機能です。 この機能により、基になるプロバイダー トークンをアプリケーションに格納し、関連付けられているユーザーのコンテキストでしかアクセスできません。 このオプションは現在、既定でオンであり、モバイル シナリオに必要です。</p>


  <p>グラフ呼び出しに必要な追加のユーザー情報とトークンを取得するには、サイトの /.auth/me エンドポイントに GET を発行します。 要求に有効なセッション Cookie またはセッション トークンが含まれる場合は、現在のユーザーに関する情報が返されます。 このMobile Apps SDK では、この API を簡単に使用できる GetAppServiceIdentityAsync() メソッドが提供されます。</p>


  <h2>移動して認証する</h2>


  <p>そうすると、アプリケーションの認証を開始するために必要なすべてがApp Serviceされます。 この&rsquo;機能とその API に関連するドキュメント セットの拡張に取り組むので、機能の追加の改善については、こちらを参照してください。</p>


  <p>認証/承認のApp Serviceして&rsquo;、お好みまたはご自分の好みまたはお知らせをお知らせします。 Azure フィードバック サイトと <a href="https://social.msdn.microsoft.com/Forums/azure/en-US/home">MSDN</a> フォーラムで<a href="https://feedback.azure.com/forums/34192--general-feedback"></a>いつでもチームに問い合わせることができます。または、以下のコメントに返信を残しておくことができます。</p>
