### YamlMime:Yaml
ms.openlocfilehash: d8671136069aeb7952af1e6aab8b4a5bc24870e9
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889254"
Slug: azure-traffic-manager-external-endpoints-and-weighted-round-robin-via-powershell
Title: Azure Traffic Manager PowerShell を使用して外部エンドポイントと重み付けラウンド ロビンを作成する
Summary: Azure Traffic Manager で外部エンドポイントと重み付け負荷分散を発表し、Traffic Manager サービス管理用の新しい PowerShell コマンドレットを使用してこれらの機能を管理する方法について説明します。
Content: "TechEd 北米では、Azure Azure Traffic Managerエンドポイントのサポートについて発表しました。ラウンドロビン負荷分散を使用する場合の重み付けサポートを追加して、さらなる機能強化をお知らせします。これらの機能を組み合わせて使用すると、オンプレミスとクラウド間のハイブリッド シナリオでのトラフィックの分散など、さまざまな新しいシナリオが可能になります。\n\nこれらの機能は現在、PowerShell コマンドレットを通じてサポートされています。これは、新しく拡張され、新しいTraffic Manager。\n<h2>はじめに</h2>\nTraffic Manager同じデータセンター内で実行されている場合でも、世界中の異なるデータセンター間で実行されている場合でも、受信トラフィックを複数のサービス間で負荷分散できます。Traffic Manager によって実現される主なシナリオには、エンド ユーザーを最も近いデプロイにルーティングしてアプリケーションのパフォーマンスを向上させる、サービスを監視し、サービスがダウンした場合の自動フェールオーバーを提供することで高可用性を実現する方法が含まれます。\n\n最近まで、Azure Cloud Services (IaaS と PaaS の両方) と Azure Websites だけがサポートされました。  <strong>これで、Azure の外部Traffic Managerのサポートを有効にしました。 また、重みを</strong>サポートするラウンドロビン負荷分散方法も強化され、エンドポイント間でのトラフィックの分散方法を制御できます。\n\n<strong>これらの機能強化により、さまざまなアプリケーションにTraffic Managerの利点が生じ、さまざまな新しいシナリオが可能になります。</strong>\n\nたとえば、外部エンドポイントのサポートTraffic Manager、Azure を使用して既存のオンプレミスまたは外部でホストされるデプロイを拡張できます。これは、パフォーマンスを向上させる追加の地理的な場所、アクティブ/アクティブまたはフェールオーバーとしての冗長性の向上、または需要の急増に対処するために継続的に、または \"クラウドへのバースト\" として追加の容量を確保する場合があります。外部エンドポイントを使用すると、Traffic Managerプロファイルを個別の Azure サブスクリプション内のサービスにまたがることを許可します。これは以前は可能でなかったサービスです。\n\n重み付けラウンドロビンを使用すると、使用率を最大化するためにデプロイ全体の負荷を調整したり、\"A/B テスト\" スキームの一部としてトラフィックの小さな割合を別のデプロイに転送したりなど、追加の新しいシナリオが可能になります。外部エンドポイントと共に使用すると、オンプレミス アプリケーションをクラウドにスムーズに移行できます。まず、オンプレミス アプリケーションに送信されるトラフィックの 100% から始め、\"ダイヤルを回す\" と、クラウド ベースのバージョンにトラフィックを段階的に移行します。\n\n現在、これらの機能は、PowerShell コマンドレット<a href=\"https://msdn.microsoft.com/en-us/library/azure/hh758255.aspx\" target=\"_blank\">REST API</a>新しい機能Traffic Manager使用できます。これらは、Azure 管理ポータルでは使用できません。このブログ記事の残りの部分では、新しい PowerShell サポートを使用してこれらの新機能を利用Traffic Manager方法について説明します。\n<h2>作業の開始</h2>\nアプリケーションの使用を開始するにはAzure PowerShellをインストールして構成する方法に関<a href=\"https://azure.microsoft.com/en-us/documentation/articles/install-configure-powershell/\" target=\"_blank\">するページAzure PowerShell</a>。バージョン 0.8.3 以上を使用する必要があります。\n<h3>既存のプロファイルとエンドポイントの表示</h3>\n'Get-AzureTrafficManagerProfile' コマンドレットは、Profile オブジェクトの配列を取得します。その後、次の情報を表示できます。\n<pre class=\"prettyprint\">PS C:\\&gt; $profiles = Get-AzureTrafficManagerProfile\nPS C:\\&gt; $profiles | Format-Table\nName                       DomainName                                    Status\n----                       ----------                                    ------\nMyProfile                  myprofile.trafficmanage...                   Enabled\nwebsites                   websites.trafficmanager...                   Enabled</pre>\nまたは、'-Name' パラメーターを指定することで、1 つのプロファイルを取得できます。 各プロファイルには、プロファイル名、ドメイン、TTL、Traffic Manager監視設定のフィールドが含まれています。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile = Get-AzureTrafficManagerProfile -Name \"MyProfile\"\nPS C:\\&gt; $profile | Format-List\nTimeToLiveInSeconds : 30\nMonitorRelativePath : /\nMonitorPort         : 80\nMonitorProtocol     : Http\nLoadBalancingMethod : RoundRobin\nEndpoints           : {tm-demo-us.cloudapp.net, www.microsoft.com}\nMonitorStatus       : CheckingEndpoints\nName                : MyProfile\nDomainName          : myprofile.trafficmanager.net\nStatus              : Enabled</pre>\nエンドポイントの配列も用意されています。エンドポイント ドメイン名、場所、種類、状態、監視状態、重みも含まれる。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile.Endpoints | Format-\nDomainName    Location            Type    Status  MonitorStatus   Weight\n----------    --------            ----    ------  -------------   ------\ntm-demo-us...             CloudService   Enabled         Online        1\nwww.micros...                      Any   Enabled         Online        1</pre>\n<h3>プロファイルの作成とエンドポイントの追加</h3>\n一般的なパターンは、\"Profile\" オブジェクトを使用して、自分のプロファイルをTraffic Managerです。このプロファイルは、コマンドレットを使用してオフラインで構成し、準備ができたら、\"Set-AzureTrafficManagerProfile\" コマンドレットを使用して Azure に読み込みます。(Azure 管理 API を実際に呼び出すコマンドレットは、\"New-AzureTrafficManagerProfile\" と \"Set-AzureTrafficManagerProfile\" だけである必要があります)。)\n\n次の例では、新しい Traffic Manager プロファイルを作成し、2 つのエンドポイントを追加して、その結果を Azure に送信します。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile = New-AzureTrafficManagerProfile -Name \"MyProfile\" -DomainName \"myprofile.trafficmanager.net\" -LoadBalancingMethod \"RoundRobin\" -Ttl 30 -MonitorProtocol \"Http\" -MonitorPort 80 -MonitorRelativePath \"/\"\nPS C:\\&gt; $profile = Add-AzureTrafficManagerEndpoint -TrafficManagerProfile $profile -DomainName \"myapp-eu.cloudapp.net\" -Status \"Enabled\" -Type \"CloudService\"\nPS C:\\&gt; $profile = Add-AzureTrafficManagerEndpoint -TrafficManagerProfile $profile -DomainName \"myapp-us.cloudapp.net\" -Status \"Enabled\" -Type \"CloudService\" \nPS C:\\&gt; Set-AzureTrafficManagerProfile –TrafficManagerProfile $profile</pre>\nこれらのコマンド (このブログの後の他の例と同様に) は、\"パイプ\" することもできます。\n<pre class=\"prettyprint\">PS C:\\&gt; New-AzureTrafficManagerProfile -Name \"MyProfile\" -DomainName \"myprofile.trafficmanager.net\" -LoadBalancingMethod \"RoundRobin\" -Ttl 30 -MonitorProtocol \"Http\" -MonitorPort 80 -MonitorRelativePath \"/\" | Add-AzureTrafficManagerEndpoint -DomainName \"myapp-eu.cloudapp.net\" -Status \"Enabled\" -Type \"CloudService\" | Add-AzureTrafficManagerEndpoint -DomainName \"myapp-us.cloudapp.net\" -Status \"Enabled\" -Type \"CloudService\" | Set-AzureTrafficManagerProfile</pre>\n<h3>外部エンドポイント</h3>\nAdd-AzureTrafficManagerEndpointコマンドレットを使用して、外部エンドポイント (つまり、Azure の外部のエンドポイント) を作成できます。DomainName パラメーターでエンドポイントのドメイン名を指定し、Type を \"Any\" として指定します。\n<pre class=\"prettyprint\">PS C:\\&gt; Add-AzureTrafficManagerEndpoint -TrafficManagerProfile $profile -DomainName \"www.microsoft.com\" -Status \"Enabled\" -Type \"Any\" | Set-AzureTrafficManagerProfile</pre>\nパフォーマンス負荷分散と共に外部エンドポイントを使用する場合は、追加の 'Location' パラメーターが必要です。これにより、Azure に外部エンドポイントの場所が伝Traffic Managerトラフィックを適切に geo ルーティングできます。\n<pre class=\"prettyprint\">PS C:\\&gt; Add-AzureTrafficManagerEndpoint -TrafficManagerProfile $profile -DomainName \"www.microsoft.com\" -Status \"Enabled\" -Type \"Any\" -Location \"North Europe\" | Set-AzureTrafficManagerProfile</pre>\n使用可能な場所には、Azure のデータ センターのグローバル ネットワークが反映されています。これは、次のコマンドレットを使用Get-AzureLocationできます。\n<pre class=\"prettyprint\">PS C:\\&gt; $loc = Get-AzureLocation\nPS C:\\&gt; $loc.Name | Format-List\nEast Asia\nSoutheast Asia\nNorth Europe\nWest Europe\nEast US\nWest US\nJapan East\nJapan West\nBrazil South\nNorth Central US\nSouth Central US</pre>\n負荷分散方法 (例: ラウンド ロビン) をラウンド ロビンに変更し、パフォーマンスに戻った場合、Traffic Manager は以前に構成したエンドポイントの場所を記憶 (ただし無視) します。そのため、もう一度指定する必要はありません。\n<h3>重み付けエンドポイント</h3>\n重み付けは、\"ラウンド ロビンTraffic Manager方法を使用して、特定のポリシーにのみ適用されます。これは、すべてのエンドポイントの種類で使用できます。トラフィックは、現在アクティブで正常なエンドポイントの重み付けに比例して分散されます。\n\n次の例に示すように、'Weight' パラメーターを使用して、1 から 1,000 の任意の重みを指定できます。これは省略可能なパラメーターです。既定では、すべてのエンドポイントの重みは '1' です。\n<pre class=\"prettyprint\">PS C:\\&gt; Add-AzureTrafficManagerEndpoint -TrafficManagerProfile $profile -DomainName \"tm-demo-us.cloudapp.net\" -Status \"Enabled\" -Type \"CloudService\" -Weight 70 | Set-AzureTrafficManagerProfile</pre>\n外部エンドポイントの場所と同様に、負荷分散方法を [パフォーマンス] に変更してからラウンド ロビンに戻す場合は、重み付けは記憶されます (ただし無視されます)。\n\nTraffic Manager DNS レベルで動作し、DNS は、DNS クライアントと、組織と ISP によって実行されるローカル DNS リゾルバーの両方によってキャッシュされる設計です。重み付けトラフィック分散は、多数のクライアントがある従来のインターネットに接続するアプリケーションに最適です。このような場合、DNS キャッシュはトラフィックの分散に影響しません。ただし、使用されるクライアントの数が少ない場合、またはすべてのクライアントがローカル DNS サーバーの数が少ない場合、キャッシュによってトラフィックの分散が偏る可能性があります。このような場合、トラフィックは、たとえばアプリケーション レベルの HTTP 302 再送信を使用して、接続ごとに分散する必要があります。\n<h2>その他の一般的な操作</h2>\nこれらのプロファイルに対するその他の一般的Traffic Manager例を次に示します。\n<h3>エンドポイントの有効化と無効化</h3>\nエンドポイントを無効にし、回転から外します。これにより、Traffic Managerの課金は停止されますが、プロファイルに保持されます。これにより、簡単に再び有効にできます。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile = Get-AzureTrafficManagerProfile -Name \"MyProfile\" \nPS C:\\&gt; $profile.Endpoints[0].Status = \"Disabled\"\nPS C:\\&gt; Set-AzureTrafficManagerProfile –TrafficManagerProfile $profile</pre>\n<h3>Re-Ordering エンドポイント</h3>\n\"フェールオーバー\" 負荷分散方法を使用する場合、エンドポイントの順序によってフェールオーバー シーケンスが決定されます。この例では、エンドポイントのペアを再シーケンス処理する方法を示します。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile = Get-AzureTrafficManagerProfile -Name \"MyProfile\" \nPS C:\\&gt; $profile.Endpoints[0],$profile.Endpoints[1] = $profile.Endpoints[1],$profile.Endpoints[0]\nPS C:\\&gt; Set-AzureTrafficManagerProfile –TrafficManagerProfile $profile</pre>\n<h3>エンドポイントの削除</h3>\nエンドポイントを削除するには、\"Remove-AzureTrafficManagerEndpoint\" コマンドレットを使用します。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile = Get-AzureTrafficManagerProfile -Name \"MyProfile\" \nPS C:\\&gt; Remove-AzureTrafficManagerEndpoint -TrafficManagerProfile $profile -DomainName www.microsoft.com\nPS C:\\&gt; Set-AzureTrafficManagerProfile –TrafficManagerProfile $profile</pre>\n<h3>エンドポイント監視の更新設定</h3>\nこの例では、専用の監視ページを指す監視パスを変更します。\n<pre class=\"prettyprint\">PS C:\\&gt; $profile = Get-AzureTrafficManagerProfile -Name \"MyProfile\"\nPS C:\\&gt; $profile.MonitorRelativePath = \"/monitor.aspx\"\nPS C:\\&gt; Set-AzureTrafficManagerProfile –TrafficManagerProfile $profile</pre>\n<h3>プロファイルの無効化</h3>\nユーザー プロファイルを完全Traffic Manager無効にできます。これにより、すべてのエンドポイントへのすべてのトラフィックが停止され、このプロファイルの課金も停止されます。これは、専用のコマンドレットを使用して行われます。\n<pre class=\"prettyprint\">PS C:\\&gt; Disable-AzureTrafficManagerProfile -Name \"MyProfile\" \nPS C:\\&gt; Enable-AzureTrafficManagerProfile -Name \"MyProfile\"</pre>\n<h3>プロファイルの削除</h3>\n最後に、プロファイルを完全Traffic Manager削除することもできます (確認プロンプトに対して 'Force' フラグをオーバー乗車します)。\n<pre class=\"prettyprint\">PS C:\\&gt; Remove-AzureTrafficManagerProfile -Name \"MyProfile\" -Force</pre>\n<h2>よく寄せられる質問</h2>\n<strong>Azure 管理ポータル 経由で外部エンドポイントまたは重みを使用できますか?</strong>\n\n現在、これらの機能は、REST API PowerShell コマンドレットを使用して構成できます。これらは、Azure 管理ポータルでは使用できません。\n\nただし、引き続き Azure 管理ポータルを使用して、外部エンドポイントまたは重みを使用してプロファイルの状態を表示できます。また、エンドポイントの有効化と無効化や監視設定の構成など、これらのプロファイルの他の設定を管理することもできます。\n\n<strong>Azure エンドポイント (Cloud Services Web サイト) と外部エンドポイントの両方を同じプロファイル内の外部エンドポイントTraffic Managerできますか?</strong>\n\nはい。プロファイル内での異なる種類のエンドポイントの組み合わせには制限はありません。\n\n<strong>外部エンドポイントと重み付けに対する課金モデルに変更はありますか?</strong>\n\n外部エンドポイントは、Azure ベースのエンドポイントよりも高いレートで請求されます。重みを使用する場合、料金は発生します。詳細については、価格に関するページ <a href=\"https://azure.microsoft.com/en-us/pricing/details/traffic-manager/\" target=\"_blank\">を参照してください</a>。\n\n<strong>Azure SDK Azure Traffic Manager Xplat-CLI でサポートされていますか?</strong>\n\n.NET TRAFFIC MANAGER管理ライブラリは<a href=\"https://www.nuget.org/packages/Microsoft.WindowsAzure.Management.TrafficManager/0.10.2-preview\" target=\"_blank\">、.NET SDK に含まれています</a>。Java SDK または Node.js SDK でも Xplat-CLI でもまだサポートされていません。\n\n<strong>Azure サービスを外部エンドポイントとして設定できますか?</strong>\n\nはい。外部エンドポイントを使用して、他の Azure サービス (Web サイトを除く) を参照できます。これらは、他の Azure ベースのエンドポイントと同じ料金で請求されます。ただし、Cloud Services や Web サイトとは異なり、基になるサービスを無効にした場合、Traffic Manager でエンドポイントを明示的に無効または削除するまで、対応する Traffic Manager エンドポイントに対して引き続き請求されます。\n\n<strong>データ の詳細については、どこで確認Azure Traffic Manager。</strong>\n\nこのAzure portalサービスと<a href=\"https://azure.microsoft.com/en-us/documentation/services/traffic-manager/\" target=\"_blank\">シナリオの</a>概要Traffic Managerが含まれています。また、価格と SLA <a href=\"https://azure.microsoft.com/en-us/pricing/details/traffic-manager/\" target=\"_blank\">の</a> 詳細 <a href=\"https://azure.microsoft.com/en-us/support/legal/sla/\" target=\"_blank\">も含</a> まれている。\n<p align=\"left\">MSDN には、アプリケーションの負荷分散方法やエンドポイントの監視と構成Traffic Manager、より詳細な概要が含まれている。</p>\nAZURE の有料サポート プランに加えて、<a href=\"https://social.msdn.microsoft.com/Forums/windowsazure/en-US/home?forum=windowsazureconnectivity\" target=\"_blank\">MSDN</a> フォーラムを使用して、DNS またはサービスに関連する Azure のあらゆる側面について質問Traffic Manager。機能に関する提案は、フィードバック サイトに <a href=\"https://feedback.azure.com/forums/217313-networking-dns-traffic-manager-vpn-vnet/category/77466-domain-name-service-dns-traffic-manager\" target=\"_blank\">投稿する必要があります</a>。ここで、既存の提案に投票することができます。"
