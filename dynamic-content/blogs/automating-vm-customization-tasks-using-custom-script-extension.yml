### YamlMime:Yaml
ms.openlocfilehash: d56deaac90c2107761ea77c9cf68aabf62b2c40b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139894583"
Slug: automating-vm-customization-tasks-using-custom-script-extension
Title: カスタムスクリプト拡張機能を使用した VM カスタマイズタスクの自動化
Summary: >-
  2/27/2015 更新プログラム: コードサンプルと最新のドキュメントについては、こちらを確認してください。


  &nbsp;


  /Build カンファレンス中に起動された VM 拡張機能の1つに、"Custom Script...
Content: >-
  2/27/2015 更新プログラム: コードサンプルと最新のドキュメントについては、こちらをご覧ください <a title=" " href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-extensions-customscript/"> </a> 。


  &nbsp;


  /Build カンファレンスの間に起動された VM 拡張機能の1つは、PowerShell サポートと共にリリースされた "カスタムスクリプト拡張機能" と呼ばれる拡張機能です。 これらのブログに初めてアクセスする場合は、前のブログで VM エージェントと拡張機能の概要を確認することをお勧めします。


  この拡張機能の動作と、リモート PowerShell やその他の既存のリモート実行ツールとの違いは何ですか。 簡単に言うと、カスタムスクリプト拡張機能では、スクリプトとファイルを Azure Storage から自動的にダウンロードし、VM で PowerShell スクリプトを起動して、追加のソフトウェアコンポーネントをインストールすることができます。 他の VM 拡張機能と同様に、これは vm の作成時または VM の実行後に追加できます。 とても便利です。


  この拡張機能を使用して PowerShell スクリプトを実行するための前提条件:

  <ul>
   <li> <a href="https://azure.microsoft.com/en-us/downloads/">ここ</a>から Azure PowerShell コマンドレット v 0.8.0 以降以降をインストールします。</li>
   <li>スクリプトが既存の VM で実行される場合は、vm で vm エージェントが有効になっていることを確認します。 vm エージェントがインストールされていない場合は、このブログの投稿に従ってインストールしてください。</li>
   <li>VM で実行するスクリプトを Azure Storage にアップロードします。 スクリプトは、1 つか複数のストレージ コンテナーから取得できます。</li>
   <li>スクリプトは、拡張機能によって起動されるエントリ スクリプトが、他のスクリプトを順に起動するように記述されている必要があります。</li>
  </ul>

  必要な前提条件が得られたので、いくつかのユースケースを使って、これらのコマンドレットを使用する方法を説明します。 この拡張機能の現在のバージョンは、PowerShell コマンドレットのみを対象としていますが、将来は他のスクリプトに拡張できます。

  <h4><strong>ユースケース 1: 既定のアカウントのコンテナーにファイルをアップロードする。</strong></h4>

  サブスクリプションの既定のアカウントのストレージコンテナーにスクリプトがある場合は、次のコマンドレットのスニペットを VM で実行する方法を示しています。 次のサンプルの ContainerName は、スクリプトをにアップロードする場所です。 既定のストレージアカウントは、コマンドレット ' Get AzureSubscription – Default ' を使用して確認できます。


  注: このユースケースでは新しい VM が作成されますが、既存の VM でも同じ操作を実行できます。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1788/8203.Kundana-1.png"><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1788/8203.Kundana-1.png" alt="" border="0"></a>

  <h4><strong>ユースケース 2: 既定以外のストレージアカウントの使用。</strong></h4>

  このユースケースでは、同じサブスクリプション内または別のサブスクリプションで、スクリプト/ファイルをアップロードするときに、既定以外のストレージを使用する方法を示します。 ここでは既存の VM を使用していますが、新しい VM を作成して同様の操作を行うことができます。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1788/1157.kundana-2.png"><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1788/1157.kundana-2.png" alt="" border="0"></a>

  <h4><strong>ユースケース 3: 異なるストレージアカウントで複数のコンテナーにスクリプトをアップロードする。</strong></h4>

  スクリプトファイルが複数のコンテナーに格納されている場合は、現在これらのスクリプトを実行するために、これらのファイルの完全な SAS URL を指定する必要があります。 生成された SAS url は、 <a href="https://azurestorageexplorer.codeplex.com/">Azure Storage Explorer</a>などのツールを使用して生成できます。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1788/8863.kundana-3.png"><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1788/8863.kundana-3.png" alt="" border="0"></a>


  これらのコマンドレットは、VM のカスタマイズタスクの一部を自動化するのに役立ちます。 今後のリリースで、この拡張機能に表示するその他の機能についてご意見をお待ちしております。 コメントや質問を <a href="https://social.msdn.microsoft.com/Forums/windowsazure/en-US/e3d5b6ea-a010-4a4b-969b-208affce3d89/vm-agent-and-vm-extensions-feedback-issues-questions?forum=WAVirtualMachinesforWindows">ここ</a>に投稿してください。


  更新: スクリプトがアップロードされたら、次のコマンドレットを使用してスクリプトの実行状態を表示できます。

  <blockquote><span style="color: #339966">VM の状態を取得</span>


  <span style="color: #0000ff">$x = get-help-ServiceName $svcName-Name $name</span>、出力を解析して


  <span style="color: #339966">拡張機能の状態を取得します。次の例では、追加された拡張機能の一覧にある customscript extension は 2<sup>nd</sup>です。</span>


  <span style="color: #0000ff">$X ResourceExtensionStatusList [1]。ExtensionSettingStatus. SubStatusList</span></blockquote>

  &nbsp;


  &nbsp;
