### YamlMime:Yaml
ms.openlocfilehash: 5e8e2f4d5b9589b56bc7e66b7692b6f75d916f29
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896395"
Slug: transforming-your-data-in-azure-sql-database-to-columnstore-format
Title: Azure SQL Database のデータを列ストア形式に変換する
Summary: クラスター化列ストアのオンラインインデックス構築と呼ばれる、論理サーバーと Managed Instance の両方で、Azure SQL Database の新機能のパブリックプレビューをご紹介します。 この操作により、行ストア形式で格納されたデータを列ストア形式に移行し、ワークロードの最小限のダウンタイムで列ストアデータ構造を維持することができます。
Content: >-
  <p><strong>クラスター化列ストアのオンラインインデックス</strong>構築と呼ばれる、<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-logical-servers" target="_blank">論理サーバー</a>と<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-managed-instance-index" target="_blank">Managed Instance</a>の両方で、Azure SQL Database の新機能のパブリックプレビューをご紹介します。 この操作により、行ストア形式で格納されたデータを列ストア形式に移行し、ワークロードの最小限のダウンタイムで列ストアデータ構造を維持することができます。</p>


  <h2>列ストア形式を選ぶ理由</h2>


  <p>Azure SQL Database を使用すると、ワークロードとデータのサイズに応じてクエリのパフォーマンスを最大限に高めるために、データベース内のデータ構造とインデックスを微調整および最適化することができます。 Azure SQL Database のリレーショナルデータは、次の2つの形式で構成できます。</p>


  <ul>
   <li><strong>行ストア形式</strong>。クエリがテーブル内の個々の行または行セットにアクセスする OLTP ワークロードに最適なオプションです。 これは、リレーショナルデータベースのほとんどのデータに使用される汎用テーブル形式です。</li>
   <li><strong>列ストア形式</strong>。分析クエリおよびデータの高圧縮 (最大100倍) に最適化されています。 この形式は、この形式を使用して効率的に圧縮できる大規模なデータセットと、テーブル列のサブセットを使用する複雑な計算を含む分析クエリに最適です。</li>
  </ul>


  <p>場合によっては、行ストア形式で編成された既存のテーブルが、テーブルで実行されるクエリに適していないことがあります。 また、場合によっては、列ストアテーブルに高圧縮を適用して、テーブルのサイズを最小限に抑えることもできます。 その場合は、データを圧縮して分析クエリのパフォーマンスを向上させるために、データを列ストア形式に変換する必要があります。</p>


  <h2>データを列ストア形式に変換する</h2>


  <p>テーブルにクラスター化列ストアインデックスを作成することにより、既存の行ストアテーブルを列ストア形式に変換できます。 クラスター化列ストアインデックスは、テーブルから元のデータセットを取得し、列で整理し、効率的な高圧縮アルゴリズムを適用してデータのサイズを最小限に抑えます。</p>


  <p>次の例では、テーブルにクラスター化列ストアインデックスを作成し、データを列ストア形式に変換する transact-sql SQL ステートメントを示します。</p>


  <div>

  <p><code>CREATE CLUSTERED COLUMNSTORE INDEX cci ON Sales.Orders</code></p>

  </div>


  <p>テーブルに作成されたクラスター化列ストアインデックスは、テーブル内のデータを再編成し、高圧縮を使用して行を列に変換します。</p>


  <p>この操作の制限は、行ストアから列ストア形式に変換されるテーブル内の行を更新しようとするすべての受信トランザクションが、変換が終了するまでブロックされる必要があることです。 これは、次の図に示すように、 <strong>オフラインインデックス構築</strong> と呼ばれています。</p>


  <p><img alt="Azure SQL clustered columnstore index offline build" border="0" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/sql-cci-offline-build.png" style="border: 0px currentcolor; border-image: none; width: 800px; height: 336px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure SQL クラスター化列ストアインデックスのオフラインビルド"></p>


  <p>すべての受信トランザクションは、テーブルが行ストアから列ストア形式に変換されている間はブロックされます。 このプロセスによって、テーブルが変換されている間にワークロードのダウンタイムが発生する可能性があるため、データを列ストア形式に変換するタイミングを選択する必要があります。</p>


  <h2>列ストア形式へのオンライン移行</h2>


  <p>Azure SQL Database の最新リリースでは、<strong>オンラインバージョンの列ストアインデックス構築</strong>(現在パブリックプレビュー中) を使用して、行ストアテーブルを列ストア形式に変換することができます。</p>


  <p>次の t-sql SQL 構文を使用して、行ストアテーブルを列ストア形式に変換できます。</p>


  <div>

  <p><code>CREATE COLUMNSTORE INDEX cci ON Sales.Orders WITH ( ONLINE = ON )</code></p>

  </div>


  <p><strong>With (ONLINE = ON)</strong>オプションを指定してクラスター化インデックス操作を作成すると、すべての受信トランザクションが実行され、元のデータが変換されている間にデータの変更がターゲット列ストアデータ構造に継続的に含まれます。</p>


  <p><img alt="Online clustered columnstore index build in Azure SQL" border="0" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/online-build.png" style="border: 0px currentcolor; border-image: none; width: 800px; height: 349px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure SQL でのオンラインクラスター化列ストアインデックスの構築"></p>


  <p>オンラインのクラスター化列ストアインデックスの構築を使用すると、データの変換中に実行されるクエリに対して大きなブロック操作を行わなくても、最小限のダウンタイムでデータを最適化して圧縮することができます。</p>


  <p>行ストアから列ストア形式へのオンライン変換以外に、クラスター化列ストアインデックスの次のオンライン機能を Azure SQL Database で使用できます。</p>


  <ul>
   <li>既存のクラスター化列ストアインデックスはオンラインモードで再構築できます。つまり、このインデックスメンテナンス操作の実行中に、テーブル &rsquo; を操作しているワークロードをブロックする必要はありません。</li>
   <li>列ストア形式で編成されたテーブルの非クラスター化インデックスは、ワークロードをブロックせずに online オプションを使用して再構築できます。</li>
  </ul>


  <p>オンラインのクラスター化列ストアインデックスの構築操作を行うと、クラスター化列ストアインデックスに対するデータの変換とメンテナンス操作を、入力方向のワークロードに対するダウンタイムを最小限に抑えて実行できます。 この機能は、現在、論理サーバー、エラスティックプール、マネージインスタンスを含むすべての種類の Azure SQL Database でプレビュー段階にあります。</p>


  <p>詳細については、 <a href="https://docs.microsoft.com/en-us/sql/relational-databases/indexes/columnstore-indexes-overview" target="_blank">列ストアインデックスに関するドキュメントページ</a>を参照してください。</p>
