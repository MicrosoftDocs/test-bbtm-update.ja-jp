### YamlMime:Yaml
ms.openlocfilehash: b00bc21fa06e4a45ed960def57e552bd29eb288f
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892023"
Slug: swap-space-in-linux-vms-on-windows-azure-part-2
Title: Azure 上の Linux VM の SWAP 領域Windows - パート 2
Summary: この記事は、Azure CAT チームの Piyush Ranjan (MSFT) によって作成されています。  前の投稿「SWAP space in Linux VMs on Windows Azure Part 1」では、Linux VM&rsquo;&rsquo; の既定の方法について説明しました。
Content: <p>この記事は、Azure CAT チームの Piyush Ranjan (MSFT) によって作成されています。</p>  <p>Windows Azure パート 1 の Linux VM&rsquo; の SWAP 領域に関する前の投稿では、ギャラリー イメージから Azure IaaS にプロビジョニングされた Linux VM&rsquo; にスワップ領域が既定で構成されていない方法について説明しました。 その後、この投稿では、リソース ディスク (/mnt/resource) でファイル ベースのスワップ領域を構成できる簡単な一連の手順を示しました。 ただし、重要な点&nbsp;は、前述の手順は、既にプロビジョニングされ、実行中の VM に対する手順です。 理想的には&nbsp;、後で待って一連のコマンドを手動で実行するのではなく、VM プロビジョニングの時間自体に合ったスワップ領域を自動的に構成する必要があります。</p>  <p>VM のプロビジョニング時にスワップ領域の構成を自動化するコツは、Azure Linux エージェント (waagent) Windowsを使用する方法です。 ほとんどの人は、Linux VM でエージェントが実行されているのを少しあいまいに認識していますが、Azure portal には実際には waagent&nbsp; に関する便利なドキュメントが含まれていますが、少しあいまいすぎて無視している人もいます。<a href="https://azure.microsoft.com/en-us/manage/linux/how-to-guides/linux-agent-guide/" target="_blank">「Azure Linux Windows ユーザー ガイド」を参照してください</a>。 waagent の詳細と、それが目の前のタスクでどのように使用されるかについて詳しく説明する前に、もう 1 つの点を説明する必要があります。 この点は、独自のカスタマイズされた Linux VM を持ち、将来 Linux VM&rsquo; をプロビジョニングするための再利用可能なイメージとしてエクスポートする場合に、このアプローチがうまく機能する点です。 Azure ギャラリーから Linux の生の基本イメージを使用する場合、waagent の機能を利用する方法はありません。 これが最も役に立つのは、ギャラリー イメージを使用してプロビジョニングされた VM&nbsp; から始め、必要なもの (たとえば、open-jdk Java ではなく <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html" target="_blank">Standard Java</a> を使用したい場合や、後でイメージを使用できるよう HADOOP バイナリを VM にインストールしたい場合など) なので、これは実際には制限ではありません。をマルチノード クラスターに向かって実行します。 このようなシナリオでは、プロビジョニング プロセスを通じて自動的に行う必要がある追加の処理のいくつかを行う waagent を構成するのと同じ方法です。</p>  <p><a href="https://azure.microsoft.com/en-us/manage/linux/how-to-guides/linux-agent-guide/" target="_blank">「Azure Linux</a>&rsquo; エージェントWindowsガイド」で説明したように、エージェントは次の中から多くのことを実行するように構成できます。</p>  <p>リソース ディスクの管理</p>  <p>リソース ディスクのフォーマットとマウント</p>  <p>スワップ領域の構成</p>  <p>waagent はギャラリー イメージからプロビジョニングされた VM &ldquo;に既にインストールされています。1 つは/etc/waagent.conf&rdquo; にある構成ファイルを編集するだけで済み、構成は次のようになります。</p>  <p><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7242.swap21.png" alt="" width="500"></p>  <p>次のように を設定して、構成ファイルで上記の 2 行を変更してスワップを有効にします。</p>  <p><strong>ResourceDisk.EnableSwap=y の設定</strong></p>  <p><strong>ResourceDisk.SwapSizeMB=5120 の設定</strong></p>  <p>したがって、全体的なプロセスは次のとおりです。</p>  <p>ギャラリーのいずれかのイメージを使用して、通常どおり IaaS に Linux VM をプロビジョニングします。</p>  <p>必要なソフトウェア コンポーネントをインストールまたは削除して、VM を好みでカスタマイズします。</p>  <p>上に示 &ldquo;すように、/etc/waagent.conf&rdquo; ファイルを編集して、スワップ関連の行を設定します。 スワップ ファイルのサイズを調整します (上記では 5 GB に設定されています)。</p>  <p>ここで説明する手順を使用して、VM の再利用可能なイメージをキャプチャ <a href="https://azure.microsoft.com/en-us/manage/linux/how-to-guides/capture-an-image/" target="_blank">します</a>。</p>  <p>エクスポートしたイメージを使用して、新しい Linux VM&rsquo; をプロビジョニングします。 これらの VM&rsquo; では、スワップ領域が自動的に有効になります。</p>  <p>Windows Azure Linux エージェント&ndash;の対象ですが、同じ構成ファイル /etc/waagent.conf&rdquo; の Role.StateConsumer &ldquo;プロパティを使用して任意のユーザー指定スクリプトを実行する別の興味深い機能が提供されているのが判明しました。 たとえば、次のようにシェル スクリプトを作成 do-cfg.sh &ldquo;&rdquo; できます。</p>  <p><a href=""><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5355.Screen-Shot-2013_2D00_08_2D00_09-at-10.56.38-AM.png" alt="" width="500"></a></p>  <p>次に、構成ファイルで <strong>Role.StateConsumer=/home/scripts/do-cfg.sh</strong> またはスクリプトへのパスを設定します。 WAagent は、VM のプロビジョニング時 &ldquo;に Azure Fabric に Ready&rdquo; シグナルを送信する直前にスクリプトを実行します。 上に示すように、 &ldquo;スクリプト内でテストできるカスタム スクリプトにコマンド ライン引数 Ready&rdquo; を渡して、カスタム初期化を実行します。 同様に、waagent は VM &ldquo;のシャットダウン時に同じスクリプトを実行し、テスト可能なスクリプトにコマンド ライン引数 Shutdown&rdquo; を渡し、いくつかのカスタム クリーンアップ タスクを VM で実行できます。</p>
