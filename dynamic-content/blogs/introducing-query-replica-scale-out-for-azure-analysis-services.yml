### YamlMime:Yaml
ms.openlocfilehash: 31011c3b505afbbda09d0681a9b08be587c4a330
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139904725"
Slug: introducing-query-replica-scale-out-for-azure-analysis-services
Title: Azure Analysis Services でのクエリ レプリカのスケールアウトの概要
Summary: スケールアウトによって、クエリ プール内の複数のクエリ レプリカ間でクライアント クエリを分散して、負荷の高いクエリのワークロードを実行している間の応答時間を短縮できます。 クエリから処理を分離することもできます...
Content: >-
  <p>現在、SQL PASS サミットでは、Azure Analysis Services の scale out 機能が発表されました。 スケールアウトを使用すると、クライアントクエリをクエリプール内の複数の <em>クエリレプリカ</em> に分散させることができるため、クエリの負荷が高い場合に応答時間を短縮できます。 クエリ プールから処理を分離して、クライアント クエリが処理操作の悪影響を受けないようにすることもできます。 Azure Analysis Services では、可能な限り簡単にスケールアウトを設定しました。 スケールアウトは Azure portal、PowerShell (近日対応予定)、または Analysis Services REST API を使用して構成できます。</p>


  <h2>しくみ</h2>


  <p>一般的なサーバーのデプロイでは、1 つのサーバーで、処理サーバーとクエリ サーバーの両方の役割を果たします。 サーバー上のモデルに対するクライアントクエリの数が、サーバー&#39;のプランのクエリ処理単位 (QPU) を超えた場合、またはモデルの処理がクエリの負荷の高いワークロードと同時に発生した場合、パフォーマンスが低下する可能性があります。</p>


  <p>スケールアウトすることで、クエリ プールを 1 つと、クエリ レプリカを追加で最大 7 つ (サーバーを入れて合計 8 つ) まで作成可能です。 重要な場面では、QPU の需要を満たせるようにクエリ レプリカの数をスケーリングできます。また、処理サーバーはいつでもクエリ プールから分離できます。</p>


  <p>クエリ プール内にあるクエリ レプリカの数に関わらず、ワークロードの処理はクエリ レプリカ間で分散されません。 単一のサーバーが処理サーバーとして機能します。 クエリ レプリカは、クエリ プール内の各レプリカ間で同期されているモデルに対するクエリにのみ機能します。 処理操作が完了したときに、処理サーバーとクエリ レプリカ サーバーの間で同期が行われる必要があります。 処理操作を自動化する場合は、処理操作が正常に完了したときに同期操作を構成することが重要&#39;ます。</p>


  <p><strong>注</strong>: スケールアウトしても、サーバーで使用可能なメモリの量は増加しません。 メモリを増やすには、プランをアップグレードする必要があります。</p>


  <h2>QPU の使用状況を監視する</h2>


  <p>お使いのサーバーでスケールアウトが必要かどうかを判断するには、Azure Portal でメトリックを使用して監視します。 QPU が頻繁に上限に達するようであれば、モデルに対するクエリの数が、お使いのプランに設定されている QPU の制限を超過していることになります。 クエリスレッドプールのキューにあるクエリの数が、使用可能な QPU を超えると、クエリプールジョブキューの長さのメトリックも増加します。 詳細については、 <a href="https://review.docs.microsoft.com/en-us/azure/analysis-services/analysis-services-monitor"><em>サーバーメトリックの監視</em></a>に関するページを参照してください。</p>


  <h2>スケールアウトを構成する</h2>


  <ol>
   <li>
   <p>ポータルで、 <strong>[スケールアウト]</strong> をクリックします。スライダーを使用してクエリ レプリカ サーバーの数を選択します。 選択したレプリカの数は既存のサーバーの数に追加されます。</p>
   </li>
   <li>
   <p><strong>[処理中のサーバーと照会中のプールを分けてください]</strong> で、[はい] を選択してクエリ サーバーから処理中のサーバーを除外します。</p>

   <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/90a5ae91-2a67-4f34-abb5-ddefb5b7edc1.png"><img alt="aas-scale-out-slider" border="0" height="354" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d8693e5f-6908-448a-9061-a557c8c7b0bc.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title=".aas-スケールアウト-スライダー" width="787"></a></p>
   </li>
   <li>
   <p><strong>[保存]</strong> をクリックして新しいクエリ レプリカ サーバーをプロビジョニングします。</p>
   </li>
  </ol>


  <p>プライマリ サーバー上の表形式モデルはレプリカ サーバーと同期されます。 同期が完了すると、クエリ プールがレプリカ サーバー間で受信クエリの分散を開始します。</p>


  <p><strong>注:</strong> これらの設定は、Azure ARM を使用してプログラムで変更することもできます。</p>


  <h2>同期</h2>


  <p>新しいクエリ レプリカをプロビジョニングするときに、Azure Analysis Services はすべてのレプリカ間でモデルを自動的にレプリケートします。 手動で同期を行うこともできます。 モデルを処理する際は、クエリ レプリカ全体で更新が同期されるよう、同期を実行してください。</p>


  <p>[ <strong>概要</strong>] で、モデルの右側にある [同期] アイコンをクリックします。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/84bd4b1a-cb1e-45a9-abd3-6e06447c0f42.png"><img alt="aas-scale-out-sync" border="0" height="371" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/914d4695-5615-4f24-8830-5366e8ac92bd.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="".aas-スケールアウト-同期"" width="832"></a></p>


  <p>同期は、Azure Analysis Services REST API を使用してプログラムによってトリガーすることもできます。</p>


  <h2>接続</h2>


  <p>サーバー&#39;の [概要] ページには、2つのサーバー名があります。 サーバーのスケールアウトを構成したら、接続の種類に応じて適切なサーバー名を指定する必要があります。</p>


  <p>Power BI Desktop、Excel、カスタムアプリなどのエンドユーザークライアント接続には、<strong>サーバー名</strong>を使用します。</p>


  <p>SSMS、SSDT、および PowerShell、Azure 関数アプリ、AMO の接続文字列については、<strong>[管理サーバー名]</strong> を使用します。 管理サーバー名は特殊な <code>:rw</code> (読み取り/書き込み) 修飾子を含みます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ecf976ad-0f87-4d0e-8860-2c4b0dc959a3.png"><img alt="aas-scale-out-name" border="0" height="377" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7504698b-3fee-41ae-a254-db13e684a62b.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="".aas-スケール-名前"" width="844"></a></p>


  <p><a href="https://feedback.azure.com/forums/556165">フィードバックフォーラム</a>で、機能について独自のアイデアを提出してください。 <a href="https://docs.microsoft.com/azure/analysis-services/analysis-services-overview">Azure Analysis Services</a>とスケールアウトの詳細については、こちらを参照してください。</p>
