### YamlMime:Yaml
ms.openlocfilehash: 9d5b7bf9cdd4071b07824ab72eacfeab2f61949e
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893828"
Slug: os-disk-swap-managed-disks
Title: マネージド ディスクの OS ディスク スワップVirtual Machines利用可能に
Summary: 本日は、仮想マシンを使用した VM の OS ディスク スワップ機能の可用性をお知らせManaged Disks。 これまで、この機能はアンマネージド ディスクでのみ使用できます。 この機能により、VM を削除することなく、OS ディスクの以前のバックアップを復元したり、VM のトラブルシューティングのために OS ディスクをスワップアウトしたりするのは非常に簡単になります。
Content: "<p>本日は、仮想マシンを使用した VM の OS ディスク スワップ機能の可用性をお知らせManaged Disks。 これまで、この機能はアンマネージド ディスクでのみ使用できます。</p>\n\n<p style=\"text-align: center;\"><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/cdda541c-68a8-43b1-bed3-3c1094787642.png\" style=\"font-family: tahoma, &quot;Helvetica Neue&quot;, arial, helvetica, sans-serif; font-size: 13px; font-style: normal; font-weight: 400; text-decoration-line: underline;\"><img alt=\"1\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/91d81f39-e6b6-464f-a066-553086f8c5e2.png\" style=\"border-style: solid; width: 327px; height: 500px; font-size: 13px; display: inline; background-image: none;\" title=\"1\"></a></p>\n\n<p>この機能により、VM を削除することなく、OS ディスクの以前のバックアップを復元したり、VM のトラブルシューティングのために OS ディスクをスワップアウトしたりするのは非常に簡単になります。 この機能を利用するには、VM が停止のデロケーション状態である必要があります。 VM の割り当て取りが停止した後、既存のマネージド OS ディスクのリソース ID を新しいマネージド OS ディスクのリソース ID に置き換える可能性があります。 スワップする新しいディスクの名前を指定する必要があります。 VM の [OS の種類] を切り替え (たとえば、OS ディスクに Linux を使用して OS ディスクを切り替える) Windows</p>\n\n<p>この機能を活用する方法の手順を次に示します。</p>\n\n<h2>Azure CLI</h2>\n\n<p>アプリケーションの使用の詳細についてはAzure CLI CLI を使用して Azure VM で使用される <a href=\"https://docs.microsoft.com/azure/virtual-machines/linux/os-disk-swap\">OS ディスクを変更する」を参照してください</a>。</p>\n\n<p>CLI の場合は、新しいディスクの完全なリソース ID を --osdisk パラメーターに使用します</p>\n\n<p><i style=\"font-family: inherit; font-weight: inherit;\">注: バージョン &gt; 2.0.25 Azure CLI必須</i></p>\n\n<pre>\naz vm update &ndash;g osrg -n vm2 --os-disk /subscriptions/&lt;sub-id&gt;/resourceGroups/osrg/providers/Microsoft.Compute/disks/osbackup</pre>\n\n<h2>Azure PowerShell</h2>\n\n<p>PowerShell の使用の詳細については、「PowerShell を使用 <a href=\"https://docs.microsoft.com/azure/virtual-machines/windows/os-disk-swap\">して Azure VM で使用される OS ディスクを変更する」を参照してください</a>。</p>\n\n<pre>\n$vm = Get-AzureRmVM -ResourceGroupName osrg -Name vm2 \n$disk = Get-AzureRmDisk -ResourceGroupName osrg -Name osbackup \nSet-AzureRmVMOSDisk -VM $vm -ManagedDiskId $disk.Id -Name $disk.Name \nUpdate-AzureRmVM -ResourceGroupName osrg -VM $vm</pre>\n\n<h2>Java SDK</h2>\n\n<pre>\nVirtualMachine virtualMachine = azure.virtualMachines().getById(&quot;&lt;vm_id&gt;&quot;);\n\nvirtualMachine\n    .inner()\n    .storageProfile()\n    .osDisk()\n    .withName(&quot;&lt;disk-name&gt;&quot;)\n    .managedDisk()\n    .withId(&quot;&lt;disk_resource_id&gt;&quot;);\n    \nvirtualMachine.update()\n    .apply();</pre>\n\n<h2>GO SDK</h2>\n\n<pre>\nfunc UpdateVM(ctx context.Context, vmName string, diskId string, diskName string) (vm compute.VirtualMachine, err error) {\n    vm, err = GetVM(ctx, vmName)\n    \n    if err != nil {\n        return\n    }\n    \n    vm.VirtualMachineProperties.StorageProfile.OsDisk.Name = diskName\n    vm.VirtualMachineProperties.StorageProfile.OsDisk.ManagedDisk.Id = diskId\n    \n    vmClient := getVMClient()\n    \n    future, err := vmClient.CreateOrUpdate(ctx, helpers.ResourceGroupName(), vmName, vm)\n    \n    if err != nil {\n        return vm, fmt.Errorf(&quot;cannot update vm: %v&quot;, err)\n    }\n    \n    err = future.WaitForCompletion(ctx, vmClient.Client)\n    \n    if err != nil {\n        return vm, fmt.Errorf(&quot;cannot get the vm create or update future response: %v&quot;, err)\n    }\n    \n    return future.Result(vmClient)\n}</pre>"
