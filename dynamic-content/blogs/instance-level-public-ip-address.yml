### YamlMime:Yaml
ms.openlocfilehash: cb1c880906c9005d74843b12670f13eb0eb533fd
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893467"
Slug: instance-level-public-ip-address
Title: Instance-Level パブリック IP アドレス
Summary: GA の発表については、Instance-Level パブリック IP アドレスについてのシナリオ、使用法、およびその他のよく寄せられる質問に関する投稿を作成します。
Content: >-
  <a href="https://azure.microsoft.com/en-us/updates/general-availability-instance-level-public-ips/">GA の発表</a>については、Instance-Level パブリック IP アドレスについてのシナリオ、使用法、およびその他のよく寄せられる質問に関する投稿を作成します。 Azure で実行されている仮想マシンを、その有効期間にわたって VM に接続されている、直接アクセス可能なパブリック IP アドレスに関連付けることができるようになりました。 この機能は、IaaS 仮想マシンと従来の Web/Worker (PaaS) ロールインスタンスの両方で使用できます。


  &nbsp;

  <h2>ユースケースシナリオ</h2>

  仮想 IP アドレス (VIP) とは異なり、Instance-Level パブリック IP アドレス (PIP) は負荷分散されません。VIP はクラウドサービスに割り当てられ、それに含まれるすべての仮想マシンとロールインスタンスによって共有されますが、PIP は1つのインスタンスのみに関連付けられます。 PIP は、各インスタンスがインターネットから独立して到達可能な複数インスタンスの展開で特に便利です。 次の図は、PIP の値を示し、VIP と区別しています。


  &nbsp;


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/17/PublicIP.jpg"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="PublicIP" alt="PublicIP" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/PublicIP_thumb.jpg" width="450" height="484" border="0" /></a>


  &nbsp;

  <blockquote>* VIP で送信されたトラフィックは、DIP1 または DIP2 のいずれかに到達できます。 ただし、PIP1 に送信されるトラフィックは常に DIP1 に送られ、PIP2 に送信されるトラフィックは常に DIP2 に送られます。


  * DIP (データセンターの IP) は、VM のプライベート IP アドレスです。</blockquote>

  <h3>動的ポート</h3>

  通常、外部ソースから Azure VM にトラフィックを送信できるようにするには、宛先ポートを VM のエンドポイントとして宣言する必要がありますが、Instance-Level パブリック Ip を使用すると、この制限は削除されます。 外部ソースは、VM のファイアウォールで許可されている限り、Instance-Level パブリック IP アドレスの任意のポートにトラフィックを送信できます。 これは、VM が動的ポートでトラフィックを受信する必要がある場合に特に便利です。これは、パッシブモードを実装する FTP サーバーであることをお勧めします。

  <h3>外部監視</h3>

  Instance-Level Public IP Addresses は、負荷分散セットに参加している個々の VM を外部ソースから監視する必要がある場合にも役立ちます。 VIP を介して接続する場合、トラフィックは常に負荷分散され、ロードバランサーの背後にある Vm のいずれかに送信される可能性がありますが、PIP を使用する場合、トラフィックはに関連付けられている特定の VM に接続されることが保証されます。

  <h3>一意の送信 IP アドレス</h3>

  パブリック IP アドレス Instance-Level のもう1つの利点は、外部エンドポイントへの接続時に VM の発信 IP アドレスとして使用されることです。 PIP は VM を一意に識別するため、受信側は、トラフィックのソースを簡単にホワイトリストに登録したり特定したりできます。 Web クローラーなどの大量の送信接続を必要とするシナリオでは、Vm で Instance-Level パブリック ip を使用して、送信元ネットワークアドレス変換 (SNAT) 専用の送信 IP を使用することをお勧めします。


  &nbsp;

  <h2>使用方法</h2>

  既に説明したように、Instance-Level パブリック IP アドレスは、Web/Worker ロール (PaaS) だけでなく、Virtual Machines (IaaS) でも使用できます。 IaaS の場合、PIP は VM 構成の一部として要求され、PaaS の場合はロール構成の一部として要求され、ロールのすべてのインスタンスは Instance-Level パブリック IP アドレスを取得します。 以下のセクションでは、どちらの場合も、サンプルの powershell コマンドレットまたはサービス構成ファイルを提供します。

  <h3>Virtual Machines</h3>

  * 次のサンプルでは、フロントエンドサブネットとバックエンドサブネットを含むサブスクリプションで、VirtualNetwork ' VnetUSEast ' を使用しています。

  <pre class="prettyprint">#Assign Public IP Address for a Virtual Machine during create

  $images = Get-AzureVMImage

  $ftp1 = New-AzureVMConfig -Name "instance1" -InstanceSize Small -ImageName $images[50].ImageName | Add-AzureProvisioningConfig -Windows -AdminUsername narayan -Password pass@word1 | Set-AzureSubnet FrontEndSubnet | Set-AzurePublicIP -PublicIPName "pip1"

  New-AzureVM -ServiceName "MyFTPService" -VMs $ftp1 -Location "East US" -VNetName VNetUSEast


  #Assign Public IP Address for a Virtual Machine through update

  Get-AzureVM -ServiceName "MyFtpService" -Name "instance1" | Set-AzurePublicIP -PublicIPName "pip1" | Update-AzureVM

  Get-AzureVM -ServiceName "MyFtpService" -Name "instance2" | Set-AzurePublicIP -PublicIPName "pip2" | Update-AzureVM


  #Get the associated Public IP Name for a virtual machine

  Get-AzureVM -ServiceName "MyFtpService" -Name "instance1" | Get-AzurePublicIP


  #Get the assigned Public IP Address for a virtual machine

  $instance1 = Get-AzureVM -ServiceName "MyFtpService" -Name "instance1"

  $instance1.PublicIPAddress


  #Remove Public IP Address from the Virtual machine

  Get-AzureVM -ServiceName "MyFtpService" -Name "instance1" | Remove-AzurePublicIP | Update-AzureVM</pre>

  &nbsp;

  <h3>Web/worker ロール</h3>

  PaaS ロールインスタンスのパブリック IP アドレスを取得するには、サービス構成ファイル (.cscfg) に定義が含まれている必要があります。

  <pre class="prettyprint">#cscfg snippet (not the entire file)</pre>

  <pre class="prettyprint">&lt;....&gt;

    &lt;NetworkConfiguration&gt;
      &lt;VirtualNetworkSite name="VNetUSEast" /&gt;
      &lt;AddressAssignments&gt;
        &lt;InstanceAddress roleName="WorkerRole1"&gt;
          &lt;Subnets&gt;
            &lt;Subnet name="BackEndSubnet" /&gt;
          &lt;/Subnets&gt;
          &lt;PublicIPs&gt;
            &lt;PublicIP name="FtpIP" /&gt;
          &lt;/PublicIPs&gt;
        &lt;/InstanceAddress&gt;
        &lt;InstanceAddress roleName="WebRole1"&gt;
          &lt;Subnets&gt;
            &lt;Subnet name="FrontEndSubnet" /&gt;
          &lt;/Subnets&gt;
        &lt;/InstanceAddress&gt;
      &lt;/AddressAssignments&gt;
    &lt;/NetworkConfiguration&gt;
  &lt;/ServiceConfiguration&gt;</pre>

  <pre class="prettyprint">#Get the Public Ips per role instance

  $roles = Get-AzureRole -ServiceName PaaSFTPService -Slot Production -RoleName WorkerRole1 -InstanceDetails


  $roles[0].PublicIPAddress

  $roles[1].PublicIPAddress


  #To disassociate public IP from the role instance, edit the public IP section from the role using a configuration update.</pre>

  <h2></h2>

  &nbsp;

  <h2>制限と課金</h2>

  インスタンスレベルのパブリック IP アドレスはプレビュー段階でしたが、この制限は2つの IP アドレスに制限されていますが、GA の発表では、サブスクリプションごとに5つの IP アドレスに制限が発生しています。


  インスタンスレベルのパブリック IP アドレスに関連する公称料金もあります。詳細については、価格に関する <a href="https://azure.microsoft.com/en-us/pricing/details/ip-addresses/">ページ</a> を参照してください。

  <h2></h2>

  &nbsp;

  <h2>よく寄せられる質問</h2>

  <strong>1. デプロイで、仮想 IP アドレス (負荷分散) とインスタンスレベルのパブリック IP アドレスの両方を使用できますか。</strong>


  はい。 VIP は、既定ですべてのクラウドサービスに割り当てられます。 インスタンスレベルパブリック IP アドレスは、必要に応じて特定の仮想マシンまたはロールインスタンスに割り当てることができます。


  &nbsp;


  <strong>2. 1 つのインスタンス仮想マシンに VIP とインスタンスレベルのパブリック IP アドレスが必要なのはなぜですか。</strong>


  おそらく、VIP は既に単一インスタンスの仮想マシン専用であるため、VM を指す別のパブリック IP は必要ありません。ただし、インスタンスレベルのパブリック IP アドレスでは、エンドポイントを宣言しなくても VM 内のすべてのポートに到達できます。 これは、アプリケーションが動的パブリックポートを公開する必要がある場合に便利です。


  &nbsp;


  <strong>3. インスタンスレベルのパブリック IP アドレスがポータルに表示されているかどうかを確認します。</strong>


  いいえ。この時点では、ポータルではサポートされていません。 Powershell コマンドレットを使用してのみ使用できます。 REST API。


  &nbsp;


  <strong>4. 任意のデプロイでインスタンスレベルのパブリックアドレスを使用できますか。</strong>


  インスタンスレベルのパブリック IP アドレスは、デプロイで使用できます。

  <ul>
   <li>クラウド Servic の最初の VM の作成時に指定されている場合</li>
   <li><a href="https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/">リージョン Virtual Network</a>での展開</li>
  </ul>

  &nbsp;


  <b>5. Instance-Level パブリック IP は VM の IP 構成に表示されますか。</b>


  いいえ。 VM 内にパブリック IP (PIP) は表示されません。 IP アドレスを取得するには、上記のように、REST API または powershell コマンドレットを使用します。


  &nbsp;


  <b>6. Instance-Level パブリック IP の DNS 名はありますか。</b>


  いいえ、この時点では DNS 名がありません。 これは今後有効になります。
