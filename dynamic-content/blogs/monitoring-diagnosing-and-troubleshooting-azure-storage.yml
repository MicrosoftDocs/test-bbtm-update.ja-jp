### YamlMime:Yaml
ms.openlocfilehash: 55820cd51f893d0a159764a67d9a36ade8c33383
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890359"
Slug: monitoring-diagnosing-and-troubleshooting-azure-storage
Title: Azure Storage の監視、診断、トラブルシューティング
Summary: オンラインサービスの正常性を管理する方法を理解するために、Storage の監視、診断、トラブルシューティングガイドを開発しました。
Content: >-
  最新のオンラインアプリケーションでの問題の診断とトラブルシューティングは、従来のクライアントサーバーアプリケーションの場合よりも複雑です。これには、次のものが含まれます。

  <ul>
   <li>PaaS または IaaS インフラストラクチャ、オンプレミス、モバイルデバイス、またはこれらの組み合わせを実行するコンポーネントを使用した複雑なトポロジ</li>
   <li>パブリックネットワークとプライベートネットワークを通過するネットワークトラフィック。接続が予測できないデバイスを含む</li>
   <li>リレーショナルデータベースなどの他のデータストアに加えて、Microsoft Azure Storage テーブル、blob、キュー、ファイルなどの複数のストレージテクノロジ。</li>
  </ul>

  Azure Storage サービスには、これらの課題を管理するための高度な機能が含まれています。 これらの機能には、ストレージクライアントライブラリを使用して開発されたストレージサービスとクライアントアプリケーションの両方で、アプリケーションが予期しない動作の変更 (通常の応答時間よりも低速) と、広範な<i>ログ記録</i>機能を Storage<i>監視</i>できるようにする機能が含まれています。 監視とログ記録の両方から取得した情報は、問題の <i>診断</i> と <i>トラブルシューティング</i> を行い、修復に使用できる適切な手順を決定するのに役立ちます。 Storage Services の監視およびログ記録機能は、操作のパフォーマンスに影響を与えないように設計されています。さらに、消費される記憶域の量を管理するための保持ポリシーを定義する機能も含まれています。


  オンラインサービスの正常性を管理する方法を理解するために、Storage の<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/">監視、診断、トラブルシューティングガイド</a>を開発しました。 これには、正常性、可用性、パフォーマンス、および容量に関連する問題の監視と診断に関する規範的なガイダンスに加えて、お客様とサポートチームがお客様と協力して直面する主な問題に関する実用的なトラブルシューティングガイダンスが含まれます。 Storage ベースのアプリケーションを構築するすべてのユーザーにとって、このガイドは必ず読む必要があると思います。 次の図は、アプリケーションのパフォーマンスを管理する方法に重点を置いた各セクションからの抽出を示しています。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/24/Steps.png"><img style="padding-top: 0px; padding-left: 0px; padding-right: 0px; border: 0px;" title="手順" alt="Steps" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Steps_thumb.png" width="1304" height="846" border="0" /></a>

  <h4>シナリオ例–アプリケーションのパフォーマンス低下の調査</h4>

  ガイドがどのように役立つかを説明するために、頻繁に表示されるシナリオについて説明します。これは、お客様のアプリケーションのパフォーマンスが通常より遅くなることを報告するシナリオです。 顧客が監視戦略を整備していない場合、この問題の根本原因を特定するのは困難で、時間がかかる可能性があります。


  ガイドの「 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#monitoring-your-storage-service"><i>監視</i></a> 」セクションでは、いくつかの重要なメトリックについて説明します。これは、調査が必要な問題が発生している可能性があることを示す指標として、これらの値の予期しない変更を調べるために、継続的にキャプチャして監視する必要があります。 この特定のシナリオに関連する2つのメトリックは、 <strong>AverageE2ELatency</strong> メトリックと <strong>AverageServerLatency</strong> メトリックです。 <strong>AverageE2ELatency</strong> とは、エンドツーエンドの待機時間のことです。これには、クライアントから要求を読み取り、要求の処理にかかった時間 (つまり、要求がストレージサービスに到達した後のネットワーク待ち時間が含まれます) に加えてクライアントに応答を送信するためにサービスがかかった時間が含まれます。 <strong>AverageServerLatency</strong> は、サービスによる処理時間だけの尺度であるため、クライアントとの通信に関連するネットワーク待ち時間や、送信バッファーと応答バッファーを設定して使用するクライアントアプリケーションに関連する待ち時間は除外されます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/24/Latency.png"><img style="padding-top: 0px; padding-left: 0px; padding-right: 0px; border: 0px;" title="待機時間" alt="Latency" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Latency_thumb.png" width="939" height="129" border="0" /></a>


  ポータルでメトリックデータを見てみると (上の図を参照)、AverageE2Elatency は AverageServerLatency よりも大幅に高くなります。 まず、サービスの継続的な監視によって確立する必要があるベースラインメトリックと比較します。最初に、アプリケーションのパフォーマンステストと運用環境への制限付きリリースを使用します。 ここでは、この不一致は実際には Azure Storage サービスの外部の問題であると想定します。その時点で、<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#troubleshooting-guidance">トラブルシューティングのデシジョンツリー</a>を使用して、「<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency">メトリック show high AverageE2ELatency and low AverageServerLatency」 (メトリックの高可用性と低</a>) セクションに移動できます。 このセクションでは、さまざまな調査方法について説明します。

  <ul>
   <li><strong>クライアントパフォーマンスの問題-</strong> クライアントの応答に時間がかかる原因として、使用可能な接続またはスレッドの数が制限されているか、CPU、メモリ、ネットワーク帯域幅などのリソースが不足していることが考えられます。 この問題を解決するには、クライアントコードをより効率的にする (たとえば、ストレージサービスへの非同期呼び出しを使用する) か、より大きな仮想マシン (より多くのコアおよびより多くのメモリを持つ) を使用して、問題を解決できる場合があります。 詳細については、 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency">こちら</a> をご覧ください。</li>
   <li><strong>ネットワーク待機時間の問題-</strong> 通常、ネットワークによって発生する高エンドツーエンドの待機時間は、一時的な状態に起因します。 Wireshark や Microsoft Message Analyzer などのツールを使用して、ドロップされたパケットなど一時的および永続的なネットワークの問題を調査できます。 Wireshark を使用したネットワークの問題のトラブルシューティングの詳細については、「<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#appendix-2">付録 2: Wireshark を使用したネットワーク トラフィックのキャプチャ</a>」を参照してください。 Microsoft Message Analyzer を使用してネットワークの問題のトラブルシューティングを行う方法の詳細については、「<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#appendix-3">付録 3: Microsoft Message analyzer を使用したネットワークトラフィックのキャプチャ</a>」を参照してください。... 詳細については、 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency">こちら</a> をご覧ください。</li>
  </ul>

  「クライアントパフォーマンス」セクションを読み、AverageE2ELatency と AverageServerLatency がどちらもキュー操作に対してのみ発生していることを確認した後、blob 操作ではないことを確認するために、このガイドでは、Nagle アルゴリズムに関する記事と、それが小さな要求に対してどのように表示されないかを確認します。 適切なテストが完了すると、これは問題であると認識され、コードが更新されて Nagle のアルゴリズムが無効になります。 このようにして、変更後の AverageE2ELatency を監視し、AverageE2ELatency にマークされた改善を見せました。


  応答時間で断続的な変動を引き起こす可能性があるその他の問題には、ネットワークの状態やサーバー側の障害などがあります。 どちらの場合も、クライアントアプリケーションは操作を再試行して、特定の操作の待機時間を長くすることがあります。 このような場合は、AverageE2ELatency と AverageServerLatency の両方が低いことが考えられます。 この場合、トラブルシューティングのデシジョンツリーでは、"メトリックは<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency">低 AverageE2ELatency と低 AverageServerLatency を示していますが、クライアントの待機時間が長い</a>" で、適切なトラブルシューティング手法を実行できます。 「<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#end-to-end-tracing">エンドツーエンドのトレース</a>」のセクションでは、クライアントとサーバーの要求の相関関係がこの種の問題のトラブルシューティングにどのように役立つかについての追加情報も提供します。


  このシナリオでは、サービスを事前に監視し、問題が発生した場合に役立つさまざまなツールについて十分に理解しておくことが重要です。

  <h4>概要とアクションの呼び出し</h4>

  オンラインサービスの正常性を管理する方法を理解するために、Storage の<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/">監視、診断、トラブルシューティングガイド</a>を開発しました。 これには、正常性、容量、可用性、パフォーマンスに関連する問題の監視と診断に関する規範的なガイダンスが含まれます。また、お客様とサポートチームがお客様と協力して直面している主な問題をトラブルシューティングするための実用的な提案も含まれます。


  また、関連するガイダンスと、に関連する作成/更新されたコンテンツについても説明しました。

  <ul>
   <li>Azure Portal、PowerShell、または api を使用してメトリックとログを有効にする: <a href="https://go.microsoft.com/fwlink/?linkid=510865&amp;clcid=0x409">Storage メトリックの有効化とメトリックデータの表示</a>、 <a href="https://msdn.microsoft.com/en-us/library/dn782840.aspx">Storage ログ記録とログデータへのアクセスの有効化</a></li>
   <li>.NET および Java クライアントライブラリ内のログ記録を有効にする–これは、クライアント接続などのアプリケーション固有の問題を診断する場合に特に役立ちます。 参照: <a href="https://msdn.microsoft.com/en-us/library/dn782839.aspx">.net Storage クライアントライブラリを使用したクライアント側のログ記録</a>と、 <a href="https://msdn.microsoft.com/en-us/library/dn782844.aspx">Java 用 Microsoft Azure Storage SDK を使用したクライアント側</a>のログ</li>
   <li>ネットワークツールを使用してネットワーク接続の問題を診断する方法について説明します。 「 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#appendices">ネットワーク分析ツールを使用したネットワークトラフィックの分析</a>」を参照してください。</li>
   <li>ストレージログ、ネットワークログ、クライアントライブラリからデータを関連付ける手順。 「<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#end-to-end-tracing">エンドツーエンドトレース」を</a>参照してください。</li>
  </ul>

  次の手順では、次のことをお勧めします。

  <ul>
   <li>実稼働ストレージアカウントのメトリックと<a href="https://msdn.microsoft.com/en-us/library/dn782840.aspx">ログ記録</a><a href="https://go.microsoft.com/fwlink/?linkid=510865&amp;clcid=0x409">を有効</a>にします。既定では有効になっていません。</li>
   <li>管理ポリシーを更新する方法については、「 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/">」ガイド</a> の「監視と診断」セクションを参照してください。</li>
   <li>Book 問題が発生した場合のトラブルシューティングに役立つガイドをマークする</li>
  </ul>

  &nbsp;


  このガイダンスにより、オンラインサービスの管理が非常に簡単になります。
