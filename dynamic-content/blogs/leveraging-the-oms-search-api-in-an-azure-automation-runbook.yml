### YamlMime:Yaml
ms.openlocfilehash: 7a567ff13afe1c43fdf7677a9ed4652c28c9b8ef
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889769"
Slug: leveraging-the-oms-search-api-in-an-azure-automation-runbook
Title: Azure Automation Runbook での OMS Search API の活用
Summary: OMS Search API を使用すると、アラート、通知、および修復のシナリオで、次のAzure Automation。 サンプルとガイダンスについては、このブログ記事を参照してください。
Content: "<p><strong>2016 年 4 月 5 日の更新:</strong> このブログの投稿は、thisblog の <a href=\"https://blogs.technet.microsoft.com/privatecloud/2016/04/05/using-the-oms-search-api-with-native-powershell-cmdlets/\" target=\"_blank\">投稿に</a>&nbsp;取ってかからされました</p>\n\n<p><strong>更新</strong>: Azure Automation 用の PowerShell モジュールに関するブログ投稿をフォローアップします。<a href=\"https://azure.microsoft.com/en-us/documentation/articles/operational-insights-api-log-search/\" target=\"_blank\">OMS Search API</a> の可用性により、<a href=\"https://www.microsoft.com/oms\" target=\"_blank\">Operations Management Suite</a> (OMS) のログ分析データに基づくアラート、通知、および潜在的な修復を含む自動化シナリオが有効になっています。<a href=\"https://azure.microsoft.com/blog/2015/08/11/powershell-module-for-the-oms-search-api/\"></a> このブログ記事では、Runbook でハニースポット アカウントを監視<a href=\"https://en.wikipedia.org/wiki/Honeypot_(computing)\" target=\"_blank\"></a>するサンプル シナリオAzure Automation説明します。 この Runbook は、特定のサーバー上で誰かがこのアカウントでログオンしようとした場合にチェックします。 ハニースポット アカウントは、多くの場合、監視が設定されている特定のアカウントを使用するために悪意のある攻撃者を起動するために使用されます。 さらに、オンプレミスのリソースを活用するだけでなく、Azure Automation にアップロードする PowerShell モジュールがない場合の潜在的な課題を克服するために、Hybrid Runbook Worker の使用も確認します。 Runbook は OMS Search API と会話し、検索を実行したり、保存された検索の結果を取得したりすることができます。 クエリ結果に基づいて、是正措置を実行するか、アラートと通知のために他の Runbook を呼び出す方法を決定できます。&nbsp;お客様との会話中に、OMS の検索クエリの結果に基づいてアクションを実行するために、OMS に同様の System Center Operations Manager (SCOM) タスク統合がある場合、何度も質問されました。 このブログ記事では、これらのオプションを確認できます。 しかし、1 つの点として、SCOM を使用する場合、エージェントはローカルで特定の条件が正しいか確認し、その条件に対応します。一方、OMS のシナリオでは、情報が最初に OMS に送信され、そのデータに対してクエリを実行できるようインデックスが作成され、分析されます。 <a href=\"https://azure.microsoft.com/en-us/documentation/articles/operational-insights-api-log-search/\" target=\"_blank\">OMS Search API のお知らせで説明したように、API</a> を利用するには次の 3 つのオプションがあります。</p>\n\n<ul>\n <li><a href=\"https://msdn.microsoft.com/library/azure/dn910477.aspx\" title=\".NET 用 .NETLibrary\"> 用ライブラリ</a></li>\n <li><a href=\"https://msdn.microsoft.com/library/azure/mt163658.aspx\" title=\"\">REST API REST API</a></li>\n <li><a href=\"https://github.com/projectkudu/ARMClient\" title=\"ARMClientARMClient\"></a></li>\n</ul>\n\n<p>このブログ記事では、&rsquo;<a href=\"https://github.com/projectkudu/ARMClient\" target=\"_blank\">Github</a> からダウンロードできる <strong>ARMClient</strong> を使用します。 ARMClient は、実際には PowerShell &ldquo;モジュールとして使用して&rdquo; 、そのモジュールにアップロードAzure Automation。 ただし、これは、Runbook がローカルで実行され、ARMClient などのローカル リソースにアクセスするため、この課題を克服できる Azure Automation Hybrid Runbook Worker をテストする大きな機会です。</p>\n\n<h2>Ok, time to set up the basics</h2>\n\n<p>では、これを行うには何が必要でしょうか。 基本:</p>\n\n<ul>\n <li>まず、明らかに OMS サブスクリプションが必要です。 まだお持ち&rsquo;でない場合は、こちらから <a href=\"https://www.microsoft.com/oms\" target=\"&quot;_blank\">無料</a> 試用版にサインアップしてください。</li>\n <li>検索データを提供するには、OMS エージェントから OMS に報告する必要があります</li>\n <li>OMS でカスタム クエリを作成、テスト、保存し、データが返されるのを確認します</li>\n <li>最後に、OMS Search API runbook Azure Automationアカウントが必要です</li>\n</ul>\n\n<p>&nbsp; このブログ記事では、次の手順について説明します。</p>\n\n<ul>\n <li>構成のHybrid Runbook Worker</li>\n <li>ARM クライアントをインストールする</li>\n <li>OMS Search API Runbook を作成する</li>\n <li>OMS で保存された検索を作成する</li>\n <li>Azure Automation Runbook を使用したハニー Azure Automation監視</li>\n</ul>\n\n<p>&nbsp;</p>\n\n<h3>1.Hybrid Runbook Workerセットアップ</h3>\n\n<p>Brian Wren は、アプリケーションをセットアップ <a href=\"https://azure.microsoft.com/en-in/documentation/articles/automation-hybrid-runbook-worker/\" target=\"&quot;_blank\">して構成</a> する方法に関する優れた投稿をHybrid Runbook Worker。 説明したように、任意の OMS エージェントを利用して、Hybrid Runbook Worker。 OMS エージェントの 1 つにログインし、管理者の PowerShell セッションを開始して、次を入力します。</p>\n\n<blockquote>\n<pre class=\"prettyprint\">\nImport-Module HybridRegistration\nImport-Module &quot;C:Program Files\\Microsoft Monitoring Agent\\Agent\\AzureAutomationFiles\\HybridRegistration\\HybridRegistration.psd1&quot;\nAdd-HybridRunbookWorker &ndash;Name &lt;String&gt; -EndPoint &lt;Url&gt; -Token &lt;String&gt;</pre>\n</blockquote>\n\n<p>まもなく、Hybrid Runbook Workerポータルに次のAzure Automationされます。 <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/20/Hybrid-runbook-shows-up.jpg\"><img alt=\"Hybrid runbook shows up\" border=\"0\" height=\"402\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Hybrid-runbook-shows-up_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"Hybrid Runbook が表示される\" width=\"332\"></a> &nbsp;</p>\n\n<h3>2.ARMClient のインストール</h3>\n\n<p>ARMClient のインストールでは、まず <a href=\"&quot;https://chocolatey.org/\" title=\"ChocolateyChocolatey\"></a> をインストールしてから、ARMClienthere について説明されている ARMClient パッケージを<a href=\"https://github.com/projectkudu/ARMClient\" title=\"インストールする必要\">があります</a>。</p>\n\n<blockquote>Chocolatey インストール<strong><em></em></strong>を実行する前に、システム変数を更新<strong></strong>して、Azure Automation Runbook が ARMClient を検索してアクセスできる場所を制御してください。</blockquote>\n\n<p><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/17/environment-variables.png\"><img alt=\"environment variables\" border=\"0\" height=\"377\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/environment-variables_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"環境変数 Automation Runbook で ARMClient を使用する場合は、ログオンする必要がなさから、自動化が<strong></strong>簡単なサービス プリンシパルを使用します。\" width=\"338\"></a> セットアップと構成については、こちらを参照 <a href=\"https://blog.davidebbo.com/2014/12/azure-service-principal.html\">してください</a>。 これがセットアップされている場合は、最初に armClient PowerShell スクリプトを Hybrid Runbook Worker でローカルでテストして、ARMClient が OMS に正常に接続できるようすることをお勧めします。 ARMClient を使用して PowerShell スクリプトをテストするには、次の情報が必要です。</p>\n\n<ul>\n <li>サービス プリンシパル情報: tenantID、ユーザー名、パスワード</li>\n <li>Azure サブスクリプション ID</li>\n <li>OMS ワークスペース名</li>\n <li>OMS リソース グループ ID</li>\n</ul>\n\n<p>&nbsp; ARMClient が正常にインストールされた後、次の PowerShell スクリプトを Hybrid Runbook Workerして接続をテストできます。</p>\n\n<blockquote>\n<pre class=\"prettyprint\">\n$AzureSubscription = &quot;YourAzureSubscription&quot;\n$OMSResourceGroupId = &quot;YourOMSResourceGroupID&quot;\n$OMSWorkspaceName = &quot;YourOMSWorkspaceName&quot;\n\n#login with Service Principal, syntax armclient, spn(=TenantID), Username, Password\n$SPNforOMS = &quot;YourSPN&quot;\n$AzureUserNameForOMS = &quot;YourAzureUserNameForOMS&quot;\n$AzureUserPasswordForOMS = &quot;YourAzureUserNameForOMSPassword&quot;\n\narmclient spn $SPNforOMS $AzureUserNameForOMS $AzureUserPasswordForOMS\n\narmclient get /subscriptions/$AzureSubscription/resourceGroups/$OMSResourceGroupId/providers/Microsoft.OperationalInsights/workspaces?api-version=2015-03-20</pre>\n</blockquote>\n\n<pre class=\"prettyprint\">\n\n&nbsp;</pre>\n\n<p>この PowerShell スクリプトを実行すると、次のようなメッセージが表示されます。 <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/21/runbook-output.png\"><img alt=\"runbook output\" class=\"alignnone size-medium wp-image-325081\" height=\"175\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/runbook-output-636x175.png\" width=\"636\"></a> <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/21/Powershell.png\">&nbsp;</a></p>\n\n<h3>3.OMS Search API Runbook を作成する</h3>\n\n<p>これで、ARMClient を設定し、Hybrid Runbook Worker OMS Search API Runbook を作成する時間を指定して OMS ワークスペースへの接続をテストしました。 ARMClient をローカルでテストした前Azure Automation&rsquo;手順と実際に似た、多数の資産をローカルに作成する必要があります。</p>\n\n<blockquote>\n<table border=\"1\" cellpadding=\"2\" cellspacing=\"0\" width=\"597\">\n <tbody>\n  <tr>\n   <td valign=\"top\" width=\"136\"><strong>資産の種類</strong></td>\n   <td valign=\"top\" width=\"157\"><strong>名前</strong></td>\n   <td valign=\"top\" width=\"302\"><strong>説明</strong></td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"135\">資格情報</td>\n   <td valign=\"top\" width=\"162\">AzureUserNameForOMS</td>\n   <td valign=\"top\" width=\"298\">OMS のユーザー名とパスワード</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"134\">変数</td>\n   <td valign=\"top\" width=\"167\">AzureSubscription</td>\n   <td valign=\"top\" width=\"295\">Azure サブスクリプション ID</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"133\">変数</td>\n   <td valign=\"top\" width=\"171\">OMSResourceGroupID</td>\n   <td valign=\"top\" width=\"293\">OMS リソース グループ ID</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"132\">変数</td>\n   <td valign=\"top\" width=\"174\">OMSWorkspaceName</td>\n   <td valign=\"top\" width=\"291\">OMS ワークスペース名</td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"132\">変数</td>\n   <td valign=\"top\" width=\"176\">SPNforOMS</td>\n   <td valign=\"top\" width=\"290\">OMS のサービス プリンシパル名</td>\n  </tr>\n </tbody>\n</table>\n</blockquote>\n\n<p>最初の OMS Search API Runbook Im&rsquo; では、動的検索クエリ<strong></strong>を利用します。このクエリは、パラメーター (<strong>$query</strong>) として渡し、結果を制限するために時間範囲を持つ開始日<strong>/</strong>終了日も使用できます。</p>\n\n<blockquote>\n<pre class=\"prettyprint\">\nworkflow Invoke-OMSsearchQuery\n{\nparam\n (\n [Parameter(Mandatory=$false)]\n [string]$StartDate = &quot;2015-07-10&quot;,\n [Parameter(Mandatory=$false)]\n [string]$StartTime = &quot;09:00&quot;,\n [Parameter(Mandatory=$false)]\n [string]$EndDate = &quot;2015-07-15&quot;,\n [Parameter(Mandatory=$false)]\n [string]$EndTime = &quot;09:00&quot;,\n [Parameter(Mandatory=$false)]\n [string]$query = &quot;Type=SecurityEvent EventID=4625 | Measure Count() by TargetAccount&quot;\n )\n#Retrieve stored variables\n$AzureSubscription = Get-AutomationVariable -Name &#39;AzureSubscription&#39;\n$OMSWorkspaceName = Get-AutomationVariable -Name &#39;OMSWorkspaceName&#39;\n$OMSResourceGroupId = Get-AutomationVariable -Name &#39;OMSResourceGroupId&#39;\n\nWrite-Output &quot;Executing runbook on hybrid runbook worker: $env:ComputerName&quot;\n\n#login with a Service Principal, syntax armclient, spn(=TenantID), Username, Password\n$SPNforOMS = Get-AutomationVariable -Name &#39;SPNforOMS&#39;\n$cred = Get-AutomationPSCredential -Name &#39;AzureUserNameForOMS&#39;\n$null = ARMClient.exe spn $SPNforOMS $cred\n\n#Use a dynamic OMS search\n$QueryRange = $StartDate + &quot;T&quot; + $StartTime + &quot;:00.231Z&#39;,&#39;end&#39;:&#39;&quot; + $EndDate + &quot;T&quot; + $EndTime + &quot;:00.231Z&#39;&quot;\n$query = &quot;{&#39;query&#39;:&#39;$query&#39;,&#39;start&#39;:&#39;$QueryRange}&quot;\n$json = armclient post /subscriptions/$AzureSubscription/resourceGroups/$OMSResourceGroupId/providers/Microsoft.OperationalInsights/workspaces/$OMSWorkspaceName/search?api-version=2015-03-20 $query | ConvertFrom-Json\n$queryResults = $json.value\nWrite-Output &quot;**** Executing query**_ &quot; $query\nWrite-Output &quot;Query results: &quot; $queryResults\n}</pre>\n</blockquote>\n\n<p>Runbook&rsquo; を発行し、その Runbook を実行Hybrid Runbook Worker。 再起動またはシャットダウンされたコンピューターを返す次のクエリを使用します。</p>\n\n<blockquote><strong>型： </strong>イベント シャットダウン EventLog:System NOT (Source:Microsoft-Windows-WAS)<strong> Source: </strong>User32<strong>&nbsp; EventID: </strong>1074 |コンピューター別の測定数 ()</blockquote>\n\n<p><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/17/startRunbook.png\"><img alt=\"startRunbook\" border=\"0\" height=\"423\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/startRunbook_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"startRunbook\" width=\"207\"></a> クエリ結果が返されます。 <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/21/Output.png\"><img alt=\"Output\" border=\"0\" height=\"641\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Output_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"出力\" width=\"952\"></a></p>\n\n<h3>4.OMS で保存された検索を作成する</h3>\n\n<p>ハニースポット アカウント Runbook では、保存された <strong>OMS 検索が利用されます</strong>。 これにより、スコープが制限され、正確に定義された検索が行うだけでなく、構文エラーも回避されます。 OMS で検索を保存するには、ログ検索機能 <strong>を</strong> 使用して検索を実行してテストします。 検索を&rsquo; 1 台のコンピューターにのみ絞り込 &ldquo;む WHDVM1 に注意してください&rdquo;。 <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/17/oms-saved-query.png\"><img alt=\"oms saved query\" border=\"0\" height=\"249\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/oms-saved-query_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"oms saved query\" width=\"499\"><strong></strong></a> <strong>[保存</strong>] を選択し、名前と<strong>カテゴリを指定します </strong>(これは、最後の Runbook で後で使用します)。<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/17/oms-save-query.png\"><img alt=\"oms save query\" border=\"0\" height=\"323\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/oms-save-query_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"oms save query\" width=\"369\"></a></p>\n\n<h3>5.次の方法でハニースポット アカウントを監視Azure Automation</h3>\n\n<p>&rsquo;これで、保存した <strong>OMS</strong> クエリを使用して監視し、ハニースポット アカウントを使用して特定のサーバー (ドメイン コントローラーなど) へのログオンを試みた場合に通知する Runbook を作成するための前提条件を設定し、テストしました。 保存された検索を関心のある特定のサーバーに絞り込むので、アカウントをフィルター処理するために Runbook でいくつかの単純なロジックを構築する必要があります。 もちろん、OMS で完全でロックダウンされた保存済みクエリも利用できます。 通知部分では、<strong>Send-AlertNotification</strong> Runbook に格納されている <strong>Send-MailMessage</strong> PowerShell コマンドレットを利用しています。</p>\n\n<blockquote>\n<pre class=\"prettyprint\">\nworkflow Send-AlertNotification\n{\n param (\n  [Parameter(Mandatory=$true)] [string]$BodyText,\n  [Parameter(Mandatory=$true)] [string]$Subject\n )\n $Cred = Get-AutomationPSCredential -Name &#39;EmailCredentials&#39;\n Send-MailMessage `\n -From &quot;OMS Alerts &lt;FromEmail@outlook.com&gt;&quot; `\n -Subject $Subject `\n -To &quot;XWING Alerts &lt;ToEmail@outlook.com&gt;&quot; `\n -Body $BodyText `\n -SmtpServer &quot;smtp.live.com&quot; `\n -Credential $Cred `\n -UseSsl\n}</pre>\n</blockquote>\n\n<p>&nbsp;<strong>Send-AlertNotification</strong> Runbook では、メール アカウントに保存されている資格情報が使用されます。</p>\n\n<table border=\"1\" cellpadding=\"2\" cellspacing=\"0\" width=\"597\">\n <tbody>\n  <tr>\n   <td valign=\"top\" width=\"136\"><strong>資産の種類</strong></td>\n   <td valign=\"top\" width=\"157\"><strong>名前</strong></td>\n   <td valign=\"top\" width=\"302\"><strong>説明</strong></td>\n  </tr>\n  <tr>\n   <td valign=\"top\" width=\"135\">資格情報</td>\n   <td valign=\"top\" width=\"162\">EmailCredentials</td>\n   <td valign=\"top\" width=\"298\">電子メールの名前とパスワード</td>\n  </tr>\n </tbody>\n</table>\n\n<p>最後のAzure Automation Runbook <strong>Check-OMSHoneyPotLogon</strong> では、すべての部分が一緒に作成されています。 OMS の保存された検索 (<strong>$SavedSearchName</strong>) を次に示します。 <strong>$BodyText</strong> 変数は電子メール本文を構築し、最後に <strong>Send-AlertNotification</strong> Runbook を呼び出します。</p>\n\n<blockquote>\n<pre class=\"prettyprint\">\nworkflow Check-OMSHoneyPotLogon\n{\nparam\n (\n  [Parameter(Mandatory=$false)]\n   [string]$StartDate = &quot;2015-07-16&quot;,\n  [Parameter(Mandatory=$false)]\n   [string]$StartTime = &quot;09:00&quot;,\n  [Parameter(Mandatory=$false)]\n   [string]$EndDate = &quot;2015-07-17&quot;,\n  [Parameter(Mandatory=$false)]\n   [string]$EndTime = &quot;17:00&quot;,\n  [Parameter(Mandatory=$false)]\n   [string]$SavedSearchName = &quot;honeypot|honeypot logon&quot;,\n  [Parameter(Mandatory=$false)]\n  [boolean]$Alert = $false\n )\n#Retrieve stored variables\n$AzureSubscription = Get-AutomationVariable -Name &#39;AzureSubscription&#39;\n$OMSWorkspaceName = Get-AutomationVariable -Name &#39;OMSWorkspaceName&#39;\n$OMSResourceGroupId = Get-AutomationVariable -Name &#39;OMSResourceGroupId&#39;\n \nWrite-Output &quot;Executing runbook on hybrid runbook worker: $env:ComputerName&quot;\n#login with a Service Principal, syntax armclient, spn(=TenantID), Username, Password\n$SPNforOMS = Get-AutomationVariable -Name &#39;SPNforOMS&#39;\n$cred = Get-AutomationPSCredential -Name &#39;AzureUserNameForOMS&#39;\n$null = ARMClient.exe spn $SPNforOMS $cred\n\n#Use a saved search\n$OMSsavedSearch = armclient get /subscriptions/$AzureSubscription/resourceGroups/$OMSResourceGroupId/providers/Microsoft.OperationalInsights/workspaces/$OMSWorkspaceName/savedSearches/&quot;$SavedSearchName&quot;?api-version=2015-03-20\n$query = $OMSsavedSearch | ConvertFrom-Json\n$query = $query.properties.Query\nWrite-Output &quot;Retrieved Query: $SavedSearchName&quot;\n$QueryRange = $StartDate + &quot;T&quot; + $StartTime + &quot;:00.231Z&#39;,&#39;end&#39;:&#39;&quot; + $EndDate + &quot;T&quot; + $EndTime + &quot;:00.231Z&#39;&quot;\n$query = &quot;{&#39;query&#39;:&#39;$query&#39;,&#39;start&#39;:&#39;$QueryRange}&quot;\n$json = armclient post /subscriptions/$AzureSubscription/resourceGroups/$OMSResourceGroupId/providers/Microsoft.OperationalInsights/workspaces/$OMSWorkspaceName/search?api-version=2014-10-10 $query | ConvertFrom-Json\nWrite-Output &quot;_*** Executing query*** &quot; $query\n\n#Check our Honeypot Account\n$Accounts = $json.value.targetusername\nforeach ($Account in $Accounts)\n {\n          if($Account -eq &quot;LocalAdmin&quot;)\n          {\n     $Alert = $true\n     $AccountName = $Account\n    }\n } \n\nif($Alert -eq $true)\n {\n  Write-Output &quot;Raising Alert! Logon attempt found for account: $AccountName&quot;\n$BodyText = @&quot;\nLogon attempt detected for account:\n$AccountName\n&quot;@\n\n#Invoking Send-AlertNotification runbook\nWrite-Output &quot;Sending email...&quot;\nSend-AlertNotification `\n  -Subject &quot;Logon attempt detected for account $AccountName&quot; `\n  -BodyText $BodyText\n }\n}</pre>\n</blockquote>\n\n<p>次&rsquo;のコマンドで Runbook を開始Hybrid Runbook Worker出力を監視します。 <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/21/Hybrid-Runbook.png\"><img alt=\"Hybrid Runbook\" border=\"0\" height=\"334\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Hybrid-Runbook_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"Hybrid Runbook\" width=\"883\"></a> :電子メールは次の通り。 <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2015/07/20/Email-alert-sent.jpg\"><img alt=\"Email alert sent\" border=\"0\" height=\"236\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Email-alert-sent_thumb.jpg\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; display: inline; background-image: none;\" title=\"送信された電子メール アラート\" width=\"505\"></a></p>\n\n<h3>まとめ</h3>\n\n<p>OMS Search API のリリースにより、OMS 分析データに基づいて、多くの自動化シナリオが利用できます。 このブログ記事のソリューション サンプルは、OMS に接続し、OMS で豊富な分析データの活用を開始する簡単な例です。 Happy Automating!</p>"
