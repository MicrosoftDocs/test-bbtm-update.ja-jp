### YamlMime:Yaml
ms.openlocfilehash: 324a9c8d28d3082d5e79738470e51d3c352ac201
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890394"
Slug: how-to-disable-ssl-3-0-in-azure-websites-roles-and-virtual-machines
Title: Azure Websites、Roles、および Virtual Machines で SSL 3.0 を無効にする方法
Summary: プードル SSL 3.0 の脆弱性から保護するために Azure で SSL 3.0 を無効にする方法については、こちらの記事の手順に従ってください。
Content: "Microsoft は、SSL 3.0 の脆弱性を解決するために、 <a href=\"https://technet.microsoft.com/en-us/library/security/3009008.aspx\">セキュリティアドバイザリ 3009008</a> を最近リリースしました。 これは、SSL 3.0 プロトコルに影響を与える業界全体の脆弱性であり、Microsoft または Azure のプロトコルの実装に固有のものではありません。 Azure Websites、Roles、および Windows Virtual Machines は、このプロトコルを既定で有効にします。\n\nサーバーで SSLv3 を無効にすることもできます。 これにより、すべての接続でより強力な TLS プロトコルが使用されるようになりますが、SSL 3.0 のみをサポートするレガシブラウザーのユーザーがサーバーに接続できなくなることに注意することが重要です。\n\n現在、お客様が Azure Websites、ロール、Virtual Machines で SSL 3.0 を無効にする方法についてのガイダンスがリリースされています。 お客様は、ロールと Virtual Machines プロトコルを無効にできます。 Azure Websites での変更を可能にする機能はライブであり、2014年10月20日月曜日にお客様が実装できます。 これらの変更を実装する前に、お客様に回帰のリスクを評価することをお勧めします。\n\nSSL 3.0 接続を許可しないように Azure Web サイト、ロール、Virtual Machines を構成する手順を以下に示します。\n<h2></h2>\n<h2>Azure Websites で SSL 3.0 を無効にします (更新されました!)</h2>\nAzure Websites は、既定ですべてのサイトの SSL 3.0 を無効にして、前述の脆弱性から顧客を保護しています。 お客様は、Azure Websites で SSL 3.0 を無効にするために何らかの措置を講じる必要がなくなりました。\n\n&nbsp;\n<h2>Azure ロール (Web ロールまたはワーカーロール) で SSL 3.0 を無効にする</h2>\nAzure Platform as a Service (PAAS) ロールの基になるオペレーティングシステムを変更する最善の方法は、スタートアップタスクを使用してアプリケーションを再デプロイすることです。 これは、すべてのロールインスタンスが構成を確実に受信するようにする唯一の方法であり、その構成は自動スケールまたはサービス復旧操作の後も実行されます。 この構成の変更は、アプリケーションを再展開することによってのみ行うことができます。\n\nVIP を運用環境にスワップする前に、ステージングモードでの回帰を十分にテストすることを強くお勧めします。\n<h3>手順 1: スタートアップスクリプトをビルドし、ロールの構成に配置する</h3>\n新しいファイル DisableSslv3 を作成し、各ロールの定義の Startup ディレクトリに配置します。\n<blockquote>更新: スクリプトは、必要に応じてサーバーで SSL 暗号スイートの順序を設定するように更新されました。</blockquote>\n<pre class=\"prettyprint\">PowerShell -ExecutionPolicy Unrestricted .\\DisableSslv3.ps1 &gt;&gt; \"%TEMP%\\StartupLog.txt\" 2&gt;&amp;1\n\nEXIT /B 0</pre>\nDisableSslv3.ps1 新しいファイルを作成し、各ロールの定義の Startup ディレクトリに配置します。\n<pre class=\"prettyprint\"># You can use the -SetCipherOrder (or -sco) option to also set the TLS cipher \n# suite order. Change the cipherorder variable below to the order you want to set on the \n# server. Setting this requires a reboot to take effect.\n\nParam(\n [parameter(Mandatory=$false)]\n [alias(sco)]\n [switch]$SetCipherOrder)\n\n$regkeys = @(\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Client\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.0\\Server\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Client\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.1\\Server\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Client\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Server\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Client\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Server\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Client\",\n\"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Server\",\n\"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Cryptography\\Configuration\\SSL0010002\"\n)\n$cipherorder = \"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,\"\n$cipherorder += \"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,\"\n$cipherorder += \"TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,\"\n$cipherorder += \"TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA\"\n\n# If any settings are changed, this will change to $True and the server will reboot\n$reboot = $False\n\nFunction Set-CryptoSetting {\n  param (\n    $keyindex,\n    $value,\n    $valuedata,\n    $valuetype,\n    $restart\n  )\n\n  # Check for existence of registry key, and create if it does not exist\n  If (!(Test-Path -Path $regkeys[$keyindex])) {\n    New-Item $regkeys[$keyindex] | Out-Null\n  }\n\n  # Get data of registry value, or null if it does not exist\n  $val = (Get-ItemProperty -Path $regkeys[$keyindex] -Name $value -ErrorAction SilentlyContinue).$value\n\n  If ($val -eq $null) {\n    # Value does not exist - create and set to desired value\n    New-ItemProperty -Path $regkeys[$keyindex] -Name $value -Value $valuedata -PropertyType $valuetype | Out-Null\n    $restart = $True\n  } Else {\n    # Value does exist - if not equal to desired value, change it\n    If ($val -ne $valuedata) {\n      Set-ItemProperty -Path $regkeys[$keyindex] -Name $value -Value $valuedata\n      $restart = $True\n    }\n  }\n\n  If ($SetCpiherOrder) {\n    Set-ItemProperty -Path $regkeys[15] -Name functions -Value $cipherorder\n    $restart = $True\n  }\n  return $restart\n}\n\n# Check for existence of parent registry keys (SSL 2.0 and SSL 3.0), and create if they do not exist\nFor ($i = 9; $i -le 12; $i = $i + 3) {\n  If (!(Test-Path -Path $regkeys[$i])) {\n    New-Item $regkeys[$i] | Out-Null\n  }\n}\n\n# Ensure SSL 2.0 disabled for client\n$reboot = Set-CryptoSetting 10 DisabledByDefault 1 DWord $reboot\n\n# Ensure SSL 2.0 disabled for server\n$reboot = Set-CryptoSetting 11 Enabled 0 DWord $reboot\n\n# Ensure SSL 3.0 disabled for client\n$reboot = Set-CryptoSetting 13 DisabledByDefault 1 DWord $reboot\n\n# Ensure SSL 3.0 disabled for server\n$reboot = Set-CryptoSetting 14 Enabled 0 DWord $reboot\n\n# If any settings were changed, reboot\nIf ($reboot) {\n  Write-Host \"Rebooting now...\"\n  shutdown.exe /r /t 5 /c \"Crypto settings changed\" /f /d p:2:4\n}</pre>\n<h3></h3>\n<h3>手順 2: 役割のサービス定義 (.csdef) にスタートアップタスクを追加する</h3>\n<pre class=\"prettyprint\">&lt;ServiceDefinition name=\"MyService\" xmlns=\"\"&gt;\n  &lt;WebRole name=\"WebRole1\"&gt;\n    &lt;Startup&gt;\n      &lt;Task commandLine=\"DisableSslv3.cmd\" executionContext=\"elevated\" taskType=\"simple\"&gt;\n      &lt;/Task&gt;\n    &lt;/Startup&gt;\n  &lt;/WebRole&gt;\n&lt;ServiceDefinition&gt;</pre>\n<h2></h2>\n<h2>Azure Virtual Machines で SSL 3.0 を無効にする</h2>\n上記の Azure ロール (PaaS) 用の PowerShell スクリプトは、Windows Virtual Machines で SSL 3.0 を無効にするときにも同じように有効になります。 このスクリプトは、リモートデスクトッププロトコル (RDP) または選択したインフラストラクチャ構成管理システム (パペットや Chef など) を使用して手動で配布し、実行することができます。\n\nLinux Virtual Machines については、配布に関するガイダンスに従ってください。"
