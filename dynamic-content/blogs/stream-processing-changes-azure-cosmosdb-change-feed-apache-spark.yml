### YamlMime:Yaml
ms.openlocfilehash: 5ac1ed4703bd9ed5a6bbd166fa8c4c6672ca6a3b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892093"
Slug: stream-processing-changes-azure-cosmosdb-change-feed-apache-spark
Title: 'ストリーム処理の変更: #Azure #CosmosDBフィード + Apache Spark'
Summary: Azure Cosmos DB は、高速でグローバルに分散されたマルチモデル データベース サービスです。 この記事では、Azure Cosmos DB の変更フィードと更新プログラムを使用したデータの更新のストリーム処理について詳Apache Spark。
Content: >-
  <h2>Azure Cosmos DB: インジェストとストレージの一対一</h2>


  <p>Azure Cosmos DB は、高速でグローバルに分散されたマルチモデル データベース サービスです。 顧客はどこにいるかにかかわらず、Azure Cosmos DB に格納されているデータにアクセスできます。1 桁の待ち時間は 99 パーセントで、インジェスト率が高いままです。 この速度では、ストリーム処理Cosmosソースとしてだけでなく、Azure Cosmos DB を使用できます。 前のブログでは、azure Apache Spark および Azure Cosmos DB を使用してリアルタイム機械学習を実行する<a href="https://azure.microsoft.com/en-us/blog/spark-connector-for-cosmosdb-seamless-interaction-with-globally-distributed-multi-model-data/" target="_blank">可能性について説明しました。</a> この記事では、Azure Cosmos DB の変更フィードと更新プログラムを使用したデータの更新のストリーム処理について詳Apache Spark。</p>


  <h2>Azure Cosmos DB 変更フィードとは</h2>


  <p>Azure Cosmos DB <a href="https://docs.microsoft.com/azure/cosmos-db/change-feed" target="_blank">変更</a>フィードでは、Azure Cosmos DB コレクション内のドキュメントが変更された順序で並べ替えた一覧が提供されます。 このフィードを使用すると、コレクション内のデータに対する変更をリッスンして、更新に対してリアルタイム (ストリーム) 処理を実行できます。 Azure Cosmos DB での変更は保持され、非同期的に処理できます。また、1 つ以上のコンシューマーに分散させて並列処理することもできます。 変更フィードはコレクションの作成時に有効にされ、変更フィード プロセッサ ライブラリで <a href="https://azure.microsoft.com/en-us/blog/introducing-the-azure-cosmosdb-change-feed-processor-library/" target="_blank">簡単に使用 </a><a href="https://azure.microsoft.com/en-us/blog/introducing-the-azure-cosmosdb-change-feed-processor-library/" target="_blank">できます</a>。</p>


  <h2>Azure Cosmos DB を使用したシステムの設計</h2>


  <p>従来、ストリーム処理の実装では、まず、Azure Event Hub や Apache Kafka などの一時的なメッセージ キューに、受信データの量が多く受信されます。 データをストリーム処理した後、マライズド ビューまたは集計は、永続的なクエリ可能なデータベースに格納されます。 この実装では、Azure Cosmos DB Spark コネクタを使用して、Spark 出力をドキュメント、グラフ、またはテーブル スキーマ用の Azure Cosmos DB に格納できます。 この設計は、受信データの一部のみ、または受信データの集計だけが役立つシナリオに最適です。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fbce437b-fbb7-4029-af97-bd4ce1f6732d.png"><img alt="traditional-stream-processing-model" border="0" height="236" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/666d7f68-422d-412e-86e8-d91750a04c40.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="traditional-stream-processing-model" width="640"></a><em>図 1: 従来のストリーム処理モデル</em></p>


  <p align="left">クレジット&rsquo; カード不正検出のシナリオを検討します。 受信データ (新しいトランザクション) はすべて、受信した後すぐに永続化する必要があります。 新しいデータが入ってくると、機械学習分類子を段階的に適用して、不正な動作を検出したいと思っています。</p>


  <p align="left"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5a2ba513-fa06-4247-8012-d3bb15ecc472.png"><img alt="detecting-credit-card-fraud" border="0" height="278" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/eaca6b6b-ee69-4d81-a2e8-991afc3a6c0e.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="detecting-credit-card-fraud" width="640"></a></p>


  <p align="center"><em>図 2: クレジット カード詐欺の検出</em></p>


  <p align="left">このシナリオでは、Azure Cosmos DB は、新しいトランザクションからすべてのデータを直接取り込む場合に最適な選択肢です。これは、未加工のレコードを持続的に永続化して同期的にインデックスを作成しながら、継続的に高率のインジェストをサポートする独自の機能により、これらのレコードを低待機時間の豊富なクエリで返すことができるようにするために最適です。 Azure Cosmos DB 変更フィードから、Apache Storm、Apache Spark、Apache Hadoop などのコンピューティング エンジンを接続して、ストリームまたはバッチ処理を実行できます。 後処理では、マライズド集計または処理されたデータを Azure Cosmos DB に格納して、将来のクエリを実行できます。</p>


  <p align="left"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0266d41a-5afe-4551-b7e8-2c8640d28ca4.png"><img alt="azure-cosmosdb-sink-and-source" border="0" height="204" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/88ba292c-6802-46e6-95db-44b90d0d029a.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="azure-cosmosdb-sink-and-source" width="640"></a></p>


  <p align="center"><em>図 3: Azure Cosmos DB のシンクとソース</em></p>


  <p align="left">変更フィードの詳細については、「<a href="https://docs.microsoft.com/azure/cosmos-db/change-feed" target="_blank">Azure Cosmos DB</a> での変更フィードサポートの操作」の記事と、GitHub で変更フィード <a href="https://aka.ms/cosmosdb-changefeed-spark" target="_blank">+ Spark</a> の例を試して確認できます。 サポートが必要な場合、またはご質問やフィードバックがある場合は、開発者フォーラム (Stack Overflow) にお問 <a href="https://stackoverflow.com/questions/tagged/azure-cosmosdb" target="_blank">い合わせください</a>。 Twitter でフォローして、最新の Azure Cosmos DB のニュースと機能に関する最新情報を確認してください<a href="https://twitter.com/AzureCosmosDB" target="_blank">@AzureCosmosDB</a>。</p>
