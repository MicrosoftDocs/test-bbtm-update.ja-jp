### YamlMime:Yaml
ms.openlocfilehash: efb770fc7ef6529449bd6d929eec93af52746fb9
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139894349"
Slug: introducing-elasticsearch-with-azure-file-storage
Title: '紹介: Azure File Storage を使用した Elasticsearch'
Summary: 最近、Azure File Storage にデータを格納する事前構成済みの Elasticsearch クラスターを作成できる Elasticsearch テンプレートがいくつか改善され、Sense、Marvel、Kibana のようなプラグインをわずか数分でインストールできます。
Content: >-
  <p><a href="https://github.com/Azure/azure-quickstart-templates" target="_blank">Azure クイック スタート テンプレートは</a>、Elasticsearch を含むさまざまなテクノロジのテンプレート ベースのデプロイを開始する場合に最適なリソースです。 最近、Elasticsearch テンプレートがいくつか改善されました。このテンプレートを使用すると、Azure File Storage にデータを格納する事前構成済みの Elasticsearch クラスターを作成し、Sense、Marvel、Kibana のようなプラグインをわずか数分でインストールできます。</p>


  <p>このサービスは、マウントされた共有Azure Files SMB プロトコルを使用して共有ストレージを提供します。 このストレージは、同じリージョン内で任意の数の仮想マシンまたはロールにアクセス可能であり、Windows と Linux の両方でサポートされています。 詳細については、 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-dotnet-how-to-use-files/#what-is-azure-file-storage" target="_blank">Azure File Storage の概要を参照してください</a>。</p>


  <p>マウントとマウント解除の共有は、システムのライブ中にすばやく行えるので、Azure Files ではコンピューティングとストレージを簡単に<strong></strong>切り離す方法が提供され、Elasticsearch のようなテクノロジで多くの楽しい可能性が生み出されます。 特に、 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.2/indices-shadow-replicas.html" target="_blank">シャドウ レプリカ インデックスを使用すると</a> 、いくつかの魅力的な最適化でこの共有ファイルシステムを利用できます。</p>


  <ul>
   <li>データの 1 つのコピーだけがインデックスが作成されます。レプリカはシャドウ レプリカに置き換えられる</li>
   <li>復旧は、別のコピーを作成するのではなく、シャードの所有権を取得する別のノードで構成されます</li>
   <li>より多くのノードまたは少数のノード間でデータを再分散または再配分すると、軽量な操作になります</li>
  </ul>


  <p>この新しい機能を試すのは、新しいテンプレートのAzure Resource Managerです。 この記事では、簡単な例を使用して、Azure File Storage で Elasticsearch を起動して実行します。</p>


  <h2>デプロイ</h2>


  <p><a href="https://github.com/Azure/azure-quickstart-templates/blob/master/elasticsearch/README.md" target="_blank">Elasticsearch</a> テンプレート<strong>で [Azure にデプロイ</strong>] を選択した後、デプロイにいくつかのパラメーターを指定する必要があります。 不明な場合は、既定値を使用して開始します。</p>


  <p><img alt="Introducing: Elasticsearch with Azure File storage" border="0" height="54" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/503c5bc3-2499-48a4-902b-d75de5f32977.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="紹介: Azure File Storage を使用した Elasticsearch" width="351"></p>


  <p align="left"><img alt="Introducing: Elasticsearch with Azure File storage" border="0" height="217" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/778d74a2-771f-4de1-b4a7-ebe4aa2af0c9.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="紹介: Azure File Storage を使用した Elasticsearch" width="289"></p>


  <p align="left">パラメーターの一部について、以下で詳しく説明します。</p>


  <ul>
   <li><strong>オペレーティング システム：</strong>テンプレートでの Azure ファイルのサポートは現在<strong>、Ubuntu</strong> でのみサポートされますが、間もなくWindows予定です</li>
   <li><strong>リソース グループ:</strong> 関連リソースのコレクションに対するサブスクリプション内の論理グループ。通常は、ここで思い出深い名前を指定します</li>
   <li><strong>ジャンプボックス:</strong>Ssh (Ubuntu) または rdp (Windows) を使用してクラスターへのエントリ ポイントを提供します。<a href="https://azure.microsoft.com/en-us/services/expressroute/" target="_blank">ExpressRoute</a> サブスクリプションにデプロイする場合を指定しない限り、これを使用します</li>
   <li><strong>ノード サイズ:</strong> 既定のサイズは、作業を開始するのに適したオプションですが、ワークロードに十分なコアをデプロイしてください</li>
   <li><strong>バージョン：</strong> Azure File のサポートには、利用可能な最新バージョン (現在 <strong>は 2.2.0</strong>) を使用をお勧めします</li>
   <li><strong>AFS：</strong> Azure File Storage の場合は、このオプションを選択します。このオプションは現在、Ubuntu と Elasticsearch 2.x でのみ有効です</li>
   <li><strong>テンプレート ベース:</strong> Azure レポポからデプロイする場合、これは変更する必要はありません。独自のフォークからデプロイする場合は、これを自分のレポポ URI に更新します</li>
   <li><strong>Kibana と Sense:</strong> これらの両方を選択すると、パブリック IP 経由でクラスターに簡単にアクセスして対話できます</li>
  </ul>


  <h2>クラスターへのアクセス</h2>


  <p>デプロイが完了すると、Kibana URL と Jumpbox IP が、指定されたリソース グループの<strong></strong>デプロイ出力内の <a href="https://portal.azure.com" target="_blank">Azure portal。</a> リソース グループを選択し、[要<strong></strong>点] の下にある [最後のデプロイ] リンクを選択して、Kibana と Jumpbox のデプロイ出力を見つける。</p>


  <p><img alt="Introducing: Elasticsearch with Azure File storage" border="0" height="225" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/da44fff4-e46b-4899-8bfa-04424a01e075.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="紹介: Azure File Storage を使用した Elasticsearch" width="262"></p>


  <p>右側のボタンを使用して Kibana URL をクリップボードにコピーし、ブラウザー ウィンドウに貼り付け、Kibana を起動します。 デプロイ時に [Sense] オプションが選択されている場合は、Kibana インターフェイスを使用して Sense アプリに切り替えます。</p>


  <p><img alt="Introducing: Elasticsearch with Azure File storage" border="0" height="101" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/19aad440-4049-438e-8c7e-01e140843984.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="紹介: Azure File Storage を使用した Elasticsearch" width="540">Sense コマンドを実行するには、正しい IP を設定する必要があります。 マスター ノードは静的 IP を使用します。そのため、localhost を <strong>10.0.0.10</strong>、またはクラスターの他のプライベート IP に置き換えます。これは、ポータルのリソースの一覧で確認できます。</p>


  <p><img alt="Introducing: Elasticsearch with Azure File storage" border="0" height="288" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/aee05f43-d3a1-4208-867f-a14cf028d225.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="紹介: Azure File Storage を使用した Elasticsearch" width="348"></p>


  <h2>シャドウ レプリカ インデックスの作成</h2>


  <p>テンプレートで AFS オプションを使用する場合、 <strong>elasticsearch.yml 設定には次</strong> が含まれます。</p>


  <blockquote>

  <pre class="prettyprint">

  node.enable_custom_paths: true

  node.add_id_to_custom_path: false

  path.shared_data: /datadisks/esdata00

  </pre>

  </blockquote>


  <p>つまり、ローカル ストレージ上のデータは既定の場所に格納され、共有ファイル システム データは <strong>パス /datadisks/esdata00</strong> の下に格納する必要があります。 そのため、シャドウ レプリカ インデックスを作成する場合は、次のようなインデックス設定を使用する必要があります。</p>


  <blockquote>

  <pre class="prettyprint">

  put my-shared-index

  {
    &quot;index&quot;: {
      &quot;data_path&quot;: &quot;/datadisks/esdata00&quot;,
      &quot;shadow_replicas&quot;: true,
      &quot;shared_filesystem.recover_on_any_node&quot;: true
    }
  }</pre>

  </blockquote>


  <p>これらの設定を使用すると、(共有データ パスの下にある) 適切な場所にインデックスが作成され、インデックスにシャドウ レプリカが作成されます。 ノード上のシャードを復旧する設定は重要です。これは、共有ファイル システムからシャードを復旧する前にノードがクラスターに再び追加されるのを Elasticsearch に待機しないよう Elasticsearch に指示します。 シャドウ レプリカの詳細については、 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.2/indices-shadow-replicas.html" target="_blank">Elasticsearch のドキュメントを参照してください</a>。</p>


  <h2>次の手順</h2>


  <p>この記事では、完全に事前構成された Elasticsearch クラスターを迅速かつ簡単にデプロイする方法について説明しました。これには、マーベル、Sense、Kibana などのオプションのツールが含まれています。 また、このクラスターにアクセスし、仮想クラスターによって提供される共有ストレージにシャドウ レプリカ ベースのインデックスを作成する方法Azure Files。 開発フェーズから実稼働デプロイに移行するには、次のトピックに関心がある場合があります。</p>


  <ul>
   <li>独自のテンプレートテンプレート <a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-authoring-templates/" target="_blank">を作成してデプロイAzure Resource Managerする</a></li>
   <li><a href="https://azure.microsoft.com/en-us/documentation/articles/guidance-elasticsearch/" target="_blank">Azure 上の Elasticsearch</a></li>
   <li><a href="https://azure.microsoft.com/en-us/documentation/articles/storage-how-to-use-files-linux/" target="_blank">Linux での Azure File Storage の使用</a></li>
  </ul>


  <p>さらに、Elastic チームと密接に取り組み、Azure File Storage で Elasticsearch の大規模なツールとガイダンスを提供しています。 この詳細については、近い将来公開される予定です。ご期待ください。</p>
