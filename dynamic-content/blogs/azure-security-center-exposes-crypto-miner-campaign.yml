### YamlMime:Yaml
ms.openlocfilehash: df37bfd16f3b13af74c07f5243a91e0f2dbc59ca
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889569"
Slug: azure-security-center-exposes-crypto-miner-campaign
Title: Azure Security Centerクリプト マイナー キャンペーンを公開する
Summary: Azure Security Center、Azure 顧客リソースに対する新しい暗号化マイニング操作が検出されました。
Content: >-
  <p>Azure Security Center、Azure 顧客リソースに対する新しい暗号化マイニング操作が検出されました。<br>

  この操作では、既知の RCE 脆弱性 (<a href="https://www.drupal.org/sa-core-2018-002">CVE-2018-7600</a>) をエントリ ポイントとして持つ古いバージョンの既知のオープン ソース CMS を利用し、その後、永続化のために CRON &ldquo;ユーティリティを使用した後、XM Crypto&rdquo; オープンソース暗号化マイニング ツールの新しいコンパイル済みバイナリを使用して Monero&rdquo; &ldquo;の暗号化をマイニングします。</p>


  <p>Azure Security Center (ASC) はリアルタイムで攻撃を検出し、次のアラートで影響を受けた顧客に警告しました。</p>


  <ul>
   <li><b>疑わしいファイルのダウンロード</b> &ndash; wget を使用した悪意のあるファイルのダウンロードの可能性が検出されました</li>
   <li><b>疑わしい </b><b>CRON ジョブ 疑</b>&ndash;わしいスケジュール タスクのアクセスが検出された可能性があります</li>
   <li><b>不審なアクティビティ</b> &ndash; ASC によって、疑わしいソースからの定期的なファイルのダウンロードと実行が検出されました</li>
   <li><b>疑 </b><b>わしい場所から実行されたプロセス</b></li>
  </ul>


  <p><strong><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4b2f1916-64c2-4b68-ab51-6c0f39036cf4.png"><img alt="Azure Security Center alert on a file downloaded and executed." border="0" height="404" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5afbfed9-2c52-4b28-a52a-0d246c6d73fb.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure Security Center実行されたファイルに関するアラートを生成します。" width="429"></a></strong></p>


  <h2>エントリ ポイント</h2>


  <p>攻撃者が残したトレースに従って、このマルウェアのエントリ ポイントを追跡し、既知のオープン ソース CMS - <a href="https://www.drupal.org/sa-core-2018-002">CVE-2018-7600</a> のリモート コード実行の脆弱性を利用して、それが発生したと結論付けえました。</p>


  <p>この脆弱性は、この CMS の古いバージョンで公開され、古いバージョンを使用している多数の Web サイトに影響すると推定されます。 この脆弱性の原因は、API 呼び出し内での入力検証が不十分です。</p>


  <p>影響を受け、Linux マシンで最初に気付いた疑わしいコマンド ラインは次の通りでした。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/25e6ee00-b074-4ca5-be51-f6b76ae7ce7c.png"><img alt="Base64 encoded bash command line (details censored)." border="0" height="50" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2203604c-5004-4dea-bfc8-33d099913b2d.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Base64 でエンコードされた bash コマンド ライン (詳細は修正済み)。" width="515"></a></p>


  <p>コマンド ラインの base64 部分をデコードすると、CRON ユーティリティを使用して Bash スクリプト ファイルを定期的にダウンロードして実行するロジックが明らかになります。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5374ff11-805a-4c7a-9652-e6a2b4292752.png"><img alt="Base64 decoded bash command line (details censored) – wget | sh." border="0" height="18" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e88aaa2c-3440-455f-877e-ddc1533bcb43.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Base64 デコードされた bash コマンド ライン (詳細は表示されません) – |Sh。" width="539"></a></p>


  <p>URL パスには、CMS 名への参照も含まれます。エントリ ポイントのもう 1 つの兆候です (また、ずさんな攻撃者の場合も同様です)。</p>


  <p>また、損害を受 &ldquo;けたマシンから収集されたテレメトリから、この最初のコマンド ラインが Apache&rdquo; ユーザー コンテキスト内および相対 CMS 作業ディレクトリ内で実行される方法も学習しました。</p>


  <p>影響を受けるリソースについて調査を行い、そのすべてが、公開されたリソースで悪意のあるコードを実行できる非常に重大なセキュリティ リスクにさらされている、パッチが未パッチのバージョンの相対 CMS で実行されているのを発見しました。</p>


  <h2>マルウェア分析</h2>


  <p>マルウェアは、CRON テーブル ファイルに次の行を追加することで、永続化のために CRON ユーティリティ (Unix ジョブ スケジューラ) を使用します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b6914f67-790a-443a-a2c6-a1c84ae9f5ce.png"><img alt="Cron command running wget | sh." border="0" height="22" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f267be76-eb27-4c79-a7ba-f1292414a9d5.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="wget コマンドを実行している Cron |Sh。" width="471"></a></p>


  <p>これにより、1 分ごとに bash スクリプト ファイルがダウンロードおよび実行され、攻撃者は bash スクリプトを使用してコマンドを実行および制御できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dc43b920-0c8d-4d8e-875a-5a3fde0936bd.png"><img alt="The malicious bash script file (details censored)." border="0" height="360" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bcc9dfd1-37aa-4515-96fa-5b201733ed07.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="悪意のある bash スクリプト ファイル (詳細が表示されます)。" width="429"></a></p>


  <p>bash ファイル (この時点でキャプチャしたように) はバイナリ ファイルをダウンロードし、それを実行します (上の図に示されています)。<br>

  バイナリは、マシンが既に侵害され、HTTP 1.1 POST メソッドまたはマシンに搭載されているプロセッサの数に応じて別のバイナリ ファイルを使用してダウンロードされる場合に、バイナリ チェックを行います。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/09279cde-d84a-490e-af1e-a2dcdd81518c.png"><img alt="Malicious network traffic sniff." border="0" height="338" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6cf2b27e-3dff-4ec7-8bfa-50652a5186e8.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="悪意のあるネットワーク トラフィックスニッフィング。" width="448"></a></p>


  <p>一見すると、2 番目のバイナリ&rsquo;は明らかに難読化されたので、調査が難しくなるようです。 幸いなことに、攻撃者は難読化ではなく圧縮に焦点を当てた UPX パッカーを使用することを選択しました。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ff0c80ab-9e4b-4f14-9a77-7c83e8bf62c3.png"><img alt="Malicioud binary packed with UPX packer." border="0" height="365" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/51f168f6-4704-43a9-9aaa-c6d0c3e2ef7a.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="UPX パッカーがパックされた社会バイナリ。" width="490"></a></p>


  <p>バイナリのパックを削除した &ldquo;後、バージョン 2.6.3 でオープンソースの通貨マイナー XMい&rdquo; びきのコンパイルが見つかりました。 マイナーは、その内部の構成でコンパイルされ、マイニング プロキシ サーバーからマイニング ジョブをプルするため、クライアントの数と攻撃者の収益を見積もる必要が出ていました。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/58526870-df61-4ff7-bae3-aca207925883.png"><img alt="XMRig assembly code." border="0" height="369" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/cf134cb7-4565-4e04-ba77-f40967b42dce.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="XMRig アセンブリ コード。" width="492"></a></p>


  <h2>全体像</h2>


  <p>いくつかの暗号マイナーの動作を分析することで、暗号マイナー駆動型攻撃に関する 2 つの強力なインジケーターに気付いたのです。</p>


  <p><b>1. 競合他社をつぶす</b> &ndash; 多くの暗号攻撃では、マシンが既に侵害され、他のコンピューティング能力の競合他社をキルしようと試みたと想定されています。 これを行うのは、次に重点を置き、プロセスの一覧を観察することで行います。</p>


  <ol start="1" style="margin-left: 40px; list-style-type: lower-alpha;">
   <li>プロセス名 - 一般的なオープン ソース マイナーからあまり知られていないマイニング キャンペーンまで</li>
   <li>既知のプール ドメイン、暗号化ハッシュ アルゴリズム、マイニング プロトコルなどのコマンド ライン引数。</li>
   <li>CPU 使用率</li>
  </ol>


  <p>特定したもう 1 つの一般的な方法は、CRON &ndash; タブをリセットする方法です。多くの場合、他のコンピューティングパワー競合他社の永続化方法として使用されています。</p>


  <p><b>2. マイニング プール &shy;</b>- 暗号化マイニング ジョブはマイニング プールによって管理されています。マイニング プールは、複数のクライアントを収集して、クライアント間で収益を貢献および共有する責任を負います。 ほとんどの攻撃者は、デプロイと使用が簡単なパブリック マイニング プールを使用しますが、攻撃者が公開された後は、自分のアカウントがブロックされる可能性があります。 最近、攻撃者が独自のプロキシ マイニング サーバーを使用するケースが増えています。 この手法は、ホスト内のセキュリティ製品 (Linux の Azure Security Center 脅威検出など) による検出と、パブリック マイニング プールによる検出の両方から、攻撃者が匿名を保つのに役立ちます。</p>


  <h2>結論と防止</h2>


  <p>この攻撃を防ぐのは、最新のセキュリティ更新プログラムをインストールするのと同じほど簡単です。 推奨されるオプションは、完全な Web サーバーとソフトウェア環境を維持するのではなく、SaaS (サービスとしてのソフトウェア) を使用する方法です。</p>


  <p>大量のリソースが消費されるので、ほとんどの場合、暗号化マイナー アクティビティを簡単に検出できます。<br>

  <a href="https://azure.microsoft.com/en-us/services/security-center/">Azure Security Center</a> などのクラウド セキュリティ ソリューションを使用すると、マシン、ネットワーク、Azure サービスのセキュリティが継続的に監視され、異常なアクティビティが検出されるとアラートが表示されます。</p>
