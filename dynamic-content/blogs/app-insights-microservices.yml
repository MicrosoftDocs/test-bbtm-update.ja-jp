### YamlMime:Yaml
ms.openlocfilehash: f1b2f91e12b7563d6fc9dac44692db0ea5ef48af
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893259"
Slug: app-insights-microservices
Title: マイクロサービスとコンテナーの Application Insights のサポート
Summary: 最近、Azure アプリケーションインサイトを使用してマイクロサービスとコンテナー化されたアプリケーションをより簡単に監視できるようになりました。 すべてのコンポーネントに対して1つの Application Insights リソースを使用できます...
Content: >-
  <p>&rsquo;最近、 <a href="https://azure.microsoft.com/services/application-insights/">Azure アプリケーションインサイト</a>を使用してマイクロサービスとコンテナー化されたアプリケーションをより簡単に監視できるようになりました。 アプリケーションのすべてのコンポーネントに対して1つの Application Insights リソースを使用できます。 サービスの正常性と、サービス間の関係は、単一のアプリケーションマップに表示されます。 自動 HTTP 関連付けを使用して、複数のサービスを通じて個々の操作をトレースできます。 Docker のメトリックとその他のコンテナーは、統合し、アプリケーションテレメトリと関連付けることができます。</p>


  <h2>ロール別のデータのセグメント化 Application Insights</h2>


  <p>ここまでは、アプリケーションの各サーバーコンポーネントまたはマイクロサービスに対して、Application Insights リソースとインストルメンテーションキーを1つ作成することを Application Insights ました。 マイクロサービスアプリケーションでは、1つのアプリケーションを多数の異なるサービスで構成できます。また、個別のリソースを作成して維持するには、非常に時間がかかることがあります。 また、 &rsquo; 両者の間で結果を関連付けることも困難です。</p>


  <p>この問題を解決するために、すべてのテレメトリにアタッチされている cloud_RoleName プロパティによって Application Insights のデータをセグメント化する機能を追加しました。 これにより、すべてのサーバーからのすべてのデータを1つの Application Insights リソースに送信し、cloud_RoleName でフィルター処理して、個々のマイクロサービスのパフォーマンスと正常性の情報を確認できます。 Cloud_RoleName プロパティは、Azure App Service のマイクロサービス、コンテナー、またはアプリ名の適切な名前を表すために、Sdk によって設定されます。</p>


  <p>[エラー]、[パフォーマンス]、[メトリックスエクスプローラー] ブレードでは、[フィルター] メニューに [新しいクラウドロール名] プロパティが表示されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d58050cc-5338-4555-935f-843949e6c98c.png"><img alt="RoleFilter" border="0" height="353" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9aa61553-b407-49f7-9d04-81f9206733a8.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="RoleFilter" width="700"></a></p>


  <p>上の例では、[障害] ブレードをフィルター処理して、フロントエンド web サービスの情報だけを表示し、CRM API バックエンドからの障害を除外しています。</p>


  <p>また、アプリケーションマップが cloud_RoleName によってサーバーノードをセグメント化できるプレビュー機能も有効にしまし &rsquo; た。 この機能を有効にするには、[プレビュー] ブレードから [ <em><strong>マルチロールアプリケーションマップ</strong></em> ] を <strong>[オン</strong><i> </i>] に設定します。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/885d2967-afee-43d7-bc4f-cada17893567.png"><img alt="EnablePreviews" border="0" height="385" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ea9409b7-69aa-4c8c-ae9c-2e476b607b6d.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="EnablePreviews" width="700"></a></p>


  <p>このプレビューを有効にすると、[cloud_RoleName] フィールドに設定されている一意の値ごとに1つのサーバーノードがマップに表示されます。<a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/69bc1387-977e-4475-bed3-1903bc110fad.png"><img alt="MultipleRolesOnMap" border="0" height="289" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4b9ff5b4-dad3-4232-97c1-7c002d4fce8a.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="乗数 Erolesonmap" width="700"></a></p>


  <p>&nbsp;</p>


  <p>サーバー間の呼び出しは、HTTP 要求のヘッダーで渡される相関 Id を使用して追跡されます。これ &rsquo; については、次に説明します。</p>


  <h2>コンテナーで動作する自動 HTTP 関連付け</h2>


  <p>最新の sdk の<a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.Web/2.4.0-beta3">2.4.0-beta3 以降 for ASP.NET</a>と<a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.AspNetCore/2.1.0-beta3">2.1.0-beta3 以降 for ASP.NET Core で</a>は、HTTP 要求と応答にヘッダーを挿入することによって、サービス間の呼び出しが自動的に関連付けられます。 以前は、インストルメント化プロファイラーをインストールする必要があり、App Services には Application Insights サイト拡張機能を使用しています。また、他の Azure コンピューティングサービスに Status Monitor をインストールする必要があります。 これらの拡張機能は、Service Fabric または Docker コンテナー環境でプロビジョニングするのは困難です。</p>


  <p>これにより、アプリケーションマップのすべてのマイクロサービスとコンテナー化されたアプリケーションを表示できます。</p>


  <p>また、サーバー間の呼び出しに関連するすべてのテレメトリを1つのビューで表示することもできます。 たとえば、次に示すのは、訪問者アプリのサンプルからの例外です。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4667c1ac-cce9-45a5-8825-83d05f57ca66.png"><img alt="ExceptionDetails" border="0" height="681" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a12edd99-0060-456d-8ce6-3ce24430eaf4.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="ExceptionDetails" width="610"></a></p>


  <p>クリックして、フロントエンド Web サーバーとバックエンド API を対象に、この操作に関連するテレメトリの一覧を表示します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/52295015-6a75-417f-b92f-3e1b0850436b.png"><img alt="CorrelatedTracing" border="0" height="762" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/32e6d9f9-0ab0-4381-8c87-f959418f92dc.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="CorrelatedTracing" width="610"></a></p>


  <p>この機能を利用するには、NuGet で利用可能な Application Insights sdk の現在のプレリリースバージョンをインストールします。</p>


  <h2>.net Core 2.0、Service Fabric、Kubernetes の SDK サポート</h2>


  <p>.net sdk を改良しました。これにより、上記の機能が Service Fabric および Kubernetes で実行されている .net アプリケーションに対して機能するようになりました。 ASP.NET Core 2.1 SDK では、自動要求と依存関係の追跡機能など、.net core 1.1 と .net core 2.0 Preview 1 の両方がサポートされるようになりました。 これにより、最新バージョンの .net Core を使用して完全な Application Insights エクスペリエンスを得ることができます。</p>


  <p>アプリケーションが Service Fabric で実行されている場合は、 <a href="https://github.com/Microsoft/ApplicationInsights-ServiceFabric">Application Insights に Service Fabric sdk</a>を使用できます。Service Fabric reliable services と、ゲスト実行可能ファイルおよび Docker コンテナー用の microsoft. applicationinsights. servicefabric パッケージに対して、NuGet パッケージを追加します。</p>


  <p>多くの Service Fabric アプリケーションは、高スケールのログ記録に EventSource を使用します。 これで、Microsoft. applicationinsights. eventsourcelistener パッケージを追加して、 <a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-asp-net-trace-logs#using-eventsource-events">EventSource イベントを Application Insights に記録</a>できるようになりました。</p>


  <p>アプリケーションが Kubernetes 上の Docker で実行されている場合、 <a href="https://github.com/Microsoft/ApplicationInsights-Kubernetes">KUBERNETES SDK</a> を使用して、Kubernetes パッケージをアプリに追加できます。</p>


  <p>Visual Studio で NuGet パッケージマネージャーを使用して、このセクションで説明されているパッケージを追加します。 このセクションで説明されているパッケージを検索するには、[ &ldquo; プレビュー &rdquo; を含める] オプションをオンにします。</p>


  <h2>Windows Docker コンテナーのコンテナーメトリック</h2>


  <p>&rsquo;個々の Docker コンテナーに関する CPU、メモリ、その他のメトリックを確認すると便利です。これにより、コンテナーの正常性を把握し、物理マシン上でコンテナーの適切な密度を達成できます。 Windows で実行されている Docker コンテナーからのメトリックの収集をサポートする<a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics">Windows Azure 診断拡張機能</a>(wad) を強化しました。</p>


  <p>wad のインストールが完了したら、<a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/azure-diagnostics-schema-1dot3-and-later">診断構成ファイル</a>を変更して Docker の統計情報を収集し、Application Insights に送信できます。</p>


  <h2>今すぐお試しください</h2>


  <p>これらの新機能により、マイクロサービスとコンテナー化されたアプリケーションで Application Insights を使用した優れたエクスペリエンスが得られることを願っています。 ドキュメントを必ず<a href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-monitor-multi-role-apps">確認</a>してください。 sdk を試してみてください。これらの新しい環境において、お客様にとってどのように改善 Application Insights できるかについてご連絡ください。</p>


  <p>この投稿に記載されている機能に加えて、アプリケーションの問題を検出して修正する<a href="https://microsoft.sharepoint.com/teams/CPT/Shared Documents1/Azure Diagnostics/Blog Posts/Optimize%20your%20apps%20for%20your%20business%20with%20Azure%20Application%20Insights">のに役立つ Application Insights の他の多くの機能強化</a>について最近発表しまし &rsquo; た。</p>


  <p>常に、 <a href="https://visualstudio.uservoice.com/forums/357324-application-insights">Application Insights UserVoice ページ</a>で新しい機能や改善された機能についてアイデアを共有してください。 質問がある場合は、 <a href="https://social.msdn.microsoft.com/Forums/vstudio/en-US/home?forum=ApplicationInsights">Application Insights フォーラム</a>にアクセスしてください。</p>
