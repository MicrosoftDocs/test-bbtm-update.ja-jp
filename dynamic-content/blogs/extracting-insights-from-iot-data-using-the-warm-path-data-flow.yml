### YamlMime:Yaml
ms.openlocfilehash: b81cc86927230f5b6384d3c20e87ca217ccf9d4b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895972"
Slug: extracting-insights-from-iot-data-using-the-warm-path-data-flow
Title: ウォームパスデータフローを使用した IoT データからの洞察の抽出
Summary: このブログは、マイクロソフトの業界の経験チームによって発行されたソリューションガイドの対象範囲を続けます。 このガイドには、取り込みデータ、ホットパス処理、コールドパス処理、および分析クライアントの各コンポーネントが含まれています。 このブログ投稿では、ソリューションガイドのウォームパス処理コンポーネントについて説明します。
Content: >-
  <p>このブログは、Microsoft &rsquo; の業界エクスペリエンスチームによって発行された<a href="https://aka.ms/manufacturingsolutionguide" target="_blank">ソリューションガイド</a>の範囲を続けています。 このガイドには、次のコンポーネントが含まれています。</p>


  <ul>
   <li>データの取り込み</li>
   <li>ホットパスの処理</li>
   <li>コールドパスの処理</li>
   <li>Analytics クライアント</li>
  </ul>


  <p>ソリューションガイドで IoT アプリケーションのデータを処理するための推奨事項について説明し、データフローにラムダアーキテクチャを使用することをお勧めします。 データパスを繰り返し実行するには、次のようにします。</p>


  <ul>
   <li>Batch レイヤー (コールドパス) は、すべての受信データを未加工の形式で格納し、データに対してバッチ処理を実行します。 この処理の結果は、バッチ ビューとして保存されます。 処理速度が遅いパイプラインで、複雑な分析を実行したり、複数のソースからのデータを長期間にわたって結合したり、レポートや機械学習モデルなどの新しい情報を生成したりします。</li>
   <li>速度レイヤーとサービスレイヤー (ウォームパス) は、リアルタイムでデータを分析します。 このレイヤーは、精度と引き換えに待機時間が短くなるように設計されています。 これは、受信メッセージをアーカイブして表示し、これらのレコードを分析して、短い重要な情報やアラームなどのアクションを生成する、より高速な処理パイプラインです。</li>
  </ul>


  <p>このブログ投稿では、ソリューションガイドのウォームパス処理コンポーネントについて説明します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d0f330e7-e4aa-44bc-b990-4abfeca7aab9.png"><img alt="Warm path processing components of the solution guide" border="0" height="613" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4be09c59-5546-4113-ae90-d883c6206bf6.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="ソリューションガイドのウォームパス処理コンポーネント" width="1286"></a></p>


  <p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">Azure Event Hubs</a> は、ビッグデータストリーミングプラットフォームおよびイベントインジェストサービスであり、データストリームからデータを取り込みするための優れたオプションです。 この記事では、関連する Azure ネイティブサービスについて説明します。 ただし、Apache Software Foundation &rsquo; s のツールと Event Hubs テクノロジを使用する場合は、Apache Kafka MirrorMaker、apache flink、および kafka ストリームを Apache Kafka のエコシステムでもサポートします。</p>


  <p>スケーラブルな方法で Event Hubs を使用することは、ストリーミングされるデータの量が増加するため重要です。 Event Hubs の <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">機能</a> に関するドキュメントと、パーティションとコンシューマーグループの概念に関する <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-programming-guide?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">プログラミングガイド</a> を参照してください。 パーティションとコンシューマーグループの最適な組み合わせを選択することは、データの性質とその処理方法によって異なります。 Event Hub のパーティションの集計数は、スループットユニット (TU) &mdash; と一致する必要があります。詳細については、 <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-faq?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">よく寄せられる質問</a> をお読みください。 パーティションを使用して、メッセージの取り込みを1つのイベントハブに拡張することができます。 既定の最大値では不十分な場合は、サポート要求を送信して最大値を増やすことができます。 別の方法としては、シナリオに応じて、複数の Event Hubs を使用して、さまざまなメッセージの種類をファンアウトソリューション用のハブごとに送信することもできます。</p>


  <p>次の図に示すように、イベントハブのコンシューマーグループを使用して受信データストリームの処理をファンアウトし、ビジネス要件に応じて複雑な処理トポロジを作成することができます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5b6d839c-e02a-4137-9032-b7a05875ccd9.png"><img alt="Figure showing complext processing topologies" border="0" height="368" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/bf9108c9-8261-4fa2-9afe-a9430002e2b7.png" style="margin: 0px auto; border: 0px currentcolor; border-image: none; float: none; display: block; background-image: none;" title="Complext 処理トポロジを示す図" width="796"></a></p>


  <p><a href="https://docs.microsoft.com/en-us/azure/stream-analytics/?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">Azure Stream Analytics</a> (ASA) は、デバイスから大量のデータストリーミングを調べることができるイベント処理エンジンです。 イベントハブ、IoT Hub、または Blob Storage からのデータを受け入れることができます。 Apache Flink などの他のストリーム処理フレームワークを使用して、受信データストリームを処理できます。 Apache Kafka の Event Hubs で Apache Flink を使用する方法については、この <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-kafka-flink-tutorial?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">チュートリアル</a> を参照してください。</p>


  <p>&rsquo;ここでは、コンピューター上の回転コンポーネントの温度に変更をストリーミングすることを想定しています。 次のようにクエリを記述して、タンブリングウィンドウを使用して5秒ごとに平均を取得できます。</p>


  <pre>

  SELECT  System.TimeStamp AS WindowTime, DeviceName, ComponentName, avg(cast(SampleValue as float)) AS Average

  FROM s2tempsamples timestamp by SampleTimestamp

  WHERE SampleName = &#39;S2temp&#39; AND TRY_CAST(SampleValue AS float) IS NOT NULL   AND DeviceName = &#39;Machine1&#39;

  GROUP BY SampleTimestamp, DeviceName, ComponentName, tumblingwindow(second, 5)</pre>


  <p>ASA は、タンブリング、ホッピング、スライディング、Session の4種類のテンポラルウィンドウから選択できます。 次の図では、これらのウィンドウ関数について説明します。詳細については、 <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-window-functions?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">ドキュメント</a>を参照してください。</p>


  <p>ASA の最近の機能は、 <strong>AnomalyDetection</strong> 演算子です。 これは、3つの異なる種類の異常を検出するために使用されます。</p>


  <ul>
   <li><strong>双方向のレベルの変更。</strong> 上向きと下向き両方向の、値のレベルの持続的な増加または減少。 この値は、スパイクやディップ (瞬間的な、または短時間の変化) とは異なります。</li>
   <li><strong>低速肯定的傾向。</strong> 時間の経過に伴うゆっくりした増加の傾向。</li>
   <li><strong>低速の負の傾向。</strong> 時間の経過に伴うゆっくりした減少の傾向。</li>
  </ul>


  <p>回転率の増加を検出する場合、または回転コンポーネントの温度を双方向に変更する場合は、ドキュメント内のサンプルクエリを変更して、次のように受信ストリームを分析できます。</p>


  <pre>

  WITH AggregationStep AS
       (
            SELECT System.Timestamp as tumblingWindowEnd, AVG(SampleValue) as avgValue
            FROM s2tempsamples timestamp by SampleTimestamp
            WHERE SampleName = &#39;S2temp&#39;
  AND TRY_CAST(SampleValue AS float) IS NOT NULL

  AND DeviceName = &#39;Machine01&#39;
            GROUP BY TumblingWindow(second, 5)
       ),

      FillInMissingValuesStep AS
       (
             SELECT System.Timestamp AS hoppingWindowEnd,
                   TopOne() OVER (ORDER BY tumblingWindowEnd DESC) AS lastEvent
            FROM AggregationStep
            GROUP BY HOPPINGWINDOW(second, 300, 5)
       ),

      AnomalyDetectionStep AS
       (
             SELECT
                   hoppingWindowEnd,
                   lastEvent.tumblingWindowEnd as lastTumblingWindowEnd,
                   lastEvent.avgValue as lastEventAvgValue,
                   system.timestamp as anomalyDetectionStepTimestamp,
                   ANOMALYDETECTION(lastEvent.avgValue) OVER (LIMIT DURATION(hour, 1)) as
                   scores
             FROM FillInMissingValuesStep
       )

      SELECT
             alert = 1,
             hoppingWindowEnd,
             lastTumblingWindowEnd,
             lastEventAvgValue,
             anomalyDetectionStepTimestamp,
             scores
       INTO output
       FROM AnomalyDetectionStep
       WHERE
           CAST(GetRecordPropertyValue(scores, &#39;BiLevelChangeScore&#39;) as float) &gt;= 3.25
          OR CAST(GetRecordPropertyValue(scores, &#39;SlowNegTrendScore&#39;) as float) &gt;=
          3.25</pre>

  <p>クエリの出力は、クエリの INTO &rdquo; 句を使用して &ldquo; さまざまな出力に送ることができます。 この <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-define-outputs?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">ドキュメント</a>では、現在使用可能な出力の種類を確認できます。 出力の種類の1つは、(ほぼ) リアルタイムの視覚化オプションを許可する<a href="https://powerbi.microsoft.com/en-us/?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">Power BI</a>です。 ASA ジョブは、 <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-documentdb-output?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">Azure Cosmos DB</a>、Azure SQL Database などのデータストアに送ることもできます。</p>


  <p>前のテーマからのこの投稿には、定期的なテーマがあることがわかります。 IoT データの分析は、状況に依存します。 使用率 &rdquo; の取得 &ldquo; は例として、マシンがどの程度の部分を生成しているかは、コンピューターがサポートしている通信プロトコルやその構成などの技術コンポーネントに加えて、シフトの編成方法、製造するパーツの種類、および使用しているコンピューターによって異なります。</p>


  <p>このブログでは、受信データストリームを処理するためのテクノロジオプションを Azure で提供していますが、例を紹介しています。 実際のソリューションのアーキテクチャと実装は、ビジネスニーズとコンテキストによって異なります。</p>


  <h2>次の手順</h2>


  <ul>
   <li>Apache Kafka の Event Hubs で Apache Flink を使用する場合は、この <a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-kafka-flink-tutorial?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">チュートリアル</a> を完了してください。</li>
   <li>Power BI と Stream Analytics の<a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-power-bi-dashboard?WT.mc_id=iotinsightsblog-blog-ercenk" target="_blank">チュートリアル</a>を完了します。</li>
   <li><a href="https://aka.ms/manufacturingsolutionguide" target="_blank">ソリューションガイド</a>から、IoT データから洞察を引き出すための大きな画像を取得します。</li>
  </ul>
