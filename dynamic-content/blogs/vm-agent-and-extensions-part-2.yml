### YamlMime:Yaml
ms.openlocfilehash: c6f3f0ef088626fa71bb82d99740c730a6a15943
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893790"
Slug: vm-agent-and-extensions-part-2
Title: VM エージェントおよび拡張機能 – パート 2
Summary: 前のブログ「VM エージェント &amp; 拡張機能-パート1」では、Vm エージェントの概要、その利点、Vm エージェントを有効にした新しい vm を作成する方法に関する情報を提供しています。 このブログのパート 2...
Content: >-
  前のブログ「VM エージェント &amp; 拡張機能-パート1」では、Vm エージェントの概要、その利点、Vm エージェントを有効にした新しい vm を作成する方法に関する情報を提供しています。 このブログシリーズの第2部では、既存の vm での VM エージェントの有効化とディスクから作成された Vm からの2つの主要なシナリオについて説明します。

  <h4>既存の Vm で VM エージェントを有効にしています:</h4>

  <a href="https://weblogs.asp.net/scottgu/archive/2014/02/20/azure-expressroute-dedicated-networking-web-site-backup-restore-mobile-services-net-support-hadoop-2-2-and-more.aspx" target="_blank">Vm エージェントが使用可能になる前に</a>作成された Azure VM がある場合、このワークフローでは、vm 上で vm エージェントを有効にし、Vm で拡張機能を有効にする方法について説明します。

  <h4>Vm で VM エージェントが有効になっていないことを確認してください:</h4>

  これは、次<a href="https://msdn.microsoft.com/en-us/library/windowsazure/jj156055.aspx" target="_blank">   の Azure PowerShell</a>   コマンドレットを使用して行うことができます。


  $x = Get-AzureVM-ServiceName $serviceName


  ' $X. ProvisionGuestAgent ' が false であることを確認してください。


  <em>$X ProvisionGuestAgent が <strong>true</strong>の場合、vm には既に vm エージェントがあります。残りの手順はスキップできます。</em>

  <h4>Microsoft Azure vm エージェントをインストールして vm を準備します。</h4>

  Azure VM エージェントインストーラーは、vm に VM エージェントバイナリをインストールするためのスタンドアロン MSI です。 VM エージェントをインストールするには、 <a href="https://go.microsoft.com/fwlink/?LinkID=394789&amp;clcid=0x409" target="_blank">MSI をダウンロード</a> して起動する簡単な手順が1つあります。 次に示すように、インストーラーのワークフローに従って VM エージェントをインストールします。


  <strong>注:</strong> ドメインに参加している Vm では、VM エージェント msi がハングすることがあります。これを回避するには、管理者特権のプロンプトから msi を起動します。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1760/8640.1.png"><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1760/8640.1.png" alt="" border="0"></a>

  <h4>PowerShell から、VM エージェントがインストールされていることを示すフラグを設定します。</h4>

  注: ドメインに参加している Vm では、VM エージェント msi がハングすることがあります。これを回避するには、管理者特権のプロンプトから msi を起動してください。


  Vm エージェントが VM にインストールされたので、次の手順では、vm に VM エージェントがインストールされていることを Azure platform に通知します。 これを行うには、次の Azure PowerShell コマンドレットを実行します。


  <em>$vm = Get-AzureVM – serviceName $svc – Name $name</em>


  <em>$vm ProvisionGuestAgent = $TRUE</em>


  <em>更新-Add-azurevm – Name $name-VM $vm-ServiceName $svc</em>


  注: Azure PowerShell コマンドレットは<a href="https://azure.microsoft.com/en-us/downloads/" target="_blank">ここ</a>からダウンロードできます。


  Vm で VM 拡張機能を実行する準備ができました。


  <strong>注</strong>: linux vm では、Azure linux エージェントは VM 拡張機能の構成を担当します。 Linux エージェントのインストールの詳細については、こちらのブログ <a title=" " href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-linux-agent-user-guide/"> </a> 記事をご覧ください。

  <h4>ディスクから作成された vm で VM エージェントと拡張機能を有効にする方法:</h4>

  Vm を作成するためのもう1つの一般的なシナリオは <a href="https://msdn.microsoft.com/en-us/library/windowsazure/jj672979.aspx" target="_blank">、ディスクから Azure vm を作成</a>することです。 Azure Portal の Sysprep イメージを使用している場合は、vm の作成ワークフローで VM エージェントが有効になります。追加の手順は必要ありません。 ただし、特殊化されたディスクを使用している場合は、VM エージェントを手動でインストールする必要があります。 次の手順では、関連するプロセスについて説明します。

  <h4>VHD に VM エージェントをインストールします。</h4>

  ディスクを使用してオンプレミスの VM を作成し、<a href="https://go.microsoft.com/fwlink/?LinkID=394789&amp;clcid=0x409" target="_blank"> MSI</a>を使用して vm エージェントをインストールします。


  <a href="https://msdn.microsoft.com/en-us/library/windowsazure/dn205185.aspx" target="_blank">VHD を Azure にアップロード</a>します。

  <h4>ディスクから VM を作成する</h4>

  ポータルから、ギャラリーから VM を作成し、アップロードした VHD を選択します。 VM 作成ワークフローで、フラグを選択して、ディスクに既に VM エージェントが含まれていることを示します。 VM の作成中または作成後に、このポイント拡張機能を VM に追加できます。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1760/2705.2.png"><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1760/2705.2.png" alt="" border="0"></a>

  <h4>3. VM エージェントを有効にした後の次の処理</h4>

  Vm で vm エージェントを有効にすると、BGInfo や VMAccess などの利用可能な拡張機能を VM に追加できるようになります。 次のいくつかのブログでは、実行中の VM で直接任意のカスタムスクリプトを実行するなど、追加の拡張機能を検出して VM に追加する方法について説明します。

  <h4>4. フィードバック/質問</h4>

  VM エージェントまたは拡張機能に関するコメント/質問を <a href="https://social.msdn.microsoft.com/Forums/windowsazure/en-US/e3d5b6ea-a010-4a4b-969b-208affce3d89/vm-agent-and-vm-extensions-feedback-issues-questions?forum=WAVirtualMachinesforWindows" target="_blank">ここ</a>に投稿してください。 皆様のご意見をお待ちしております。


  &nbsp;
