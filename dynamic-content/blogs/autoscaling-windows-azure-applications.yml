### YamlMime:Yaml
ms.openlocfilehash: 154e5dff1c1b7f286658594317aa49d7cbcbc77d
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139912937"
Slug: autoscaling-windows-azure-applications
Title: Azure アプリケーションWindows自動スケール
Summary: エディターの注:この&nbsp;投稿は、Windows&nbsp; Azure Monitoring Team から提供されています。  Azure を使用する場合のWindows利点の 1 つは、変更に対応してアプリケーションをすばやくスケーリングできるという利点があります。
Content: '<p><strong>エディターの注:&nbsp;</strong><span>この投稿は、Windows&nbsp; Azure Monitoring Team から提供されます。</span></p>  <p>Azure を使用する場合のWindows利点の 1 つは、需要の変化に応じてアプリケーションをすばやくスケーリングできるという利点です。 以前は、アプリケーションのスケールを手動で設定するか、追加のツール ( <a href="https://msdn.microsoft.com/en-us/library/hh680892(v=pandp.50).aspx" target="_blank">WASABi</a> や <a href="https://www.metricshub.com" target="_blank">MetricsHub</a> など) を使用してアプリケーションを自動的にスケーリングする必要がありました。 ただし、これらのソリューションでは、パフォーマンスとコストの間の理想的なバランスを簡単に見つけ出すことのできない場合があります。</p>  <p>本日、自動&rsquo;スケーリングは次の場合に Azure に直接組み込Windows発表しました。</p>  <ul>  <li>Cloud Services</li>  <li>Virtual Machines</li>  <li>Web サイト</li>  </ul>  <p>自動スケーリングを使用すると、Azure は(手動で介入することなく) アプリケーションを動的にスケーリングして、理想的なパフォーマンスとコストのバランスを実現できます。 アプリケーション&rsquo;の負荷に &mdash; 応じて、インスタンスの数を定期的に調整します。 現在、次の 2 つの異なる負荷メトリックがサポートされています。</p>  <ul>  <li>CPU の割合</li>  <li>Storageの深さ (Cloud ServicesとVirtual Machinesのみ)</li>  </ul>  <h4>自動スケーリングを有効にする方法</h4>  <p>サービスのコンポーネントで自動スケーリングを使用する場合の推奨条件を次に示します。</p>  <ol>  <li>コンポーネントは水平方向にスケーリングできます (たとえば、複数のインスタンスに複製できます)</li>  <li>コンポーネントの読み&rsquo;込み時間の変化</li>  </ol>  <p>これらの条件を満たしている場合は、自動スケーリングを利用できます。ただし、そのメリットは、時間の過ぎた負荷の動的な量によって異なります。</p>  <p>自動スケーリングを有効にするには、有効にするサービスのポータルの [スケール] タブに移動します (現時点では、これをプログラムで実行できる API はありません)。 たとえばCloud Servicesロールごとに自動スケーリングが構成されます。 仮想マシンの場合、自動スケーリングは可用性セットごとに構成されます。</p>  <p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0083.westtest.png" alt="" border="0">&nbsp;</p>  <p>[CPU] ボタンをクリックすると、平均 CPU 使用率でスケーリングするために自動スケーリングを構成するために必要なすべてのコントロールが表示され、[キュー] ボタンをクリックすると、Storage アカウント キューによるスケーリングのオプションが表示されます。 メトリックに関係なく、常にインスタンスの最小数と最大数を定義します。そのため、サービスが常にベースライン レベルのパフォーマンスを確実に持ち、また、特定の支出レベルを超えないようにすることができます。&nbsp;</p>  <p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4762.workerrole.png" alt="" border="0">&nbsp;</p>  <p>インスタンス範囲スライダーの下には、ターゲット CPU を調整するコントロールがあります (または、Queue の場合はターゲット キューの深さ)。 ターゲットは、Azure がインスタンスの追加または削除によってメトリックを保持しようとする場所です。 &nbsp;</p>  <p>自動スケーリング&rsquo;を有効にしたら、任意の時点で [スケール] タブに戻り、[オフ] を選択してインスタンスの数を手動で設定できます。&nbsp;</p>  <h4>自動スケーリング インスタンスの範囲に関するガイダンス</h4>  <p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6862.range.png" alt="" border="0"></p>  <p>自動スケーリングを初めて設定する場合、インスタンスの最小数を適切に設定することが非常に重要です。 アプリケーションまたはサイトの負荷が現在非常に低い場合は、次の方法をお勧めします。</p>  <ul>  <li>クラウド サービスと仮想マシンの場合、高可用性を実現する 2 つのインスタンス</li>  <ul>  <li>Azure プラットフォームでは、SLA&rsquo; を満たすために少なくとも 2 つのインスタンスが必要です。Web サイトでは、SLA&rsquo; に必要なインスタンスは 1 つのみです</li>  </ul>  <li>ただし、現在、1 つのインスタンスを超えるベースライン負荷がある場合、またはサービスで急激な使用量の急増がある場合は、負荷を処理するインスタンスの最小数が多い必要があります。</li>  </ul>  <p>Azure で CPU 使用率がチェックされる前にトラフィックWindows急増している場合は、その間にサービスが応答しない可能性があります。 このようなトラフィックの急増が予想される場合は、それに対応できるように最小インスタンス数の値を大きくしてください。</p>  <h4>自動スケーリングターゲット メトリックのガイダンス</h4>  <p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0602.range2.png" alt="" border="0"></p>  <p>CPU による自動スケーリングを選択すると、新しい&rsquo;スライダーが表示されます。 この範囲は、ロール全体の平均 CPU 使用率を表します。 既定では、ターゲット CPU に対して 60% から 80% をお勧めします。 つまり、マシンはスケールアップ前に非常にホット ( &gt; 80%) で実行できます。そのため、より保守的なメトリックが必要な場合は、最小値と最大値の両方を減らします。</p>  <p>スライダーを端または互いに近すぎる範囲に設定は推奨されません。 いずれかのスライダーを最後までドラッグすると (例: 0% から 100%)、スケール アクションは表示しません。 スライダーを互いに非常に近い位置にした場合 (例: 74% から 75%)、スケール アクションが多すぎます。</p>  <p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4722.storaccounts.png" alt="" width="300"></p>  <p>ストレージ キュー別にスケーリングする場合は、まず、キューを含むストレージ アカウントと、スケールに使用するキューを選択する必要があります。 各ロールは、1 つのキューでのみスケーリングできます。</p>  <p>自動スケールが設定するマシンの数は、マシンあたりのターゲット メッセージ数によって決まります。 キュー内のメッセージの数をターゲットで除算して、必要な数のマシンを取得します。 したがって、ターゲットは、1 つのワーカー インスタンスが処理するキュー内のメッセージの平均数である必要があります。</p>  <h4>仮想マシンの自動スケール</h4>  <p>仮想マシンの場合、自動スケールは可用性セット内のマシンのオンとオフを切り替えます。 課金作業を行わない<a href="https://weblogs.asp.net/scottgu/archive/2013/06/03/windows-azure-announcing-major-improvements-for-dev-test-in-the-cloud.aspx" target="_blank">最近の停止のため</a>&rsquo;、停止されたマシンに対して料金はかからずに行います。 さらに、Virtual Machines分ごとに課金 <a href="https://weblogs.asp.net/scottgu/archive/2013/06/03/windows-azure-announcing-new-dev-test-offering-biztalk-services-ssl-support-with-web-sites-ad-improvements-per-minute-billing.aspx" target="_blank">されます</a>。 つまり、追加の負荷を処理するためにマシンを 30 分間オンにした場合、その 30&rsquo; 分間だけ課金されます。</p>  <p>Web サイトやクラウド サービスとは異なり、仮想マシンの自動スケーリングでは、新しいインスタンスを作成したり、既存のインスタンスを削除したりすることはできません。 つまり、必要と思うすべてのマシンをプロビジョニングし、事前に自動スケーリングする可用性セットに追加する必要があります。 追加すると、自動スケーリングによって、負荷を確認して実行されている VM が管理されます。</p>  <p>現時点では、 &ndash; 常にオンにする必要があるマシンが 1 つ以上ある場合は、どのマシンをオンまたはオフにするか選択するメカニズムはありません。個別の可用性セットに置くことをお勧めします。&nbsp;</p>  <h4>自動スケーリングはどのくらい高速ですか?</h4>  <p>サービスを自動スケーリングする速度は、スケーリングに使用されるメトリックによって異なります。 クラウド サービスと仮想マシン上の CPU の場合、メトリックは過去 1 時間のすべてのインスタンスの平均 CPU です。 つまり、トラフィックが &ndash; 急激に増加した場合、スケールは直ちに増加しません。60 分の実行平均が増加するには時間が必要です。</p>  <p>キューの深さと Web サイトの CPU の場合、メトリックは 5 分ごとにチェックされ、実行時間の平均ではありません。</p>  <p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4478.scaleup.png" alt="" border="0"></p>  <p>スケールCloud ServicesとVirtual Machines、スケールアップまたはスケールダウンの速度を調整できるコントロールも公開されています。 ステップ サイズ (一度に 2 インスタンスなど) または各アクション間の待機時間 (たとえば、スケールダウン アクションを実行する前に 30 分待つ) を設定できます。 Web サイトの場合、自動スケーリング速度はサービスの機能に基づいて固定されます。</p>  <table style="border: 0px solid #000000;" border="0" cellpadding="6" align="center">  <tbody>  <tr>  <td>&nbsp;</td>  <td>Cloud Services および Virtual Machines</td>  <td>Web サイト</td>  </tr>  <tr>  <td>スケール ステップ</td>  <td>1 - 全範囲</td>  <td>一度に 1</td>  </tr>  <tr>  <td>待機時間のスケールアップ</td>  <td>5 分* - 2 時間</td>  <td>5 分</td>  </tr>  <tr>  <td>スケールダウン待機時間</td>  <td>5 分* - 2 時間</td>  <td>2 時間</td>  </tr>  </tbody>  </table>  <p>* 5 分を設定しても、5 分ごとにスケール アクションが実行される保証はありません。 Azure は、次のスケール アクションを実行する前に、以前のデプロイが完了するまで常に待機します。 そのため、サービスのデプロイにかかる時間によっては、待機時間を 5 分として選択した場合でも、スケール アクションの間に 10 分または 15 分かかる場合があります。</p>  <p>スケールダウンよりもスケールアップに積極的に取り入りたい場合は、スケールダウンするよりもスケール<em></em>アップを高く<em></em>設定するか、スケールダウン待機時間よりもスケール<em></em>アップ待機時間を低くすることをお勧<em>めします。</em>&nbsp;</p>  <h4>まとめ</h4>  <p>Azure のこの最新の更新プログラムを使用すると、わずか数分で、実行しているインスタンスの数を Azure で自動的に調整し、サービスのパフォーマンスを目的のコストで維持することができます。</p>  <p>自動スケーリングはプレビュー機能であり、一般提供まで、期間限定で無料で提供されます。 プレビュー期間中、各サブスクリプションは、サポートしているすべてのリソース (Web サイト、クラウド サービス、またはクラウド サービス) 全体で 10 の自動スケール ルールに制限Virtual Machines。 この制限が発生した場合は、任意のリソースの自動スケーリングを無効にして、別のリソースに対して有効にできます。&nbsp;</p>  <p>自動スケーリングのしくみの詳細については、ヘルプ トピックを参照してください。</p>  <ul>  <li><a href="https://azure.microsoft.com/en-us/manage/services/cloud-services/how-to-scale-a-cloud-service/" target="_blank">クラウド サービスをスケーリングする方法</a> (クラウド サービスとクラウド サービスVirtual Machines)</li>  <li><a href="https://azure.microsoft.com/en-us/manage/services/web-sites/how-to-scale-websites/" target="_blank">Web サイトをスケーリングする方法</a></li>  </ul>'
