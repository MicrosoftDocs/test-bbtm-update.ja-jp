### YamlMime:Yaml
ms.openlocfilehash: eb171681c8c1b3b4cd7fa11148bb9d24f5aeb54c
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891314"
Slug: allocation-failure-and-remediation
Title: 割り当ての失敗と修復
Summary: この記事では、いくつかの一般的な割り当てエラーの原因について説明し、考えられる修復方法を示します。 この情報は、サービスのデプロイを計画する場合にも役立ちます。
Content: "vm を作成するとき、停止 (割り当て解除) された vm を再起動する、vm のサイズを変更する、または新しい web ロールまたは worker ロールインスタンスを追加するときに、Microsoft Azure はコンピューティングリソースをサブスクリプションに割り当てます。 これらの操作をしているときに、Azure サブスクリプションの制限に達していなくても、エラーが発生する場合があります。 このブログの投稿では、いくつかの一般的な割り当てエラーの原因について説明し、考えられる修復方法を提案します。 この情報は、サービスのデプロイを計画する場合にも役立ちます。\n\nAzure データセンターのサーバーは、クラスターにパーティション分割されています。 通常、割り当て要求は複数のクラスターで試行されますが、割り当て要求からの特定の制約によって、Azure platform が1つのクラスターでのみ要求を試行することがあります。 このブログ投稿では、これを \"クラスターに固定\" と呼びます。 次の図1は、複数のクラスターで試行される通常の割り当てのケースを示しています。図2は、 <em>クラスター 2</em> に固定されている割り当ての場合を示しています。これは、既存のクラウドサービスの <em>CS_1</em> がホストされているためです。\n\n<img style=\"float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; padding-right: 0px; border: 0px;\" title=\"AllocationBlogPost1\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/AllocationBlogPost1.png\" alt=\"AllocationBlogPost1\" width=\"610\" height=\"296\" border=\"0\" />\n\n割り当て要求がクラスターに固定されると、リソースプールが小さくなるため、空きリソースを見つけられない可能性が高くなります。 さらに、割り当て要求がクラスターに固定されていて、そのクラスターでは要求されたリソースの種類がサポートされていない場合、クラスターに空きリソースがあっても、要求は失敗します。 次の図3は、唯一の候補となるクラスターに空きリソースがないため、固定された割り当てが失敗するケースを示しています。図4は、クラスターに空きリソースがある場合でも、候補クラスターが要求された VM サイズをサポートしていないために、ピン留めされた割り当てが失敗するケースを示しています。\n\n<img style=\"float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; padding-right: 0px; border: 0px;\" title=\"AllocationBlogPost2\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/AllocationBlogPost2.png\" alt=\"AllocationBlogPost2\" width=\"610\" height=\"345\" border=\"0\" />\n\n次のセクションでは、割り当て要求が固定される原因となる一般的なケースを示します。 割り当てエラーが発生した場合は、説明されているいずれかの状況に該当するかどうかを確認してください。 要求がピン留めされている場合は、ピン留めの制約をいくつか削除して、より多くのクラスターに対する要求を開いてみてください。これにより、割り当てが成功する可能性が高くなります。\n\n一般に、\"要求された VM のサイズがサポートされていません\" というエラーが表示されない限り、後でいつでも再試行できます。これは、要求に対応するために十分なリソースがクラスターで解放されている可能性があるためです。 要求された VM サイズがサポートされていない場合は、別の VM サイズを試してください。それ以外の場合、唯一のオプションは、次のセクションで提案されているようにピン留め制約を削除することです。\n\n2つの一般的なエラーシナリオは、アフィニティグループに関連しています。 以前は、アフィニティグループは、Vm/サービスインスタンスに近接していることを示すために使用されていたか、または Virtual Network (VNet) の作成を有効にするために使用されていました。 リージョン Virtual Network の導入により、アフィニティグループは Virtual Network を作成する必要がなくなりました。 Azure インフラストラクチャでのネットワーク待機時間の短縮により、VM/サービス近接性グループの使用に関する推奨事項が変更されました。 アフィニティグループの推奨事項のトピックには、フォローアップドキュメントの更新があります。\n\n次の図 5 は、(固定された) 割り当てシナリオの分類を示しています。 各シナリオについては、次のセクションで説明します。\n\n<img style=\"float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; padding-right: 0px; border: 0px;\" title=\"AllocationBlogPost3\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/AllocationBlogPost3.png\" alt=\"AllocationBlogPost3\" width=\"610\" height=\"237\" border=\"0\" />\n<h1>割り当てのシナリオ</h1>\n<blockquote>メモ (*): Azure platform から返された割り当てエラーを使用して、対応するシナリオを特定します。 各シナリオセクションに示されているエラーは、短い形式です。 エラー文字列の詳細については、付録を参照してください。</blockquote>\n<h2>シナリオ: VM のサイズの変更、または既存のクラウドサービスへの vm またはロールインスタンスの追加</h2>\n<strong>エラー</strong>: Upgrade_VMSizeNotSupported * または一般エラー *\n\n<strong>クラスターの固定の原因</strong>: vm のサイズを変更する要求、または既存のクラウドサービスに vm またはロールインスタンスを追加する要求は、既存のクラウドサービスをホストしている元のクラスターで試行する必要があります。 新しいクラウドサービスを作成すると、Azure platform は、無料リソースを持つ別のクラスター、または要求した VM サイズをサポートするクラスターを見つけることができます。\n\n<strong>修復</strong>:\n\nエラーが Upgrade_VMSizeNotSupported* である場合は、別の VM サイズを試してみてください。 別の VM サイズを使用することはできませんが、別の VIP を使用できる場合は、新しい VM をホストする新しいクラウドサービスを作成し、既存の Vm が実行されているリージョン Virtual Network に新しいクラウドサービスを追加します。 既存のクラウドサービスでリージョン Virtual Network が使用されていない場合でも、新しいクラウドサービス用に新しい Virtual Network を作成し、この <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn690122.aspx\">リンク</a> の指示に従って既存の vnet を新しい vnet に接続することができます。 リージョンの Virtual Network の詳細については、この <a href=\"https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/\">ブログの投稿</a>を参照してください。\n\nエラーの場合は *、リソースの種類 (特定の VM サイズなど) がクラスターによってサポートされていても、その時点でクラスターに空きリソースがない可能性があります。上記と同様に、新しいクラウドサービスを作成することによって目的のコンピューティングリソースを追加してみてください (新しいクラウドサービスは別の VIP を使用する必要があります)。また、Cloud Services に接続するには、リージョン Virtual Network を使用します。<h2>シナリオ: 停止 (割り当て解除) された vm の再起動-<span style=\"text-decoration: underline;\">部分的</span>な割り当て </h2> \n 解除 <strong>エラー</strong>: 全般エラー*\n\n<strong>クラスターの固定の原因</strong>: <span style=\"text-decoration: underline;\">部分的</span> な割り当て解除とは、1つ以上のクラウドサービス内の <span style=\"text-decoration: underline;\">すべて</span> の vm を停止 (割り当て解除) したことを意味します。 VM を停止 (割り当て解除) すると、関連付けられているリソースが解放されます。 そのため、停止した (割り当て解除された) VM を再起動すると、新しい割り当て要求になります。 部分的に割り当て解除されたクラウドサービスで Vm を再起動することは、既存のクラウドサービスに Vm を追加することと同じです。割り当て要求は、既存のクラウドサービスをホストしている元のクラスターで試行する必要があります。 別のクラウドサービスを作成すると、Azure platform は、無料リソースを持つ別のクラスター、または要求した VM サイズをサポートするクラスターを見つけることができます。\n\n<strong>修復</strong>:\n\n別の VIP を使用できる場合は、停止 (割り当て解除) された Vm を削除し (ただし、関連付けられているディスクは保持します)、別のクラウドサービスを使用して Vm を再び追加します。 Cloud Services を接続するには、リージョン Virtual Network を使用します。\n<ol>\n <li>既存のクラウドサービスでリージョン Virtual Network が使用されている場合は、単に新しいクラウドサービスを同じ Virtual Network に追加します。</li>\n <li>既存のクラウドサービスがリージョンの Virtual Network を使用しない場合は、新しいクラウドサービスの新しい Virtual Network を作成します。 この <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn690122.aspx\">リンク</a> の指示に従って、既存の vnet を新しい vnet に接続します。 リージョンの Virtual Network の詳細については、この <a href=\"https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/\">ブログの投稿</a>を参照してください。</li>\n</ol>\n<h2>シナリオ: 停止 (割り当て解除) された Vm の再起動- <span style=\"text-decoration: underline;\">完全</span> De-Allocation</h2>\n<strong>エラー</strong>: 全般エラー *\n\n<strong>クラスターの固定の原因</strong>: <span style=\"text-decoration: underline;\">完全な</span> 割り当て解除とは、クラウドサービスから <span style=\"text-decoration: underline;\">すべて</span> の vm を停止 (割り当て解除) したことを意味します。 現時点では、これらの Vm を再起動するための割り当て要求は、クラウドサービスをホストしている元のクラスターで試行する必要があります。 新しいクラウドサービスを作成すると、Azure platform は、無料リソースを持つ別のクラスター、または要求した VM サイズをサポートするクラスターを見つけることができます。\n\n<strong>修復</strong>:\n\n別の VIP を使用できる場合は、元の停止 (割り当て解除) Vm を削除し、対応するクラウドサービスを削除します (関連付けられているコンピューティングリソースは、Vm を停止 (割り当て解除) したときに既にリリースされています)。 新しいクラウドサービスを作成して、Vm を再び追加します。\n<h2>シナリオ: ステージング/運用環境のデプロイ (サービスとしてのプラットフォームのみ)</h2>\n<strong>エラー</strong>: New_General * または New_VMSizeNotSupported *\n\n<strong>クラスターの固定の原因</strong>: クラウドサービスのステージングデプロイと運用デプロイは、同じクラスターでホストされます。 2 つ目のデプロイを追加する場合、対応する割り当て要求は、最初のデプロイをホストする同じクラスター内で試行されます。\n\n<strong>修復</strong>:\n\n許容できる場合は、最初のデプロイと元のクラウドサービスを削除し、クラウドサービスを再デプロイします。 この操作では、両方のデプロイに適合する十分な空きリソースがあるクラスター、または要求した VM サイズをサポートするクラスターに、最初のデプロイが配置されます。\n<h2>シナリオ: アフィニティグループ-VM/サービス近接性</h2>\n<strong>エラー</strong>: New_General * または New_VMSizeNotSupported *\n\n<strong>クラスターの固定の原因</strong>: アフィニティグループに割り当てられているすべてのコンピューティングリソースは、1つのクラスターに関連付けられています。 このアフィニティグループの新しいコンピューティングリソース要求は、既存のリソースがホストされているのと同じクラスターで試行されます。 新しいリソースが新しいクラウドサービスまたは既存のクラウドサービスを使用して作成される場合でも、これは当てはまります。\n\n<strong>修復</strong>:\n\n必要でない場合は、アフィニティグループを使用しないか、複数のアフィニティグループでコンピューティングリソースをグループ化してみてください。\n<h2>シナリオ: アフィニティ-グループベースの Virtual Network</h2>\n<strong>エラー</strong>: New_General * または New_VMSizeNotSupported *\n\n<strong>クラスターの固定の原因</strong>: リージョンの Virtual Network が発表される前に、Virtual Network をアフィニティグループに関連付ける必要がありました。 その結果、アフィニティグループに配置されたコンピューティングリソースは、上記の「アフィニティグループ-VM/サービス近接性」シナリオで説明したものと同じ制約によってバインドされます。コンピューティングリソースは、1つのクラスターに関連付けられています。\n\n<strong>修復</strong>:\n\nアフィニティグループが不要な場合は、追加する新しいリソースの新しいリージョン Virtual Network を作成します。 この <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn690122.aspx\">リンク</a> の指示に従って、既存の vnet を新しい vnet に接続します。 リージョンの Virtual Network の詳細については、この <a href=\"https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/\">ブログの投稿</a>を参照してください。\n\nまたは、この <a href=\"https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/\">リンク</a> の指示に従って、アフィニティグループベースの Virtual Network を地域 Virtual Network に移行してから、必要なリソースをもう一度追加してみてください。\n<h1>付録</h1>\n<h2>エラー文字列の参照</h2>\n<strong>New_VMSizeNotSupported</strong>: デプロイ要求の制約により、このデプロイで必要とされる vm サイズ (または vm サイズの組み合わせ) をプロビジョニングできません。 可能であれば、仮想ネットワークのバインドなどの制約条件の緩和、他のデプロイがなくアフィニティ グループが別のホストされるサービスへのデプロイ、アフィニティ グループのないホストされるサービスへのデプロイ、別のリージョンへのデプロイのいずれかを試してください。\"\n\n<strong>New_General</strong>: \"割り当てに失敗しました。要求の制約を満たすことができません。 要求されている新しいサービスのデプロイがアフィニティ グループにバインドされているか、仮想ネットワークを対象としています。または、このホストされるサービスに既存のデプロイがあります。 ここに挙げた条件に該当する場合には、新しいデプロイが特定の Azure リソースに制限されます。 後でもう一度やり直すか、VM サイズを小さくするか、ロール インスタンスの数を減らしてください。 可能な場合には、上に挙げた制約条件を削除することや、別のリージョンにデプロイすることもできます。\"\n\n<strong>Upgrade_VMSizeNotSupported</strong>: \"展開をアップグレードできません。 要求された VM サイズ XXX は、既存のデプロイをサポートするリソースの中では用意できない可能性があります。 後でもう一度やり直すか、VM サイズを変更するか、ロール インスタンスの数を減らしてみてください。または、空のホストされるサービスの下で、新しいアフィニティ グループを指定するかアフィニティ グループのバインドなしを指定して、デプロイを作成してください。\"\n\n<strong>一般エラー</strong>: \"サーバーで内部エラーが発生しました。 要求を再試行してください。\" または \"サービスの割り当てを作成できませんでした。\""
