### YamlMime:Yaml
ms.openlocfilehash: a120fdd79135f624de67e15f9d5062de044e7f45
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889322"
Slug: advancing-azure-virtual-machine-availability-transparency
Title: Azure 仮想マシンの可用性の透過性の昇格
Summary: これで、VM の可用性が影響を受けたときに迅速な通知を受け取るだけでなく、自動根本原因分析 (RCA) システムによって、VM 障害の原因となっている Azure platform コンポーネントが特定された後に、根本的な原因が追加されることを期待できます。
Content: >
  <p><em> &ldquo; 強化された<a href="https://www.aka.ms/AdvancingReliability" target="_blank">信頼性のブログシリーズ</a>全体を通じて、Azure platform が使用するさまざまな手法について説明しました。これ &rsquo; は、技術的な問題が顧客 &rsquo; の仮想マシン (vm) に影響したり、 <a href="https://azure.microsoft.com/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/" target="_blank">Project tardigrade によるホストの回復性</a>や、 <a href="https://azure.microsoft.com/blog/advancing-safe-deployment-with-aiops-introducing-gandalf/" target="_blank">ML ベースの aiops インサイト</a>を<a href="https://azure.microsoft.com/blog/advancing-safe-deployment-practices/" target="_blank"></a>活用した慎重で安全な展開の &mdash; 手法を利用<a href="https://azure.microsoft.com/blog/advancing-failure-prediction-and-mitigation-introducing-narya/" target="_blank">Project narya でハードウェア障害を予測し、軽減</a>します。これらの取り組みにもかかわらず、Azure のスケールで運用している場合は、お客様のリソース &mdash; に影響する何らかの障害が必然的に発生していることがわかっています。そのため、影響を受ける顧客とのコミュニケーション方法の透明性に努めています。そのため、シリーズの本日 &rsquo; の投稿では、Azure resource health を使用してより詳細な根本原因ステートメントをどのように表示するかについて、最近の機能強化 &mdash; について明確に説明するために、プリンシパルソフトウェアエンジニアリングマネージャーの<strong>ニックネーム</strong>を求めています。 &rdquo; </em> &mdash;Mark Russinovich、CTO、Azure</p>


  <hr>

  <p>&nbsp;</p>


  <p>既存の Azure resource health 機能は、Azure リソースに影響するサービスの問題を診断し、サポートを受けるために役立ちます。 リソースの現在と過去の正常性について報告し、各リソースが使用できなくなった時間範囲を示します。 しかし、お客様とパートナーは、基礎となる技術上の問題の原因を把握する理由 &rdquo; に &ldquo; 特に興味を持っています。また、監視プロセスへの対応に関する問題 &mdash; についての情報を受信し、他の利害関係者に崩すを説明し、最終的にビジネス上の意思決定について通知するために、</p>


  <h2>Azure resource health での VM の問題 &mdash; の根本原因の紹介</h2>


  <p>最近、リソース正常性のエクスペリエンスが向上し、VM の障害に関してお客様と共有する情報が拡張され、問題の原因となった根本原因に関する追加のコンテキストが提供されています。 これで、VM &rsquo; の可用性が影響を受けたときに迅速な通知を受け取るだけでなく、自動根本原因分析 (RCA) システムによって、vm 障害の原因となっている失敗した Azure platform コンポーネントが特定された後に、根本的な原因が追加されることを期待できます。 これが実際にどのように動作するかを確認する例を見てみましょう &rsquo; 。</p>


  <ol>
      <li>ネットワークの問題によってサーバーラックがオフラインになり、ラック上の Vm の接続が失われることがあります。 (ネットワークアーキテクチャに関連する最近の信頼性の向上は、今後の <a href="https://www.aka.ms/AdvancingReliability" target="_blank">信頼性</a> の向上に関するブログ投稿 &mdash; こちらをご覧ください)。</li>
      <li>Time T2 では、Azure &rsquo; の内部監視機能が、ラック上の vm に接続できないことを認識し、影響を受ける vm を新しいラックに再デプロイすることで軽減を開始します。 この期間中は、リソースの正常性に注釈が送信され、その VM が現在影響を受けていないことを顧客に通知します。
      <p>&nbsp;</p>
      <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/12785145-3b38-495b-84c2-8d0d9ee927be.png"><img alt="A screenshot of the Azure portal “resource health” blade showing the health history of a resource." border="0" height="974" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/993840fc-e567-46bc-a3d1-c89e1f36cb51.png" style="border-image: none; display: inline; background-image: none;" title="図 1: 正常性の履歴" width="1430"></a>

      <p><em><strong>図 1</strong>: リソースの正常性の履歴を示す [Azure portal &ldquo; resource health (リソース正常性 &rdquo; )」ブレードのスクリーンショット</em></p>
      </li>
      <li>時間 T3 では、ラックスイッチの上位のプラットフォームテレメトリ、ホストコンピューター、および内部監視システムがすべて RCA エンジンで相互に関連付けられ、障害の根本原因が導き出されます。 計算が完了すると、RCA が resource health に発行され、関連するアーキテクチャの回復性に関する推奨事項と共に、お客様が実装して将来の影響の可能性を最小限に抑えることができます。</li>
  </ol>


  <p>&nbsp;</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9392bf23-e34d-4352-a9bc-a9738d21af02.png"><img alt="A screenshot of the Azure portal &quot;health history&quot; blade showing root cause details for an example of a VM issue." border="0" height="944" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0e155d0b-d963-4495-bbcc-b2ee2c690b3a.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="図2" width="1430"></a></p>


  <p><em><strong>図 2:</strong> Azure portal &quot; の正常性の履歴 &quot; ブレードのスクリーンショット。 VM の問題の例に関する根本原因の詳細が示されています。</em></p>


  <p>最初のダウンタイム通知機能は数年にわたって存在していましたが、根本原因ステートメントの発行は新たに追加されました。 では、 &rsquo; これらの根本的な原因をどのように導き出すかについて詳しく説明します。</p>


  <h2>根本原因分析エンジン</h2>


  <p>&rsquo;前の例を詳しく見て、RCA エンジンの動作と背後にあるテクノロジについて詳しく説明します。 仮想マシン用の RCA エンジンの中核となるのは、高ボリュームのログテレメトリ分析用に最適化されたビッグデータサービスである <a href="https://docs.microsoft.com/en-us/azure/data-explorer/data-explorer-overview" target="_blank">Azure データエクスプローラー</a> (adx) です。 Azure データエクスプローラーを使用すると、Azure プラットフォームを構成するデバイスやサービスからテラバイト単位のログテレメトリを簡単に解析し、それらを結合して、さまざまな障害シナリオの根本原因を導き出すために相関情報ストリームを解釈することができます。 これは、次のような Data Engineering プロセスになります。</p>


  <h3>フェーズ 1: ダウンタイムの検出</h3>


  <p>根本原因分析の最初のフェーズでは、分析を実行するトリガーを定義します。 Virtual Machines の場合は、VM が予期せず再起動されるたびに根本原因を特定する必要があるため、トリガーは up 状態から down 状態に移行する VM です。 プラットフォームテレメトリからこれらの遷移を識別することは、ほとんどのシナリオでは簡単ですが、デバイスの障害または停電によってプラットフォームテレメトリが失われる可能性がある特定の種類のインフラストラクチャ障害については、複雑になります。 このようなエラーを処理するには、VM の正常性遷移を示す可能性があるデータ損失の追跡など、他の手法が必要です &mdash; 。 azure データエクスプローラーは、このシリーズ分析の時点で威力を持っています。 Community これに関する手法の詳細については、「 <a href="https://techcommunity.microsoft.com/t5/azure-data-explorer/calculating-downtime-using-window-functions-and-time-series/ba-p/1345430" target="_blank">azure データエクスプローラーのウィンドウ関数と時系列関数を使用したダウンタイムの計算」</a>を参照してください。</p>


  <h3>フェーズ 2: 相関関係の分析</h3>


  <p>トリガーイベントが定義されると (この例では、VM は異常な状態に移行します)、次のフェーズは相関関係分析です。 このステップでは、次のように、トリガーイベントの存在を使用して、Azure platform 全体のポイントからテレメトリを関連付けます。</p>


  <ul style="margin-left: 40px;">
      <li>Azure host: Vm をホストしている物理ブレード。</li>
      <li>TOR: ラックネットワークスイッチの上部。</li>
      <li>Azure Storage: Azure Virtual Machines の仮想ディスクをホストするサービス。</li>
  </ul>


  <p>これらの各システムには、解析を行い、VM のダウンタイムトリガーイベントと関連付けられる必要がある独自のテレメトリフィードがあります。 これを行うには、vm の依存関係グラフと基になるシステムを理解します。これにより、VM の障害が発生する原因となる可能性があり、これらすべての依存システム &rsquo; の正常性テレメトリが、vm の時間内に比較的近くにあるイベントでフィルター処理されます。 Azure データエクスプローラー &rsquo; s の直感的で強力なクエリ言語は、テンポラルテレメトリストリームを関連付けるための <a href="https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/join-timewindow" target="_blank">時間枠の結合</a> のような、ドキュメント化されたパターンを使用して、これに役立ちます。 この関連付けプロセスの最後に、vm の障害の原因を特定するのに役立つ情報が得られる可能性のある、すべての依存システムから、関連付けられているプラットフォームテレメトリを使用して、VM のダウンタイム遷移を表すデータセットが用意されています。</p>


  <h3>フェーズ 3: 根本原因の属性</h3>


  <p>プロセスの次の手順は、属性です。 すべての関連データを1つのデータセットにまとめて収集した &rsquo; ので、属性ルールを適用して情報を解釈し、顧客向けの根本原因ステートメントに変換します。 TOR エラーの元の例に戻ると、相関関係分析の後、解釈するために多くの興味深い情報が含まれている可能性があります。 たとえば、Azure ホストを監視するシステムには、この間にホストへの接続が失われたことを示すログが記録されている場合があります。 また、仮想ディスクの接続に関する問題に関連するシグナルや、TOR デバイスからのエラーに関する明示的なシグナルが含まれている場合もあります。 これらの情報はすべてスキャンされるようになりました。明示的な TOR エラーシグナルは、根本原因として他のシグナルに優先順位が付けられます。 この優先順位付けプロセスとその背後にあるルールは、ドメインの専門家によって構築され、Azure プラットフォームの進化に伴って変更されています。 機械学習と異常検出メカニズムは、これらの属性付きの根本原因の上にあります。これらの分類規則を改善する機会を特定し、これらのエラーの発生率に基づいてパターンの変化を検出して、 <a href="https://azure.microsoft.com/blog/advancing-safe-deployment-with-aiops-introducing-gandalf/" target="_blank">安全な展開のパイプライン</a>に戻すことができるようにします。</p>


  <h3>フェーズ 4: RCA の発行</h3>


  <p>最後の手順では、根本原因を Azure resource health に発行します。これにより、顧客に表示されるようになります。 これは非常に単純な <a href="https://azure.microsoft.com/en-us/services/functions/" target="_blank">Azure Functions</a> アプリケーションで実行されます。このアプリケーションは、Azure データエクスプローラーの処理された根本原因データを定期的に照会し、結果を resource health バックエンドに出力します。 情報ストリームにはさまざまなデータ遅延が発生する可能性があるため、RCAs はこのプロセスで更新されることがあります。これにより、最初に発行された情報の根本原因をより具体的に把握することができます。</p>


  <h2>今後の予定</h2>


  <p>お客様とパートナーとの間で発生した問題の根本原因を特定し、それに対応しているのは、最初だけです。 お客様は、これらの RCAs を利用し、顧客や同僚と共有することが必要になる場合があります。 ここでは、リソース RCAs の識別と追跡を容易にすると共に、簡単に共有できるように、ここでの作業について説明します。これを実現するために、バックエンドの変更に取り組んで、公開できる一意のリソースごとの追跡 Id とダウン時間ごとの追跡 Id を生成します。これにより、ダウンタイムを RCAs に簡単に対応付けることができます。 また、RCAs を簡単に電子メールで送信し、最終的には Vm に対して RCAs をサブスクライブできるようにする新機能についても説明しています。 これにより、利用できないイベントが発生した後に、追加のアクションを必要とせずに、受信トレイで RCAs に直接サインアップできるようになります。</p>
