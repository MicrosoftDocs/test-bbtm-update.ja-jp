### YamlMime:Yaml
ms.openlocfilehash: 3f93c1a6bb441150321a760e082c9960bb2bf6e4
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889092"
Slug: network-security-groups
Title: ネットワーク セキュリティ グループ
Summary: 先週の TechEd ヨーロッパでは、Azure ネットワークスタックに追加された重要なネットワークセキュリティグループの一般提供を発表しました。
Content: >-
  先週の TechEd ヨーロッパでは、Azure ネットワークスタックに追加された重要な <a href="https://azure.microsoft.com/blog/2014/10/29/networking-enterprise/">ネットワークセキュリティグループの一般提供</a>を発表しました。 ネットワークセキュリティグループは、Virtual Network (VNet) 内にセグメント化を提供するだけでなく、VNet 内の仮想マシンをはまたは egresses するトラフィックを完全に制御します。 また、DMZs (非武装地帯) などのシナリオを実現し、ユーザーがデータベースやアプリケーションサーバーなどのバックエンドサービスを緊密にセキュリティで保護できるようにすることもできます。


  &nbsp;

  <h2>ユースケースとシナリオ</h2>

  多層アプリケーションの構築は、クラウドでビジネスワークフローを実現するための一般的なパターンです。 通常、フロントエンド層のエンティティ (Web プロキシや DNS サーバーなど) は、インターネットに公開されている DMZ に配置されます。 アプリケーションサーバーやバックエンドインスタンスなど、他の層の機能は高いレベルのセキュリティを必要とするため、DMZ から分離されます。 これらの層は、フロントエンド内の特定のインスタンスからのトラフィックのみを受信し、通常はインターネットへの送信接続がありません。 ネットワークセキュリティグループを使用すると、これらの多層アプリケーションアーキテクチャを Azure でホストできます。


  次の図は、多層アプリケーションのデプロイの例を示しています。


  &nbsp;


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/30/DMZ.jpg"><img style="padding-top: 0px; padding-left: 0px; padding-right: 0px; border-width: 0px;" title="DMZ" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/DMZ_thumb.jpg" alt="DMZ" width="644" height="320" border="0" /></a>


  ネットワークセキュリティグループは、Azure で実行されているサービスとの間でやり取りされるネットワークトラフィックを制御します。 ネットワークセキュリティグループは、仮想ネットワーク内のサブネットにも適用できます。これにより、複数の Vm 間でアクセス制御規則の更新を管理するための効率的なメカニズムが提供されます。 数百または数千のコンピューターのアクセス制御規則は、VM に更新や変更を加えなくても、数秒で変更できます。


  イントラネットトラフィックをセグメント化するだけでなく、ネットワークセキュリティグループを使用して、インターネットとの間で送受信されるトラフィックを制御することもできます。 ユーザーは、単一のアクセス制御規則を使用して、サブネット全体に対してインターネットへの接続を拒否できます。


  &nbsp;

  <h2>VM とサブネットの Acl</h2>

  ネットワークセキュリティグループは、トラフィックフィルターを記述する一連のアクセス制御規則で構成されます。 これらは、仮想マシンまたは同じリージョン内のサブネットに関連付けることができます。 ネットワークセキュリティグループで定義されている規則は、フィルターとして機能します。 受信パスでは、トラフィックが VM に入る前に適用されます。 送信パスでは、トラフィックが VM から出た後に適用されます。 これらの規則は、ユーザープロセスや VM で実行されている OS では変更できないインフラストラクチャレベルで適用されます。 ネットワークセキュリティグループがサブネットに関連付けられている場合は、サブネット内のすべての Vm に適用されます。 ネットワークセキュリティグループに加えられた変更は、すぐにサブネット内のすべての Vm に適用されます。


  ネットワークセキュリティグループには、次のような重要な側面があります。

  <ul>
   <li>規則には、5つの組 (ソース IP、発信元ポート、接続先 IP、接続先ポート、プロトコル) が含まれています。</li>
   <li>規則はステートフルです。 つまり、ポートでのトラフィックを許可する受信規則 (ポート80など) がある場合、パケットを同じポートでフローさせるために、送信側の照合ルールは必要ありません。</li>
   <li>各ネットワークセキュリティグループには、Virtual Network およびインターネットへの発信アクセスで接続を許可する既定の規則が含まれています。 これらの既定の規則は、ユーザー規則によって上書きできます。</li>
   <li>ルールは、優先度に基づいて処理されます。 小さい (優先順位の高い) 値を持つ規則は、より大きい (つまり優先順位の低い) 値を持つ規則より先に処理されます。</li>
   <li>Azure には、インターネットや VIRTUAL_NETWORK などの既定のタグが用意されており、Virtual Network 外のパブリック IP アドレス空間と、ユーザーのネットワークアドレス空間全体を参照します。 タグは、アクセス制御規則の一部として使用できます。</li>
  </ul>

  &nbsp;


  ネットワークセキュリティグループは、VM またはサブネットに適用でき、場合によっては両方に適用できます。 サブネット内の Vm 間のトラフィックパターンが非常に異なる場合は、vm へのトラフィックを制御するための正確なルールを使用して、個々のネットワークセキュリティグループを VM に接続することをお勧めします。 サブネット内の Vm のトラフィックパターンが同じである場合 (通常はこの場合)、サブネット全体の受信と送信を管理するためのトラフィック制御ルールを持つサブネットにネットワークセキュリティグループをアタッチする方がよい場合があります。 場合によっては、2つのアプローチのハイブリッドが最適な場合がありますが、ほとんどのトラフィックが同じですが、1つまたは2つの細かい粒度制御が必要な場合です。


  &nbsp;


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/31/NSGRules.jpg"><img style="padding-top: 0px; padding-left: 0px; padding-right: 0px; border: 0px;" title="NSGRules" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/NSGRules_thumb.jpg" alt="NSGRules" width="532" height="484" border="0" /></a>


  上の図に示すように、受信パスでは、サブネットに接続されているネットワークセキュリティグループのルールが適用され、その後に VM に接続されているネットワークセキュリティグループのルールが適用されます。 これは、送信パスの逆になります。


  また、ネットワーク管理者が、VM のネットワークセキュリティグループの規則を記述するために、サブネットと開発者 (VM の所有者) のネットワークセキュリティグループの規則を定義することが適しています。


  &nbsp;

  <h2>制限</h2>

  ネットワークセキュリティグループは、VNet で実行されているサービスのネットワークトラフィックに対してきめ細かいアクセス制御を提供することを目指しています。この目標に合わせると、1つのサブスクリプションで最大100のネットワークセキュリティグループを持つことができ、各ネットワークセキュリティグループには最大200のルールが適用されます。 より多くのルールまたはグループを必要とする正規のユースケースがある場合は、Microsoft サポートに連絡することで制限を増やすことができます。


  ネットワークセキュリティグループは、リージョン VNet 内の Vm に対してのみ使用できます。他の相互運用性の項目については、以下の FAQ セクションを参照してください。


  &nbsp;

  <h2>使用</h2>

  現在、ネットワークセキュリティグループは、power shell と REST API によってのみ公開されています。


  &nbsp;

  <pre class="prettyprint">#Create a Network Security Group

  New-AzureNetworkSecurityGroup -Name "MyVNetSG" -Location uswest -Label "Security group for my Vnet in West US"


  #Add, Update Rules to a NSG

  Get-AzureNetworkSecurityGroup -Name "MyVNetSG" | Set-AzureNetworkSecurityRule -Name WEB -Type Inbound -Priority 100 -Action Allow -SourceAddressPrefix 'INTERNET'  -SourcePortRange '*' -DestinationAddressPrefix '*' -DestinationPortRange '*' -Protocol TCP


  #Delete a rule from NSG

  Get-AzureNetworkSecurityGroup -Name "MyVNetSG" | Remove-AzureNetworkSecurityRule -Name WEB


  #Associate a NSG to a Virtual machine

  Get-AzureVM -ServiceName "MyWebsite" -Name "Instance1" | Set-AzureNetworkSecurityGroupConfig -NetworkSecurityGroupName "MyVNetSG"


  #Remove a NSG from a VM

  Get-AzureVM -ServiceName "MyWebsite" -Name "Instance1" | Remove-AzureNetworkSecurityGroupConfig -NetworkSecurityGroupName "MyVNetSG"


  #Associate a NSG to a subnet

  Get-AzureNetworkSecurityGroup -Name "MyVNetSG" | Set-AzureNetworkSecurityGroupToSubnet -VirtualNetworkName 'VNetUSWest' -SubnetName 'FrontEndSubnet'


  #Remove a NSG from the subnet

  Get-AzureNetworkSecurityGroup -Name "MyVNetSG" | Remove-AzureNetworkSecurityGroupFromSubnet -VirtualNetworkName 'VNetUSWest' -SubnetName 'FrontEndSubnet'


  #Delete a NSG

  Remove-AzureNetworkSecurityGroup -Name "MyVNetSG"


  #Get Details of Network Secuirty group along with rules

  Get-AzureNetworkSecurityGroup -Name "MyVNetSG" -Detailed</pre>

  詳細については、MSDN のコンテンツを参照してください。


  &nbsp;

  <h2>よく寄せられる質問</h2>

  1. VM エンドポイントで既にエンドポイント Acl を使用しています。ネットワークセキュリティグループも使用できますか。

  <blockquote>いいえ、エンドポイント Acl またはネットワークセキュリティグループのいずれかを使用することはできません。 VM からエンドポイント Acl を削除し、VM をネットワークセキュリティグループに関連付けることができます。</blockquote>

  2. VM に複数の Nic がある場合、ネットワークセキュリティグループの規則はすべての Nic のトラフィックに適用されますか。

  <blockquote>いいえ。ネットワークセキュリティグループの規則は、プライマリ NIC のトラフィックにのみ適用されます。 今後は、ネットワークセキュリティグループを NIC に直接関連付ける機能を追加します。</blockquote>

  3. ネットワークセキュリティグループを作成しました。次のステップは何ですか?

  <blockquote>ネットワークセキュリティグループを作成したら、次のコマンドを実行して既定のルールを確認します。</blockquote>

  <pre class="prettyprint">Get-AzureNetworkSecurityGroup -Name "MyVNetSG" -Detailed</pre>

  <blockquote>これにより、既定の規則が表示されます。 次の手順として、ネットワークセキュリティグループを VM またはサブネットに関連付けます。 エンティティのネットワークトラフィックを制御するために、さらにルールを追加します。 ルールが数分以内に有効になることを確認します (通常は秒)。</blockquote>

  4. VM の RDP エンドポイントを定義しました。ネットワークセキュリティグループを使用していますか。インターネットから RDP ポートに接続するには、アクセス制御ルールが必要ですか?

  <blockquote>はい。ネットワークセキュリティグループの既定のルールでは、インターネットからのポートへのアクセスが許可されていません。ユーザーは、RDP トラフィックを許可するための特定のルールを作成する必要があります。</blockquote>
