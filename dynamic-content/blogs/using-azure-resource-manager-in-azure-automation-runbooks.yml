### YamlMime:Yaml
ms.openlocfilehash: 1ac1601b6f90f8473985a87931e41230cdc4de28
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896987"
Slug: using-azure-resource-manager-in-azure-automation-runbooks
Title: Azure Automation Runbook での Azure Resource Manager の使用
Summary: Azure Automation runbook での Azure Resource Manager 機能の使用に関する現在のベストプラクティスと、この分野での将来の計画について説明します。
Content: >-
  <p><strong>更新プログラム &nbsp; 5-12/7/2015 &nbsp; -Azure Automation で Azure Resource Manager PowerShell モジュールの出荷を開始しました。このブログ記事は現在最新ではありません。代わりに、 <a href="https://azure.microsoft.com/en-us/blog/announcing-azure-resource-manager-support-azure-automation-runbooks/">このブログ投稿</a> を参照してください。</strong><b></b></p>


  <p><strong>Update 1: &nbsp; </strong>現在、<a href="https://blog.davidebbo.com/2014/12/azure-service-principal.html" target="_blank">サービスプリンシパル</a>を使用して Azure Automation runbook からの Azure Resource Manager 認証を防止するバグがあります。 <a href="https://github.com/Azure/azure-powershell/issues/655" target="_blank">ここ</a>ではバグの状態に従うことができますが &nbsp; 、平均して<a href="https://azure.microsoft.com/blog/2014/08/27/azure-automation-authenticating-to-azure-using-azure-active-directory/" target="_blank">ユーザープリンシパル</a>が正常に動作するはずです。</p>


  <p><strong>更新プログラム 2: &nbsp; </strong>モジュールサイズの制限のために Azure portal から ARM モジュールをインポートするときに問題が発生した場合<font face="Calibri" size="3">は、制限値を大きくするまでは、使用しないサービス &rsquo; に対応するモジュール &nbsp; からフォルダーを削除し、モジュールがインポート &nbsp; に十分な大きさになるまで、.psd1 ファイルから &rsquo; これらのフォルダーへの参照を削除することが最善の回避策になり</font>ます。 <strong>更新プログラム</strong><b> <strong> 3</strong> - 10/13/2015</b> - これが修正されるようになりました。</p>


  <p><strong>更新プログラム 4-10/13/2015</strong> -Azure PowerShell チームは、 <a href="https://azure.microsoft.com/en-us/blog/azps-1-0-pre/">Azure PowerShell モジュール</a>を並行して動作するように更新し、Azure Automation でサイドバイサイドで使用できるようにしました。 新しい Azure PowerShell モジュールは、すぐにグローバルモジュールとして Azure Automation で出荷されますが、このブログ記事の指示に従って ARM コマンドレットで使用するための別の automation アカウントを設定するまでは、こちらの手順に従って、1つ &nbsp; の automation アカウントで azure (サービス管理) モジュールと azure (Resource Manager) モジュールを並べて使用できます。</p>


  <p>&nbsp;</p>


  <p><a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-overview/" target="_blank">Azure Resource Manager</a> (ARM) の多くの魅力的な機能により、多くのお客様は、Azure Automation runbook 内で<a href="https://msdn.microsoft.com/en-us/library/dn654592.aspx" target="_blank">ARM PowerShell コマンドレット</a>を利用する方法について質問しています。</p>


  <p>現時点では、 <a href="https://msdn.microsoft.com/en-us/library/azure/dn708504.aspx" target="_blank">Azure (サービス管理) powershell コマンド</a> レットと ARM powershell コマンドレットは、Azure Automation アカウント内では同時に機能しません。 このため、Azure Automation で ARM コマンドレットを使用するための現在のベストプラクティスは、個別の Automation アカウント (ARM 用と Azure PowerShell 用に1つ) を設定することです。 プロセスに ARM 機能と Azure サービス管理機能の両方が含まれている場合は、 <a href="https://msdn.microsoft.com/en-us/library/dn690259.aspx" target="_blank">start-azureautomationrunbook</a> コマンドレットを使用して、1つの automation アカウントの runbook で他の automation アカウントの runbook を開始できます (AZURE と ARM の両方の PowerShell モジュールで利用可能)。</p>


  <p>Azure PowerShell モジュールの代わりに ARM PowerShell モジュールを使用するように Automation アカウントを設定する方法の詳細についても説明しますが、これは Azure Automation で Azure Resource Manager と Azure サービス管理の両方の機能を使用できるようにするための一時的な方法であることを指摘します。 <b>単一の Automation アカウントで両方のモジュールをサイドバイサイドで使用できるという、より簡単で長期的なソリューションが登場 &ndash; しています。その提案に</b>ついて詳しくは<a href="https://github.com/Azure/azure-powershell/wiki/Deprecation-of-Switch-AzureMode-in-Azure-PowerShell" target="_blank">こちら</a>をご覧<b>ください。</b> この提案には Azure PowerShell コマンドレットの変更が含まれているので、フィードバックがある場合は、<a href="https://github.com/Azure/azure-powershell/issues/428" target="_blank">こちらで</a>既に開始されているディスカッションに投稿してください。</p>


  <p>現在、Azure Automation で Azure Resource Manager コマンドレットを使用する方法については、 &nbsp;</p>


  <h2>Azure Automation での Azure Resource Manager の設定</h2>


  <p>現在、Azure Automation は ARM コマンドレットに既定では付属していませんが、自分で簡単にインポートできます。 Azure Automation、runbook は、ローカル環境とは異なるセキュリティで保護されたサンドボックスで実行されます。 また、runbook をコンパイルするには、すべてのモジュールを読み込む必要があり、コンパイル後にアンロードすることはできません。 このため、Azure Resource Manager モジュールをそのようにインポートすると、Azure モジュールと Azure Resource Manager モジュールの両方がすべての runbook ジョブ &rsquo; の PowerShell セッションに読み込まれます。 このため、ローカル PowerShell の場合と同様に、Switch-AzureMode コマンドレットは Azure Automation では必要ありません。実際には、コマンドレットは機能しません。</p>


  <p>現在、Azure モジュールと ARM モジュールは同じ PowerShell セッションで実行するように構築されていないため、同じセッションで実行すると、競合や予期しない動作が発生する可能性があります。 したがって、現在のベストプラクティスとして、ARM 用と Azure PowerShell 用に個別の Automation アカウントを設定することをお勧めします。 &rsquo;その方法は次のとおりです。</p>


  <p>Azure Resource Manager の機能を想定した別の Automation アカウントを作成した後、 &rsquo; 既定では、各 automation アカウントに付属するグローバル Azure モジュールを上書きするように、Azure Resource Manager モジュールをインポートする必要があります。</p>


  <ol>
   <li>ローカルコンピューターに<a href="https://azure.microsoft.com/en-us/downloads/" style="line-height: 1.5;" target="_blank">Microsoft Azure PowerShell</a> &nbsp; をインストール &nbsp; する</li>
   <li>ARM PowerShell モジュールがインストール &ndash; されている Azure PowerShell ディレクトリ (通常は &nbsp; <i>C:\Program files (x86) \Microsoft SDKs\Azure\PowerShell\ResourceManager)</i>に移動します。</li>
   <li>AzureResourceManager フォルダーをデスクトップにコピーします。</li>
   <li>Azure にコピーした AzureResourceManager フォルダーの名前を &ldquo; 変更する&rdquo;</li>
   <li>このフォルダー内のモジュールマニフェストの名前を azureresourcemanager. .psd1 &rdquo; から &ldquo; .psd1 に &ldquo; 変更します。&rdquo;</li>
   <li>新しく名前を変更した Azure フォルダーを Zip 圧縮します。 名前 &ldquo; はAzure.zip&rdquo; で、Azure という &ldquo; 名前のフォルダーが1つ含まれている必要があります。&rdquo;</li>
   <li>Azure portal で、zip モジュールを (Azure サービス管理ではなく) ARM を使用する Azure Automation アカウントにインポートします。 <ul>
    <li>[資産]、[モジュール] の順に移動し、[モジュール &rdquo; のインポート] を選択 &ldquo; します (このボタンは、 <a href="https://portal.azure.com" target="_blank">Azure プレビューポータル</a>で再作成する &rsquo; 場合は [モジュール &rdquo; の追加] と呼ば &ldquo; れます)。</li>
    <li>メッセージが表示されたら、[はい] をクリック &ldquo; して既存の Azure モジュールを上書きします。&rdquo;</li>
   </ul>
   </li>
   <li>モジュールにインポートと抽出の時間を指定します。</li>
   <li>Azure &rdquo; モジュールをドリルダウン &ldquo; すると、モジュールがグローバル Azure (サービス管理) モジュールではなくなり、代わりに Azure Resource Manager モジュールであることがわかります。</li>
  </ol>


  <p>&nbsp; <b><img alt="Using Azure Resource Manager in Azure Automation Runbooks" border="0" height="408" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Untitled.png" style="border: 0px currentColor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block;" title="Azure Automation runbook " width="610"> </b> &nbsp; での Azure Resource Manager の使用 <b>Huzzah!</b> Azure Resource Manager モジュールを新しい Azure Automation アカウントにインポートしたので、PowerShell ISE で使用するのと同じ方法で、runbook の任意の ARM コマンドレットを使用できます (Switch-azuremode を使用する必要がない場合 &rsquo; を除く)。 Azure (サービス管理) の Automation アカウントから ARM 機能を使用する必要がある場合は、Azure モジュールの Start-AzureAutomationRunbook コマンドレットを使用して、ARM Automation アカウントで runbook を開始するだけです。 同様に、ARM Automation アカウントから Azure サービス管理機能を使用する必要がある場合は、ARM モジュールの Start-AzureAutomationRunbook コマンドレットを使用して、Azure (Service Management) Automation アカウントで runbook を開始するだけです。 &rsquo;忘れずに、Azure サービス管理の &rsquo; ような証明書認証がサポートされない Azure Resource Manager &rsquo; <a href="https://azure.microsoft.com/blog/2014/08/27/azure-automation-authenticating-to-azure-using-azure-active-directory/" target="_blank">は、Azure AD ユーザーまたはサービスプリンシパル</a>を使用して Azure Resource Manager に対する認証を行う必要があります。</p>


  <p>Azure Automation を使い始めたばかりですか? &nbsp;<a href="https://aka.ms/Q2p1ap" target="_blank">ここで</a>サービスについて説明し、 <a href="https://twitter.com/AzureAutomation" target="_blank">Twitter</a>の Azure Automation に従います。</p>


  <p>個人的なご連絡をお持ちですか? <a href="https://jodoglevy.com/" target="_blank">ブログ</a>で連絡するか、 <a href="https://twitter.com/jodoglevy" target="_blank">Twitter</a>でフォローしてください。</p>
