### YamlMime:Yaml
ms.openlocfilehash: f13122d77789107272902aef58e90def883bbafa
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895136"
Slug: devtest-sql-server-certification-on-windows-azure-virtual-machines-learnings-and-best-practices
Title: Windows Azure Virtual Machines の開発/テスト SQL Server 証明書–学習とベストプラクティス
Summary: 'エディターのメモ: この投稿は、arvind Ranasaria と &nbsp; Khalid によって &nbsp; 作成されました。  Windows Azure Virtual Machines サービスでの SQL Server 製品の認定の一環として、SQL Server エンジニアリングチーム...'
Content: '<p class="Publishwithline"><strong>エディターのメモ:</strong>この投稿は arvind Ranasaria と &nbsp; Khalid によって &nbsp; 作成されました。</p>  <p class="Publishwithline">Windows azure Virtual Machines サービスでの SQL Server 製品の認定の一環として、SQL Server エンジニアリングチームは、数週間の間 Windows Azure Virtual Machines で 100 &rsquo; のテストスイートを実行します。 さらに、ラボとインフラストラクチャの管理に使用される主要なチケットアプリケーションの1つをオンプレミスのサーバーから Azure Virtual Machines Windows 移行するために、並行して作業が行われていました。 これらの作業はいずれも、この作業で採用された重要な学習といくつかのベストプラクティスを強調表示しています。 SQL Server は Windows Azure Virtual machines で実行される重要なワークロードです。 このブログでは、学習のいくつかをまとめ、機能することを確認したいと思います。</p>  <p><strong>大規模な Vm のプロビジョニング/プロビジョニング解除</strong></p>  <p><strong></strong>Windows Azure Virtual Machines で SQL Server 認定を行っている場合、ラボでは、完全なテストの実行を完了するために、150 SQL サーバーと Windows vm の数十をプロビジョニングする必要があります。 このプロビジョニングは、カスタムツール &rsquo; の自動化によって行われます。 最も一般的なシナリオは、これらの Vm の数をプロビジョニングし、一連のテストとワークロードを実行して完了した後、Vm をいったん破棄し、次の実行用に再作成してから、ほとんどの場合、同じ VM 名を使用します。 これらの vm の大部分はバッチ化され、Windows Azure のクラウドサービスの制限に従って、現在の 50 vm によって異なるクラウドサービスに配置されます。</p>  <p>数回ラウンドした後、通常は成功率全体が50% で実行されるので、特に、一度に10個を超える Vm をバッチ処理する場合は、再試行メカニズムを追加しました。 これらのイベントのほとんどは、1つのストレージアカウントで実行されていることも重要です。 多くの Vm を大規模にプロビジョニングおよびプロビジョニング解除するためにシナリオでを呼び出す場合は、次のことをお勧めします。</p>  <ol>  <li>エラー409を検出して、再試行メカニズムを設定します。</li>  <li>複数のストレージアカウントに複数のデプロイを分散する (注: サブスクリプションあたりのストレージアカウントの既定の制限は10個で、サポートチケットを通じて増やすことができます)</li>  <li>高障害率が発生した場合は、プロビジョニング/プロビジョニング解除のための並列呼び出しの回数を減らしてみてください。これにより、同じストレージアカウントに移動する複数の操作のロックの競合を減らすことができます。 また、Vm のバッチは、一度に10個未満の推奨される Vm に限定します。</li>  </ol>  <p>この分野で Azure Windows の機能強化が行われており、今後数週間の間にこの分野で追加の結果と推奨事項をご提案します。</p>  <p><em>既知の制限事項: クラウドサービスごとにプロビジョニングされた Vm は、1つの時点で50です。</em></p>  <p><strong>Windows Update と Microsoft Update</strong></p>  <ul>  <li>SQL Server のギャラリーイメージは、既定では有効になって Windows Update。 事前設定された既定値: 毎日午前3時00分</li>  <li>SQL 自動的に更新されるようにするには、<a href="https://support.microsoft.com/kb/901037" target="_blank">ここ</a>でも Microsoft Update が有効になっ &ndash; ていることを確認します。 Microsoft Update は、今後のリリースで既定で有効になる場合があります。</li>  <li>一部の Windows の更新ではリセットが必要になるため、可用性セットに vm を設定し、各レプリカで異なる Windows update time を使用することを強くお勧めします。&nbsp;</li>  </ul>  <p><strong>サービスマスターキーの再生成 (SMK)</strong></p>  <p>すべてのデプロイで同じサービスマスターキーを使用しないようにするには、キーローテーションポリシーが必要です。</p>  <p><span style="text-decoration: underline;">推奨事項 1</span>: <em>サービスマスターキーの再生成を変更します。「</em> 新しいキーを生成する」に進んでください。</p>  <p><span style="text-decoration: underline;">Recommendation2</span>: これはリソースを大量に消費する操作です。要求が少ない期間中に実行します。</p>  <p>詳細については、<a href="https://technet.microsoft.com/en-us/library/ms189060.aspx" target="_blank">こちら</a>をご覧ください。 これにより、Azure での SQL Server の安全性が向上し、同じマスターキー &rsquo; を再利用することができなくなります。</p>  <p><strong>サブスクリプションとリソース管理</strong></p>  <p>複数のチームが使用する Azure サブスクリプションを共有していて、多くのリソースが組織全体で管理されることが予想される場合は、サブスクリプションを開く前に、いくつかのリソース計画を作成し、組織のプロセスガイダンスを提供することを強くお勧めします。 これにより、サブスクリプションの使用が正常であり、使用されていないリソースが多くなく、不要な容量に対して料金がかかる場合に、多くの時間を節約することができます。</p>  <p>詳細と、このトピックの推奨事項については、こちらのリンクを参照してください。</p>  <p><strong>VNet の構成に関する問題</strong></p>  <p><strong></strong>オンプレミスのチケットアプリケーションをリフトアンドシフトして Azure Virtual Machines サービスを Windows すると、VNet 構成に関していくつかの問題が発生しました。</p>  <ol>  <li>Web 層のマシンと SQL Server 層のコンピューターは、2つの異なる vnet 上にありました。 これらの各 vnet は、VPN デバイスを使用してオンプレミスネットワークに接続し、Azure 仮想ネットワーク機能を Windows しました。 これは、オンプレミスネットワークとの通信に対してより広い帯域幅を使用できるようにするために行われました。 ただし、これにより、Azure ネットワーク Windows 内の vm 間の通信に直接 vm を接続するのではなく、オンプレミスネットワークへのラウンドトリップを実行して、Sql 層のマシンに接続しています。</li>  <li>Windows Azure 仮想マシン環境のチケット発行アプリケーションは、1つのチケット発行システムから別のチケットシステムにチケットを移動するために、サーバー (Server1 など) と通信する必要があります。 オンプレミスネットワークに接続されている vnet の構成中に、Windows Azure 環境の VNet 内の vm から到達できるオンプレミスのサブネットの一覧を指定する必要があります。 サーバー Server1 をホストしていたサブネットがこの一覧から除外されたため、アプリケーションが完全に機能していませんでした。 この解決策では、vnet および Vnet にデプロイされているすべての Vm の再構成が必要でした。</li>  </ol>  <p>上記のいずれの問題でも、Vm と Vnet の再展開が必要でした。 残念ながら、Vnet への変更は、現在オンラインでは実行できません。 そのため、vnet のレイアウトを慎重に計画し、Windows Azure の vm から到達できる必要があるオンプレミスのすべてのサブネットが vnet の構成に含まれていることを確認することをお勧めします。</p>  <p><strong>COPY BLOB API を使用したシステムディスクのバックアップ/復元</strong></p>  <p>SharePoint、ドメインコントローラー、web フロント、アプリサーバーなどを使用して HA 環境で SQL Server を実行するために必要な複数の vm を必要とするデプロイがある場合。運用環境を維持するには、これらのマシンを展開した後にバックアップすることが重要です。</p>  <p><strong>VM のウォームアップフェーズ</strong></p>  <p>VM が最初に新しいホストコンピューターで起動すると、ローカル VM キャッシュが構築されるまでに少し時間がかかります。 このフェーズでは、VM が完全に実行されるまで、vm のパフォーマンスが非常に低くなり、UI エクスペリエンスが非常に遅くなる可能性があります。 これを緩和するための推奨事項は、実行中の VM が運用環境で実行される一般的な関数を実行して、VM をウォームアップすることです。</p>  <p><strong>一部の VPN デバイスでパケットの並べ替えに関する問題が発生しています。</strong></p>  <p>一部の VPN デバイスには、既定で TCP パケットの並べ替えを行うセキュリティ設定が付属しています。 オンプレミスネットワークで IPSec が構成されている場合、この設定によって問題が発生し、TCP パケットの並べ替えが不要になり、電源をオフにする必要があります。</p>  <p><strong> 形式</strong></p>  <p><a href="https://msdn.microsoft.com/en-us/library/jj823132.aspx" target="_blank">Windows Azure 仮想マシン内の SQL Server</a></p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>  <p>&nbsp;</p>'
