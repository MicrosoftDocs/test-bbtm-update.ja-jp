### YamlMime:Yaml
ms.openlocfilehash: 7231e8c46fe8a8a522d715a9bdd9b48c6b622917
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890596"
Slug: wordpress-with-memcached-on-azure-websites
Title: Azure Web サイトでの Memcached を使用した WordPress
Summary: Azure Web サイト サービスで実行されている WordPress Web サイトのパフォーマンスを向上させる必要がありますか? "はい" の場合、必要なのは、Web サイトの高速化に役立つキャッシュです。 Web サイトが大きくなる場合...
Content: >-
  Azure Web サイト サービスで実行されている WordPress Web サイトのパフォーマンスを向上させる必要がありますか? "はい" の場合、必要なのは、Web サイトの高速化に役立つキャッシュです。 Web サイトでトラフィックが多い場合は、何らかの形式の分散メモリ キャッシュ メカニズムを設定するのが最適です。


  <strong>Memcached は</strong> 、汎用の分散メモリ キャッシュ システムです。 多くの場合、外部データ ソース (データベースや API など) を読み取る必要がある回数を減らすために、RAM にデータとオブジェクトをキャッシュすることで、動的なデータベース駆動型 Web サイトを高速化するために使用されます。 Memcached システムでは、クライアントとサーバーのアーキテクチャが使用されます。 Web サイトになるクライアントは、クライアント側ライブラリ (この場合は PECL memcached ライブラリ) を使用して、ポート 11211 でサービスを公開するサーバーに接続します。 各クライアントは、すべてのサーバーを知っています。サーバーは相互に通信しません。


  クライアントが特定のキーに対応する値を設定または読み取る場合、クライアントのライブラリは最初にキーのハッシュを計算して、使用するサーバーを決定します。 その後、そのサーバーに接続します。 サーバーは、キーの 2 番目のハッシュを計算して、対応する値を格納または読み取る場所を決定します。


  Memcached クライアントは、memcached サーバーを一時キャッシュとして扱う必要があります。Memcached に格納されているデータが、必要なときにまだ存在すると想定することはできません。 <em>MemcacheDB、Couchbase Server、</em><em>Couch、および他</em>のデータベース サーバーは、Memcached プロトコルの互換性を維持しながら永続的なストレージを提供します。


  このチュートリアルで学習する内容は次のとおりです。

  <ul>
   <li>Azure Ubuntu VM で Memcached サーバーをセットアップする</li>
   <li>Memcached を使用して WordPress サイトを構成する</li>
  </ul>

  <h4><strong>Azure VM での Memcached のセットアップ </strong></h4>

  Azure 管理ポータルにログインし、Ubuntu VM を作成します。 詳細については、「仮想マシン ギャラリー <a href="https://azure.microsoft.com/en-us/manage/linux/tutorials/virtual-machine-from-gallery/">から Linux VM を作成する方法」を参照してください</a> 。 Azure アカウントをお持ちではない場合は、30 日間の無料<a href="https://azure.microsoft.com/en-us/pricing/free-trial/">試用版 (Azure</a> リソースの 200 ドルWindows試してください)。


  Ubuntu VM にアクセスするには、Putty などの SSH クライアントを <a href="https://www.putty.org/">インストールします</a>。 詳細については、「 <a href="https://azure.microsoft.com/en-us/manage/linux/how-to-guides/ssh-into-linux/">Linux VM に SSH 接続する方法」を参照してください</a> 。 putty クライアントを開き、VM 名を入力します (例: <strong>memcachesrv.cloudapp.net 開く</strong>)<strong></strong>


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8272.graphic.png-550x526.png"><img class="alignnone  wp-image-132481" alt="8272.graphic.png-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8272.graphic.png-550x526.png" width="495" height="477" /></a>


  &nbsp;


  マシン管理者ユーザー (この場合は <strong><em>azureuser</em></strong>) を使用してログインした後、次のコマンドを実行して、ルート ユーザー特権を持つ Linux シェルを起動し、既存のリポジトリから最新バージョンのパッケージとその VM への依存関係にパッケージ 一覧をダウンロード/更新します (図 2 を参照)


  <span style="font-family: courier new,courier;">sudo -s</span>


  <span style="font-family: courier new,courier;">apt-get update</span>


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4377.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img2.PNG-550x526.png"><img class="alignnone  wp-image-132471" alt="4377.Sunitha Muthukrishna - WordPress with Memcached on Azure websites-img2.PNG-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4377.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img2.PNG-550x526.png" width="550" height="474" /></a>


  既定では、ポート 11211 はブロックされます。 このポートを開くには、 <em>Azure 管理</em> ポータルにログインして VM のダッシュボードにアクセスする必要があります。 [エンドポイント <strong>] をクリック</strong> し、ポート 11211 の新しいエンドポイントを追加します。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1385.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img3.png-550x526.png"><img class="alignnone  wp-image-132461" alt="1385.Sunitha Muthukrishna - WordPress with Memcached on Azure websites-img3.png-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1385.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img3.png-550x526.png" width="550" height="507" /></a>

  <h4>Memcached をインストールする</h4>

  memcached のインストールには、いくつかの手順が必要です。開始するには、 <strong>apt-get を使用して memcached をインストールします</strong>。


  <span style="line-height: 125%; font-family: 'Courier New'; font-size: 10pt;">sudo apt-get install memcached</span>


  &nbsp;


  サーバーにコンパイラがインストールされていない場合は、memcached をインストールするために <strong>build-essential</strong> をダウンロードできます。


  <span style="font-family: courier new,courier;">sudo apt-get install build-essential</span>


  &nbsp;


  次のコマンドを使用して、<em>memcached 構成ファイル (memcached.conf</em>) を編集します。


  <span style="line-height: 125%; font-family: 'Courier New'; font-size: 10pt;">sudo nano /etc/memcached.conf </span>


  35 行目の前に # を追加して、行をコメント アウトします


  <span style="font-family: courier new,courier;">-l 127.0.0.1</span>


  <strong>Memcached を使用して WordPress を構成する </strong>

  <ul>
   <li>FTP を使用してサイトにアクセスします。</li>
   <li>bin フォルダー <strong>を作成 </strong>します。</li>
   <li>memcached PECL 拡張機能をこちら からダウンロードして <a href="https://windows.php.net/downloads/pecl/releases/memcache/3.0.8/php_memcache-3.0.8-5.4-nts-vc9-x86.zip">コピーします</a> 。 この拡張機能は PHP5.4 (32 ビット) 用です。 Web サイトで別の構成を使用している場合は、ここから適切な DLL を選択 <a href="https://pecl.php.net/package/memcache/3.0.8/windows">します</a></li>
   <li>管理ポータルにログインして、WordPress Web サイトの構成を更新します。 [構成] <strong>の [アプリ設定</strong> ] <strong>セクションで</strong>、次の設定を行います。</li>
  </ul>

  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4617.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img4.png-550x526.png"><img class="alignnone  wp-image-132451" alt="4617.Sunitha Muthukrishna - WordPress with Memcached on Azure websites-img4.png-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4617.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img4.png-550x526.png" width="550" height="117" /></a>

  <ul>
   <li>このリンク <strong><em>から Memcached オブジェクト キャッシュ プラグイン</em></strong> をダウンロード <a href="https://wordpress.org/plugins/memcached/">します</a></li>
   <li><strong>object-cache.php を</strong> <strong>wp-content フォルダーにコピー</strong>します。</li>
   <li><strong>wp-config.php file で memcached サーバーの詳細を指定</strong>します。</li>
  </ul>

  <span style="font-family: courier new,courier;">/* の上に似たものを追加します。すべてです。編集を停止してください。幸せなブログ。 </span>


  <span style="font-family: courier new,courier;">*/</span>


  <span style="font-family: courier new,courier;">$memcached_servers = array(</span>


  <span style="font-family: courier new,courier;">            'default' =&gt; array('memcachesrv.cloudapp.net:11211' )</span>


  <span style="font-family: courier new,courier;">);</span>

  <ul>
   <li><strong><em>ここから、バトキャッシュ プラグインを</em></strong>ダウンロード<a href="https://wordpress.org/plugins/batcache/">します</a></li>
   <li>アップロード <strong>advanced-cache.php を </strong><strong>wp-content ディレクトリに移動</strong>します</li>
   <li>ファイルの先頭にある <strong>wp-config.php</strong> ファイルに次の行を追加します</li>
  </ul>

  <span style="font-family: courier new,courier;"> define('WP_CACHE',true);</span>

  <h4><strong>キャッシュが動作している場合のテスト方法</strong></h4>

  ホーム ページを 2 回以上再度読み込み、HTML ソースを表示して、キャッシュが機能するかどうかをテストします。 最初の読み込み時に、/head 終了タグを justabove &lt;&gt; すると、次のようなコメントが表示されます。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2235.Screenshot-1.png-550x526.png"><img class="alignnone  wp-image-132441" alt="2235.Screenshot 1.png-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2235.Screenshot-1.png-550x526.png" width="410" height="44" /></a>


  WordPress ページを数回更新すると、ページがキャッシュから読み込まれたことを示すコメントが変更されます。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1830.Screenshot-2.png-550x526.png"><img class="alignnone  wp-image-132431" alt="1830.Screenshot 2.png-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1830.Screenshot-2.png-550x526.png" width="335" height="90" /></a>

  <h4><strong>Memcache サーバーの統計情報を確認する </strong></h4>

  memcached サーバーを定期的に追跡して、サーバーの状態を把握することを強くお勧めします。これを行う方法を次に示します。

  <ol>
   <li>"apt-get update" コマンドを実行した場合は、Ubuntu VM で既に使用できる netcat ユーティリティを使用できます。 ポート 11211 でリッスンしている memcached サーバーのコマンド "stats" と共に Netcat を実行すると、memcached サーバーの状態が表示されます。</li>
  </ol>

  <span style="font-family: courier new,courier;"> echo "stats" |nc memcachesrv.cloudapp.net 11211</span>


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4682.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img5.PNG-550x526.png"><img class="alignnone  wp-image-132421" alt="4682.Sunitha Muthukrishna - WordPress with Memcached on Azure websites-img5.PNG-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4682.Sunitha-Muthukrishna-WordPress-with-Memcached-on-Azure-websites-img5.PNG-550x526.png" width="401" height="526" /></a>


  &nbsp;


  2. watch コマンドを使用 <a href="https://en.wikipedia.org/wiki/Watch_(Unix)">すると</a> 、2 秒ごとに状態を確認し、状態を一覧表示できます


  <code>             watch "echo stats <span style="font-family: courier new,courier;">|</span></code><span style="font-family: courier new,courier;">nc memcachesrv.cloudapp.net 11211<code>"</code></span>


  3. プログラムでこれを行うには、PHP memcached 拡張機能の <a href="https://www.php.net/manual/en/memcache.getstats.php">Memcache::getStats ()</a> API を呼び出します。


  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6557.new-image.png-550x526.png"><img class="alignnone  wp-image-132411" alt="6557.new image.png-550x526" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6557.new-image.png-550x526.png" width="550" height="114" /></a>

  <h4><strong>Future Reading </strong></h4>

  <ul>
   <li><a href="https://memcached.org/">Memcached</a></li>
   <li><a href="https://www.php.net/manual/en/class.memcache.php">PHP Memcache クラス</a></li>
   <li>NetCat ユーティリティ (Linux)</li>
   <li><a href="https://pecl.php.net/package/memcache/3.0.8/windows">Memcache 用 PECL パッケージ (Windows)</a></li>
  </ul>

  &nbsp;


  &nbsp;


  &nbsp;


  &nbsp;
