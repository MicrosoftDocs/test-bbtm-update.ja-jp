### YamlMime:Yaml
ms.openlocfilehash: 27a8a0c3329da53cba7a9ce97a7c14277981513d
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892140"
Slug: step-through-creating-resource-manager-virtual-machine-powershell
Title: PowerShell を使用して Resource Manager ベースの Azure 仮想マシンを作成する手順
Summary: PowerShell を使用して、Resource Manager ベースの仮想マシンを作成および事前構成します。
Content: "<p>Azure サービス管理では、仮想マシンの作成に関連する多くの機能 (ネットワークインターフェイスカードの作成や、Azure に格納されているディスクファイルの名前の指定など) が自動的に自動化されます。 Azure Resource Manager では、Resource Manager ベースの仮想マシンを手動で構築する際に、新しい仮想マシンを構築するときに、コンピューティング、ネットワーク、およびストレージの各コンポーネントを個別に考慮する必要があります。 たとえば、Azure Resource Manager テンプレートを使用して Resource Manager ベースの仮想マシンを作成する場合、テンプレートには、すべてのコンピューティング、ネットワーク、およびストレージリソースをまとめて作成し、関連付けるための手順が含まれています。 Azure PowerShell を使用して resource manager ベースの仮想マシンを作成する場合は、必要なリソースを正しい順序で要求する resource manager ベースの PowerShell コマンドのセットを構築する必要があります。 「 <a href=\"https://azure.microsoft.com/documentation/articles/virtual-machines-ps-create-preconfigure-windows-resource-manager-vms/\">resource manager での Windows 仮想マシンの作成と事前</a>構成」と「Azure PowerShell」の記事では、resource manager ベースの仮想マシン用の PowerShell コマンドセットを構築するプロセスについて説明しています。 このプロセスには、次の要素が含まれます。</p>\n\n<ul>\n    <li>リソースグループ (必須)</li>\n    <li>ストレージアカウント (必須)</li>\n    <li>仮想ネットワーク (必須)</li>\n    <li>可用性セット (オプション)</li>\n    <li>ネットワークインターフェイスカード (NIC) とパブリック IP アドレス (両方必要)</li>\n    <li>DNS ドメイン名ラベル (省略可能)</li>\n    <li>追加のデータディスク (オプション)</li>\n    <li>Azure 仮想マシンイメージの発行元、プラン、および SKU (必須)</li>\n    <li>オペレーティングシステムのディスク名 (必須)</li>\n</ul>\n\n<p>次に示すのは、仮想マシンに対して上記の要素を使用して作成された、結果として得られる PowerShell コマンドセットです。</p>\n\n<ul>\n    <li>既存の LOBServers リソースグループに存在する</li>\n    <li>Windows Server 2012 R2 Datacenter イメージを使用する</li>\n    <li>の名前は LOB07 で、既存の WEB_AS 可用性セットに含まれています。</li>\n    <li>既存の AZDatacenter 仮想ネットワークの FrontEnd サブネット (サブネット インデックス 0) 内のパブリック IP アドレスを持つ NIC がある</li>\n    <li>200 GB の追加データ ディスク容量</li>\n</ul>\n\n<p>注: このブログ投稿には Azure PowerShell 0.9.8 と以前のバージョンのコマンドが含まれています。 Azure PowerShell 1.0 Preview でこれらのコマンドを使用するには、 <strong>switch-azuremode azureresourcemanager</strong>コマンドを削除し、-Azure &quot; のすべての &quot; インスタンスを-azurerm &quot; に &quot; 変更します。 詳細については、「 <a href=\"https://azure.microsoft.com/blog/azps-1-0-pre/\">Azure PowerShell 1.0 Preview</a>」を参照してください。</p>\n\n<p>&nbsp;</p>\n\n<pre class=\"prettyprint\">\n# Switch to the Resource Manager mode   \nSwitch-AzureMode AzureResourceManager\n\n# Set values for existing resource group and storage account names\n$rgName=&quot;LOBServers&quot;\n$locName=&quot;West US&quot;\n$saName=&quot;contosoLOBServersSA&quot;\n\n# Set the existing virtual network and subnet index\n$vnetName=&quot;AZDatacenter&quot;\n$subnetIndex=0\n$vnet=Get-AzurevirtualNetwork -Name $vnetName -ResourceGroupName $rgName\n\n# Create the NIC\n$nicName=&quot;AzureInterface&quot;\n$domName=&quot;contoso-vm-lob07&quot;\n$pip=New-AzurePublicIpAddress -Name $nicName -ResourceGroupName $rgName -DomainNameLabel $domName -Location $locName -AllocationMethod Dynamic\n$nic=New-AzureNetworkInterface -Name $nicName -ResourceGroupName $rgName -Location $locName -SubnetId $vnet.Subnets[$subnetIndex].Id -PublicIpAddressId $pip.Id\n\n# Specify the name, size, and existing availability set\n$vmName=&quot;LOB07&quot;\n$vmSize=&quot;Standard_A3&quot;\n$avName=&quot;WEB_AS&quot;\n$avSet=Get-AzureAvailabilitySet &ndash;Name $avName &ndash;ResourceGroupName $rgName\n$vm=New-AzureVMConfig -VMName $vmName -VMSize $vmSize -AvailabilitySetId $avset.Id\n\n# Add a 200 GB additional data disk\n$diskSize=200\n$diskLabel=&quot;APPStorage&quot;\n$diskName=&quot;21050529-DISK02&quot;\n$storageAcc=Get-AzureStorageAccount -ResourceGroupName $rgName -Name $saName\n$vhdURI=$storageAcc.PrimaryEndpoints.Blob.ToString() + &quot;vhds/&quot; + $vmName + $diskName  + &quot;.vhd&quot;\nAdd-AzureVMDataDisk -VM $vm -Name $diskLabel -DiskSizeInGB $diskSize -VhdUri $vhdURI -CreateOption empty\n\n# Specify the image and local administrator account, and then add the NIC\n$pubName=&quot;MicrosoftWindowsServer&quot;\n$offerName=&quot;WindowsServer&quot;\n$skuName=&quot;2012-R2-Datacenter&quot;\n$cred=Get-Credential -Message &quot;Type the name and password of the local administrator account.&quot; \n$vm=Set-AzureVMOperatingSystem -VM $vm -Windows -ComputerName $vmName -Credential $cred -ProvisionVMAgent -EnableAutoUpdate\n$vm=Set-AzureVMSourceImage -VM $vm -PublisherName $pubName -Offer $offerName -Skus $skuName -Version &quot;latest&quot;\n$vm=Add-AzureVMNetworkInterface -VM $vm -Id $nic.Id\n\n# Specify the OS disk name and create the VM\n$diskName=&quot;OSDisk&quot;\n$storageAcc=Get-AzureStorageAccount -ResourceGroupName $rgName -Name $saName\n$osDiskUri=$storageAcc.PrimaryEndpoints.Blob.ToString() + &quot;vhds/&quot; + $vmName + $diskName  + &quot;.vhd&quot;\n$vm=Set-AzureVMOSDisk -VM $vm -Name $diskName -VhdUri $osDiskUri -CreateOption fromImage\nNew-AzureVM -ResourceGroupName $rgName -Location $locName -VM $vm\n</pre>\n\n<p>再作成する VM のコマンドセットを作成したら、それを PowerShell スクリプトファイル (* .ps1) として保存することができます。 それではお楽しみください。</p>"
