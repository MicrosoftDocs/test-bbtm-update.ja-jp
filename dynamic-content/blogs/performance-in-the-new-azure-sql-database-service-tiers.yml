### YamlMime:Yaml
ms.openlocfilehash: f0f05db50e512c62239c75cca4034cb9b8f68305
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891413"
Slug: performance-in-the-new-azure-sql-database-service-tiers
Title: 新しい Azure SQL Database サービスレベルのパフォーマンス
Summary: 4月24日に、新しいサービス階層のプレビュー (Basic と Standard) が導入され、SQL Database と新しいビジネス継続性機能も導入されました。 このブログの投稿では、新しい...
Content: >-
  4月24日に、新しいサービス階層のプレビュー (Basic と Standard) が導入され、SQL Database と新しいビジネス継続性機能も導入されました。 このブログ投稿では、SQL Database の新しいパフォーマンスアプローチについて詳しく見ていきます。


  それでは、最初に変更を行う必要があります。 新しいサービスレベルでのパフォーマンスと、特に予測可能<b></b>なパフォーマンスに重点を置いているのは、Web および Business における SQL Database のパフォーマンスについてのお客様からのフィードバックです。 Web およびビジネス層でのパフォーマンスは、従来は予測不可能であり、ビジネスに不可欠なアプリケーションを実行しているお客様にとって問題が生じます。 予測可能なパフォーマンスが非常に重要であることをお客様が理解しています。 時間の経過と共にプラットフォームのパフォーマンスに依存できない場合は、プラットフォームで確実に実行できるシステムを構築するのは非常に困難です。


  このフィードバックへの回答として、プレミアムに参加するための Basic と Standard が導入されました。これは、2013年7月以降のプレビュー段階であり、主に、予測可能なパフォーマンスの実現に重点を置いています。 プレミアムのパフォーマンスについてのお客様からのフィードバックが overwhelmingly ています。Basic と Standard では、この特典を追加の価格ポイントでお客様に拡張します。 お客様は、制御できるレバーとしてのパフォーマンスを持ち、クラウドコンピューティング業界と連携しています。 このレバーは、"price/storage" の Web &amp; ビジネスサービスモデルから "price/performance plus features" の新しいモデルに移行するための主要なドライバーです。


  新しいサービスレベルでアプリケーションをテストするときは、現在プレビュー段階にあることに注意してください。これには、新しいパフォーマンスエクスペリエンスの継続的な微調整が含まれます。 プレビューを使用してフィードバックを注意深く聞き、このフィードバックを使用して新しいサービス階層を作成します。 パフォーマンステストを実行する場合は、これらを定期的に再実行して、新しいサービス階層で使用できるさまざまなパフォーマンスレベルを十分に理解していることを確認してください。 プレビューの進行に合わせて、インクリメンタルパフォーマンスブログを投稿することをお勧めします。


  <b>実際、お客様からのフィードバックに基づいて、月曜日5月19日の週にオンラインになる Basic レベルと Standard レベルのスループットが改善されました。</b>

  <ul>
   <li>Basic: 1 DTU – &gt; <b>5 dtu</b></li>
   <li>S1: 5 DTU – &gt; <b>15 dtu</b></li>
   <li>S2:25 DTU ~ &gt; <b>50 dtu</b></li>
  </ul>

  <h1>パフォーマンスによってどのような意味があるのでしょうか。</h1>

  データベースのパフォーマンスは複雑な主題であり、多くの場合、状況の状態を示すために多くのメトリックが使用されます。 アプリケーションの観点から見ると、ユーザーは次のことに注意してください。

  <ul>
   <li><b>応答時間</b>
  <ul>
   <li>特定のクエリ実行の開始から終了までの経過時間。</li>
  </ul>

  </li>
   <li><b>処理</b>
  <ul>
   <li>任意の時点でシステムが実行できる総作業時間または実行率。 スループットレートは、通常、個々の実行が指定された応答時間内に終了する場合にのみ有効と見なされます。</li>
  </ul>

  </li>

  </ul>

  応答時間とスループットに影響する要因は多数ありますが、主に2つのカテゴリ、アプリケーション設計、ハードウェアリソースに分割されます。 次に、データベースアプリケーションのパフォーマンスに関するトラブルシューティングを行うときによく寄せられる質問の例をいくつか示します。

  <ul>
   <li><b>アプリケーションの設計</b>
  <ul>
   <li>クエリの実行に最適なプラットフォームを提供するために、適切なインデックスセットが作成されていることを確認してください。</li>
   <li>適切なトランザクション分離レベルが使用されています。ロックされたリソースを待機しているシステムは不要ですか?</li>
   <li>複数ステートメントのバッチやストアドプロシージャを使用するなど、ラウンドトリップが最小化されているかどうか。</li>
  </ul>

  </li>
   <li><b>ハードウェアリソース</b>
  <ul>
   <li>ワークロードを実行するために使用できるリソースが十分にあるか。</li>
   <li>時間の経過と共に発生するさまざまな種類のワークロードに必要なリソースの量を確認できます。</li>
  </ul>

  </li>

  </ul>

  パフォーマンスに関しては、新しい SQL Database サービスレベルを使用して、お客様がより多くのハードウェアリソースを提供するパフォーマンスレベルにアップグレードできるようにすることで、ハードウェアリソースに関連する問題を解決することができます。 スケールアウトデザインパターン (シャーディング) を使用している場合は、新しいパフォーマンスレベルを使用して、ワークロードの配分に応じて、さまざまなシャードに提供されるリソースを変化させることができます (たとえば、高アクティブな顧客を含むシャードに高いパフォーマンスレベルを割り当てるなど)。 この問題を解決するために、シャーディングの詳細なガイダンスに積極的に取り組んでいます。引き続きご利用ください。


  さらに、クラウド設計のベストプラクティスとして、アプリケーションの設計の最適化を継続することをお勧めします。 これらの投資によって、より高いパフォーマンスレベルを使用する必要性が軽減され、データベースワークロードを実行するためのコストを削減できます。

  <h1>ハードウェア仕様について</h1>

  データベースワークロードを実行するために必要なリソースは、CPU、ディスク IO 操作 (読み取り/書き込み)、メモリなど、さまざまな種類のハードウェアリソースに要約されています。 これらの各リソースディメンション内には、大きな違いがあります。 たとえば、さまざまな種類のコアのクロックサイクルとキャッシュサイズが異なるため、データベースシステムの動作に応じて、さまざまなサイズで IOs が実行されます。 アプリケーションが実際に必要とするリソースの量を推定し、時間の経過と共に使用状況を比較することは、困難で時間のかかる作業になる可能性があります。 オンプレミスの環境では、これは、データベースが実行されているハードウェア経由での制御の結果として受け入れられます。 クラウドへの移行の引力、特に SQL Database を使用することは、ハードウェアや修正プログラムの管理やデータベースソフトウェアの管理を必要とせずに、優れたアプリケーションの構築に専念できることです。 お客様は面倒なことを望んでおらず、必要なときにのみスループットを必要としています。 これは、新しいパフォーマンスに重点を置いたビジョンです。


  新しいサービスレベルでは、予測可能なパフォーマンスの確保に役立つ新しい設計原則が適用されています。 各パフォーマンスレベル (Basic、S1、S2、P1、P2、P3) は、一連のリソース (CPU、メモリ、IO など) の割り当てに対応しています。 各レベルでデータベースが使用できるリソースの最大量が定義されています。 設計原則として、データベースのパフォーマンスは、パフォーマンスレベル用に提供されているものと同じリソースのセットを持つ専用のコンピューター上で実行されていた場合に、そのパフォーマンスが達成されるおおよそのものである必要があります。 この設計原則は、予測可能なパフォーマンスを実現するための基礎となります。


  さまざまなレベルのリソースの違いを理解するために、データベーススループットユニット (DTU) の概念が導入されました。 DTU は、各パフォーマンスレベルで割り当てられたリソースを組み合わせた指標です。 たとえば、P1 には100という DTU 評価があり、S1 の DTU は15となります。つまり、S1 は P1 のリソースの約 1/7 になります。 前に説明した設計の原則に従うと、S1 で実行されているデータベースのパフォーマンスレベルは、CPU が約 1/7 で、メモリが約 1/7 で、メモリが最大で 1/7 で、IO 容量が約 1/7 であることが前提となります。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/05/1.png"><img class="alignnone size-medium wp-image-146271" style="width: 625px; height: 434px;" alt="1" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1-469x369.png" width="469" height="369" /></a>


  ユーザーとトラブルシューティングの観点からは、データベースワークロードが各リソースディメンションで使用している現在のパフォーマンスレベルの割合を明らかにして、さまざまな種類の IOs やディスクキューの長さなどを理解する必要がなくなります。これにより、現在のパフォーマンスレベルと比較して、リソースの使用量を簡単に把握できるようになります。


  CPU 間の使用状況に関するテレメトリを公開し、master データベースの<i>sys.resource_stats</i>ビューで書き込みを読み取り &amp; ます。メモリは、後でプレビューで追加されます。 このビューには、各ディメンションの5分間の平均 (合計使用量/5 分) が含まれており、時間の経過に伴うリソース要件を測定するのに役立ちます。 このテレメトリは、ポータルからも利用できます。 クエリ <i>sys.resource_stats</i> の詳細と、使用されている dtu の推定については、 <a href="https://msdn.microsoft.com/en-us/library/dn369873.aspx">この</a> MSDN の記事を参照してください。新しいサービスレベルに関する情報が提供されます。


  パフォーマンスのトラブルシューティングを行うための優れたテレメトリのストーリーを提供することは重要であり、プレビュー期間中はこれをさらに改善することを期待できます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/05/clip_image002_thumb.png"><img class="alignnone size-medium wp-image-146241" alt="clip_image002_thumb.png" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image002_thumb-636x364.png" width="636" height="364" /></a>

  <h3></h3>

  <h1>データベースワークロードのライフサイクル</h1>

  "データベースを使用する" 操作は1つのアクションではなく、さまざまな種類のアクションで構成されています。 これは明らかに見えるかもしれませんが、データベースに適したパフォーマンスレベルと、その結果、データベースのワークロードを実行するために必要なパフォーマンスレベルを計算するときに重要になります。 回答は、"<b>Standard S2</b> @ $ 200/month" (GA 価格を使用) ほど単純ではありません。 クラウドと特に SQL Database によってもたらされる優れた点の1つは、柔軟なスケールを実現できることです。 次のように、スパースクエリには <b>Basic、</b> Mon-Thu、および Sat &amp; を使用し、金曜日は <b>S2</b> を使用して、指定された時間枠で実行される大規模なバッチジョブを管理し、1日に1日に、大規模な ETL 操作を迅速に実行するために <b>P1 </b>を使用します。

  <ul>
   <li>(Basic 価格/30 * 25) = $4.16</li>
   <li>(S2 価格/30 * 4) = $26.7</li>
   <li>(P1 price/30 * 1) = $31 <b>$ 61.86/month</b>"</li>
  </ul>

  上の例と同じように、多くのデータベースのワークロードライフサイクルには、さまざまな要件を持つ異なるサブワークロードが含まれます。次に例を示します。

  <ul>
   <li>データベースの初期読み込み (たとえば、SQL Database に移動する場合)</li>
   <li>通常の使用状況 (たとえば、通常の稼働日にアプリを使用する1つの部門のユーザーアクティビティ)</li>
   <li>ピーク時の使用量 (たとえば、会社全体のすべての従業員のレポートを1か月に1回処理した場合など)</li>
   <li>大規模抽出変換 &amp; の読み込み (ETL または Import/Export) 操作</li>
   <li>物理的なデータベースメンテナンス操作 (インデックスの作成など)</li>
  </ul>

  ワークロードをさまざまな要件に分類する場合、ピーク時の負荷に必要なパフォーマンスレベルで常に実行されているとは限りません。


  アプリケーションコードでは、新しい<i>サービス目標</i>を指定する単純な<a href="https://msdn.microsoft.com/en-US/library/azure/dn505718"><i>Update Database API</i></a>呼び出しによって、必要に応じてパフォーマンスレベルを変更できます。 変更自体は非同期操作であり、 <a href="https://msdn.microsoft.com/en-US/library/azure/dn505708"><i>Get DATABASE API</i></a> を使用して変更の状態を監視できます。 データベースはオンラインになり、変更を通じて利用できます。

  <h1>Web &amp; Business と Basic、Standard &amp; プレミアム</h1>

  よく寄せられる質問は、新しいサービス階層のパフォーマンスが Web &amp; ビジネスとどのように比較されるかということです。 これは簡単な方法で回答するのは困難です。 課題は、Web &amp; ビジネスと新しいサービス階層が根本的に異なることです。 Web &amp; ビジネスでは、サービスモデルは使用されているストレージの量に基づいているだけであり、他のハードウェアリソースは考慮されません。 システムは、基本的に欠陥のあるデータベースワークロードの実行に使用される他のリソースではなく、ストレージの可用性を保証するように最適化されています。 Web &amp; ビジネスでのリソースのパフォーマンスレベル<i></i>と可用性は、<i> </i>同じコンピューター上の他の顧客のワークロードのようなさまざまな要因に依存します。また、システムが使用率を超えて保護されることもあります。 これらのリソースを利用できるかどうかにかかわらず、新しい階層で対処していない限り、この問題は時間の経過と共により顕著になるかどうかにギャンブルます。


  最初に言ったように、この予測不可能なパフォーマンスエクスペリエンスが必要ではないことをお客様に明確に伝えました。 新しいサービス階層の Basic、Standard、およびプレミアムは、複数の価格ポイントでの予測可能性の向上に焦点を合わせています。 つまり、システムは、ストレージだけでなく、データベースのワークロードを実行するために必要なその他のハードウェアリソースを提供するように最適化されています。


  これらのサービス階層が根本的に異なる設計原則で実行されるという事実は、1つのリンゴとオレンジの比較を行います。


  Web &amp; ビジネスリソースの消費に関する洞察を得るために、 <i>sys.resource_stats</i> で使用されるリソースの割合を示します (前述)。 Web &amp; Business のリソース割合の計算に関するテレメトリの参照ポイントは、 <i>Standard S2</i> の1/2 に設定されています。これは、現在のところ、W/B データベースの一般的な価格です。 これはテレメトリ参照ポイントのみであり、前述のように、Web &amp; ビジネスで利用可能なリソースの量は未定義であることに注意してください。 ただし、データベースに必要なパフォーマンスレベルを正確に把握するには、新しいサービス階層のいずれかにアップグレードし、ワークロードを実行して <i>sys.resource_stats</i>を監視する必要があります。 基本的な &amp; Standard サービスレベルが新しい論理サーバーでのみ利用可能であるという現在の制限は、プレビュー段階で削除されます。これにより、Web および Business データベースをインポートして新しいサービス階層をテストする必要性が軽減されます。

  <h1>ありがとうございます。</h1>

  このブログ投稿では、新しいサービスレベルのパフォーマンスについてさらに洞察を得られることを願っています。 概要で説明したように、お客様からのフィードバックと、プレビュー期間全体のパフォーマンス目標の品質を評価しています。また、フィードバックを学習して収集する際に、パフォーマンスレベルを調整する予定です。


  次に、その他の参考資料を示します。

  <ul>
   <li><a href="https://msdn.microsoft.com/en-us/library/dn741336.aspx">Azure SQL Database のサービス階層とパフォーマンス レベル</a></li>
   <li><a href="https://msdn.microsoft.com/en-us/library/dn369873.aspx">Azure SQL データベースの Basic、Standard、および Premium プレビュー</a></li>
   <li><a href="https://msdn.microsoft.com/en-us/library/dn741327.aspx">Azure SQL Database ベンチマークの概要</a></li>
  </ul>

  SQL Database を使用してプレビューをお試しいただき、ありがとうございます。


  SQL Database チームの/Tobias &amp;
