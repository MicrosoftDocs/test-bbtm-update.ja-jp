### YamlMime:Yaml
ms.openlocfilehash: c5c8f787932dff979776f225ec7effe53eb10b49
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139908978"
Slug: hardening-azure-analysis-services-with-the-new-firewall-capability
Title: 新しいファイアウォール機能を使用して Azure Analysis Services を強化する
Summary: Azure Analysis Services (Azure AS) はセキュリティを念頭に置いて設計され、Azure プラットフォームで使用できるセキュリティ機能を利用します。 たとえば、 と Azure Active Directory...
Content: >-
  <p>Azure Analysis Services (Azure AS) はセキュリティを念頭に置いて設計され、Azure プラットフォームで使用できるセキュリティ機能を利用します。 たとえば、Azure Active Directory (Azure AD) との統合によって、アクセス制御の基盤が確固として提供されます。 サーバーを作成、管理、または接続するユーザーには、Azure Analysis Services有効なユーザー ID がAzure AD必要があります。 モデル内のオブジェクト レベルのセキュリティを使用すると、テーブル、行、および列レベルで権限を定義できます。 さらに、Azure AS では暗号化を使用して、ローカル データ センター内、データ センター間、データ センター間、オンプレミス ネットワーク間、およびパブリック インターネット接続間での保存データと転送中のデータの保護に役立ちます。 トランスポート層セキュリティ (TLS)、Perfect Forward Secrecy (PFS)、および RSA ベースの 2,048 ビット暗号化キーの組み合わせにより、盗聴者に対する強力な保護が提供されます。</p>


  <p>ただし、Azure Analysis Servicesはマルチテナント クラウド サービスである点に注意してください。サービスは既定で任意のクライアントからのネットワーク トラフィックを受け入れる点に注意してください。 基本的なファイアウォールサポートを利用して、サーバーを強化することを忘れないでください。 Azure Portal では、Azure AS サーバーのプロパティを表示するときにファイアウォール設定を確認できます。 次のスクリーンショット <strong>に示</strong> すように、[ファイアウォール] タブをクリックします。 ファイアウォールを構成するには、Analysis Services Admins グループのメンバーである必要があります。</p>


  <p>クライアント IP アドレス範囲を指定せずにファイアウォールを有効にすると、Azure AS&mdash; サーバーがすべての受信トラフィックに効果的に閉じ、Power BI クラウド サービスからのトラフィックを受け入れられません。 サービスPower BI既定&quot;&quot;のファイアウォールの状態でホワイトリストに登録されますが、必要に応じてこの規則を無効にできます。 [保存 <strong>] を</strong> クリックして変更を適用します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b5ec817a-21e8-4d5b-a6b9-c2390b568e7a.png"><img alt="image" border="0" height="436" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0ef94ab6-178e-4751-9563-5664efd4df5d.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="イメージ" width="737"></a></p>


  <p>ファイアウォールを有効にすると、Azure AS サーバーは 401 エラー コードでブロックされたトラフィックに応答します。 対応するエラー メッセージは、クライアントが使用した IP アドレスを通知します。 これは、この IP アドレスに Azure AS サーバーへのアクセスを許可する場合に役立ちます。 このエラー処理は、ブロックされたトラフィックに応答しないステルス モードのネットワーク ファイアウォールとは異なります。 Azure AS ファイアウォールはステルス モードでは動作しませんが、サーバーを効果的にロックダウンできます。 次のスクリーンショットに示すように、SQL Server Management Studio (SSMS) でファイアウォールの動作をすばやく確認できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3d779286-e2b0-45d3-8c54-3a5c49a0a14e.png"><img alt="image" border="0" height="500" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dbd0780b-05af-436e-944b-9c646654f78c.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="イメージ" width="722"></a></p>


  <p>また、Azure Portal でワークステーションのクライアント IP アドレスを検出することもできます。 [ファイアウォール] ページで、[クライアント <strong>IP</strong> の追加] をクリックして、現在のワークステーションの IP アドレスを許可されている IP アドレスの一覧に追加します。 通常、IP アドレスはパブリック アドレスで、ほとんどの場合、ネットワーク アクセス ポイントでインターネットに動的に割り当てられる点に注意してください。 クライアント コンピューターが常に同じ IP アドレスを使用するとは限りない場合があります。 このため、通常は、個々のアドレスではなく IP 範囲を構成すると便利です。 例については、次の表を参照してください。 アドレスは IPv4 形式で指定する必要があります。</p>


  <table border="1" cellpadding="0" cellspacing="0">
   <tbody>
    <tr>
     <td valign="top" width="156">
     <p><b>Name</b></p>
     </td>
     <td valign="top" width="156">
     <p><b>開始 IP アドレス</b></p>
     </td>
     <td valign="top" width="156">
     <p><b>終了 IP アドレス</b></p>
     </td>
     <td valign="top" width="156">
     <p><b>コメント</b></p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="156">
     <p><b>ClientIPAddress</b></p>
     </td>
     <td valign="top" width="156">
     <p>192.168.1.1</p>
     </td>
     <td valign="top" width="156">
     <p>192.168.1.1</p>
     </td>
     <td valign="top" width="156">
     <p>1 つの IP アドレスへのアクセスを許可します。</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="156">
     <p><b>ClientIPAddresses</b></p>
     </td>
     <td valign="top" width="156">
     <p>192.168.1.0</p>
     </td>
     <td valign="top" width="156">
     <p>192.168.1.254</p>
     </td>
     <td valign="top" width="156">
     <p>192.168.1.x サブネット内のすべての IP アドレスへのアクセスを許可します。</p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="156">
     <p><b>米国東部 2 データ センター </b></p>
     </td>
     <td valign="top" width="156">
     <p>23.100.64.1</p>
     </td>
     <td valign="top" width="156">
     <p>23.100.71.254</p>
     </td>
     <td valign="top" width="156">
     <p>これは、米国東部 2 データ センターからのアドレス範囲 23.100.64.0/21 です。</p>
     </td>
    </tr>
   </tbody>
  </table>


  <p>オンプレミス Power BIのクライアント コンピューターに加え、特定の Azure ベースのソリューションに Azure AS サーバーへのアクセス権を付与することもできます。 たとえば、Azure AS に対して自動処理または他のアクションをAzure Functionsに基づいてソリューションを使用できます。 Azure AS ファイアウォールによってソリューションがブロックされている場合は、エラー メッセージ System.Net.WebException: リモート サーバーから次のエラーが返されます<em>: (401) Unauthorized&rdquo;。&ldquo;</em>次のスクリーンショットは、エラー状態を示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/39add6dc-8f8e-4205-94f1-41555001cc16.png"><img alt="AF blocked" border="0" height="850" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fdfeab5d-e6f3-4922-9e00-7b605c204689.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="AF ブロック" width="1077"></a></p>


  <p>Azure AS サーバーへのAzure App Serviceを許可するには、関数アプリが使用する IP アドレスを決定する必要があります。 関数アプリのプロパティで、送信 IP アドレス (次のスクリーンショットを参照) をコピーし、ファイアウォール規則で許可されているクライアント IP アドレスの一覧に追加します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/755bf1c6-9f57-472a-ad83-d0a60373f063.png"><img alt="GetAFIPAddresses" border="0" height="850" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dec757c8-00c0-4794-bd3c-f0066e3f5d4a.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="GetAFIPAddresses" width="1077"></a></p>


  <p>この時点で、Azure AS サーバーをデータ センター全体に開く方法を疑問に思う場合があります。 Azure データ センターのアドレス範囲は動的なので、これは少し複雑です。 すべての <a href="https://www.microsoft.com/en-us/download/details.aspx?id=41653">Azure データ センターの IP</a> アドレス範囲の一覧を含む XML ファイルは、Microsoft ダウンロード センターからダウンロードできます。 この一覧は毎週更新されます。そのため、定期的に更新プログラムを確認してください。</p>


  <p>XML ファイルではクラスレスドメイン間ルーティング (CIDR) 表記が使用され、Azure AS Firewall の設定では範囲が開始 IP アドレスと終了 IP アドレスで指定される必要があります。 CIDR 形式を開始 IP アドレスと終了 IP アドレスに変換するには、一般公開されている任意の IP コンバーター ツールを使用できます。 または、次のスクリーンショットに示すように、Power Queryを使用して XML ファイルを処理することもできます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9f5315f2-4efb-46f3-bcfe-e555e0b109e5.png"><img alt="XMLfileprocessing" border="0" height="1298" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b8feb366-c5d9-4f71-a9ef-e55366de3c96.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="XMLfileprocessing" width="1743"></a></p>


  <p>ブックを<a href="https://github.com/Microsoft/Analysis-Services/blob/master/BlogArticleUploads/StartIP-EndIP.xlsx">Excelし</a>、ダウンロードした XML ファイルを指す XmlFilePath パラメーターを更新してください。 便宜上、ブックには Firewall Rule Added という名前の列が含まれています。この列は、データ センター情報を Azure Resource Manager (ARM) テンプレートで定義されるのと同じファイアウォール規則に連結します。 次のスクリーンショットは、米国東部 2 データ センターの IP アドレス範囲に Azure AS サーバーへのアクセスを許可するいくつかのルールを含む ARM テンプレートを示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4a3410dc-fa3b-4442-a0ff-4c66db2de81b.png"><img alt="ARM Template" border="0" height="891" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ec621656-3adc-4279-b85d-4fdb8d1ea033.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="ARM テンプレート" width="1158"></a></p>


  <p>ARM テンプレートを使用すると、Azure PowerShell、Azure コマンド ライン インターフェイス (CLI)、Azure portal、または Resource Manager REST API を使用して、大規模なルールの一覧をプログラムで簡単に適用できます。 ただし、IP アドレスのリストが過度に長い場合は、管理が難しいです。 さらに、Azure AS ファイアウォールでは、受信要求ごとに各規則を評価する必要があります。 このため、ルールの数を必要な絶対数に制限する必要があります。 たとえば、すべての Azure データ センターのすべての IP 範囲に対して約 3,500 のルールを追加しないようにします。 ルールをサーバーのローカル データ センター&rsquo;に制限しても、サブネットは 400 を超える可能性があります。 ベスト プラクティスとして、静的 IP アドレスまたは少なくとも一連の動的 IP アドレスをサポートするテクノロジを使用して、Azure AS ビジネス ソリューションを構築します (Azure App Service の場合と同様)。 表面領域が小さいほど、Azure AS サーバーのセキュリティ強化の効果が高くなる。</p>


  <p>フィードバック フォーラムで機能に関する独自のアイデアを送信<a href="https://feedback.azure.com/forums/556165">し</a>、詳細を確認<a href="https://docs.microsoft.com/azure/analysis-services/analysis-services-overview">Azure Analysis Services。</a></p>
