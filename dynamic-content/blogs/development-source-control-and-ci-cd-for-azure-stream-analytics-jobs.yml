### YamlMime:Yaml
ms.openlocfilehash: ef64bab65e49e1ac542e02c326afba7b19d5b677
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139909900"
Slug: development-source-control-and-ci-cd-for-azure-stream-analytics-jobs
Title: Azure Stream Analytics ジョブの開発、ソース管理、CI/CD
Summary: Microsoft Azure Stream Analytics (ASA) ジョブを開発およびソース管理する方法はありますか。 これらのジョブをビルドし、テストして、複数の環境にデプロイするように自動プロセスを設定する方法はありますか。
Content: >-
  <p>Microsoft Azure Stream Analytics (ASA) ジョブを開発およびソース管理する方法はありますか。 これらのジョブをビルドし、テストして、複数の環境にデプロイするように自動プロセスを設定する方法はありますか。 <a href="https://marketplace.visualstudio.com/items?itemName=ADLTools.AzureDataLakeandStreamAnalyticsTools" target="_blank">Stream Analytics Visual Studio ツール</a>を<a href="https://azure.microsoft.com/en-us/services/devops/pipelines/" target="_blank">Azure Pipelines</a>と共に使用すると、これらすべてのシナリオを実現するのに役立つ統合環境が提供されます。 この記事では、これらのツールの使用を開始するための適切な場所について説明します。</p>


  <p>以前は、ASA ジョブの出力シンクとして Gen1 を Azure Data Lake Store 使用したり、関連する自動化された CI/CD プロセスを設定したりするのは困難でした。 これは、OAuth モデルがこの種類のストレージに対して自動認証を許可しなかったためです。 2019年1月にリリースされるツールでは<a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-managed-identities-adls#stream-analytics-tools-for-visual-studio" target="_blank">Azure Data Lake Storage Gen1 出力シンクのマネージド id</a>がサポートされるようになり、この重要なシナリオが可能になりました。</p>


  <p>この記事では、Stream Analytics Visual Studio ツール、 <a href="https://www.nuget.org/packages/Microsoft.Azure.StreamAnalytics.CICD/" target="_blank">Stream Analytics CI.CD NuGet パッケージ</a>、Azure Pipelines を使用したエンドツーエンドの開発と CI/CD プロセスについて説明します。 現在 Visual Studio 2019、2017、2015がすべてサポートされています。 ツールを使用 &rsquo; しない場合は、インストール手順に従って作業を開始してください。</p>


  <h2>ジョブ開発</h2>


  <p>&rsquo;まず、ジョブを作成します。 Stream Analytics Visual Studio ツールを使用すると、プロジェクトを使用してジョブを管理できます。 各プロジェクトは、ASA クエリスクリプト、ジョブ構成、およびいくつかの入力および出力構成で構成されています。 エラーマーカー、オートコンプリート、構文の強調表示など、すべての IntelliSense 機能を使用する場合は、クエリの編集が非常に効率的です。 ジョブを作成する方法の詳細については、<a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-quick-create-vs" target="_blank">クイックスタートガイドの Visual Studio</a>を参照してください。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f67fba48-b30d-4f63-a161-b63eae6d8be6.png"><img alt="Screenshot of Azure Stream Analytics query script" border="0" height="195" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7c9d99c0-86ea-4fcf-b252-19da02476ec1.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure Stream Analytics クエリスクリプトのスクリーンショット" width="624"></a></p>


  <p>既存のジョブがあり、それらを Visual Studio で開発したり、ソース管理を追加したりする場合は、最初にローカルプロジェクトにエクスポートするだけです。 これは、特定の ASA ジョブのサーバーエクスプローラーのコンテキストメニューから実行できます。 この機能を使用すると、最初からすべてを作成しなくても、複数のリージョンにジョブを簡単にコピーできます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/65e09e97-aa44-4df9-809f-97fcf9b8a2a0.png"><img alt="Screenshot of exporting to new Stream Analytics project" border="0" height="165" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9a3f3539-33a5-4903-9383-fc922475a6f8.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="新しい Stream Analytics プロジェクトへのエクスポートのスクリーンショット" width="775"></a></p>


  <p>Visual Studio での開発では、クラウドジョブで<a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-javascript-user-defined-functions" target="_blank">JavaScript ユーザー定義関数</a>を作成するとき、または<a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-edge-csharp-udf-methods" target="_blank">Edge ジョブの C# ユーザー定義関数</a>を記述するときに、最適なネイティブの作成とデバッグを行うことができます。</p>


  <h2>ソース管理</h2>


  <p>プロジェクトとして作成した場合、クエリおよびその他の成果物は、開発用コンピューターのローカルディスクに配置されます。 バージョン管理には Azure DevOps 以前 Visual Studio Team Service を使用し、必要な任意のリポジトリに直接コードをコミットすることができます。 これにより、さまざまなバージョンの [script.asaql] クエリだけでなく、入力、出力、およびジョブの構成も保存できます。また、必要に応じて、以前のバージョンに簡単に戻すことができます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5127c5ba-c53b-4bf6-a29d-f170ec13bd6a.png"><img alt="Screenshot of home screen on Team Explorer" border="0" height="298" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0156e25e-e00c-4600-b06c-330cbbc99fd2.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="チームエクスプローラーのホーム画面のスクリーンショット" width="393"></a></p>


  <h2>ローカルでのテスト</h2>


  <p>開発時には、ローカルテストを使用して、 <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-vs-tools-local-run" target="_blank">ローカルサンプルデータ</a> または <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-live-data-local-testing" target="_blank">ライブストリーミング入力データ</a>を使用してコードを繰り返し実行し、修正します。 [ローカルで実行] を使用すると、クエリが数秒で開始され、テストサイクルが大幅に短くなります。</p>


  <h2>クラウドでのテスト</h2>


  <p>クエリがローカルコンピューター上で適切に機能するようになっ &rsquo; たら、パフォーマンスとスケーラビリティをテストするためにクラウドに送信します。 クエリをアップロードして実行中のジョブを開始するには、クエリエディターで [Azure &rdquo; に送信] を選択 &ldquo; します。 その後、Visual Studio 内からジョブメトリックとジョブフローダイアグラムを表示できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a94f0ba0-6ef8-44d3-8a28-511548aa182c.png"><img alt="Screenshot of submitting query to Azure" border="0" height="201" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8cec8e3b-237a-404e-8529-21557b593fa7.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure へのクエリの送信のスクリーンショット" width="658"></a></p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f96e6eea-5281-4ad8-9cce-cdc87a51e200.png"><img alt="Screenshot of Stream Analytics job summary" border="0" height="632" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ec9aeed4-5051-4a74-997b-e357eb9bfd26.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Stream Analytics ジョブの概要のスクリーンショット" width="800"></a></p>


  <h2>CI/CD パイプラインのセットアップ</h2>


  <p>クエリのテストが完了したら、次の手順として、運用環境用の CI/CD パイプラインを設定します。 ASA ジョブは、Azure Resource Manager (ARM) テンプレートを使用して Azure リソースとしてデプロイされます。 各ジョブは、 <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-templates-parameters" target="_blank">ARM テンプレート定義ファイルとパラメーターファイル</a>によって定義されます。</p>


  <p>前述の2つのファイルを生成するには、次の2つの方法があります。</p>


  <ol>
   <li>Visual Studio で、プロジェクト名を右クリックし、[ビルド] を選択 &ldquo; します。&rdquo;</li>
   <li>任意のビルドコンピューターで<a href="https://www.nuget.org/packages/Microsoft.Azure.StreamAnalytics.CICD/" target="_blank">Stream Analytics CI.CD NuGet パッケージ</a>をインストールし、現時点では Windows でのみサポートされているコマンド &ldquo; ビルド &rdquo; を実行します。 これは、自動化されたビルドプロセスに必要です。</li>
  </ol>


  <p>ビルドを &ldquo; 実行すると、bin &rdquo; フォルダーの &ldquo; 下に2つのファイルが生成され、任意の場所に保存でき &rdquo; ます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e2765c35-6a6b-444d-8e1e-733952ce33f5.png"><img alt="Screenshot of the deployment folder" border="0" height="141" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3bb545f0-27ba-4e65-8295-4be54fe38e0c.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="配置フォルダーのスクリーンショット" width="789"></a></p>


  <p>パラメーターファイルの既定値は、Visual Studio プロジェクトの入力/出力ジョブ構成ファイルの値です。 複数の環境に展開するには、パラメーターファイルの単純な powershell スクリプトで値を置き換えて、ターゲット環境を指定するために、このファイルの異なるバージョンを生成します。 これにより、開発環境、テスト環境、および最終的な運用環境にをデプロイできます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/07759465-6381-460b-bf4f-698d5f37e5df.png"><img alt="Example code for power shell script" border="0" height="354" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/06e4e8dc-4f26-410d-9e46-6e9504731097.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Powershell スクリプトのコード例" width="450"></a></p>


  <p>前述のように、 <a href="https://www.nuget.org/packages/Microsoft.Azure.StreamAnalytics.CICD/" target="_blank">Stream Analytics CI.CD NuGet パッケージ</a>は、独立して使用することも、Azure Pipelines などの CI/CD システムで使用して、Stream Analytics Visual Studio プロジェクトのビルドとテストのプロセスを自動化することもできます。 詳細については、 &ldquo; 「 <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-tools-for-visual-studio-cicd" target="_blank">Stream Analytics ツールを使用した継続的な統合と開発</a>」と<a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-tools-visual-studio-cicd-vsts" target="_blank">「Azure Pipelines チュートリアルを使用して CI/CD で Stream Analytics ジョブをデプロイ</a>する」をご覧ください。 &rdquo; &ldquo; &rdquo;</p>


  <h2>フィードバックとアイデアの提供</h2>


  <p>Azure Stream Analytics チームは、フィードバックをリッスンするために高度にコミットされています。 会話に参加して、 <a href="https://feedback.azure.com/forums/270577-stream-analytics/filters/top" target="_blank">UserVoice</a>から音声を聞くことができます。 ツールのフィードバックについては、まで <a href="mailto:ASAToolsFeedback@microsoft.com">ASAToolsFeedback@microsoft.com</a> お問い合わせいただくこともできます。</p>


  <p>パブリックプレビューには10個を超える新機能がありますか。 <a href="https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-previews" target="_blank">プレビュープログラムにサインアップ</a> して試してみてください。また、最新の機能を更新するには、Twitter <a href="https://twitter.com/azurestreaming" target="_blank">@AzureStreaming</a> でフォローしてください。</p>
