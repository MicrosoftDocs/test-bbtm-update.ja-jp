### YamlMime:Yaml
ms.openlocfilehash: 2376772b18394a82e9255f860b58accf7173ed52
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139904272"
Slug: azure-stream-analytics-support-for-iot-hub-operations-monitoring-2
Title: Azure Stream Analytics操作の監視IoT Hubサポート
Summary: Azure Stream Analytics で IoT Hub Operations Monitoring がサポートされたので、IoT デバイスの操作を簡単に分析できます。
Content: "<p><a href=\"https://azure.microsoft.com/en-us/services/stream-analytics/\" target=\"_blank\">Azure Stream Analytics</a> は、1 秒あたり数百万のイベントを処理し、ほぼリアルタイムで集計と計算を実行できる、リアルタイムでスケーラブルでフル マネージドのストリーム分析サービスです。<br>\n<br>\nStream Analytics Hub と <a href=\"https://azure.microsoft.com/en-us/services/iot-hub/\" target=\"_blank\">Azure IoT Hub</a> は、以前から非常にうまく機能しており、IoT デバイスから IoT Hub に送信されるデータに関する分析情報を簡単に収集できます。 データ ストリームの作成IoT Hubドキュメントの説明に従って入力を構成するだけで、IoT Hubを <a href=\"https://azure.microsoft.com/en-us/documentation/articles/stream-analytics-define-inputs/#create-an-iot-hub-data-stream-input\" target=\"_blank\">実行</a> できます。 現在、多くのお客様が IoT ソリューションでこれを使用しています。これは非常にうまく機能します。ただし、お客様からの一般的な質問は、IoT ハブでの操作の状態をリアルタイムで監視する方法です。 これで、現在は&rsquo;、運用監視エンドポイントに接続して、これを行IoT Hubお知らせします。</p>\n\n<p>IoT Hub の操作の監視では、IoT Hub に対する操作の状態をリアルタイムで監視することができます。 IoT Hub では複数のカテゴリの操作にわたってイベントを追跡するので、処理のために IoT Hub のエンドポイントに送信された 1 つまたは複数のカテゴリのイベントの使用を有効にすることがでます。 データを監視してエラーがないか確認したり、データ パターンに基づいてより複雑な処理をセットアップしたりできます。</p>\n\n<p>IoT Hub では、次の 5 つのカテゴリのイベントを監視します。</p>\n\n<ul>\n <li>デバイス ID の操作</li>\n <li>デバイス テレメトリ</li>\n <li>クラウドからデバイスへのコマンド</li>\n <li>接続</li>\n <li>ファイルのアップロード</li>\n</ul>\n\n<p>操作の監視の詳細IoT Hub操作の監視の <a href=\"https://azure.microsoft.com/en-us/documentation/articles/iot-hub-operations-monitoring/\" target=\"_blank\">概要に関するドキュメントを参照</a> してください。</p>\n\n<p>顧客からの一般的な質問は、デバイスが&nbsp; IoT Hub から切断され、1 分以内に再接続されないかどうか (1 分など) をほぼリアルタイムで知る方法です。 これが発生した場合は、ほぼリアルタイムで電子メールを送信するか、ワークフローを開始します。 一部のデバイスでは、これらのアラートができるだけ早く送信され、問題が発生する前にメンテナンスが実行される必要があります。</p>\n\n<p>&rsquo;&ldquo;&rdquo; Stream Analytics 操作の監視機能を使用してこれを簡単に行う方法を示IoT Hub接続イベント監視を構成します。</p>\n\n<p>&nbsp;</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dbf910da-ac69-4024-84ee-0dc1f205fd19.png\"><img alt=\"ConnectionsInfo\" border=\"0\" height=\"347\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/db20a9ac-2f5b-483f-b19a-54f0c2b1834f.png\" style=\"border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px\" title=\"ConnectionsInfo\" width=\"527\"></a></p>\n\n<p>上の図から確認したように、 を有効にすると、デバイスの接続時と切断時にイベントのログ記録が開始されます。 これを使い始めるには、次のように [接続] スイッチを [詳細] に切り替えます。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0c44259c-29c1-4d17-af74-b24bac6a1afa.png\"><img alt=\"ConnectionsConfig\" border=\"0\" height=\"687\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b7369272-5975-480b-a209-88867950a862.png\" style=\"border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px\" title=\"ConnectionsConfig\" width=\"588\"></a></p>\n\n<p>&nbsp;</p>\n\n<p>これが構成された後、デバイスが IoT ハブに接続すると、イベントのキャプチャが開始されます。 これを確認するには、Service Bus エクスプローラー&quot;のようなツールを使用して、Event Hub &ndash; 互換名/&quot;エンドポイントに接続し、メッセージを表示します。</p>\n\n<p>収集されたサンプル メッセージは次のようになります。</p>\n\n<pre class=\"prettyprint\">\n{\n     &quot;durationMs&quot;: 1234,\n     &quot;authType&quot;: &quot;{\\&quot;scope\\&quot;:\\&quot;hub\\&quot;,\\&quot;type\\&quot;:\\&quot;sas\\&quot;,\\&quot;issuer\\&quot;:\\&quot;iothub\\&quot;}&quot;,\n     &quot;protocol&quot;: &quot;Amqp&quot;,\n     &quot;time&quot;: &quot;2016-09-13T20:00Z&quot;,\n     &quot;operationName&quot;: &quot;deviceConnect&quot;,\n     &quot;category&quot;: &quot;Connections&quot;,\n     &quot;level&quot;: &quot;Error&quot;,\n     &quot;statusCode&quot;: 4XX,\n     &quot;statusType&quot;: 4XX001,\n     &quot;statusDescription&quot;: &quot;MessageDescription&quot;,\n     &quot;deviceId&quot;: &quot;device-ID&quot;\n}</pre>\n\n<p>同様に、デバイスがデバイスから切断IoT Hub、operationName == deviceDisconnect を使用してイベントがキャプチャされます。</p>\n\n<p>次に、これらのメッセージが IoT Hubに到着し、ジョブでそれらを使用Stream Analytics確認しました。</p>\n\n<p>1. 新しいジョブをStream Analyticsします。<br>\n<br>\n新しいジョブを作成する方法についてはStream Analyticsデータ分析処理ジョブを作成する方法に関する <a href=\"https://azure.microsoft.com/en-us/documentation/articles/stream-analytics-create-a-job/\" target=\"_blank\">ページをStream Analytics</a></p>\n\n<p>2. 自分のデータ ストリームを指す入力を作成IoT Hub。 [メッセージング] ではなく、[ &ldquo;エンドポイント] から&rdquo; [操作の監視] を選択 &ldquo;してください&rdquo;。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e85d2a1f-c8b7-4653-92e7-12d4bab9e588.png\"><img alt=\"ConnectionsConfig\" border=\"0\" height=\"739\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5ba9c8d9-c797-44be-9c80-d948c74d7388.png\" style=\"border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px\" title=\"ConnectionsConfig\" width=\"313\"></a></p>\n\n<p>3. 次のクエリを作成します。</p>\n\n<pre class=\"prettyprint\">\nWITH\nDisconnected AS (\nSELECT *\nFROM input TIMESTAMP BY [Time]\nWHERE OperationName = &#39;deviceDisconnect&#39;\n    AND Category = &#39;Connections&#39;\n),\nConnected AS (\nSELECT *\nFROM input TIMESTAMP BY [Time]\nWHERE OperationName = &#39;deviceConnect&#39;\n    AND Category = &#39;Connections&#39;\n)\n\nSELECT Disconnected.DeviceId, Disconnected.Time\nINTO Output \nFROM Disconnected\nLEFT JOIN Connected \n    ON DATEDIFF(second, Disconnected, Connected) BETWEEN 0 AND 180\n    AND Connected.deviceId = Disconnected.deviceId\nWHERE Connected.DeviceId IS NULL</pre>\n\n<p>このクエリには、すべての切断イベントを取得する最初の手順と、すべての接続イベントを取得する 2 つの手順があります。</p>\n\n<p>次に、LEFT JOIN の Stream Analytics DATEDIFF 操作を使用してこれら 2 つのストリームを結合し、一致したレコードをフィルターで削除します。 これにより、切断イベントが発生したが、180 秒内に対応する接続イベントがないデバイスが提供されます。</p>\n\n<p>これで、このジョブの出力は、サポートされている任意のキュー Stream Analytics出力に送信Service Busできます。 Service Bus キューに入った後は、Azure 関数や Azure Logic App を簡単に作成できます。これは、メッセージがキューに発行された後すぐに実行されます。</p>\n\n<p>同様に、非常に単純なSQLのようなクエリを使用すると、IoT Hub Operations Monitoring エンドポイントからリアルタイムの更新を行えます。</p>\n\n<p>このような複雑なシナリオを&hellip;コーディングするのが難しく、時間がかかり過ごした古き良き時代を見逃す場合&rsquo;があります。 Azure&nbsp; の PaaS サービスとサーバーレス コンピューティング機能の使用は非常に簡単で強力であり、付加価値の構築に集中できます。</p>\n\n<h2>関連サービス</h2>\n\n<p><a href=\"https://azure.microsoft.com/en-us/services/iot-hub/\" target=\"_blank\"></a> - Microsoft Azure IoT Hub数百万の IoT 資産の接続、監視、管理を行う</p>\n\n<p><a href=\"https://azure.microsoft.com/en-us/services/event-hubs/\" target=\"_blank\"></a> &ndash; Microsoft Azure Event Hubs、アプリ、デバイスからデータを取り込む</p>\n\n<p><a href=\"https://azure.microsoft.com/en-us/services/service-bus/\" target=\"_blank\"></a> - Microsoft Azure Service Busプライベート クラウドとパブリック クラウド間で接続されているアプリとデバイスを保持する</p>\n\n<p><a href=\"https://azure.microsoft.com/en-us/services/logic-apps/\" target=\"_blank\"></a> - Microsoft Azure Logic Apps強力な統合ソリューションを迅速に構築する</p>\n\n<p><a href=\"https://azure.microsoft.com/en-us/services/functions/\" target=\"_blank\">Microsoft Azure関数</a> -サーバーレス コードを使用してイベントを処理する</p>\n\n<h2>次の手順</h2>\n\n<p>この&rsquo; IoT Hubs との密接な統合に本当にうれしく思います。また、お客様と IoT アプリケーションの多くの新しい、楽しい機能のロックが解除されるのを願っています。</p>\n\n<p>サービス&nbsp;の横に追加する情報について、<a href=\"https://feedback.azure.com/forums/270577-stream-analytics\"><u>User Voice</u></a>&nbsp; ページでフィードバックをお寄せください。</p>\n\n<p>Microsoft Azure または Stream Analytics を初めて使用する場合は、<a href=\"https://azure.microsoft.com/pricing/free-trial/\">無料の Azure</a> 試用版アカウントにサインアップして試し、最初の Stream Analytics <a href=\"https://azure.microsoft.com/en-us/documentation/articles/stream-analytics-create-a-job/\">ジョブを作成します</a>。</p>\n\n<p>ヘルプが必要な場合、または質問がある場合は、<a href=\"https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics\">MSDN </a>または <a href=\"https://stackoverflow.com/questions/tagged/azure-stream-analytics\">Stackoverflow </a><a></a>&nbsp;フォーラムを通じてお問い合わせください。製品チームに直接メールをお送りください。</p>"
