### YamlMime:Yaml
ms.openlocfilehash: 161aaaf618b52e7835cc9a839fe98b6813c7cd59
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892405"
Slug: snapshot-debugger-for-azure
Title: Azure のスナップショットデバッガープレビューの概要
Summary: この投稿では、Azure のスナップショットデバッガーを発表します。 Application Insights と Visual Studio の使用。
Content: >-
  <p>スナップショットデバッガーは、例外が発生したとき、またはその他の目的の時点で、実稼働 Azure アプリのスナップショットを取得します。 これにより、運用アプリケーションのトラフィックに影響を与えることなく、問題の原因を正確に確認できます。</p>


  <p>これは Visual Studio <a href="https://azure.microsoft.com/services/application-insights/">Application Insights</a>のまったく新しい機能であり、今すぐ発表することをお &rsquo; 勧めします。 これは、Azure の web 開発者として、運用環境で検出された問題の解決にかかる平均時間を大幅に短縮するのに役立ちます。</p>


  <p>まず、 &rsquo; <a href="https://go.microsoft.com/fwlink/?linkid=848052">現在利用可能な .Net の自動スナップショットのパブリックプレビューについ</a>て説明します。次 &rsquo; に、 <a href="https://aka.ms/vssnapshotpreview">プライベートプレビュープログラムで試してみる</a>ことができる対話型のスナップポイントおよび logpoints の機能について説明します。</p>


  <h2>運用環境での問題の診断は難しい</h2>


  <p>実稼働サービスでは問題が発生し、すべてのユーザーがクラウドの速度で実行したいと考えています。 ログとメトリックは、開発者や DevOps エンジニア &ndash; によって使用される標準ツールであり、多くの場合に役立ちますが、ログとメトリック &rsquo; が根本原因を特定できないほど多く &ndash; のバグがあります。</p>


  <p>クラウドでの問題の診断には、次のような理由で特に時間がかかります。</p>


  <ul>
   <li>多くの場合、さまざまな構成、データ、使用パターンによって問題が発生します。</li>
   <li>&rsquo;ローカルにあるクラウドでは、同じデバッグツールをすぐに使用できます。</li>
   <li>実稼働サイトはライブトラフィックを処理しているため、実行できる操作は限られています。</li>
  </ul>


  <p>Microsoft では、この問題を解決するために、 <a href="https://blogs.msdn.microsoft.com/visualstudio/2017/02/09/visual-studio-2017-launch-event-and-20th-anniversary/">Visual Studio の開発に20歳以上の経験を持って</a>います。 これらの問題を解決するのに役立つスナップショットデバッガーを構築しています。</p>


  <h2>テレメトリによってトリガーされる自動スナップショット</h2>


  <p>スナップショットデバッガーは、運用環境用に構築された新しいツールです。 &nbsp; これは、特にログがハングした場合に、問題を発見するのに役立ちます。</p>


  <p>スナップショットデバッガーのパブリックプレビューを有効にすると、Application Insights は、環境で監視されている例外のスナップショットを自動的にキャプチャします。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/69284cfb-4d73-4b46-833c-45210bfc577a.png"><img alt="image" border="0" height="689" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7462b206-8636-4779-9861-e887ca515916.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="絵" width="583"></a></p>


  <p>例外を収集するように Application Insights を構成するだけで、アプリに NuGet パッケージを含めることが<a href="https://www.nuget.org/packages/Microsoft.ApplicationInsights.SnapshotCollector">できます。</a>また、Application Insights ポータルで [デバッグスナップショットを開く] リンクが例外に表示されます。</p>


  <p>デバッグスナップショットを開き、クラウドで実行されている Visual Studio &rsquo; s デバッグエンジンを使用して、ポータルで軽量の表示エクスペリエンスを取得できます。 ここでは、各フレームの呼び出し履歴とローカル変数を調べることができます。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8e727e06-d97a-428d-9e43-f4d5afff5f47.png"><img alt="open-snapshot-portal" border="0" height="456" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0af0a937-de76-496d-9f39-da5f3d3e637d.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="オープンスナップショット-ポータル" width="686"></a></p>


  <h2>Visual Studio での完全忠実なデバッグ</h2>


  <p>表示される変数からは、問題の根本原因をすぐに特定できる場合がありますが、問題を把握するには、スナップショットをさらに掘り下げなければならないことがあります。 スナップショットデバッガーの機能を最大限に活用するには、[スナップショット &rdquo; のダウンロード] をクリックし &ldquo; て、運用環境から収集されたスナップショットファイルとシンボルファイルを含む diagsession ファイルをダウンロードします。これにより、デバッガーはソースコードにマップし直すことができます。</p>


  <p><a href="https://aka.ms/snapshotdebugger">スナップショットデバッガー拡張機能がインストールされ</a>ている Visual Studio Enterprise 2017 でスナップショットファイルを開くと、その時点でのプロセスの完全な状態を確認できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2595381f-bfc1-46ae-86d5-ea62f274b07d.png"><img alt="OpenSnapshotVs_770" border="0" height="410" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/92275700-8a81-4891-a852-21839b2d0afc.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="OpenSnapshotVs_770" width="770"></a></p>


  <p>Visual Studio、デバッガーの全機能を使用して、例外がスローされた時点のプログラムの状態を調べることができます。 ここでは、ダンプデバッグのすべての機能を使用できます。</p>


  <h2>スナップポイントとログポイントを使用した対話型スナップショットのデバッグ</h2>


  <p>これまでは、誰でも使用できることについて &rsquo; お話ししまし &rsquo; た。 また、ビルド2017で示されているスナップショットデバッガーの <a href="https://aka.ms/vssnapshotpreview">スナップポイントおよび logpoints 機能のために、プライベートプレビュープログラムにサインアップ</a> するように招待されています。 これらの機能は、この夏のパブリックプレビューとして提供されます。</p>


  <p>例外の自動スナップショットは開始するのに適していますが、実稼働環境をテストするための仮説がある場合はどうでしょうか。 ライブスナップショットデバッグモードでは、Azure で実行されているアプリケーションに Visual Studio をアタッチできます。 このモードでは、[ブレークポイント &ldquo; ] 余白 &rdquo; をクリックすると、そのコード行が運用環境で実行されたときにスナップショットが収集されるようにスナップポイントが設定されます。</p>


  <p>&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/eed8432b-fc00-4ae7-a2c8-f14775b49314.png"><img alt="SetSnappoint" border="0" height="124" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/28ce1875-75a1-4b33-9067-ecef426f313c.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="SetSnappoint" width="729"></a></p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/42f2ee56-d6d2-4139-bd16-650dc8e2b38d.png"><img alt="Interactive2_Multiple" border="0" height="570" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/25d82629-e399-4e8f-aaa1-33ac6ad5e39b.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="Interactive2_Multiple" width="883"></a></p>


  <p>スナップショットは、右側のイベントログに表示されるので、ダブルクリックすると、Visual Studio を使用してスナップショットをデバッグできます。 関連付けを使用して、可能な限り同じ要求から複数のスナップショットを収集し、時間の経過と共に状態が変化したかどうかを把握できるようにします。</p>


  <p>特定のユーザーにのみ影響を与える問題や、特定の条件下でのみ発生する問題を追跡することに関心がある場合があります。 [スナップポイント] 構成ボタンをクリックすると、条件を設定できます。これにより、スナップショットコレクションをトリガーする式を簡単に入力できます。</p>


  <p>&nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f6211a73-fe42-4347-99e3-fa38440e1f4a.png"><img alt="Interactive3_Conditions" border="0" height="330" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/efbca125-f8d1-46fc-bfbd-5d85276c2db5.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="Interactive3_Conditions" width="818"></a></p>


  <p>バグによっては、完全なスナップショットが必要ではなく、時間の経過と共に変化する変数の値を表示する必要がある場合があります。 ログポイントを設定するには、構成ページを使用して操作 &rdquo; を確認 &ldquo; し、メッセージを指定します。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c444ff6a-7bc6-432e-bbff-6fab0e8a7760.png"><img alt="Interactive4_LogPoints" border="0" height="332" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f9c1efdc-a390-4e9f-afd5-d51e439b6f91.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" title="Interactive4_LogPoints" width="921"></a></p>


  <p>ログは、[出力] ウィンドウに表示され、標準のログ api を使用して、Application Insights などの標準的な監視およびログ記録ソリューションによって取得できるようにします。</p>


  <h2>運用クラウド用のデバッガー</h2>


  <p>プロセススナップショットを取得するには、10ミリ秒 &ndash; が必要です。また、ページをコピー時書き込みとしてマークすることにより、実行中のプロセスのシャドウコピーが作成されます。 これは、メインプロセスの実行とユーザーへのトラフィックの処理を継続しながら、メモリをオフラインで分析できることを意味します。 スナップショットのメモリオーバーヘッドも少なくなります。メインプロセスがメモリに書き込むときにのみ、メモリがコピーされます。</p>


  <p>このスナップショット機能を使用すると、ユーザーのトラフィックに影響を与えずに、使い慣れたツールを使用して、問題と根本原因の問題を再現するために必要なデータを取得できる、本格的なデバッグエクスペリエンスを構築できました。 実行中の <a href="https://channel9.msdn.com/Events/Build/2017/B8027">スナップショットデバッガーを確認するには</a> 、「」を参照してください。</p>


  <h2>今すぐプレビューをお試しください</h2>


  <p>これはスナップショットデバッガーの取り組みの始まりに過ぎません。 Azure でのクラウドの速度でのデバッグに役立つように、これらすべての機能 &ndash; &ndash; を利用できるようになるまで待つことができ &rsquo; ます。</p>


  <p>現時点では、Application Insights と Visual Studio で<a href="https://go.microsoft.com/fwlink/?linkid=848052">自動スナップショットのパブリックプレビュー</a>をお試しください。また、これらの機能を試すための最初の1つとして、<a href="https://aka.ms/vssnapshotpreview">スナップポイントとログポイントのプライベートプレビューにサインアップ</a>してください。</p>
