### YamlMime:Yaml
ms.openlocfilehash: 7eeb893ec00647db156906db4ecc2a8838c3c8c8
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891172"
Slug: azure-automation-runbook-management
Title: Azure Automation の概要 – Runbook の管理
Summary: Azure Automation での Runbook 管理の基礎。 Automation アカウントの作成、Runbook の作成またはインポート、テストと発行、ログ記録の管理、Runbook を開始するためのスケジュールの設定を行う手順。
Content: >-
  Azure Automationは、Azure 管理タスクを自動化し、Azure 内から外部システム間でアクションを調整できる、Azure の新しいサービスです。 これは PowerShell ワークフローを基に構築されています。そのため、言語の多くの機能を利用できます。 まだサインアップしていない場合は、Azure Automation無料プレビューにサインアップ <a href="https://azure.microsoft.com/en-us/services/preview/" target="_blank"><span style="color: #0000ff">してください</span></a>。 詳細については、こちらをAzure Automation <a href="https://azure.microsoft.com/en-us/documentation/services/automation/" target="_blank">してください</a>。


  この投稿では、Runbook 管理の基礎の一部を、Azure Automation。 Automation アカウントの作成、Runbook の作成またはインポート、Runbook のテストと発行、その Runbook のログ記録の管理、Runbook を開始するためのスケジュールの設定を行う手順について説明します。


  アプリケーションの使用を開始するときに最初に行う必要Azure Automationは、Automation アカウントを作成する方法です。 Automation アカウントは、コンテナー Azure Storage機能するアカウントに似たアカウントです。 Automation では、すべての Runbook、Runbook の実行 (ジョブ)、および Runbook が依存する資産のコンテナーです。 Automation が GA に進むと、Automation アカウントに使用するリージョンを選択できます。 これにより、効率を最大化するために、他のサービスが含まれるリージョンとのアフィニティを作成できます。 Automation はプレビュー サービスのままですが、利用可能なリージョンは米国東部の 1 つのみです。


  アカウントを作成するには、Automation Create <strong>を選択 &gt; します</strong>。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/CreateAccount.png"><img style="float: none;margin-left: auto;margin-right: auto;border-width: 0px" title="CreateAccount" alt="CreateAccount" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/CreateAccount_thumb.png" width="610" border="0" /></a>


  その後、アカウントの名前を追加し、サブスクリプションを選択し (複数のサブスクリプションを使用できる場合)、リージョンを選択するように求めるメッセージが表示されます。

  <h2>Automation での Runbook の作成</h2>

  Automation アカウントを作成できたので、クラウド管理を自動化するための Runbook の作成を開始する準備ができました。 Automation で Runbook を作成するには、次の 2 つの方法があります。

  <ol>
   <li>新しい Runbook を簡単に作成する</li>
   <li>既存の Runbook をインポートする (PowerShell Workflow in a .ps1 File)</li>
  </ol>

  <h3>クイック作成を使用した新しい Runbook の作成</h3>

  空の Runbook を作成するには、簡易作成を使用します。 クイック作成には、+NEW -&gt; App Services Runbook -&gt;&gt; Quick Create を使用してアクセスできます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/QuickCreate1.png"><img style="float: none;margin-left: auto;margin-right: auto;border-width: 0px" title="QuickCreate1" alt="QuickCreate1" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/QuickCreate1_thumb.png" width="610" border="0" /></a>


  ここでは、Runbook の<b>名前</b>、説明を指定し、<b></b>Runbook を作成する <b>Automation</b> <b></b> アカウントを選択できます。 Runbook の名前は変更できませんが、後で [Runbook の構成] タブから説明を <strong>変更</strong> できます。一般に、PowerShell 動詞名詞の名前付け規則に従い、承認された PowerShell 動詞のみを使用する方 <a href="https://msdn.microsoft.com/en-us/library/ms714428(v=vs.85).aspx" target="_blank">が良い方法です</a>。 この例では、"Set-RunbookConfiguration" を使用します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/QuickCreate2.png"><img style="float: none;margin-left: auto;margin-right: auto;border-width: 0px" title="QuickCreate2" alt="QuickCreate2" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/QuickCreate2_thumb.png" width="610" border="0" /></a>


  &nbsp;


  準備ができたら、[作成 <b>] を</b> クリックすると、新しい Runbook が作成され、 <b>Runbook の一覧に表示</b> されます。 この "Runbook" ビューでは、さまざまなプロセスを自動化するために使用できる Runbook の独自のプライベート ライブラリについて考えます。 Runbook の基本的な操作は、開始、インポート、エクスポート、削除など、このビューから実行できます。 これらの一部については、後の投稿で説明します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Runbooks.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Runbooks" alt="Runbooks" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Runbooks_thumb.png" width="610" border="0" /></a>


  &nbsp;


  これで Runbook が Runbook ビューに作成され、[新規] と表示されます。 これで Runbook を選択し、[作成] を選択して Runbook の作成を開始できます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/SetConfig2.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Set-Config2" alt="Set-Config2" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/SetConfig2_thumb.png" width="610" border="0" /></a>


  &nbsp;


  これで、標準の PowerShell ワークフロー構文を使用して Runbook の作成を開始できます。 PowerShell ワークフローは標準の PowerShell スクリプトとは異なっています。 PowerShell ワークフローの詳細については、こちらを参照 <a href="https://technet.microsoft.com/en-us/library/jj134242.aspx" target="_blank">してください</a>。 Runbook の作成に関する質問がある場合は、フォーラムを参照<a href="https://social.msdn.microsoft.com/Forums/windowsazure/en-US/home?forum=azureautomation&amp;filter=alltypes&amp;sort=lastpostdesc" target="_blank"></a>して、他の誰かが同じ問題を抱えているか確認するか、新しい質問を投稿してください。

  <h3><span style="font-size: 1.17em">Runbook のインポート</span></h3>

  (.PS1) PowerShell ワークフロー、または以前に作成または検出した Runbook が既にある場合は、それを Runbook ライブラリに簡単にインポートできます。 これに従って、スクリプト センターから Runbook をダウンロードし、<a href="https://gallery.technet.microsoft.com/scriptcenter/site/search?f%5B0%5D.Type=RootCategory&amp;f%5B0%5D.Value=WindowsAzure&amp;f%5B0%5D.Text=Windows%20Azure&amp;f%5B1%5D.Type=SubCategory&amp;f%5B1%5D.Value=WindowsAzure_automation&amp;f%5B1%5D.Text=Automation" target="_blank"></a>システムにインポートします。 後で、この Runbook が必要ない場合は、この Runbook を削除して、Runbook の一覧をクリーンな状態に保つ必要があります。


  "Import" 関数は、Runbook タブのコマンド バーにあります。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Import.png"><img style="float: none;margin-left: auto;margin-right: auto;border-width: 0px" title="[インポート]" alt="Import" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Import_thumb.png" width="610" border="0" /></a>

  <h2></h2>

  <h2>Runbook とジョブの並べ替えとフィルター処理</h2>

  システムに Runbook が 1 つ以上あるので、 <b>Runbook</b> ビューで実行できる操作を見てみます (上の図を参照)。 このビューには、開始されたジョブに関する特定の詳細が表示されます。 ユーザーは、名前、最後のジョブの開始、最後のジョブの状態、ジョブ、作成、またはタグで並べ替える機能を持っています。これらのいくつかについて詳しく説明しましょう。

  <ul>
   <li><b>Name</b> – Runbook 名 (A ~ Z や Z-A など) による並べ替えを許可します。</li>
   <li><b>[最後の</b> ジョブの開始] – Runbook によって開始された最後のジョブ (MM/DD/YYYY HH:MM:SS AM) による並べ替えを許可します|PM)。 最後のジョブの開始は、Runbook がジョブを開始したことがないことを示す "None" になったことにも注意してください。</li>
   <li><b>[最後のジョブの</b> 状態] – ユーザーが最後のジョブの状態を表示できます。 たとえば、ジョブは、Suspended、Completed、Failed、Queued、Running、Starting など、いくつかの有限の状態の 1 つになります。</li>
   <li><b>[ジョブ</b> ] – Runbook に関連付けられているジョブの数を表示します。 この数には、実稼働環境で実行され、テスト実行を含めないジョブだけが含まれます。</li>
   <li><b>作成</b> – Runbook 定義の現在の状態を表示します。
  <ul>
   <li><b>新規 </b>– アクティブに編集されている非実稼働バージョン (UI のドラフト) が存在します。 この Runbook は、"テスト" モードでのみ実行できます。</li>
   <li><b>発行 </b>済み – ジョブを開始できる実稼働バージョン (UI 内の実稼働) が存在し、ドラフト バージョンは存在しません。 この Runbook は、"実稼働" モードでのみ実行できます。</li>
   <li><b>[編集 </b>] – 実稼働バージョンと、現在編集中のドラフト バージョンが存在します。 スケジュールと、Runbook を開始する (別の Runbook から、UI から、またはコマンドレットから) いつでも、Runbook の実稼働バージョンが開始されます。 ドラフト バージョンは、作成ウィンドウの "テスト" モードでのみ開始できます。</li>
   <li><b>タグ</b> – タグを使用すると、Runbook を分類して、検索する Runbook をすばやく識別できます。 たとえば、Runbook を実稼働またはテスト、ワークロード、またはテクノロジ別に分類できます。 タグは次のように表示される場合があります。PROD: Windows Azure、IaaS、または TEST: Virtual Machines、Library。 これらのタグは自由に形成され、ユーザーは意味のある何かを提供できます。</li>
  </ul>

  </li>
   <li><b>フィルター</b> - 右上にある虫眼鏡アイコンを選択すると、Runbook ビューの [名前] 列または [タグ] 列でフィルター処理することもできます。</li>
   <li><b>範囲</b> - 最後に、ユーザーは、ジョブの状態 (上記) に関連する X ポイントインタイムから Y ポイントインタイムまでジョブの状態を表示するために、トップ レベルのフィルター処理メカニズムを使用できます。</li>
  </ul>

  <h2>新しい Runbook の作成</h2>

  次に、Runbook 作成エクスペリエンスを実行する簡単な Runbook を作成しましょう。 問題が発生した場合に Runbook ジョブのトラブルシューティングに役立つさまざまなストリーム出力の種類を追加し、実稼働環境で Runbook のログ記録を有効または無効にする方法について説明します。


  Runbook ビューから先に作成した "Set-RunbookConfiguration" Runbook を選択して、Runbook の作成を開始します。 次に、[作成] タブをクリックして Runbook コードを表示します。 ここから、"ワークフロー名 { }" Azure Automationが自動的 <i>に追加されているのを確認できます。 </i>次に示す Runbook 定義を挿入します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Rb.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Rb" alt="Rb" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Rb_thumb.png" width="610" border="0" /></a>


  詳細ストリームと進行状況ストリームは、有効または無効にできるストリームの例です。 Verbose は、追加の情報を提供する実稼働 Runbook のトラブルシューティングを行う場合に特に便利です。 Write-Output常に表示されます。そのため、Runbook の結果は常に表示されます。


  Runbook<i> </i>を手動で入力する以外に、[挿入] ボタンを使用して、Azure Automation に読み込まれたモジュール、別の発行済み Runbook、または変数や接続のような資産にアクティビティを挿入することもできます。 [資産] タブから資産を管理したり、[管理] ボタンを使用して Runbook の作成エクスペリエンスを離れることなくアセットを作成できます。 資産は、Automation サービスでグローバルに使用できます。 今後、資産に関するより詳細な投稿が表示される予定です。


  Runbook に問題がなければ、Runbook を保存、テスト、または発行できます。 "テスト" 機能は実際にはワークフローを実行し、–WhatIf ではない点に注意してください。


  この場合は、Runbook を発行します。 これにより、読み取り専用の発行済みビューが表示されます。 これで、コマンド バーの [アプリ] をクリック[スタート] ボタン Runbook を開始できます。 これにより、ジョブと呼ばれる Runbook のインスタンスが作成 <b>されます</b>。 次の「Runbook の構成」セクションの手順を実行せずに Runbook を開始すると、詳細ストリームまたは進行状況ストリームは有効になっていないため、表示されません。 結果を比較するには、[開始] をクリックします。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/StartJob.png"><img style="float: none;margin-left: auto;margin-right: auto;border-width: 0px" title="StartJob" alt="StartJob" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/StartJob_thumb.png" width="610" border="0" /></a>

  <h2></h2>

  <h2>Runbook の構成</h2>

  Runbook は、Runbook の [構成] <b>タブを使用</b> して簡単に構成できます。


  [構成] タブから、作成した Runbook に固有の設定を変更できます。 たとえば、Runbook の整理<strong>に役立つ説明</strong>を変更したり、タグを追加したりできます。<strong></strong> これは、ワークフロー全体を完了するために一緒に動作する一連の小さな Runbook がある場合に特に役立ちます。 PowerShell ストリームのログ記録は、ここで管理できます。


  後で表示するためにログに記録する詳細ストリームと進行状況ストリームが含まれます。このため、ログ詳細レコードとログ<b>進行状況レコード</b><b>を変更します</b>。 Runbook のすべてのログ レベルを有効にするには、これらのオプションを [はい] に設定します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Configure.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="構成" alt="Configure" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Configure_thumb.png" width="610" border="0" /></a>


  構成設定を変更したので、Runbook を再度開始します。 Runbook は、次のコマンドレットを使用してプログラムStart-AzureAutomationRunbookすることもできます。 PowerShell コマンドレットの詳細については、こちらを参照してください。 Azure サービスを管理するには、Automation Assets で Azure 管理証明書をインポートして、これらのサービスに PowerShell 呼び出しを行う必要があります。 管理証明書をインポートする方法については、前のブログ「Microsoft Azure <a href="https://blogs.technet.com/b/orchestrator/archive/2014/04/10/managing-azure-services-with-the-microsoft-azure-automation-preview-service.aspx">Automation Preview Service を使用した Azure サービスの管理」を参照してください</a>。


  &nbsp;

  <h2>Runbook ジョブの調査</h2>

  この手順を実行すると、実行した 2 つのジョブが正常に完了したと表示されます。 この Runbook のジョブで発生した処理の詳細については、[ジョブ] ビューをクリックして、(選択した時間内に) 実行されたジョブを表示します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Jobs.png"><img style="float: none;margin-left: auto;margin-right: auto;border-width: 0px" title="ジョブ" alt="Jobs" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Jobs_thumb.png" width="610" border="0" /></a>


  &nbsp;


  ジョブをクリックすると、ジョブ ダッシュボード ビューが表示され、ジョブの概要、入力パラメーター、出力を確認できます。 ジョブをクリックして [履歴] タブを選択すると、前に有効にしたログ記録に関する詳細を表示できます。 たとえば、すべてのログ ストリームを有効にしたため、2 番目のジョブでは Progress と Verbose の出力を確認できますが、最初のジョブでは Write-Output 出力しか表示できません。 Runbook ソース (ジョブに対して実行されたバージョン) も使用できます。[ソースの表示] コマンドをクリックすると、このジョブに使用された実際の Runbook を確認できます。


  ジョブ 1:


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Job1.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Job1" alt="Job1" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Job1_thumb.png" width="610" border="0" /></a>


  ジョブ 2:


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Job2.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Job2" alt="Job2" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Job2_thumb.png" width="610" border="0" /></a>

  <h2></h2>

  <h2>Scheduling a Runbook</h2>

  このAzure Automation、スケジュールを作成できます。 作業している Runbook から[スケジュール] ビューに移動し、[新しいスケジュールへのリンク] を選択します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Schedule1.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Schedule1" alt="Schedule1" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule1_thumb.png" width="610" border="0" /></a>


  スケジュールの名前と説明を入力します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Schedule2.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Schedule2" alt="Schedule2" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule2_thumb.png" width="610" border="0" /></a>


  &nbsp;


  最後に、スケジュール設定を選択します。[種類]、 [開始時刻]、 [有効期限]、および [繰り返し] です。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Schedule3.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Schedule3" alt="Schedule3" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule3_thumb.png" width="610" border="0" /></a>


  &nbsp;


  このスケジュールはアクティブになります。特に変更がない限り、ローカル タイム ゾーンで実行されます。 また、複数の Runbook を同時に実行するスケジュールを設定する場合は、このスケジュールを他の Runbook に再利用できます。 スケジュールを表示またはリンク解除するには、Runbook の [スケジュール] ビューをクリックするか、[資産] ビューに移動します。


  &nbsp;


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/06/Schedule4.png"><img style="float: none;margin-left: auto;margin-right: auto;border: 0px" title="Schedule4" alt="Schedule4" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Schedule4_thumb.png" width="610" border="0" /></a>

  <h2></h2>

  <h2>まとめ</h2>

  これで、ジョブ ストリームの作成、実行、構成、ジョブの表示などの Runbook 管理タスクを完了するために、Azure Automation サービス内を移動する専門家になる必要があります。 幸せな自動化!


  まだAzure Automationユーザーではありませんか? <a href="https://aka.ms/Q2p1ap" target="_blank">プレビューにサインアップし</a> 、ガイドはじめに <a href="https://azure.microsoft.com/en-us/documentation/articles/automation-create-runbook-from-samples/" target="_blank">してください</a>。
