### YamlMime:Yaml
ms.openlocfilehash: 504c609807c796216b5a9613216b6f4b057d69ea
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893120"
Slug: cloud-service-fundamentals-telemetry-data-acquisition-pipeline
Title: 'クラウド サービスの基礎: テレメトリ - データ取得パイプライン'
Summary: データ取得パイプラインは、Azure のクラウド サービスの基礎の一部であるテレメトリ ソリューションの中核Windowsにあります。 このパイプラインは、 の 3 番目の記事の &nbsp;対象です。
Content: <p>データ取得パイプラインは、Azure のクラウド サービスの基礎の一部であるテレメトリ ソリューションの中核Windowsにあります。 このパイプラインは、Wiki シリーズの 3 <a href="https://social.technet.microsoft.com/wiki/contents/articles/18854.telemetry-data-acquisition-pipeline.aspx" target="_blank">番目の </a>&nbsp;記事の対象 <a href="https://social.technet.microsoft.com/wiki/contents/articles/17987.cloud-service-fundamentals.aspx" target="_blank">です</a>。 ソリューションにおけるその役割は、さまざまなリポジトリからさまざまな情報を抽出し、それらを 1 つのリレーショナル データベースに集約する役割です。 これを使用して、キャプチャされたメトリックに関する長期的な傾向を関連付け、分析し、特定の問題とインシデントをドリルダウンし、定義済みのレポートとアドホック の両方のレポートとダッシュボードをフィードできます (ただし、待ちます)。 これは、次の記事J) のトピックです。 質問には、&ldquo;お客様&rdquo;&ldquo;がパフォーマンスの低下を報告した場合にアプリケーション コンポーネントで何が起こっていたか、またはアプリケーションが UTC の午前 12 時から午後 1 時の間にタイムアウト エラーを生成した場合のデータ層の変更点が含まれる場合があります。&rdquo;このような質問に対する回答は、エンドツーエンドのテレメトリ ソリューションで有効にしたい分析情報の種類です。</p>  <p><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5140.tele-1.png" alt="" border="0"><br><em>図 1 - テレメトリ ソリューション アーキテクチャ全体でのデータ取得パイプラインの強調表示</em></p>  <p>アーキテクチャの観点から、データ取得パイプラインの設計を次の 3 つの主な領域に分割できます。</p>  <ol>  <li>インポートタスクと変換タスクを実行する構成可能なスケジューラ エンジン。</li>  <li>さまざまな情報ソースに対してクエリを実行し、変換ロジックを適用し、結果を一元化されたリポジトリにプッシュする、拡張可能な一連のタスク。</li>  <li>このWindows Azure SQL Databaseを共通のリレーショナル スキーマに格納するインスタンスです。これを使用して、分析クエリを実行し、意味のある情報を抽出できます。</li>  </ol>  <p>スケジューラ エンジンの実装中に、さまざまな&ldquo;&rdquo;データ ソースに対して時間間隔でクエリを実行するプル メカニズムを採用することを決定しました。 より複雑なプッシュとストリーミングのアプローチよりも&ldquo;、このアプローチを&rdquo;&ldquo;&rdquo;好む理由は多数ある。 主な点は、データが Windows Azure Storage (Windows Azure Diagnostics によって生成された情報) や Windows Azure SQL Database 内部データ構造 (動的管理ビューの場合) のような中間リポジトリに既に格納されている点です。 リアルタイムの継続的な分析に関する厳密な要件はなかったので、実装を可能な限りシンプルに保ちたいと考えています。 現在のリリースでは、スケジューラは、Windows BLOB コンテナーでホストされている XML ファイルから構成を読み取る Windows Azure Storageとして実装されています。 このファイルでは、実行するスケジュールされたジョブの数と種類、実行頻度、およびさまざまなデータ ソースと変換先へのすべての構成オプションと接続文字列を定義します。 いつでも構成ファイルを変更したり、タスクを追加または削除したり、特定の構成を変更したりすることができます。worker ロールは、更新されたファイルを選択して、必要に応じて実行を開始します。 このスケジューラ コンポーネントの多くの実稼働デプロイを実行し、ソリューションを監視している顧客やパートナーと協力しました。 この worker ロールの &ldquo;小さな&rdquo; VM サイズで、数百のターゲット コンピューティング インスタンスとデータベースを処理するのに十分である必要があるという結果が得つかりました。</p>  <p>また、次の 2 つの主要な診断ソース ファミリに接続する、多数のインポート タスクも実装しました。</p>  <ul>  <li>Windows Azure Diagnostics (WAD) によって生成されたデータ</li>  <li>Windows Azure SQL Databaseを介して公開される内部状態の管理</li>  </ul>  <p>WAD はほとんどの情報をテーブルに格納Windows Azure Storage、多くのインポート タスクは非常に似ています。 基本的に、特定の期間 (startdate から enddate) に対して Windows Azure Storage クライアント ライブラリ v2.0 コンテキストを使用してソース テーブルに対してクエリを実行し、一部の即時フィルター (重大イベントやエラー イベントなど) を適用し、データ行を即座に整形または変換し、新しい情報をコピー先データベースに一括コピーします。 このカテゴリには、ノードのパフォーマンス カウンター Windows Azure Computeイベント ログ、トレース ログWindowsなどの情報が含まれます。 より複雑な実装では、WAD によってすべての Web ロールにわたって IIS ログを収集します。これは、特定の構造で編成された BLOB コンテナーに格納されます。 まず、テーブル (特定のタイム ウィンドウで生成されたログ ファイルへの参照を含む) に対してクエリを実行し、worker ロールのローカル ストレージにこれらの IIS ログ ファイルをダウンロードして、Web ページや API 応答時間などの意味のある情報を分析して抽出する必要があります。</p>  <p>SQL Database インスタンスの場合は、(並列ファンアウト ライブラリを使用して) すべてのターゲット データベースで一般公開されている DMV に対してクエリを実行し、クエリと要求の統計から接続エラー、欠落したインデックス、データベース サイズまで、さまざまな有用な情報を抽出する特定のインポート タスクを作成します。</p>  <p>今後の改善として、分析診断とキャッシュ診断からWindows Azure Storageを追加する予定です。</p>  <p>その後、この診断情報はすべて、共通の時間ベースのキー定義を使用して単一のリレーショナル スキーマ (SQL Database でもホスト) に格納され、時間間隔クエリ用に最適化されます。 この単純な理由は、特定&rsquo;のインシデントを調査したり、時間の流中の傾向を把握したりするために使用する可能性が非常に高いからです。</p>  <p>前に説明&rsquo;したように、次の記事では、テーブル値関数 (TVF) レイヤーに焦点を当て、OpsStatsDB から興味深い情報をクエリして抽出する方法について説明します。 これらの TVF を作成して、アプリケーションを使用したアドホック レポートの実装Excel。 また&rsquo;、Cloud Service Fundamentals コード パッケージと共Windows Azure SQL Reporting Services のレポートとダッシュボードのセットも確認します。</p>  <p>シリーズ全体は、 <a href="https://social.technet.microsoft.com/wiki/contents/articles/17987.cloud-service-fundamentals.aspx" target="_blank">Cloud Service Fundamental</a> TechNet Wiki ランディング ページにあります。</p>
