### YamlMime:Yaml
ms.openlocfilehash: 07bde277cfe23787f02690b29b22ec4daccb6531
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891120"
Slug: azure-virtual-machine-scale-sets-now-provide-simpler-management-during-scalein
Title: Azure Virtual Machine Scale Sets では、スケールイン中の管理が簡単になりました
Summary: Azure Virtual Machine Scale Sets の3つの新機能の一般提供が開始され、スケールイン中の仮想マシンインスタンスの適切な処理をより細かく制御できるようになりました。
Content: >-
  <p>最近、Azure Virtual Machine Scale Sets の3つの機能の <a href="https://azure.microsoft.com/en-us/updates/virtual-machine-scale-sets-now-simpler-to-manage/" target="_blank">一般提供</a> を発表しました。 インスタンス保護、カスタムスケールインポリシー、および終了通知は、スケールイン中の仮想マシンインスタンスの管理を簡略化する新しい機能を提供します。</p>


  <p><a href="https://azure.microsoft.com/en-us/services/virtual-machine-scale-sets/" target="_blank">Azure Virtual Machine Scale Sets</a> は、グループ内の多数の仮想マシン (VM) インスタンスをまとめてデプロイし、簡単に管理する方法です。 また、スケールセットの <a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview" target="_blank">自動スケールルール</a> を構成して、ワークロードに必要な量に基づいてインスタンスの数を動的に増減できるようにすることもできます。</p>


  <p>これらの新機能により、スケールイン時にインスタンスの削除を適切に処理できるようになりました。これにより、アプリケーションやサービスのユーザーエクスペリエンスを向上させることができます。 これらの新機能は、パブリッククラウドとソブリンクラウドのすべての Azure リージョンで利用できます。 Azure Virtual Machine Scale Sets でこれらの機能を使用する場合、追加料金は発生しません。</p>


  <p>これらの機能によって、スケールイン時の制御が向上するしくみを見てみましょう &rsquo; 。</p>


  <h2>インスタンス保護 &mdash; : 1 つ以上のインスタンスをスケールインから保護します</h2>


  <p>スケールインが発生したときにこれらのインスタンスを削除したくない場合は、スケール <em>インから</em> のポリシー保護をスケールセット内の1つ以上のインスタンスに適用できます。 これは、スケールセット内の他のインスタンスを動的にスケールインまたはスケールアウトするときに保持する必要がある特殊なインスタンスがいくつかある場合に便利です。 これらのインスタンスは、スケールセット内の他のインスタンスとは異なる特定の特殊なタスクを実行している可能性があります。これらの特殊なインスタンスをスケールセットから削除することはできません。 <a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-instance-protection" target="_blank">インスタンス保護</a> は、ワークロードに対してこのようなシナリオを可能にする機能を提供します。</p>


  <h3>スケールセットアクションから1つ以上のインスタンスを保護する</h3>


  <p>また、<a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-instance-protection" target="_blank">インスタンス保護</a>を使用すると、再イメージ化やアップグレードなどの他のスケールセット操作中に、1つ以上のインスタンスが変更されないように保護することもできます。 これを行うには、 <em>スケールセットアクションから</em> 特定のインスタンスにポリシー保護を適用します。 インスタンスにこのポリシーを適用すると、スケールインからも自動的に保護されます。</p>


  <h2>カスタムスケールインポリシー &mdash; スケールイン時のインスタンスの削除の順序を構成する</h2>


  <p>スケールイン中に1つ以上のインスタンスをスケールセットから削除する必要がある場合は、可用性ゾーンと障害ドメイン間でのスケールセットのバランスが維持されるように、インスタンスが削除対象として選択されます (該当する場合)。 <a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-scale-in-policy" target="_blank">カスタムスケールインポリシー</a> を使用すると、スケールイン中に削除するインスタンスを選択する順序をさらに指定したり、制御したりすることができます。 <em>Oldestvm</em>スケールインポリシーを使用して、最初に作成された最も古いインスタンスを削除するか、 <em>NewestVM</em>スケールインポリシーを使用して、作成された最も新しいインスタンスを最初に削除することができます。 どちらのシナリオでも、 <a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones#zone-balancing" target="_blank">可用性ゾーン間</a> での分散は優先されます。 いずれかの保護ポリシーをインスタンスに適用している場合は、スケールイン中に削除するように選択されません。</p>


  <p>次に示すのは、3つの可用性ゾーンと初期インスタンス数が9であるスケールセットのスケールイン順序の例です。 これらの例では、インスタンス ID が最も小さい VM が最初に作成され、最大インスタンス ID に関連付けられた VM が最後に作成されていることを前提としています。 点線で囲まれた VM インスタンスは、インスタンス保護ポリシーの1つを使用して保護されていることを表します。 "クロス" は、スケールイン中に VM インスタンスが削除対象として選択されることを示します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0caf5371-1017-47d0-84f6-87a30a89d184.jpg"><img alt="Newest VM scale-in policy example. The VM with ID 9 is deleted first during scale-in which is the newest created VM. Next, the VM with ID 7 is deleted during scale-in because the VM with ID 8 is a protected VM." border="0" height="696" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/985df91e-de4d-4c27-a28b-f3ec9be164e3.jpg" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="最新の VM スケールインポリシーの例。 ID 9 の VM は、新しく作成された VM であるスケールイン中に最初に削除されます。 次に、id が8の vm が保護された VM であるため、スケールイン中に ID 7 の VM が削除されます。" width="1024"></a></p>


  <p>&nbsp;</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f20749a0-3c77-4e34-96ea-58980f99c3ab.jpg"><img alt="Oldest VM scale-in policy example. The VM with ID 1 is deleted first during scale-in which is the oldest created VM. Next, the VM with ID 3 is deleted during scale-in because the VM with ID 2 is a protected VM." border="0" height="693" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/67bbce4b-c145-44cd-8d0b-4f2428dc2a6b.jpg" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="最も古い VM スケールインポリシーの例。 ID 1 の VM は、最初に、作成された最も古い VM であるスケールイン中に削除されます。 次に、id が2の vm が保護された VM であるため、スケールイン中に ID 3 の VM が削除されます。" width="1024"></a></p>


  <h2>インスタンスの削除に関する VM の受信通知の終了通知 &mdash;</h2>


  <p>インスタンスをスケールセットから削除しようとしているときに、インスタンスで特定のカスタムアクションを実行することができます。 これらのアクションの例としては、ロードバランサーからの登録解除や、ログのコピーなどがあります。 スケールインなどの理由で、インスタンスの削除がプラットフォームによってトリガーされた場合、アプリケーションが中断されたり、役に立つログが適切に保持されないように、これらのアクションをプログラムで実行する必要があります。 <a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-terminate-notification" target="_blank">終了通知</a>機能を使用すると、インスタンスを構成して、インスタンスの今後の削除に関する、VM 内の通知を受信するように構成できます。また、インスタンスでこのようなカスタムアクションを実行するには、5 ~ 15 分間、削除操作を一時停止します。</p>


  <p>終了通知は、Azure metadata service &mdash; のスケジュールされた<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/scheduled-events" target="_blank">イベント</a> &mdash; を介して送信され、VM インスタンス内からアクセスできる REST エンドポイントを使用して受信できます。 構成されたエンドポイントでインスタンスが終了通知を受け取ると、特定のアクションまたはスクリプトを実行するように構成できます。 これらの操作が完了し、事前に構成された一時停止タイムアウトが終了するのを待たずに、メタデータサービスの POST 呼び出しを発行して、削除を承認することができます。 これにより、インスタンスの削除が続行されます。</p>


  <h2>はじめに</h2>


  <p>スケールセットに対してこれらの機能を有効にするには、REST API、Azure CLI、Azure PowerShell または Azure Portal を使用します。 詳細な手順については、ドキュメントページへのリンクを以下に示します。</p>


  <ul>
      <li><a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-instance-protection" target="_blank">インスタンスの保護</a></li>
      <li><a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-scale-in-policy" target="_blank">カスタムスケールインポリシー</a></li>
      <li><a href="https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-terminate-notification" target="_blank">終了通知</a></li>
  </ul>
