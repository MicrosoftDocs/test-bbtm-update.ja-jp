### YamlMime:Yaml
ms.openlocfilehash: efc1a55b090c6af073edab97f937c72d9af34b15
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892880"
Slug: more-resource-policy-aliases
Title: その他のリソース ポリシーエイリアス
Summary: このブログでは、リソース ポリシーの新しいエイリアスについて説明します。
Content: "<p>リソース ポリシーのエイリアスを使用すると、リソースのプロパティに対して許可される値または条件を制限できます。 既にポリシーエイリアス<a href=\"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-policy#aliases\">に精通</a><a href=\"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-policy#aliases\"></a>している場合は、Azure 環境を管理する上で重要な部分です。</p>\n\n<p>新しいポリシーエイリアスを追加し続け、環境にデプロイされるリソースを簡単に管理できるようしたいと考えています。 このブログでは、有効にした最新のエイリアスを共有します。</p>\n\n<p>まず、エイリアス&rsquo;がユーザー要求に統合される方法を確認します。 各ポリシー エイリアスは、特定のリソースの種類に対して異なる API バージョンのパスにマップされます。 ポリシーの評価中に、ポリシー エンジンは特定のフィールドの値を取得すると、要求の API バージョンを確認し、そのバージョンのパスを取得します。 次の図は、ポリシーの評価時にポリシーエイリアスがどのように機能するのか示しています。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2fc981a6-9b63-45ac-a3dd-50a0f87adad4.png\"><img alt=\"howaliasworks\" border=\"0\" height=\"861\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b67fda3b-1fc2-4eb9-b33f-158e826cca6c.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"howaliasworks\" width=\"1411\"></a></p>\n\n<h2>仮想マシンのカスタム イメージ</h2>\n\n<p>セキュリティ上の理由から、多くのお客様は、中央 IT チームのカスタム イメージのみを環境にデプロイしたいと考えています。 IT チームは、一連のマネージド イメージ&nbsp;<a href=\"https://docs.microsoft.com/en-us/azure/virtual-machines/windows/capture-image-resource\">を</a>承認し、リソース グループに入れる。 これらのイメージから VM が作成されるのを確認するには、リソース ポリシーを実装します。 実装の場合は、イメージを含むリソース グループを指定するか、イメージを明示的に指定できます。</p>\n\n<p>このシナリオを有効にするために、Microsoft.Compute/imageId エイリアスを追加しました。 型の条件を変更することで、仮想マシンまたは仮想マシン スケール セットに使用できます。</p>\n\n<p>次の例は、ポリシーの外観を示しています。</p>\n\n<p>例 1: (特定のリソース グループのイメージを使用する)</p>\n\n<pre class=\"prettyprint\">\n{\n    &quot;if&quot;: {\n        &quot;allOf&quot;: [\n            {\n                &quot;field&quot;: &quot;type&quot;,\n                &quot;equals&quot;: &quot;Microsoft.Compute/virtualMachines&quot;\n            },\n            {\n                &quot;not&quot;: {\n                    &quot;field&quot;: &quot;Microsoft.Compute/imageId&quot;,\n                    &quot;contains&quot;: &quot;resourceGroups/testImage&quot;\n                }\n            }\n        ]\n    },\n    &quot;then&quot;: {\n        &quot;effect&quot;: &quot;deny&quot;\n    }\n} \n</pre>\n\n<p>例 2: (特定の画像を使用する)&nbsp;</p>\n\n<pre class=\"prettyprint\">\n {\n\n                    &quot;field&quot;: &quot;Microsoft.Compute/imageId&quot;,\n\n                    &quot;in&quot;: [&quot;&lt;imageId1&gt;&quot;,&quot;&lt;imageId2&gt;&quot;]\n\n                }\n\n   </pre>\n\n<p><strong>Microsoft.Compute/imageId は</strong> 、有効にした新しいエイリアスです。 型の条件を変更することで、仮想マシン スケール セットにも使用できます。</p>\n\n<h2>プラットフォーム イメージ</h2>\n\n<p>リソースの種類間で使用できるエイリアスのセットを導入しました。 これらのリソース間の種類のエイリアスを使用<a href=\"https://docs.microsoft.com/en-us/azure/virtual-machines/windows/policy?toc=%2fazure%2fazure-resource-manager%2ftoc.json\"></a>すると、仮想マシン、仮想マシン スケール セット、およびマネージド ディスクのプラットフォーム イメージを制限できます。 たとえば、<b>エイリアス Microsoft.Compute/imagePublisher</b>&rsquo; にはリソースの種類の名前が付いておかしいので、さまざまなリソースの種類で動作できます。 リンクされた例は、これらのエイリアスを使用する方法を示しています。</p>\n\n<h2>マネージド ディスクを使用する</h2>\n\n<p>マネージド ディスクのリリースにより、多くのお客様は、VM に対してマネージド ディスクのみをデプロイする必要があります。 リソース ポリシーを使用して、マネージド ディスクのみを使用する VM と <a href=\"https://docs.microsoft.com/en-us/azure/virtual-machines/windows/policy?toc=%2fazure%2fazure-resource-manager%2ftoc.json\">スケール セットを制限できます</a>。 このポリシーでは、マネージド ディスクに関連するフィールドがユーザー要求に存在する必要があります。 これらのフィールドは、リンクされた例に示されています。 これらのフィールドを探して、マネージド ディスクが VM とスケール セットの間で使用されているかどうかを判断できます。</p>\n\n<h2>VM 拡張機能の種類</h2>\n\n<p>組織は、特定の種類の拡張機能の使用を制限する必要がある場合があります。 たとえば、VM 拡張機能は、特定のカスタム VM イメージと互換性がない場合があります。 または、セキュリティ上の理由から、&rsquo;ユーザーが VM のパスワードをリセットしたくはありません。 次の例は、特定の VM 拡張機能をブロックする方法を示しています。 発行元と種類を使用して、ブロックする拡張機能を決定します。</p>\n\n<pre class=\"prettyprint\">\n{\n    &quot;if&quot;: {\n        &quot;allOf&quot;: [\n            {\n                &quot;field&quot;: &quot;type&quot;,\n                &quot;equals&quot;: &quot;Microsoft.Compute/virtualMachines/extensions&quot;\n            },\n            {\n                &quot;field&quot;: &quot;Microsoft.Compute/virtualMachines/extensions/publisher&quot;,\n                &quot;equals&quot;: &quot;Microsoft.Compute&quot;\n            },\n            {\n                &quot;field&quot;: &quot;Microsoft.Compute/virtualMachines/extensions/type&quot;,\n                &quot;equals&quot;: &quot;VMAccessAgent&quot;\n\n      }\n        ]\n    },\n    &quot;then&quot;: {\n        &quot;effect&quot;: &quot;deny&quot;\n    }\n}\n</pre>\n\n<h2>Azure Hybrid Use Benefit</h2>\n\n<p>適切なオンプレミス ライセンスがある場合は、仮想マシンにライセンス料金を節約できます。 ライセンスを持&rsquo;ってない場合は、 オプションを無効にする必要があります。 次のポリシーでは、Azure ハイブリッド使用特典 (AHUB) の使用を制限しています。</p>\n\n<pre class=\"prettyprint\">\n{\n    &quot;if&quot;: {\n        &quot;allOf&quot;: [\n            {\n                &quot;field&quot;: &quot;type&quot;,\n                &quot;in&quot;:[ &quot;Microsoft.Compute/virtualMachines&quot;,&quot;Microsoft.Compute/VirtualMachineScaleSets&quot;]\n            },\n            {\n                &quot;field&quot;: &quot;Microsoft.Compute/licenseType&quot;,\n                &quot;exists&quot;: true\n            }\n        ]\n    },\n    &quot;then&quot;: {\n        &quot;effect&quot;: &quot;deny&quot;\n    }\n}</pre>\n\n<h2>まとめ</h2>\n\n<p>簡単なまとめとして、このブログでは、ポリシーエイリアスのしくみと、リソース ポリシーを通じて管理できる内容について説明します。 それらを試して、管理する新しい情報をお知らせします。</p>"
