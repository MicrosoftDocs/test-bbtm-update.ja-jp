### YamlMime:Yaml
ms.openlocfilehash: ea63c44f3d979dd717da72a8bc6b874dec594b34
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890842"
Slug: doazureparallel
Title: 'doAzureParallel: R セッションから直接 Azure の柔軟なコンピューティングを活用する'
Summary: DoAzureParallel – Azure Batch の上に構築された軽量の R パッケージであり、R セッションから直接 Azure の柔軟なコンピューティングリソースを簡単に使用できるようになります。
Content: "<p>多くの場合、 <a href=\"https://www.r-project.org\" target=\"_blank\">R 言語</a> のユーザーは、ローカルコンピューターが処理できるよりも多くのコンピューティング能力を必要とします。 ただし、クラウドの容量を活用するために作業をスケールアップすることは複雑で面倒な場合があり、R ユーザーはアルゴリズムを重視しないことがよくあります。</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/azure/batch/batch-technical-overview\" target=\"_blank\">Azure Batch</a>上に構築さ &ndash; れた軽量の r パッケージを使用して、r セッションから直接 Azure &rsquo; の<a href=\"https://www.github.com/Azure/doAzureParallel\" target=\"_blank\">柔軟なコンピューティング</a>リソースを簡単に使用できるようにしました。 doazureparallel コンプリメント<a href=\"https://www.microsoft.com/en-us/cloud-platform/r-server\">Microsoft R Server</a> 、大規模なコンピューティング並列シミュレーションを実行するためのインフラストラクチャを提供します。</p>\n\n<p>主に、doAzureParallel パッケージは、広く普及している <a href=\"https://cran.r-project.org/web/packages/foreach/\" target=\"_blank\">foreach パッケージ</a>の並列バックエンドであり、Azure 仮想マシンのクラスター全体で複数のプロセスを実行できます。 数行のコードで、このパッケージは、Azure でクラスターを作成して管理し、foreach パッケージで使用する並列バックエンドとして登録するのに役立ちます。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/da20fbcb-e577-416e-87a1-cbd47c46fe3f.png\"><img alt=\"doAzureParallel diagram\" border=\"0\" height=\"343\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/101fd79e-be44-4416-b858-10058233166b.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"doAzureParallel ダイアグラム\" width=\"610\"></a></p>\n\n<p>DoAzureParallel では、 &rsquo; 個々の仮想マシンのクラスターを手動で作成、構成、管理する必要はありません。 代わりに、このパッケージでは、ローカルコンピューターでのアルゴリズムの実行に比べて、大規模なジョブの実行が可能になります。 Azure Batch &rsquo; の自動スケール機能を使用すると、ワークロードに合わせてクラスターのサイズを増減させ、時間やコストを節約することもできます。</p>\n\n<p>また、doAzureParallel は <a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft-ads.standard-data-science-vm\" target=\"_blank\">Azure Data Science Virtual Machine (DSVM)</a>も使用します。これにより、Azure Batch はできるだけ少ない時間で簡単かつ迅速に適切な環境を構成できます。</p>\n\n<p>これらの機能 &ndash; に対して追加料金は発生しません。使用する Azure vm に対してのみ料金が発生します。</p>\n\n<p>doAzureParallel は、パラメータースイープやモンテカルロシミュレーションなどの驚異的並列処理を実行するのに最適で、多くの財務モデリングアルゴリズム (バックテスト、ポートフォリオシナリオのモデリングなど) に適しています。</p>\n\n<h2>インストール/前提条件</h2>\n\n<p>doazureparallel を使用するには、Batch アカウントと Storage アカウントが Azure にセットアップされている必要があります。 詳細については、「 <a href=\"https://github.com/Azure/doAzureParallel#azure-requirements\">Azure アカウント</a>の設定」を参照してください。</p>\n\n<p>パッケージは、Github から直接インストールできます。 詳細については <a href=\"https://www.github.com/Azure/doAzureParallel#installation\">、インストール手順と依存関係</a>に関する情報を参照してください。</p>\n\n<h2>作業の開始</h2>\n\n<p>パッケージをインストールすると、作業の開始が数行のコードで簡単に実行できます。</p>\n\n<p>パッケージを読み込みます。</p>\n\n<pre class=\"prettyprint\">\nlibrary(doAzureParallel)</pre>\n\n<p>Azure を使用して、並列バックエンド (仮想マシンのプール) を設定します。</p>\n\n<pre class=\"prettyprint\">\n# 1. Generate your credentials config and fill it out with your Azure information\ngenerateCredentialsConfig(&ldquo;credentials.json&rdquo;)\n\n# 2. Set your credentials\nsetCredentials(&ldquo;credentials.json&rdquo;) \n\n# 3. Generate your cluster config to customize your cluster\ngenerateClusterConfig(&ldquo;cluster.json&rdquo;)\n\n# 4. Create your cluster in Azure passing, it your cluster config file.\ncluster &lt;- makeCluster(&ldquo;cluster.json&rdquo;)\n\n# 5. Register the cluster as your parallel backend\nregisterDoAzureParallel(cluster)\n</pre>\n\n<p>% Dopar% キーワードを使用して並列 foreach ループを実行します。 Foreach 関数は、並列コードの結果を返します。</p>\n\n<pre class=\"prettyprint\">\nnumber_of_iterations &lt;- 10\nresults &lt;- foreach(i = 1:number_of_iterations) %dopar% {\n    # This code is executed, in parallel, across your Azure pool.\n    myAlgorithm(&hellip;)\n}</pre>\n\n<p>大規模な環境で開発する場合は、最初にコードをローカルでテストおよびデバッグすることをお勧めします。 % Dopar% と% do% を切り替えて、Azure での並列実行とローカルコンピューターでの実行を切り替えます。</p>\n\n<pre class=\"prettyprint\">\n# run your code sequentially on your local machine\nresults &lt;- foreach(i = 1:number_of_iterations) %do% { &hellip; }\n\n# use the doAzureParallel backend to run your code in parallel across your Azure pool\nresults &lt;- foreach(i = 1:number_of_iterations) %dopar% {&hellip;}</pre>\n\n<p>R コードの大規模な &rsquo; 実行が完了したら、vm のプールをシャットダウンして、課金されないようにすることができます。</p>\n\n<pre class=\"prettyprint\">\n# shut down your pool\nstopCluster(pool)</pre>\n\n<h2><br>\nモンテカルロの価格シミュレーションのデモ</h2>\n\n<p>次のデモでは、1つの株式の500万異なる結果をシミュレートすることで、5年後の株価の予測を簡略化したバージョンを示します。</p>\n\n<p>たとえば、Contoso&#39;の株価が1日に <strong>平均1.001 倍</strong> に達したとしても、 <strong>0.01 の変動</strong>があると仮定します。&#39; <b>$100 の開始価格</b>を指定すると、モンテカルロの価格シミュレーションを使用して、Contoso&#39;s 株式が5年後にどのような価格であるかを判断できます。</p>\n\n<p>まず、前提条件を定義します。</p>\n\n<pre class=\"prettyprint\">\nmean_change = 1.001\nvolatility = 0.01\nopening_price = 100</pre>\n\n<p>前に定義した変数を使用して正規分布から累積製品を取得することによって、 <strong>5 年間 &nbsp; にわたる1つの結果に対する株価の移動をシミュレート </strong>する関数を作成します。</p>\n\n<pre class=\"prettyprint\">\nsimulateMovement &lt;- function() {\n    days &lt;- 1825 # ~ 5 years\n    movement &lt;- rnorm(days, mean=mean_change, sd=volatility)\n    path &lt;- cumprod(c(opening_price, movement))\n    return(path)\n} </pre>\n\n<p>ローカルコンピューターで、 <strong>可能な30個</strong> の結果をシミュレートし、結果をグラフ化します。</p>\n\n<pre class=\"prettyprint\">\nsimulations &lt;- replicate(30, simulateMovement())\nmatplot(simulations, type=&#39;l&#39;) # plots all 30 simulations on a graph</pre>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1cbfcb90-e615-4346-a641-de01c702b9ed.png\"><img alt=\"doAzureParallel - demo image 1\" border=\"0\" height=\"287\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8cfaeb8c-b049-4eff-95f1-d3c14add4bc0.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"doAzureParallel-デモ画像1\" width=\"520\"></a></p>\n\n<p>Contoso&#39;の株価額が5年になる場所を理解するには、各シミュレーションの終値 (線で表される) の分布を把握しておく必要があります。 しかし、可能な限り30の結果の分布を確認するのではなく、 <strong>500万の結果をシミュレート</strong> して、分布の大規模なサンプルを取得することができます。</p>\n\n<p>1つの考えられる結果に対して株価の移動をシミュレートする関数を作成します。ただし、 <strong>終了価格</strong>のみが返されます。</p>\n\n<pre class=\"prettyprint\">\ngetClosingPrice &lt;- function() {\n    days &lt;- 1825 # ~ 5 years\n    movement &lt;- rnorm(days, mean=mean_change, sd=volatility)\n    path &lt;- cumprod(c(opening_price, movement))\n    closingPrice &lt;- path[days]\n    return(closingPrice)\n}</pre>\n\n<p>Foreach package と doAzureParallel を使用すると、Azure で500万の結果をシミュレートできます。 これを並列化するために、10万の結果を50イテレーションで実行できます。</p>\n\n<pre class=\"prettyprint\">\nclosingPrices &lt;- foreach(i = 1:50, .combine=&#39;c&#39;) %dopar% {\n    replicate(100000, getClosingPrice())\n}</pre>\n\n<p>DoAzureParallel バックエンドに対して foreach パッケージを実行した後、Azure Portal で Azure Batch アカウントを調べて、シミュレーションを実行している Vm のプールを確認できます。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ea846616-933b-4107-a7bd-c6f3ca6530f0.png\"><img alt=\"doAzureParallel - demo image 2\" border=\"0\" height=\"412\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7d66444a-e337-49f7-a8f4-58d3dc96a75a.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"doAzureParallel-デモ画像2\" width=\"610\"></a></p>\n\n<p>ヒートマップ内のノードに色が変化すると、価格シミュレーションでの作業中であることがわかります。</p>\n\n<p>シミュレーションが完了すると、パッケージは各シミュレーションの結果を自動的にマージし、ノードから取り出して、R セッションで結果を使用できるようにします。</p>\n\n<p>最後に、結果をプロットして、500万の結果に対する終値の分布を把握&#39;ます。</p>\n\n<pre class=\"prettyprint\">\n# plot the 5 million closing prices in a histogram\nhist(closingPrices) </pre>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a708a370-f649-4824-89df-32cfe6a47b3d.png\"><img alt=\"doAzureParallel - demo image 3\" border=\"0\" height=\"341\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9ebae183-95cb-43e9-af48-0267b5d5a32e.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"doAzureParallel-デモ画像3\" width=\"520\"></a></p>\n\n<p>上記のディストリビューションに基づいて、Contoso&#39;の株価額は、$100 年の期首価格から <strong>約 $500 の</strong>5 年後の終値に移行される可能性が高くなります。</p>\n\n<p>&nbsp;</p>\n\n<hr>\n<p><br>\nこれらの機能を使用してお客様のフィードバックをお待ちしております。 フィードバックについては、までご連絡 <a href=\"mailto:razurebatch@microsoft.com\">razurebatch@microsoft.com</a> ください。または、 <a href=\"https://www.github.com/Azure/doAzureParallel\" target=\"_blank\">Github リポジトリ</a>に投稿してください。</p>\n\n<h3>追加情報:</h3>\n\n<ul style=\"margin-left: 40px;\">\n <li><a href=\"https://www.github.com/Azure/doAzureParallel\">DoAzureParallel のダウンロードと開始</a></li>\n <li>DoAzureParallel パッケージの使用に関する質問については、 <a href=\"https://www.github.com/Azure/doAzureParallel/tree/master/docs\">ドキュメント</a>を参照してください。または、 <a href=\"mailto:razurebatch@microsoft.com\">razurebatch@microsoft.com</a></li>\n <li><a href=\"https://www.github.com/Azure/doAzureParallel/issues\">Github 経由で問題を送信してください</a></li>\n</ul>\n\n<h3>その他の情報</h3>\n\n<ul style=\"margin-left: 40px;\">\n <li>DoAzureParallel パッケージによって使用される、基になる Azure サービスの<a href=\"https://azure.microsoft.com/en-us/services/batch\"> Azure Batch</a>を参照してください。</li>\n <li><a href=\"https://azure.microsoft.com/en-us/solutions/high-performance-computing\">Azure でのより汎用的な HPC</a></li>\n</ul>"
