### YamlMime:Yaml
ms.openlocfilehash: 9860943c4df899c90e0a874bab982fce9ddf9342
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896665"
Slug: advancing-failure-prediction-and-mitigation-introducing-narya
Title: 障害の予測と軽減策の推進 — ナヤの紹介
Summary: Projectナヤは、包括的なエンドツーエンドの予測と軽減サービスです。これは、時間のたつれを抵抗することが知られているリングの "リング" にちなんで名付けられています。
Content: >-
  <p><em>&quot;この投稿では、Azure プラットフォームの<a href="https://www.aka.ms/AdvancingReliability" target="_blank">信頼性</a>を継続的に向上させるために進行中の取り組みを強調する、信頼性の向上シリーズを続けて説明します。2018 年には、ライブ マイグレーション&#39;仮想マシン (VM) の回復性を向上させるために実行する手順<a href="https://azure.microsoft.com/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/" target="_blank">を共有しました</a>。201&#39;&nbsp; 9 年には、<a href="https://azure.microsoft.com/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/" target="_blank">Project Tardigrade</a> を使用して仮想マシンの回復性をさらに向上させる方法について説明しました。これは、ホストの障害を識別し、メモリを保持するソフト カーネルの再起動を通じて回復します。2020 年には、人工知能を使用してサービス品質を向上させる <a href="https://azure.microsoft.com/blog/advancing-azure-service-quality-with-artificial-intelligence-aiops/" target="_blank">AIOps</a> ビジョンを共有しました。今日、これらの取り組みの進化に関する更新プログラムを提供したいと思いました。Project Narya、エンドツーエンドの予測、軽減サービスを導入しました。先週 <a href="https://www.youtube.com/watch?v=69PrhWQorEM" target="_blank">Microsoft Ignite で共有</a>したのと同様に、Narya は Azure のインテリジェント インフラストラクチャの重要な部分です。次の投稿は、私たちのチームのプログラム マネージャー<strong>である Jeffrey He</strong> によってAzure Computeされました。&quot;&mdash;</em>Mark Russinovich、CTO、Azure</p>


  <hr>

  <p><em>この投稿には、プリンシパル データ科学者 Manager <strong>Yingnong Dang</strong> とシニア データ サイエンティスト <strong>Sebastien Levy</strong>、 <strong>Ranienph Yao</strong>、 <strong>および Youing Wu</strong> からの投稿が含まれています。</em></p>


  <p>Projectナ&mdash;&quot;&quot;ヤは包括的なエンドツーエンドの予測と軽減サービスです。これは、時間のたつれを抵抗することが知られているリングオブ ザ リングからの火災のリングの後に名前が付けられています。 Narya は、Azure ホストの障害を予測して軽減するだけでなく、軽減策アクションの影響を測定し、自動フィードバック ループを使用して軽減戦略をインテリジェントに調整するように設計されています。 これは、世界中のすべての Azure コンピューティング クラスターにデプロイした一般的な機械学習および予測サービス システムである Resource Central プラットフォームを活用しています。 Narya は 1 年間以上の実稼働環境で実行され、平均して、仮想マシンの中断が 26%&mdash; 減少し、Azure ワークロードの円滑な実行に役立っています。&nbsp;このブログ記事では、この Narya <a href="https://www.usenix.org/conference/osdi20/presentation/levy" target="_blank">&quot;フレームワークの概要について説明します。詳細については、オペレーティング システムの設計と実装に関する第 14 回 USENIX シンポジド (OSDI 2020) の「運用クラウド VM&quot;</a> の中断を回避する予測および適応型障害の軽減策」の論文を参照してください。&nbsp;</p>


  <h2>Narya の前にこれをどのようにアプローチしましたか?</h2>


  <p>以前は、機械学習を使用して障害予測を通知し、予測された障害に基づいて軽減策アクションを静的に選択しました。 たとえば、&quot;&quot;&nbsp;&nbsp;ハードウェアの一部が危険にさらされると判断された場合は、仮想マシンの通知を通じて機能低下したハードウェアが検出されたと、ワークロードを実行しているお客様に通知します。 また、常に次の一連の手順を実行します。</p>


  <ol>
      <li>ノードでの新しい割り当てをブロックします。</li>
      <li>(ライブ マイグレーションを使用して) 可能な限り多くの仮想マシンをその他の場所に移行します。</li>
      <li>短期間の仮想マシンが有機的に&nbsp;停止するか、顧客によって再デプロイされるのを数日待ちます。</li>
      <li>仮想マシンを切断し、正常な&nbsp;ノードに移動して、残りの仮想マシンを移行します。</li>
      <li>ノードを実稼働から取り出し、内部診断を実行して修復アクションを決定します。</li>
  </ol>


  <p>このアプローチはうまくいったが、特定のシナリオで改善する機会がいくつか見えました。 たとえば、仮想マシンが停止または再デプロイされるのを何日も待つには、一部の障害 (ディスクの破損など) が深刻すぎる可能性があります。 また、危険な予測 &quot;の&quot; 方が軽微な場合や偽陽性である場合があります。 このような場合は、強制移行によって不要な顧客への影響が発生します。代わりに、さらなるシグナルの監視を継続し、特定の期間後にノードを再評価する方が良いです。 最終的に、お客様に最適なシステムを真に設計するには、予測に対する対応方法の柔軟性を高め、さまざまなシナリオに対するアクションの顧客への正確な影響を測定する必要があるという結論に終わったのです。</p>


  <h2>ここでは、Narya を使用してこのアプローチを行う方法を示します。</h2>


  <p>ここで、Narya が使用されます。 危険な予測に対して&quot;&quot;事前に決定された軽減策アクションを 1 つ持つのではなく、Narya は多くの可能な軽減策を検討します。 特定の予測セットについて、Narya はオンラインの A/B テスト フレームワークまたは強化学習フレームワークのいずれかを使用して、可能な限り最適な応答を決定します。</p>


  <h3>フェーズ 1: 障害予測</h3>


  <p>Narya は、ハードウェア障害によるホスト障害の可能性を予測するために、フリート テレメトリを使用して開始します。 ドメインエキスパート、ナレッジ ベースの予測ルール、機械学習ベースの方法の両方を組み合わせ、正確な予測を生成できます。</p>


  <p>&nbsp;ドメインエキスパート予測ルールの例は、CPUInternal&nbsp; Error (IERR) が n 日以内に 2 回発生した場合 (n = 30 など)、ノードがすぐに再び失敗する可能性を示しています。 現在、Narya では、データ駆動型メソッドから派生した数十のドメインエキスパート予測ルールを使用しています。</p>


  <p>また、Narya&mdash; には機械学習モデルも組み込み、予測ルールよりも大きな時間枠でより多くのシグナルとパターンを分析し、より早く障害を予測することができるため便利です。 これは、以前の障害予測作業に基が構築されますが、個々のコンポーネントの障害に重点を置くのではなく、このモデルでは、実際の顧客への影響に関してホストの全体的な正常性が確認されます。 2018 年から、受信信号の種類も拡張され、信号の品質が向上しています。 その結果、偽陽性と陰性の数が減り、最終的にこの失敗予測ステップの有効性が向上しました。</p>


  <h3>フェーズ 2: 軽減策の決定と適用</h3>


  <p>軽減策戦略を 1 つ固定するのではなく、Narya が考慮すべき軽減策の選択を作成しました。 各軽減策は、次を含む多くの小さな手順の複合と見なされます。</p>


  <ul>
      <li>ノードを非呼び出し可能としてマークする。</li>
      <li><a href="https://azure.microsoft.com/blog/improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration/" target="_blank">仮想マシンを他</a> のノードに&nbsp;ライブ マイグレーションする。</li>
      <li><a href="https://azure.microsoft.com/blog/improving-azure-virtual-machines-resiliency-with-project-tardigrade/" target="_blank">メモリを保持しながらカーネルを</a> ソフト再起動すると、短時間の一時停止しか発生するお客様のワークロードの中断を最小限に抑える。</li>
      <li>ノード上の割&nbsp;り当て解除。</li>
      <li>その他</li>
  </ul>


  <p>たとえば、軽減策の 1 つは、ノードを非呼び出し可能としてマークしてから、メモリを保持するカーネルのソフト再起動を試み、成功した場合は再び割り当て可能をマークする操作です。 失敗した場合は、ライブ マイグレーションを実装し、ノードを診断に送信します。そこでテストを実行して、ハードウェアが機能低下するかどうかを判断します。 その場合は、ノードを送信してハードウェアの修復と交換を行います。 全体的に、これにより、さまざまな軽減策を使用してさまざまなシナリオを処理する柔軟性が大幅に向上し、Azure ホストの全体的な回復性が向上します。</p>


  <p>&quot;&quot;危険な予測にはるかに柔軟に対応するために、Narya はオンラインの A/B テスト フレームワークと強化学習 (RL) フレームワークを使用して、最小限の仮想マシンの中断に対する軽減策アクションを継続的に最適化します。</p>


  <h3>A/B テスト フレームワーク</h3>


  <p>Narya は、A/B テストを実施するときに、さまざまな軽減策アクションを選択し、アクションを実行する必要がないコントロール グループと比較し、すべてのデータを収集して、どの軽減策アクションがどのシナリオに最適か判断します。 それ以降、&mdash;&nbsp;この一連の障害予測では、仮想マシンの再起動を減らし、使用可能な容量を確保し、最適なパフォーマンスを維持するために役に立つ最適なアクションを継続的に選択します。</p>


  <h3>強化学習 (RL) フレームワーク</h3>


  <p>Narya が強化学習を使用する場合は、時間の長い間さまざまなアクションを探索し、最新のアクションを最も重く評価することで、全体的なカスタマー エクスペリエンスを最大化する方法を学習します。 強化学習は、最適なアクションの使用と新しいアクションの探索の間で継続的にバランスを取り、最適なアクションを回避するために自動的に学習するという、A/B テストとは異なります。</p>


  <h3>フェーズ 3: 顧客への影響を観察し、モデルを再トレーニングする</h3>


  <p>最後に、軽減策アクションを実行した後、新しいデータを収集できます。 最新の顧客への影響データを測定しました。これは、Narya フレームワークのすべてのステップでモデルを継続的に改善するために使用されます。 Narya&mdash; はこれを自動的に行う必要があります。データは、障害予測手順でドメインエキスパートルールと機械学習モデルを更新するのに役立つだけでなく、決定手順で軽減策アクション ポリシーの向上を通知します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8e1ca08a-b3f4-4108-b491-6819e133e7aa.png"><img alt="Narya starts with a hardware failure prediction, makes a smart decision on how to respond, implements the response, then measures the customer impact and incorporates it via a feedback loop." border="0" height="332" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f61ae5d8-a9d6-44e7-a78c-f15d702aec41.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="" width="1024"></a></p>


  <p><em>図 1: Narya はハードウェア障害の予測から始まり、応答方法をスマートに決定し、応答を実装して、顧客への影響を測定し、フィードバック ループを介して組み込む。</em></p>


  <h2>動作中のナヤ: 例</h2>


  <p>実際の顧客のワークロードを保護するために Narya が役立った実際の例を次に示します。</p>


  <ul>
      <li>T0 20:15:31、Narya は、ディスクの問題による障害の可能性が高いノードを予測しました。</li>
      <li>T0 20:32:01、Narya &quot;は軽減策アクションを選択しました:ノードを 3 日間非対応としてマークし、ライブ マイグレーションを試み、すべての仮想マシンが移行された後、またはホストが失敗した場合は、ノードを診断に送信します。&quot;</li>
      <li>T0 20:32:11、 ノードが非呼び出し可能とマークされ、ライブ マイグレーションがトリガーされました。</li>
      <li>T0 20:47:22 &ndash; 00:11:55、ライブ マイグレーションの対象となる 9 台の仮想マシンがノードから正常に移行されました。</li>
      <li>T1 19:14:01、ノードが問題になり、ノード上の 15&nbsp; 台の仮想マシンが再起動されました。</li>
      <li>T1 19:55:07、障害状態に入った後に診断に送信されたノード。</li>
      <li>T2 00:14:12、ディスク ストレス テストに失敗しました。</li>
      <li>T3 00:19:56、ディスクが交換されました。</li>
  </ul>


  <p>この実際の例では、Narya&nbsp; は 9 つの仮想マシンの再起動を防止し、間もなく失敗すると予想されるノードに新しいワークロードが割り当てられていないので、顧客のさらなる問題を回避しました。 さらに、破損したノードは&nbsp;直ちに修復のために送信され、問題が既に予想していたので、仮想マシンの再起動が繰り返されません。 この例は比較的単純ですが、主な目的は、Narya が状況を評価し、この状況に対してこの軽減策をスマートに選択した点を示す目的です。 その他のシナリオでは、軽減策として、ノードを別の日数の間呼び出し可能としてマークしたり、ライブ マイグレーションではなくソフト カーネルの再起動を試したり、ノードを完全にアロケーション可能としてマークするのではなく、割り当てを割り当てから割り当て解除したりする場合があります。 Narya は、全体的なカスタマー エクスペリエンス&quot;&quot;を改善するために、さまざまな危険にさらされている予測に対してはるかに柔軟に対応できるように構築されています。</p>


  <h2>Narya の違いは何ですか?</h2>


  <ol>
      <li><strong>データ駆動型アクションの選択:</strong> 軽減策アクションに対して最善の推測を行う代わりに、選択した各軽減アクションの真の影響を判断するためにデータを使用して、各軽減策アクションの効果をテストして測定します。</li>
      <li><strong>可能な限り動的:</strong> 静的な軽減策の割り当てとは対照的に、Narya では、ソフトウェア更新プログラム、ハードウェア更新プログラム、または顧客のワークロードの変更などを通じてシステムが変更された場合でも、最適な軽減策が継続的に選択されます。たとえば、CPU 頻度の低下によって予測される障害がライブ マイグレーションを実行する静的な割り当てがある可能性があります。 これは差し迫った障害を示す防御メカニズムである可能性があります。Azure プラットフォームに対する最近の更新では、電力消費量を再調整するために CPU 頻度が意図的に調整される可能性があります。つまり、CPU 頻度の低下は必ずしもライブ マイグレーションを実行する必要があるという意味ではない可能性があります。 静的な割り当てでは、正常なノードの使用を誤って避けるため、最終的に害を及ぼすアクションを誤って適用します。 Narya では、A/B のテストと強化学習から、この特定のシナリオでは、ライブ マイグレーションが最適な軽減策ではなくなったのが気付くでしょう。</li>
      <li><strong>柔軟な軽減策:</strong> 過去には、特定の一連の症状に対して特定の軽減策を 1 つしか指定していけなかったのです。 ただし、マルチテナントと多様な顧客ワークロードでは、エキスパートドメインの知識を持つ場合でも、前もって最適な軽減策を決定することは困難でした。 Narya を使用すると、必要な数の軽減アクションを構成し、さまざまな障害予測に最適なアクション項目を自動的にテストして選択することができます。 最後に、スマートな安全メカニズムが用意されているので、Narya&#39;の軽減アクション チェーンによって、無期限のブロックにつながる可能性のあるすべてのロック停止を防ぐことも確信できます。</li>
  </ol>


  <h2>今後の予定</h2>


  <p>今後は、Azure の回復性と信頼性を高め、Narya を向上させる必要があります。 具体的には、次の計画を立て計画しています。</p>


  <ul>
      <li><strong>より多くの予測シナリオを組み込む:</strong> より多くのハードウェア 障害の種類をカバーする、より高度なハードウェア障害予測手法を開発する予定です。 また、この予測手順には、さらに多くのソフトウェア シナリオを組み込む予定です。</li>
      <li><strong>より多くの軽減策アクションを組み込む:</strong> 追加の軽減策を構築することで、Narya が広範な障害予測範囲に対応する方法に柔軟性を追加できます。</li>
      <li><strong>決定をスマートに行う:</strong>最後に、最適な軽減策を決定するスマートな決定ステップに微妙な違いを加えて、ナ&quot;&quot;ヤを改善することを計画しています。 たとえば、&quot;&quot;特定のノードで実行されているワークロードを確認し、その情報をスマートな決定ステップに組み込み、中断を最小限に抑える方法で軽減策を実行することができます。</li>
  </ul>


  <p>Narya&nbsp;&nbsp; フレームワークの詳細については、オペレーティング システムの設計と実装に関する第 14 回 USENIX シンポジトリ (OSDI 2020) で、運用クラウド VM &nbsp;<a href="https://www.usenix.org/conference/osdi20/presentation/levy" target="_blank">&quot;の中断を回避するPredictive とアダプティブ 障害の軽減策に関するページを参照&quot;</a>してください。</p>
