### YamlMime:Yaml
ms.openlocfilehash: 65f02e606b73471fe959c13f0ff719d6bc345495
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891029"
Slug: a-new-way-to-send-custom-metrics-to-azure-monitor
Title: Azure Monitor にカスタムメトリックを送信する新しい方法
Summary: 現代の最新のアプリケーションでは、メトリックは、アプリ、サービス、および実行されているインフラストラクチャがどのように実行されているかを理解するうえで重要な役割を果たします。 これらの情報は、トリミング時に問題を検出、調査、診断するのに役立ちます。 このレベルの可視性を提供するために、Azure は Azure Monitor を通じてリソースレベルのプラットフォームメトリックを利用できるようにしました。
Content: >-
  <p>&rsquo;現代の最新のアプリケーションでは、メトリックは、アプリ、サービス、および実行されているインフラストラクチャがどのように実行されているかを理解するのに役立つ重要な役割を果たします。 これらの情報は、トリミング時に問題を検出、調査、診断するのに役立ちます。 このレベルの可視性を提供するために、Azure は<a href="https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview">Azure Monitor</a>を通じて<a href="https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics">リソースレベルのプラットフォームメトリック</a>を利用できるようにしました。 ただし、多くの場合は、さらに多くのメトリックを収集し、ハイブリッド環境で実行しているリソースとアプリケーションに関するより深い洞察を得る必要があります。</p>


  <p>これを実現するには、 <a href="https://docs.microsoft.com/azure/application-insights/app-insights-overview">Application Insights</a> sdk を使用してアプリからカスタムメトリックを送信できるようにします。 現在、Azure Monitor でカスタムメトリックのパブリックプレビューを発表しました。これにより、任意の Azure リソースについて、どこからでも収集されたメトリックを送信できるようになりました。 これらのメトリックは、リソースに関するメモリ使用率などの追加のパフォーマンス指標になります。または、ページの読み込み時間など、アプリケーションによって生成されるビジネス関連のメトリック。 <a href="https://aka.ms/AzureMonitor/FullStackMonitoring">Azure Monitor の統合メトリックエクスペリエンス</a>の一部として、次のことが可能になりました。</p>


  <ul>
   <li>最大10個のディメンションを含むカスタムメトリックを送信する</li>
   <li>名前空間を使用してメトリックを分類および分離する</li>
   <li>Azure Monitor を通じて、統合された一連のメトリックとアラートエクスペリエンスを活用する <ul>
    <li>Azure Portal のグラフとダッシュボードで、リソース &rsquo; プラットフォームのメトリックと共にカスタムメトリックをプロットする</li>
    <li>プラットフォームメトリックと同じ <a href="https://docs.microsoft.com/rest/api/monitor/metrics/list">REST api</a> セットを使用してカスタムメトリックにアクセスする</li>
    <li>Azure Monitor に出力されたカスタムメトリックに対してアラートルールを作成および構成します。メトリックに含まれるすべてのディメンションをフィルター処理できるようにサポートを追加しました。</li>
   </ul>
   </li>
   <li>カスタムメトリックのリテンション期間は3か月で、1分単位で保持されます。</li>
  </ul>


  <p>カスタムメトリックは、いくつかの方法で Azure Monitor に送信できます。</p>


  <ul>
   <li>新しい<a href="https://docs.microsoft.com/en-us/rest/api/monitor/metrics%20(data%20plane)">カスタムメトリック</a>を使用してメトリックを送信 REST API</li>
   <li><a href="https://docs.microsoft.com/azure/monitoring-and-diagnostics/azure-diagnostics">Windows 診断拡張機能</a>(wad) を使用して Windows vm からメトリックを発行する</li>
   <li><a href="https://docs.influxdata.com/telegraf">InfluxData 受付 Graf エージェント</a>を使用して Linux vm からメトリックを発行する</li>
   <li><a href="https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics">Application Insights SDK</a>を使用してアプリケーションをインストルメント化する</li>
  </ul>


  <p>Azure Monitor にカスタムメトリックを生成する方法については、「」を参照してください。</p>


  <h2>Windows vm からメトリックを生成する</h2>


  <p>多くのユーザーは、Azure vm とクラシック Cloud Services で Azure 診断拡張機能 (Windows と Linux) を使用して、詳細なゲスト OS レベルのパフォーマンスデータを収集しています。 以前は、これらの診断拡張機能を使用して、Storage テーブルにデータを送信し、これらのゲスト OS メトリックに加えて、限られたメトリックエクスペリエンスのセットをサポートしていました。</p>


  <p>現在 &rsquo; のリリースの一部として、Windows 診断拡張機能がアップグレードされ、Azure Monitor にパフォーマンスカウンターを直接送信できるようになりました。 つまり、Azure Monitor エクスペリエンスと REST api を使用して、Windows のゲスト OS メトリックを直接グラフ化、アラート化、クエリ、フィルター処理できます。 <a href="https://aka.ms/VM/Windows-DiagExt-to-AzureMonitor">診断拡張機能をインストールして構成</a>する方法に関するチュートリアルを公開しました。 Linux 診断拡張機能を使用して Azure Monitor にゲスト OS メトリックを送信することは現時点では利用できませんが、近日公開予定です。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0c7b2772-2bc9-4168-a10d-a2de073a8ddf.jpg"><img alt="Azure%20Monitor%20-%20VM%20Guest%20and%20Platform%20Metrics" border="0" height="821" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3fa4face-8f47-422f-b3a6-1a5a674d72bd.jpg" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure% 20Monitor %20-% 20MONITOR% 20Monitor% 20monitor% 20Monitor% 20Monitor" width="1406"></a></p>


  <p align="center"><em>Windows の仮想マシンに対して、ゲスト OS メトリック ( &lsquo; メモリ/% Committed バイト &rsquo; ) とサイドバイサイドでプロットされたプラットフォームメトリック ( &lsquo; CPU &rsquo; の割合) を示すグラフ</em></p>


  <h2 align="left">InfluxData &rsquo; s の電話 Graf プラグインエージェントを使用して Linux vm からメトリックを生成する</h2>


  <p>&rsquo;オープンソースの監視ツールの豊富なエコシステムにより、Linux vm で実行されているワークロードのメトリックを収集できます。 <a href="https://docs.influxdata.com/telegraf/v1.7/">受付 Graf は、</a> このような一般的なオープンソースのエージェントの1つです。 このため、この <a href="https://www.influxdata.com/">InfluxData</a>のチームであるパートナーと協力して、Azure Monitor との統合を構築しました。</p>


  <p>受付 graf は、オープンソースのプラグインドリブンエージェントであり、150の異なるソースからのメトリックの収集を可能にします (VM 上で実行されているに &rsquo; よって異なります)。 これらのプラグインのほとんどは、コミュニティによって提供されています。これは、今後数か月の間、より多くのコレクタエージェントが利用可能になることを期待できることを意味します。 その後、エージェントは、出力プラグインを使用して任意の宛先に書き込むことができます。 エージェントはカスタムメトリック REST API に直接統合され、新しい &ldquo; Azure Monitor 出力プラグイン &rdquo; をサポートするようになりました。 これにより、次のように、webex Graf エージェントをインストールし、ワークロードに関するメトリックを収集できます ( MySQL、NGINX など)Linux VM でを実行しており、カスタムメトリックとして Azure Monitor に公開されていること。 ここでは、これを自分で設定する方法について <a href="https://aka.ms/AzureMonitor/Telegraf-to-AzureMonitor">簡単</a> に説明します。</p>


  <h2>Application Insights SDK が生成したメトリックの統合されたエクスペリエンス</h2>


  <p>Application Insights の一部として、常に Application Insights SDK を使用して、アプリケーションに関する洞察を収集し、それらをカスタムメトリックとして出力するコードをインストルメント化することができました &rsquo; 。 そこから、これらのメトリックに関するアラートを作成し、ディメンションを分割してフィルター処理する機能を備えたグラフをプロットすることができました。 現在、ディメンションに関するアラートも可能にしています。これは、Application Insights によって出力されるすべての標準メトリックで自動的に使用できます。 カスタムメトリックのディメンションに関するアラートを有効にするには、Application Insights コンポーネントの<a href="https://aka.ms/AppInsights/DimensionalAlerting">簡単なオプトインエクスペリエンス</a>があります。</p>


  <h2>価格</h2>


  <p>すべてのリソースレベルのプラットフォームメトリックは、引き続き無料でご利用いただけます。 Azure リソースに対して生成されたカスタムメトリックは、従量制課金の対象となります。 カスタムメトリックは、1か月あたりの最初の 150 MB に無料で利用できます。その後、データ取り込まれたのボリュームに基づいて、使用状況が測定されます。</p>


  <p>Application Insights のお客様は、現在の Application Insights の価格モデルに基づいて引き続き課金されますが、変更はありません。 カスタムメトリックでのディメンションアラートの有効化は完全に省略可能です。この機能を有効にすると、カスタムメトリックのメータリングが適用されます。</p>


  <p><a href="https://azure.microsoft.com/pricing/details/monitor/">これらの機能の価格</a>の詳細については、こちらを参照してください。</p>


  <h2>まとめ</h2>


  <p>Azure では、Azure Monitor を通じて、プラットフォームメトリックを使用してリソースがどのように実行されているかを把握することができます。 ここでは、Azure Monitor するアプリケーションとリソースに関する独自のカスタムメトリックを生成することで、これらのメトリックを補うことができます。 この最初のリリースについては、今後数か月の間、今後も Azure リージョンでの使用が可能になり、機能が追加され、Azure Monitor 全体で他の機能が有効になり、カスタムメトリックを活用できるようになります。 お客様からのご意見をお待ちしております。コメントを削除するか、 <a href="https://feedback.azure.com/forums/231545-diagnostics-and-monitoring">ユーザーの声</a> に進んで、ご意見をお聞かせください。</p>
