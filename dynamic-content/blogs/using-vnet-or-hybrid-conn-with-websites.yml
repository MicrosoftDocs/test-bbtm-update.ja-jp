### YamlMime:Yaml
ms.openlocfilehash: 0699adf3189cdfb3f739f7720a5561d27e5b9a84
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890045"
Slug: using-vnet-or-hybrid-conn-with-websites
Title: Azure Websites での VNET 統合とハイブリッド接続の使用
Summary: このチュートリアルでは、VNET 統合またはハイブリッド接続を使用して、Azure VM またはオンプレミスで WordPress with MySQL をインストールします。
Content: >-
  次の説明では、リモート MySQL データベースを使用して Azure Websites で実行されている WordPress を取得する例の概要を示します。2つの部分について説明します。最初の部分では、データベースは Azure VM と Azure VNET でホストされています。この例では、VNET 統合を使用して、Azure VNET に安全に接続するためのハイブリッド接続します。これは、VM が既にプロビジョニングされている既存の VNET があることを前提としています。


  2番目のパートでは、サイト間 VPN と VNET 統合の組み合わせを使用してアクセスできるオンプレミスのホストでデータベースをホストする方法について説明します。これには、既存の同じ VNET が使用されます。オンプレミスと VNET のどちらで動作するかに違いがないため、ハイブリッド接続を示す必要はありません。


  両方の接続機能は現在プレビュー段階です。これは、ほとんどの場合、改善され、使用しやすくなることを意味します。アプリケーションエンドポイントをインターネットからアクセスできるようにする際に問題が発生していない場合は、他にも利用可能なオプションがあり、それを使用するための追加機能が不要であることに注意してください。

  <h2>MySQL データベースを作成する</h2>

  WordPress を設定する前に、データベースをやり取りする必要があります。これはデモを目的としたものであるため、最も簡単なアプリケーションパスに進みます。これは、MySQL データベースを実際に実行する方法であるという意味ではありません。ここでの主な目的は、リモートデータベースを使用して web サイトを設定することです。プロビジョニングした vm は、Windows Server 2012 R2 がインストールされている2コア 3.5 gb vm として動作します。


  VM と VNET を初めて作成する場合は、最初に VNET を作成してから VM を作成してください。VNET は VM 作成プロセス中に指定する必要があり、作成後に変更することはできません。Azure 仮想ネットワークについてさらに詳細な情報が必要な場合は、次の情報を参照してください。 <a title="https://azure.microsoft.com/en-us/documentation/services/virtual-network/" href="https://azure.microsoft.com/en-us/documentation/services/virtual-network/">https://azure.microsoft.com/en-us/documentation/services/virtual-network/</a>


  リモートデスクトップを使用して VM にログオンします。リモートデスクの最上位の rdp ファイルを取得するには、以下に示すように、新規または古いポータルを使用します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image001.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image001" alt="clip_image001" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image001_thumb.png" width="610" height="376" border="0" /></a>


  VM で MySQL インストーラーを取得 <a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a> し、実行しました。


  インストーラーは正常に動作し、使用されているポートのファイアウォールも無効になります。WordPress にアクセスするには、データベースとアカウントが必要です。これを行うために、最も簡単なのは、C:\Program Files\MySQL\MySQL Server 5.6 \ bin \ ディレクトリでコマンドシェルを開くだけです。


  そこから、次のように mysql にログインします。

  <pre class="prettyprint">mysql –u root –p&lt;password&gt;</pre>

  今回のケースでは、次のようになりました。

  <pre class="prettyprint">mysql –u root –pvpndemo</pre>

  デモを簡単にするために、ルートを使用していますが、注意が必要なシステムでこれを行わないようにしてください。 次のコマンドを使用して、データベースを作成します。

  <pre class="prettyprint">CREATE DATABASE &lt;database name&gt;;</pre>

  データベースの名前として「ハイブリッド」を使用しました。

  <pre class="prettyprint">CREATE DATABASE hybrid;</pre>

  次のコマンドを使用して、データベースを使用するためのアクセス許可をアカウントに付与します。

  <pre class="prettyprint">GRANT ALL PRIVILEGES ON *.* TO ’root’@’%’ IDENTIFIED BY ’vpndemo’ WITH GRANT OPTION; FLUSH PRIVILEGES;</pre>

  これで、mysql シェルを終了できます。データベースがセットアップされています。リモートデスクトップセッションを終了する前に、VM の IP を取得します (まだ不明な場合)。シェルプロンプトから ipconfig を使用するだけです。私の ip は10.0.1.4 であり、インターネットでルーティング可能な IP アドレスではありません。

  <h2>WordPress のインストール</h2>

  ギャラリーから WordPress を使用する代わりに、すべてを最初から実行することを考えました。開始するには、ここから WordPress を取り出します。 <a href="https://wordpress.org/latest.zip">https://wordpress.org/latest.zip</a>    これは、WordPress の最新バージョンの zip です。これは4.0 です。


  次に、Azure Websites に空の web サイトを作成しました。新しい Azure プレビューポータル <a href="https://portal.azure.com">https://portal.azure.com</a> では、の左下にある [新規] アイコンを使用して、web サイトの作成 UI を表示しました。この例では、thirdVPNdemoSite という名前のサイトを作成しました。


  Web サイトを作成する前に、すべての地域について検討してください。この記事で行っているようなものを作成する場合は、web サイト、VNET、VM をすべて同じリージョンに配置します。あるリージョンの web サイトを別のリージョンの VNET に接続することはできますが、他に何も行わない場合は、パフォーマンス上の理由から回避する必要があります。


  WordPress をアップロードして操作するために、Kudu コンソールを使用しました。これにより、非常にシンプルになります。Web サイトの scm ページを開きます。 web サイトを参照し、url を編集して scm を追加します。 サイト名の後。Web サイトは thirdVPNdemoSite.azurewebsites.net ので、scm サイトは thirdVPNdemoSite.scm.azurewebsites.net です。その後、デバッグコンソールにアクセスし、CMD または Powershell を選択します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image002.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002" alt="clip_image002" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image002_thumb.png" width="610" height="588" border="0" /></a> D:\home\site\wwwroot. に移動します。ここで WordPress が行われます。これを行うには、シェルコマンドまたはナビゲーターを使用することをお勧めします。WordPress をコピーするには、zip ファイルを取得し、Kudu コンソールの [エクスプローラー] ビューにドラッグします。[アップロードして解凍するにはここにドラッグしてください] というボックスが表示されます。Zip をドラッグします。これにより、wwwroot ディレクトリに WordPress ディレクトリが作成されます。WordPress サイトは、アプリケーションの仕様なしに、url のベースにする必要がありました。そのためには、WordPress ディレクトリの内容を1つ上のレベルに移動する必要がありました。これは、WordPress ディレクトリに移動して、

  <pre class="prettyprint">move * ..</pre>

  次に、データベースを操作するように WordPress を構成する必要があります。Wwwroot ディレクトリで、wp-config-sample ファイルを wp-config.php にコピーし、編集します。このファイルには、データベースにアクセスするための情報が含まれています。ファイルを編集するには、Kudu エクスプローラーの UI で [edit pen (ペンの編集) を実行します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image0025.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002 [5]" alt="clip_image002[5]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image0025_thumb.png" width="527" height="610" border="0" /></a>


  図に示されているように、データベース名、ユーザー名、パスワード、およびホスト名を含む項目を変更します。まだ完了していない部分は、web サイトと VNET の間の接続を確立することです。これを行う前に、失敗したケースを証明するのが理にかなっています。Web サイトを参照しようとすると、WordPress はデータベースにアクセスできないため、予想されるエラーメッセージが表示されます。

  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/Capture2a.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="Capture2a" alt="Capture2a" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture2a_thumb.png" width="610" height="58" border="0" /></a> ここでは、Chrome を使用して、上記のメッセージを表示していました。他のブラウザーのエクスペリエンスは異なります。IE では、"web サイトはページを表示できません" と表示されます。

  <h2>VNET 統合の設定</h2>

  Web サイトからデータベースに接続できるようにするには、最初に VNET 統合を使用し、次に VNET 統合を停止して、ハイブリッド接続が同じデータベースにアクセスする方法を示します。VNET を有効にするには、web サイトのプレビューポータルビューに戻り、[参照] を参照して現在の VNET 設定を確認します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image0027.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002 [7]" alt="clip_image002[7]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image0027_thumb.png" width="610" height="583" border="0" /></a>


  Standard 価格レベルに web サイトを配置していない場合は、これが最初の手順です。Standard より低い価格レベルを使用している場合は、さらに課金されることになります。まだ標準プランに含まれていないときに Virtual Network UI をクリックすると、価格レベルの画面が表示され、そこで変更を加えることができます。次の手順では、仮想ネットワークを web サイトに追加します。もう一度 Virtual Network UI をクリックすると、web サイトを統合する VNET を選択できます。


  VNET を選択できない場合は、次のいずれかまたは両方の項目が true である場合にのみ可能です。VNET に動的ルーティングゲートウェイが設定されていないか、ポイント対サイトが有効になっていません。

  VNET でポイント対サイトが有効になっていない場合は、現在のポータルで Virtual Network にアクセスして設定する必要があります。サイト間 VPN 接続の操作に関するこのドキュメントの2番目のセクションを試す場合は、ポイント対サイト接続に使用する IP 範囲がオンプレミスの IP 範囲と競合していないことを確認してください。ここでは、192.168.0.0 をオンプレミスで使用しているため、ここでは 10.0.0.0 IP アドレスを使用します。

  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image002.jpg"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002" alt="clip_image002" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image002_thumb.jpg" width="610" height="508" border="0" /></a>


  ゲートウェイを設定していない場合は、ゲートウェイも追加する必要があります。ゲートウェイがあり、ポイント対サイトを有効にできない場合は、ゲートウェイが静的ルーティングゲートウェイであることが原因です。代わりに、動的ルーティングゲートウェイが必要になります。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image0029.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002 [9]" alt="clip_image002[9]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image0029_thumb.png" width="610" height="518" border="0" /></a>


  すべての設定が完了したので、前の手順に進んで、web サイトを統合する VNET を選択します。Web サイトとの VNET 統合を有効にすると、web サイトシステムは証明書を交換して、web サイトと VNET の間ですべての通信が安全であることを確認します。緑色のチェックは、サイトが接続されていることを意味するものではありません。これは、証明書が同期されていることを意味します。 [Virtual Network 証明書] タブで、VNET 用に設定されている web サイトの証明書を確認できます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/23/Capture5.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="Capture5" alt="Capture5" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture5_thumb.png" width="480" height="181" border="0" /></a>


  DNS の追加やサイト間 VPN の追加など、証明書の再同期が必要な場合があります。証明書を再同期する必要がある場合は、[仮想ネットワーク] をクリックし、ページの上部にある [接続の同期] アクションをクリックします。

  Web サイトにアクセスすると、データベースにアクセスします。表示される画面は、最初に WordPress を設定するときにヒットする言語選択画面です。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image0017.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image001[7]" alt="clip_image001[7]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image0017_thumb.png" width="366" height="480" border="0" /></a>


  Success!


  次に、ハイブリッド接続を使用してプロセスを繰り返します。まず、VNET 統合を壊す必要があります。サイトの構成に移動し、[仮想ネットワーク UI] と [切断] に移動します。ここで Web サイトを参照すると、前に見たのと同じデータベースが使用できない UI が表示されます。


  &nbsp;

  <h2>ハイブリッド接続を設定する</h2>

  VNET 統合を使用すると、VNET 内または VNET を介して多くのリソースにアクセスできますが、ハイブリッド接続を使用すると、エンドポイントごとに 1 つのアプリケーションにのみアクセスできますが、VNET 内のアプリケーションに限定されません。必要に応じて、それぞれ別のネットワーク内にあるアプリケーションにアクセスできます。Web サイトは 1 つの VNET としか統合できませんが、多くのハイブリッド接続エンドポイントと統合できます。BizTalk サービスの対象となるエンドポイントの数によって制限されます。


  ハイブリッド接続を有効にするには、Web サイトの [ハイブリッド接続] UI の [Virtual Network UI] に移動し、エンドポイントへの新しい接続を作成します。この場合、BizTalk サービス アカウントをまだ作成していない場合は、そのアカウントを作成する必要があります。この UI から作成できるのは、無料の BizTalk アカウントのみです。これにより、任意の数の Web サイトで使用できる最大 5 つのエンドポイントを使用できます。追加のエンドポイントの場合は、現在のポータルを使用して Biztalk サービス プランを調整します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00211.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002[11]" alt="clip_image002[11]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00211_thumb.png" width="554" height="610" border="0" /></a>


  ハイブリッド接続を作成すると、まだ未接続として表示されます。VNET 統合機能では、ポイント対サイト テクノロジを使用して統合が作成されます。ハイブリッド接続ソリューションでは、以前は"ポート ブリッジ" と呼ばばのようなものが使用されています。その一部は、このハイブリッド ソリューションを可能にするためにも活用されました。動作方法は、Web サイトがリレー サーバーに接続する方法です。エンドポイントと Azure にアクセスできる場所に配置されたエージェントもインストールされます。両方ともリレー サーバーに接続し、接続を介して 1 つのエンドポイントにトンネルが作成されます。エンドポイントに host:port を指定する場合は、リレー エージェントがインストールされているホストから解決されるホスト名を使用できます。その後、Web サイトで同じホスト名を使用してアプリケーション エンドポイントにアクセスできます。これにより、特定の Web サイトをオンプレミスから Azure Websites にリフトアンドシフトする方がはるかに簡単になり、オンプレミスで行ったのと同じ接続文字列を使用できます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/23/Capture10.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="Capture10" alt="Capture10" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture10_thumb.png" width="480" height="198" border="0" /></a>


  接続を完了するには、ハイブリッド接続エージェントをインストールする必要があります。この次の部分は、アプリケーションをホストしている VM から、またはデータベースにアクセスできる VNET 内の別の VM から行う必要があります。私の場合は、単にデータベースをホストしている VM と同じ VM を使用しました。IE ブラウザーを開き、Azure プレビュー ポータルにログインします。Web サイトに移動し、[ハイブリッド接続] UI に移動します。ハイブリッド接続 UI で、接続をクリックします。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image0019.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image001[9]" alt="clip_image001[9]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image0019_thumb.png" width="480" height="250" border="0" /></a>


  IE を使用すると言いましたが、次の手順は IE ではうまく機能しますが、Firefox や Chrome ではうまく機能しないという理由だけでした。[リスナーのセットアップ] をクリックして、エージェント インストーラーにアクセスします。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00111.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image001[11]" alt="clip_image001[11]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00111_thumb.png" width="265" height="360" border="0" /></a>


  エージェントをインストールするには、[今すぐインストールして構成する] をクリックします。インストーラーは項目を数回クリックし、エージェントのインストールに必要なすべてです。エージェントをインストールすると、エージェントは Azure Relay サーバーに接続し、エンドポイントへの接続を開きます。VNET とは異なり、UI で接続の状態を確認できますが、これはエンドポイントに接続できるのではなく、Web サイトがエージェントに接続できるという意味です。冗長性を確保するために複数のエージェントが必要な場合は、必要に応じて複数のインスタンスをインストールできます。複数のエージェント インスタンスは、エンドポイント数に対してカウントされません。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00113.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image001[13]" alt="clip_image001[13]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00113_thumb.png" width="480" height="199" border="0" /></a>


  Web サイトを参照すると、VNET に接続した後に表示されたのと同じ WordPress 言語選択 UI が表示されます。次のセクションに進む前に、ハイブリッド接続 UI に移動し、Web サイトからエンドポイントの登録を解除します。Delete を使用しない限り、エンドポイントは削除されますが、Web サイトから切断されます。Web サイトを参照すると、使い慣れたエラー画面が再び表示されます。


  これは、VNET 内のリソースに安全にアクセスする方法を説明する最初のセクションを終了します。ハイブリッド接続の説明は、どのネットワークにも適用できます。オンプレミスアクセスに対して機能するために特別なプロビジョニングを行う必要はない。たとえばVNET 統合は異なります。VNET を介してオンプレミスのリソースにアクセスするには、サイト間 VPN 用に設定する必要があります。


  &nbsp;

  <h2>オンプレミス データベース - サイト間 VPN</h2>

  既存の VNET に対してサイト間 VPN を設定するには、ローカル ネットワークを追加して VNET に関連付けする必要があります。これは、この目的で使用できるインターネット アドレス指定可能なゲートウェイ サーバーを持っている必要があります。インターネット アドレス指定可能なゲートウェイをお持ちない場合は、前述のようにハイブリッド接続を使用する方が簡単です。


  インターネット アドレス指定可能なゲートウェイがある場合、最初の手順はローカル ネットワークを作成します。これを行うには、現在のポータルに移動し、左下にある [新規] アイコンをクリックします。[ローカル ネットワークのNetwork Services - Virtual Network&gt; - ローカル ネットワーク&gt; の追加] に移動します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00213.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002[13]" alt="clip_image002[13]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00213_thumb.png" width="614" height="262" border="0" /></a>


  オンプレミス ネットワークの名前、VPN デバイスの IP アドレス、IP 範囲を指定します。これでローカル ネットワークが作成されたので、単に VNET に関連付ける必要があります。VNET の構成タブに移動します。サイト間接続 UI が表示される前に、少なくとも 1 つのローカル ネットワークが必要です。チェック ボックスをオンにしてローカル ネットワークに接続し、使用するローカル ネットワークを選択します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00215.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002[15]" alt="clip_image002[15]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00215_thumb.png" width="610" height="265" border="0" /></a>


  ダッシュボードにローカル ネットワークが表示されますが、切断されます。 次の手順は、オンプレミスのゲートウェイ サーバーで実行する必要があります。現在のバージョンのネットワークのダッシュボードAzure portal画面の右側にある [VPN デバイス スクリプトのダウンロード] をクリックします。これにより、次のような画面が表示されます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/image.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="image" alt="image" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/image_thumb.png" width="480" height="393" border="0" /></a>


  R2 で RRAS を使用Windows Server 2012これらの項目を選択し、VPNDeviceScript.cfg ファイルをダウンロードする必要があります。このファイルは、ゲートウェイ サーバーで実行する必要がある PowerShell スクリプトです。それを実行すると、ネットワーク ダッシュボードに接続が確立されたと表示されます。この更新には数分かかるので、変更を行った後に UI がすぐに応答しない場合は警告されません。


  &nbsp;


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00217.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002[17]" alt="clip_image002[17]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00217_thumb.png" width="610" height="519" border="0" /></a>


  すべてが設定されているように見えますが、ネットワーク構成の一部として残っている最後の項目が 1 つ残っています。現時点では、サイト間 VPN の有効化では、VNET 内のポイント対サイト接続のルートは設定されません。次の手順を実行しない場合、Web サイトからオンプレミス システムに要求を送信することができますが、応答を取得できないという意味です。

  幸い、これは簡単に修正できます。オンプレミスのルートを追加するだけで、Web サイトで使用されているポイント対サイト接続にトラフィックが返されます。RRAS では、次に示すように静的ルートを追加しました。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00220.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002[20]" alt="clip_image002[20]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00220_thumb.png" width="610" height="237" border="0" /></a>


  ポイント対サイト IP 範囲を覚えていない場合は、Azure portal の Virtual Network スペースに移動し、[構成] タブを入力します。 Web サイトがポイント対サイト ブロックで使用する IP を知る方法はないので、ブロック全体のルートを設定する必要があります。


  これで、Web サイトからオンプレミス ネットワーク内のリソースにアクセスできます。デモを完了するには、ネットワーク内のホストを選択し、このドキュメントの最初と同様に MySQL をインストールします。忘れずにデータベースを作成し、アカウントへのアクセス権を付与してください。


  kudu コンソールに移動し、wp-config.php ファイルを編集します。ホスト名と、新しいデータベースで変更したその他の情報を更新します。わかりやすくするために、Azure VM で行ったのと同じ方法ですべてを設定するだけで、異なるのはホスト名のみです。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/10/22/clip_image00222.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border: 0px" title="clip_image002[22]" alt="clip_image002[22]" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image00222_thumb.png" width="610" height="608" border="0" /></a>


  既知の状態を示す場合は、Web サイトをクリックします。[データベース接続の確立中にエラーが発生しました] UI が再び表示されます。 次に、プレビュー ポータルに移動し、もう一度 Web サイトを VNET と統合します。言語の選択画面が再び表示されます。今回は、VNET 統合を通じてオンプレミスのデータベースを使用します。


  &nbsp;

  <h2>トラブルシューティングとその他の情報</h2>

  目的のエンドポイントへのアクセスで問題が発生した場合は、接続をテストするために使用できるユーティリティがいくつかあります。セキュリティの制約により、ツール ping、nslookup、および tracert は Kudu コンソールでは機能しません。Void にデータを格納するには、問題のデバッグに役立つ2つのツールが追加されています。DNS 機能をテストするために、nameresolver.exe という名前のツールが追加されました。の構文は次のとおりです。

  <pre class="prettyprint">nameresolver.exe hostname [optional: DNS Server]</pre>

  接続を証明するために、tcpping.exe という名前の TCP ping を実行するためのツールも追加しました。このツールの構文は次のとおりです。

  <pre class="prettyprint">tcpping.exe hostname [optional: port]</pre>

  TCP ping ユーティリティの優れた点と欠点は、特定のホストとポートに到達していることです。これらのツールは、アプリケーションに接続できるかどうかを判断するのに非常に役立ちますが、一般的な意味でホストに接続できるかどうかを判断するためのものではありません。ヒットしようとしているポートでリッスンしていることが不明な場合は、netstat – a を使用して、リッスンしている場所をリッスンしているアプリケーションがあることを確認してください。


  これまでに見た最も一般的な問題は、ファイアウォールに関するものです。アプリケーションポートにアクセスできないかどうかを確認する必要がある最初の項目の1つは、ファイアウォールの構成です。MySQL のインストールの場合、MySQL インストーラーはリスニングポート3306を自動的に開きます。それでも、問題があるかどうかを最初に確認します。


  もう1つのデバッグポイントは、web サイトと VNET が同じ情報セットを使用していることを確認することです。証明書とは別に、証明書を同期するときに、web サイトと VNET 間で交換される重要な情報がいくつかあります。VNET 内の何かを変更しても、web サイトが最新の情報で更新されていない可能性があります。トラブルシューティングの手順の1つとして、接続を再同期します。これが自動ではない理由の1つは、ユーザーが証明書を削除することによって VNET アクセスを簡単に無効にできるようにするためです。

  <h2>制限事項</h2>

  これらの統合によって多くの種類の使用が可能になりますが、いくつかの点には依然として制限があります。現時点では、次のハイブリッドアクセステクノロジは使用できません。

  <ul>
   <li>Web サイトを Active Directory と統合する</li>
   <li>Web サイトを LDAP と統合する</li>
   <li>ドライブをマウントする</li>
  </ul>

  また、VNET 統合の量やハイブリッド接続できる容量についても制限があります。

  <ul>
   <li>Standard 価格レベルの Web ホスティングプランごとに最大5つの VNET 統合を設定できます。これらの5つの統合は、その計画内の任意の数のサイトで使用できます。</li>
   <li>無料の BizTalk サービスでは、最大5つのハイブリッド接続エンドポイントを使用できます。これらの5つのエンドポイントは、すべての web サイトで使用でき、使用する web ホスティングプランに限定されませんが、サブスクリプションで使用できます。</li>
  </ul>

  ハイブリッド接続と VNET の統合はどちらもまだプレビュー段階であり、GA の前後に改善されますが、既に豊富な機能を提供しています。
