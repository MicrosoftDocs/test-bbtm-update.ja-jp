### YamlMime:Yaml
ms.openlocfilehash: d1cf8808e1960a6e9dbd74286f65aef5b1cd3d87
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139910218"
Slug: why-do-i-need-a-clustered-index
Title: クラスター化インデックスが必要なのはなぜですか。
Summary: '[この記事は SQL Azure チームによって提供されました。] "なぜでしょうか。 " 5年前に要求されたことを確認します。 "私はいつも言っています。 ブログのコメントには、"なぜ必要なのですか" という'
Content: '<p>[この記事は SQL Azure チームによって提供されました。]</p><p>"なぜでしょうか。" 5年前に要求されたことを確認します。 "私はいつも言っています。 ブログのコメントでは、"テーブルにクラスター化インデックスを作成する必要があるのはなぜですか" ということに気付きました。 このケースでは、"はそれを切り取れませんが、私の娘では機能しません。</p>  <h2>クラスター化インデックス</h2>  <p>SQL Azure には、レプリケーションテクノロジにクラスター化インデックスが必要です。 ここでは、データの3つのレプリカ (1 つのプライマリレプリカと2つのセカンダリレプリカ) を常に実行します。 トランザクションがコミットされることを検討する前に、データがプライマリレプリカと1つのセカンダリレプリカに書き込まれるクォーラムベースのコミットスキームを使用します。 各書き込みは、すべての3つのレプリカのデータ行の同じ場所で、まったく同じリーフノードに対して行います。 つまり、3つのレプリカすべてで、データページがまったく同じになります。 </p>  <p>SQL Server と SQL Azure では、クラスター化インデックスは B ツリーとして構成されます。 インデックス B ツリー内の各ページは、インデックスノードです。 B-tree の最上位ノードはルートノードです。 インデックス内のノードの最下位レベルはリーフノードです。 ルートノードとリーフノードの間のインデックスレベルは、総称して中間レベルになります。 B-tree を各レプリカに個別に保持すると、特定のパフォーマンスの最適化を行うことができます。また、仮想マシン間の物理復旧を実行するために必要なデータを提供しないので、デフラグやコンピューター間のトラフィックの削減などのローカルメンテナンスを行うことができます。</p>  <p>クラスター化インデックスでは、リーフ ノードに基になるテーブルのデータ ページが含まれています。 ルート ノードと中間レベル ノードには、インデックス行を保持するインデックス ページが含まれています。 各インデックス行には、キー値と、B ツリー内の中間レベル ページかインデックスのリーフ レベルのデータ行のいずれかへのポインターが含まれています。 インデックスの各レベルのページは、二重にリンクされた一覧でリンクされています。 </p>  <p><a href="" mce_href=""><img style="BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; DISPLAY: inline; BORDER-TOP: 0px; BORDER-RIGHT: 0px" title="grid.ai" border="0" alt="grid.ai" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image001_thumb.gif" width="464" height="496" mce_src=""></a></p>  <h2>非クラスター化インデックス</h2>  <p>非クラスター化インデックスは、クラスター化インデックスと同じ B ツリー構造を持ちますが、テーブルがヒープである (クラスター化インデックスが存在しない) 場合は、行ロケーターが行へのポインターになります。つまり、SQL Server です。 このポインターは、ファイル識別子 (ID)、ページ番号、およびそのページ上での行の番号で構成されます。 ポインター全体は、行 ID (RID) です。 データ行は特定の順序で格納されず、データ ページの並びにも特定の順序はありません。 データ ページはリンク リストにリンクされません。 詳細については、「 <a href="https://msdn.microsoft.com/en-us/library/ms188270.aspx" mce_href="https://msdn.microsoft.com/en-us/library/ms188270.aspx">ヒープ構造体</a>」を参照してください。 ヒープテーブルをサポートしていない理由は、データページが順序付けされていないことです。これは、レプリケーションの要件です。</p>  <h2>それはなぜでしょうか?</h2>  <p>SQL Azure、データページの順序はデータレプリケーションにとって重要であり、そのため、テーブルにクラスター化インデックスを作成する必要があります。 クラスター化インデックスを選択することをお勧めします。また、最大限のパフォーマンスを実現するために、データベースの設計に最適なクラスター化インデックスを選択します。</p>  <p>質問、懸念事項、コメントがありますか。 これらを下に投稿してください。</p>'
