### YamlMime:Yaml
ms.openlocfilehash: d217c6236a17726c6049db175513993bed311043
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896011"
Slug: details-of-the-february-22nd-2013-windows-azure-storage-disruption
Title: 2013年2月22日 Windows Azure Storage 中断の詳細
Summary: 2013年2月22日の 12:29 PM PST では、Windows Azure Storage blob、テーブル、キューにアクセスしていた顧客に影響を与えるすべてのリージョンでサービスが中断されました。
Content: '<p>12:29 年2月22日の PM PST<sup>では 2013</sup>、HTTPS を使用して Windows Azure Storage blob、テーブル、キューにアクセスしていたお客様に影響を与えるすべてのリージョンでサービスが中断されていました。 可用性は、2013年2月23日に 00:09 AM PST によって世界中に復元されました。</p>  <p>影響を受けるお客様に対するサービスの中断をお詫びし、以下に示すように顧客にサービスクレジットを事前に発行しています。</p>  <p>中断に関連するコンポーネント、中断の根本原因、復旧プロセス、 &rsquo; このケースから学んだこと、およびお客様のサービスの信頼性を向上させるために何 &rsquo; を行っているかについて、より多くの情報を提供しています。</p>  <p><strong>Windows Azure の概要</strong></p>  <p>サービスの中断の詳細について説明する前に、このイベントに関連付けられている Windows Azure の内部コンポーネントに関するいくつかの情報を共有することをお &rsquo; 勧めします。</p>  <p>Windows Azure は、世界中のさまざまなデータセンターと地理的リージョンにわたって多数のクラウドサービスを実行します。 Windows Azure Storage は、Azure Windows クラウドサービスとして実行されます。 地理的リージョンごとに複数の物理ストレージサービスデプロイがあり、スタンプを呼び出します。 各ストレージスタンプには、記憶域ノードのラックが複数あります。</p>  <p>Windows azure ファブリックコントローラーは、ハードウェアを管理するリソースのプロビジョニングと管理レイヤーであり、リソースの割り当て、デプロイとアップグレードの機能、Windows azure プラットフォーム上のクラウドサービスの管理を提供します。</p>  <p>Azure Windows は、秘密ストアと呼ばれる内部サービスを使用して、サービスの実行に必要な証明書を安全に管理します。 この内部管理サービスにより、システムのプラットフォームと顧客の証明書のストレージ、配布、更新が自動化されます。 この内部管理サービスにより、システム内の証明書の処理が自動化されるため、ユーザーは機密情報に直接アクセスしてコンプライアンスとセキュリティを確保することができます。</p>  <p><strong>根本原因の分析</strong></p>  <p>Windows Azure Storage では、一意の secure Socket Layer (SSL) 証明書を使用して、主なストレージの種類 (blob、テーブル、キュー) ごとに顧客データトラフィックをセキュリティで保護します。 証明書を使用すると、HTTPS 経由で顧客アカウント (例: myaccount.blob.core.windows.net) を表すすべてのサブドメインのトラフィックを暗号化することができます。 内部および外部のサービスは、これらの証明書を利用して、ストレージシステムとの間で送受信されるトラフィックを暗号化します。 証明書は、シークレットストアから生成され、各 Windows Azure Storage ノードにローカルに保存され、ファブリックコントローラーによって展開されます。 Blob、テーブル、キューの証明書はすべてのリージョンとスタンプで同じです。</p>  <p>先週の証明書の有効期限は次のようになります。</p>  <ul>  <li>* blob.core.windows.net &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 金曜日、2月22日 2013 12:29:53 PM PST</li>  <li>* queue.core.windows.net &nbsp; &nbsp; &nbsp; 金曜日、2月22日 2013 12:31:22 PM PST</li>  <li>* table.core.windows.net &nbsp; &nbsp; &nbsp; 金曜日、2月22日 2013 12:32:52 PM PST</li>  </ul>  <p>証明書の有効期限に達すると、証明書は、ストレージサーバーで HTTPS を使用する接続の拒否を求める無効になります。 全体として、HTTP トランザクションは引き続き動作していました。</p>  <p>証明書の有効期限は顧客に直接影響しますが、これらの証明書を保守および監視するための手順の内訳が根本原因でした。 また、これらの証明書はリージョン間で同じであり、互いに近接していたため、ストレージシステムの単一障害点として一時的にました。</p>  <p><strong>Storage 証明書が更新されなかった方法の詳細</strong></p>  <p>状況によっては、シークレットストアの通常の動作の一部として、管理対象の証明書に対して週単位でスキャンが実行されます。 保留中の期限切れのアラートは、サービスを管理しているチームに、180日前に開始されます。 この時点から、シークレットストアは、証明書を所有するチームに通知を送信します。 次に、通知されたときに証明書を更新し、展開を予定しているサービスの新しいビルドに更新した証明書を含め、シークレットストア &rsquo; s データベースの証明書を更新します。 このプロセスは、Azure Windows の多くのサービスにおいて、1か月に何百もの時間にわたって定期的に発生します。</p>  <p>この場合、シークレットストアサービスは、前述の SSL 証明書が指定された日付に期限切れになることを Windows Azure Storage サービスチームに通知します。 2013年 1<sup>月7日に、</sup>ストレージチームはシークレットストア内の3つの証明書を更新し、今後のリリースのサービスに含めました。 ただし、証明書の更新が含まれているリリースとして、ストレージサービスリリースにフラグを付けることができませんでした。 その後、重要な証明書の更新を含むストレージサービスのリリースは、優先順位の高い更新プログラムの後に遅延され、証明書の有効期限を満たすために時間内に展開されませんでした。 また、証明書はシークレットストアで既に更新されているため、アラートシステムのギャップであった追加のアラートはチームに提示されませんでした。</p>  <p><strong>Storage サービスの回復</strong></p>  <p>インシデントは、通常の監視によって 12:44 PM の PST で検出され、有効期限が切れた証明書は原因として診断されました。 13:15 PM PST によって、エンジニアリングチームは問題をトリアージし、いくつかの作業ストリームを確立して、サービスを復元する最速のパスを決定しました。</p>  <p>通常の操作では、ファブリックコントローラーはノードを目的の状態 (目標状態 &rdquo; と &ldquo; も呼ばれます) にします。 サービスのサービス定義は、デプロイの目的の状態を提供します。これにより、ファブリックコントローラーは、デプロイの一部であるノード (サーバー) の目標の状態を確認できます。 サービス定義は、エンドポイント、構成、および障害/更新ドメインを持つロールインスタンスと、コード、仮想ハードディスク (VHD) 名、証明書の拇印などの他のアイテムへの参照で構成されます。</p>  <p>通常の運用では、指定されたサービスは、新しい証明書を含むようにビルドを更新してから、更新ドメインを体系的に調査し、すべてのノードにサービスを展開することによって、ファブリックコントローラーがサービスをデプロイするようにします。 このプロセスは、外部の顧客がシームレスに更新し、公開されたサービスレベルアグリーメント (SLA) に準拠するように、ソフトウェアを更新するように設計されています。 この作業の一部は並行して実行されますが、グローバルサービスに更新をデプロイする全体的な時間は数時間です。</p>  <p>この HTTPS サービスの中断中に、http を使用してデータにアクセスしていたお客様が、http に一時的に移行することによって HTTPS の問題を迅速に軽減していたお客様には、Windows Azure Storage サービスがまだ稼働しています。 他のユーザーのためにサービスを復元するときに、HTTP を使用しているお客様には影響を与えませんでした。</p>  <p>HTTPS サービスを復元するためのいくつかのオプションを確認した後、2つの方法が選択されています。 1) 各ストレージノードでの証明書の更新、2) ストレージサービスの完全な更新。 カスタマーサービスをできるだけ迅速に復元するために最適化された1番目のアプローチ。</p>  <p><strong>1) &nbsp; &nbsp; &nbsp; &nbsp; </strong><strong>証明書の更新</strong></p>  <p>開発チームは、修復方法と復元サービスを検証するために、証明書を更新するために必要な手動の手順を実行しました。 このプロセスは、ファブリックコントローラーがノードを目標状態に戻すことによって複雑になりました。 証明書を正常に更新したプロセスは、18:22 PM の PST によって開発およびテストされています。 以前の障害からの重要なのは、他のサービスに影響を与える複雑さや二次的な停止を防ぐために、事前に時間を取って修正プログラムを十分にテストして検証することでした。 修正プログラムのテスト中に、運用環境のデプロイで検証される前に、いくつかの問題が見つかり、修正されました。</p>  <p>自動更新プロセスが検証されると、19:20 PST の米国西部データセンターのストレージノードに適用され、20:50 PM の PST でサービスが正常に復元されます。 その後、すべてのストレージノードにグローバルにロールアウトします。 このプロセスは、22:45 PM の PST で完了し、ほとんどの顧客に対して HTTPS サービスが復元されました。 追加の監視と検証が実行されました。 Azure ダッシュボードは、00:09 年2月<sup>2013 23 日</sup>の太平洋標準時 AM に緑色でマークされています。</p>  <p><strong>2) 更新の完了</strong></p>  <p>証明書の更新と並行して、更新された証明書を使用したストレージサービスの完全な更新がスケジュールされ、世界規模でロールアウトされました。 この更新の目的は、すべての記憶域ノードに最終的かつ正しい目標の状態を提供し、システムが一定の状態で正常であることを確認することでした。 このプロセスは、23:00 PM<sup>pst に</sup> 年2月22日に開始され、19:59 pm pst では年 2<sup>月23日に完了</sup> しました。そのため、お客様の可用性 SLA には影響しませんでした。</p>  <p><strong>サービスの向上</strong></p>  <p>インシデントが発生した後、常にインシデントを分析し、エンジニアリング、運用、および通信を改善する方法を確認します。 可能な限り、根本原因を分析して、インシデントのあらゆる側面を分析し、お客様にとってのプラットフォームの信頼性を向上させます。</p>  <p>この分析は、インシデントのライフサイクルの各部分とそれに先行するエンジニアリングプロセスを見ながら、4つの主要領域で構成されています。</p>  <ul>  <li><strong>検出</strong> &ndash; 障害を迅速に表面化し、復旧を優先する方法</li>  <li><strong>回復</strong> &ndash; お客様への復旧時間と影響を軽減する方法</li>  <li><strong>防止</strong> &ndash; 障害からのシステムの回避、分離、回復の方法</li>  <li><strong>応答</strong> &ndash; インシデント中に顧客をサポートする方法</li>  </ul>  <p><strong>検出</strong></p>  <p>証明書の有効期限の監視を拡張して、シークレットストアだけでなく、運用エンドポイントも含めて、証明書が運用環境で期限切れにならないようにします。</p>  <p><strong>回復</strong></p>  <p>回復用のプロセスは正常に動作しましたが、展開メカニズムのパフォーマンスと信頼性を向上させるために引き続き機能します。</p>  <p>ここでは、重要な証明書の更新を行うための特定のメカニズムを用意し、これらのメカニズムを定期的に実行して、このようなインシデントが発生した場合の迅速な対応を実現します。</p>  <p><strong>防止</strong></p>  <p>運用環境に展開される将来の証明書の検出を改善します。 有効期限が切れるまで3か月未満のすべての実稼働証明書は、運用上のインシデントを作成し、サービスに影響を与えるイベントの場合と同様に処理および追跡されます。</p>  <p>また、関連する手動プロセスも自動化します。これにより、証明書の更新を含むサービスのビルドが適切に追跡および優先されます。 &nbsp; 暫定的には、証明書に関連するすべての手動プロセスがチームによってレビューされています。</p>  <p>マイクロソフトは証明書を調査し、リージョン間および期間全体で証明書を分割する機会を探します。そのため、キャッチされていない有効期限によって、広範囲にわたる同時イベントが作成されることはありません。 また、システムの確認を続け、単一障害点に対処します。</p>  <p><strong>Response</strong></p>  <p>Windows Azure サービスダッシュボードの複数レベルのフェールオーバー手順は想定どおりに機能し、インシデントを通じてお客様に重要な更新を提供しました。 インシデントの期間にわたって59の進行状況の更新がありましたが、問題と更新プログラムについて正確な Eta を提供する機能を引き続き改良していきます。</p>  <p>microsoft では、Azure<a href="https://azure.microsoft.com/en-us/support/service-dashboard/" target="_blank">ダッシュボード</a>Windows のリアルタイムで、お客様のコミュニケーションを改善する方法を継続的にご紹介します。</p>  <p><strong>サービス クレジット</strong></p>  <p>このサービスの中断は、影響を受ける顧客に大きな影響を与えていることを認識しています。 このイベントの性質と期間が原因で、影響を受ける顧客に <strong>SLA クレジットを事前に提供</strong> します。 クレジットは、影響を受けるすべてのサービスに対応します。 停止時に次の影響を受けるサービスを実行していたお客様は、影響を受けた請求期間について、これらのサービスに関連付けられている料金に対して25% のサービスクレジットを取得します。</p>  <ul>  <li>Storage</li>  <li>Mobile Services</li>  <li>Service Bus</li>  <li>Media Services</li>  <li>Web サイト</li>  </ul>  <p>影響を受けるお客様は、データ転送の使用状況に対して 25% のクレジットも受け取ります。 クレジットは SLA に従って計算され、後続の請求書に反映されます。 その他の質問がある場合は、Azure サポートWindows問<a href="https://azure.microsoft.com/support/?WT.mc_id=cmp_pst001_blg_post0072" target="_blank">い</a>合わせください。</p>  <p><strong>まとめ</strong></p>  <p>Azure Windowsチームは、今後数週間の間に上記の結果を引き続き確認し、サービスを継続的に改善するためのすべての手順を実行します。</p>  <p>この停止が顧客に与えた影響を申し訳なく思います。 引き続き、高可用性サービスを提供するために、引き続き取り組み続けながら取り組む必要があります。</p>  <p>&nbsp;-Mike</p>'
