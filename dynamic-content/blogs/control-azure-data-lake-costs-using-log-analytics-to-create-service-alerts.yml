### YamlMime:Yaml
ms.openlocfilehash: 9600fd57e1de27a2f9910bcf14973a563bc54f3a
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891664"
Slug: control-azure-data-lake-costs-using-log-analytics-to-create-service-alerts
Title: Log Analytics を使用してサービスの警告を作成する Azure Data Lake コストを管理する
Summary: Azure Data Lake のお客様は、Data Lake Store と Data Lake Analytics を使用して、複雑な分析を大量のデータに格納して実行します。
Content: >-
  <p>Azure Data Lake のお客様は、Data Lake Store と Data Lake Analytics を使用して、複雑な分析を大量のデータに格納して実行します。 ただし、コストを管理したり、アカウントの利用状況を常に把握したり、使用量のしきい値が一定の制限に近づいたときに事前に通知したりすることは困難です。 Log Analytics と Azure Data Lake を使用すると、これらの課題に対処し、コストが増加しているか、特定のアクティビティが発生した時期を知ることができます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/eaeb8328-7731-4020-8c74-f4e694bd0bef.png"><img alt="image" border="0" height="157" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e30ef903-e843-458b-a56d-91b3a799d825.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="絵" width="624"></a></p>


  <p>この記事では、Data Lake アカウントで Log Analytics を使用して、Data Lake アクティビティイベント、および特定の使用状況のしきい値に達したときに通知できるアラートを作成する方法について説明します。 簡単に始めることができます。</p>


  <h2>手順 1: Connect Azure Data Lake と Log Analytics</h2>


  <p>Data Lake アカウントは、診断ログを生成するように構成できます。その中には、自動的に生成されるものもあります (たとえば、現在の使用状況をレポートするような通常の Data Lake 操作や、ジョブが完了したときなど)。 他のユーザーは、要求に基づいて生成されます (たとえば、新しいファイルが作成されたとき、開かれたとき、ジョブが送信されたときなど)。 これらの診断ログを Log Analytics アカウントに送信するように、Data Lake Analytics と Data Lake Store の両方を構成できます。このアカウントでは、ログのクエリを実行し、クエリ結果に基づいて警告を作成できます。</p>


  <p>診断ログを Log Analytics アカウントに送信するには、「 <a href="https://blogs.msdn.microsoft.com/azuredatalake/2018/02/06/struggling-to-get-insights-for-your-azure-data-lake-store-azure-log-analytics-can-help/" target="_blank">Azure Data Lake Store の洞察を得るには」のブログ記事で説明されている手順に従います。Azure Log Analytics は役に立ちます。 </a></p>


  <h2>手順 2: 特定のイベントまたは集計されたしきい値を識別できるクエリを作成する</h2>


  <p>Azure Data Lake アカウントの状態または使用に関する特定の重要な質問は、一般に、使用状況ログまたはメトリックログを解析するクエリを使用して応答することができます。 Log Analytics でログを照会するには、アカウントホーム (OMS ワークスペース) で [ログ検索] をクリックします。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b5d85adc-9338-409d-ba81-e4a34f73c1a3.png"><img alt="image" border="0" height="114" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/6e33847d-cbe8-4519-b4d2-f807eef1d590.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="絵" width="624"></a></p>


  <p>[ログ検索] ブレードで、 <a href="https://docs.loganalytics.io/index" target="_blank">Log Analytics クエリ言語</a>を使用してクエリの入力を開始できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e0bdfd63-cbdc-4c6c-a06c-39920ab52e7b.png"><img alt="image" border="0" height="329" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a9cdc897-249d-4ea7-a500-bcc96a43487b.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="絵" width="624"></a></p>


  <p>アラートを構成するために Log Analytics で使用できるクエリには、主に次の2種類があります。</p>


  <ul>
   <li>個々のイベントを返すクエリでは、1行につき1つのエントリが表示されます (たとえば、ファイルが開かれるたびに)。</li>
   <li>1つのイベント (過去5分間に開かれた10個のファイルなど)、またはメトリックの値 (ジョブに割り当てられた Au の合計など) を集計することによって、特定の時間の値やメトリックをしきい値として集計するクエリ。</li>
  </ul>


  <p>次にサンプルクエリをいくつか示します。次に、3番目の集計値のうち、最初の2つのイベントを返します。</p>


  <ul>
   <li>このクエリは、指定された Azure Data Lake Store (ADLS) アカウントで新しい Data Lake Store フォルダーが作成されるたびに、新しいエントリを返します。</li>
  </ul>


  <pre>

  AzureDiagnostics

  | where Category == &quot;Requests&quot;

  | where ResourceProvider == &quot;MICROSOFT.DATALAKESTORE&quot;

  | where Resource == &quot;[Your ADLS Account Name]&quot;

  | where OperationName == &quot;mkdirs&quot;</pre>


  <ul>
   <li>このクエリは、Log Analytics ワークスペースに構成されているいずれかの Data Lake Analytics アカウントでジョブが失敗するたびに、新しいエントリを返します。</li>
  </ul>


  <pre>

  AzureDiagnostics

  | where ResourceProvider == &quot;MICROSOFT.DATALAKEANALYTICS&quot;

  | where OperationName == &quot;JobEnded&quot;

  | where ResultType == &quot;CompletedFailure&quot;</pre>


  <ul>
   <li>このクエリは、ユーザーが24時間間隔で送信したジョブの一覧を返します。これには、ユーザーアカウントと、24時間間隔で送信されたジョブの合計が含まれます。</li>
  </ul>


  <pre>

  AzureDiagnostics

  | where ResourceProvider == &quot;MICROSOFT.DATALAKEANALYTICS&quot;

  | where OperationName == &quot;SubmitJob&quot;

  | summarize AggregatedValue = count(identity_s) by bin(TimeGenerated, 24h), identity_s</pre>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/eebb0deb-f05b-4926-80fa-f1feaf505f74.png"><img alt="image" border="0" height="194" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/08f9f8e8-d68d-4eff-ab75-f6d8c840191b.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="絵" width="624"></a></p>


  <p>これらのようなクエリは、アラートを構成するときに次の手順で使用されます。</p>


  <h2>手順 3: イベントが検出されたとき、またはしきい値に達したときに通知するアラートを作成します。</h2>


  <p>前の手順のようなクエリを使用すると、Log Analytics を使用して、イベントがキャプチャされたとき、またはメトリックのしきい値に達したときに、電子メール、テキストメッセージ、または webhook を使用してユーザーに通知する警告を作成できます。 新しいアラートの作成については、「 <a href="https://blogs.msdn.microsoft.com/azuredatalake/2018/04/10/simple-trick-to-stay-on-top-of-your-azure-data-lake-create-alerts-using-log-analytics/" target="_blank">Log Analytics を使用してアラートを作成する</a>」をご覧ください。この記事では、Azure Data Lake について簡単に確認できます。</p>


  <p>アラートは少し遅れているので、「 <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-alerts" target="_blank">Log Analytics のアラートについ</a>て」で、遅延と Log Analytics sla に関する詳細を確認できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/db8cad49-7829-48ed-b4bb-e792ad9d3d7e.png"><img alt="image" border="0" height="453" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dc91f799-d401-4b67-9538-815e6a522def.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="絵" width="435"></a></p>


  <h2>ご意見をお寄せください</h2>


  <p>Log Analytics でのアラートの設定は、使用率の増加に応じて使用状況を把握し、コストを管理するのに役立ちます。 アラートを設定するプロセスにより、特定のニーズに合わせて柔軟性を高めることができます。 特定のメトリックまたは使用状況アクティビティを探していますか? ご意見をお寄せください。また、ご意見やご <a href="https://aka.ms/adlfeedback" target="_blank">要望</a>をお寄せください。 Azure Data Lake アカウントを最大限に活用するための更新プログラムとヒントを定期的に共有している <a href="https://blogs.msdn.microsoft.com/azuredatalake/2018/04/10/simple-trick-to-stay-on-top-of-your-azure-data-lake-create-alerts-using-log-analytics/" target="_blank">Azure Data Lake のブログ</a>をご覧ください。</p>
