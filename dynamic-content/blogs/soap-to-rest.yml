### YamlMime:Yaml
ms.openlocfilehash: ffea051ec2635a8010aa065a2d82460623b11c1b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892392"
Slug: soap-to-rest
Title: SOAP から REST
Summary: '数か月前に、Azure API Management に SOAP パススルー サポートが追加されました。この機能に関するフィードバックをお寄せいただきありがとうございます。 上位の要求の 1 つは、「SOAP バックエンドを RESTful HTTP フロントエンドに変換する方法」でした。 '
Content: >-
  <p>数か月前に、Azure API Management に SOAP パススルー サポートが追加されました。この機能に関するフィードバックをお寄せいただきありがとうございます。 最も多かった要求の &quot;1 つは、SOAP バックエンドを RESTful HTTP フロントエンドに変換する方法です。&quot; このブログ記事では、この新機能の使い方について説明します。</p>


  <p>それでは&#39;始めましょう。 インポートする WSDL ファイルが必要になります。SOAP から REST への変換はポリシーを使用して手動で行うことができますが、最も簡単な方法は、WSDL インポート機能を使用してから、必要に応じてカスタマイズすることです。 使用する SOAP サービスの WSDL の URL を取得するか、 <a href="https://fazioapisoap.azurewebsites.net/FazioService.svc?singleWsdl">Orders SOAP サービスの例を使用します</a>。 WSDLs のサポート方法に関する注意点を次に示します。</p>


  <ul>
   <li>WS-I Basic Profile 1.1、SOAP 1.1、WSDL1.1、SOAP 1.2 を使用して定義された SOAP サービスがサポートされています。</li>
   <li>現在、wsdl:import 要素を含む WSDL、または複数の部分を含むメッセージはサポートされていません</li>
  </ul>


  <p>パブリッシャー ポータルで、[API] メニューを参照し、[API のインポート] を &quot;選択します&quot;。 表示される画面で、WADL、Swagger、または WSDL からインポート形式を選択できます。</p>


  <p>[WSDL] を選択し、リンクを貼り付けるか、WSDL ファイルを参照します。 次に、実行している WSDL &quot;インポートの種類を選択する必要があります。[SOAP to REST&quot; - API に URL サフィックスを付けます] (注文など) を選択し、必要に応じて製品に追加します (&quot;&quot;開発者ポータルでテストできるよう、この例を製品に追加します)。 [保存&#39;] を&#39;。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e9268fc3-4dad-45d9-a911-b2c4255777cc.png"><img alt="clip_image002" border="0" height="379" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b230c1f4-f9a5-469a-9ff6-a223db2c3cc5.png" style="display: inline; background-image: none;" title="clip_image002" width="1251"></a></p>


  <p>このデモに表示される次の画面は、WSDL ファイルに複数のサービス エンドポイント (&quot;&quot;&quot;&quot;ポートの種類またはインターフェイス) が定義されている場合に発生します。 SOAP API を他の API と同様の方法で処理するには、その中で定義されているインターフェイスの 1 つのみをインポートする必要があります (他のインターフェイスは個別の API としてインポートできます)。 [FazioService::basic] を選択して続行します。</p>


  <p>API Management、SOAP を作成してデータをREST API。 ここでは、SOAP パススルー API との違いが発生します。 API メニューを参照して操作の定義を確認すると、通常の REST 定義が表示されます。ただし、異なるのは、[書き換え URL テンプレート] フィールドがバックエンド SOAP サービスを指している点です。</p>


  <p>では、これを実現するために何を行っているのでしょうか。 インポート プロセスの一環として、Azure API Management では、JSON から SOAP エンベロープへの受信変換、および送信フローに対するその逆の特殊なポリシーが生成されます。 Liquid テンプレートを使用できるセット本文ポリシーの更新バージョンを使用しています。 これらを&#39;を見てみしましょう。</p>


  <h2>テンプレート</h2>


  <p>これで、セット本文ポリシーで <a href="https://shopify.github.io/liquid/basics/introduction/">Liquid テンプレート</a> を使用できます。 このテンプレートを使用すると、要求または応答の本文を、必要に応じて完全に変換できます。ここでは特に、このテンプレートを使用して、SAOP から REST に使用していますが、ポリシーはこれに限定されません。 Liquid の詳細については、Liquid の概要に関するページ <a href="https://shopify.github.io/liquid/basics/introduction/">を参照してください</a>。 GetOrders のポリシーは、Liquid テンプレートのしくみの簡単な例を示しています ({{body.getOrder.orderId}} を使用して JSON 本文からテンプレートに値を挿入します)。</p>


  <pre>

  &lt;set-body template=&quot;liquid&quot;&gt;


  &lt;soap:Envelope xmlns:soap=&quot;https://schemas.xmlsoap.org/soap/envelope/&quot; xmlns=&quot;https://tempuri.org/&quot;&gt;


  &lt;soap:Body&gt;


  &lt;GetOrder&gt;


  &lt;orderId&gt;{{body.getOrder.orderId}}&lt;/orderId&gt;


  &lt;/GetOrder&gt;


  &lt;/soap:Body&gt;


  &lt;/soap:Envelope&gt;


  &lt;/set-body&gt;</pre>


  <p>作成されたポリシーを確認すると、作成された送信ポリシーが受信ポリシーと大異なっているのが確認されます。 これは、SOAP を JSON に変換し戻すためです。 また、SOAP API から返される応答も確認しています。400 を超える HTTP 状態コードを受け取った場合は、SOAP エラーを確認し、エラー メッセージを転送します。</p>


  <p>SOAP から REST へのテンプレートの使用に関する大きな点は、最初のインポートとセットアップを行った後は、変更を自由に変更し、ニーズに合わせて調整できる点です。</p>


  <p>この開発者ポータル Orders API をクリックすると、生成した操作とドキュメントを確認できます。 開発者コンソールを使用して、SOAP API から返される RESTful ペイロードを確認します。 &quot;[GetOpenOrders] をクリック&quot;し&quot;、[試&quot;してみる] ボタンをクリックすると、要求の例が表示されます。 GetOpenOrders の場合は、顧客番号 ( &quot;cust&quot; 値) &quot;を 1001&quot; に変更して、応答の例を取得します。 管理者としてログオンしている&quot;&quot;場合は、[トレース] タブを見て、テンプレートの実行がどれだけ速く行ったか確認できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ed8511a4-c355-403a-8f0f-ef0023933db7.png"><img alt="clip_image004" border="0" height="292" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/01a60292-a78f-4d33-9d5e-326424db298d.png" style="display: inline; background-image: none;" title="clip_image004" width="1251"></a></p>


  <h2>API</h2>


  <p>必要な場合は、独自の管理 API を使用して SOAP から REST へのインポートを実行することもできます。</p>


  <p>https://.management.current.azure-api.net/apis/soapapi?import=true&amp;p ath=soapapiapiType&amp;=Httpapi-version&amp;=2014-02-14-preview</p>


  <p>APIType は、SOAP が REST &quot;&quot; の&quot;場合は Http&quot;、SOAP パススルーの場合は Soap に設定する必要があります。</p>
