### YamlMime:Yaml
ms.openlocfilehash: 93e708f82889deb12cca458546ea007555cd750c
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890787"
Slug: heuristic-dns-detections-in-azure-security-center
Title: ヒューリスティック DNS 検出 (Azure Security Center
Summary: 多くのお客様から、非常に回避性の高い脅威の検出に関する課題についてお聞きしました。 現在、この重要なプロトコルの悪意のある使用を検出する、より複雑でヒューリスティックな手法と、一般的な現実世界の攻撃の主要なコンポーネントを検出する方法について説明します。
Content: >-
  <p>多くのお客様から、非常に回避性の高い脅威の検出に関する課題についてお聞きしました。 ガイダンスを提供するために、ネットワーク<a href="https://blogs.technet.microsoft.com/teamdhcp/2015/11/23/network-forensics-with-windows-dns-analytical-logging/" target="_blank">のWindows用の DNS</a> サーバー ログと、Azure DNS Analytics ソリューションの導入を<a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-dns" target="_blank">公開しました</a>。 現在、この重要なプロトコルの悪意のある使用を検出する、より複雑でヒューリスティックな手法と、一般的な現実世界の攻撃の主要なコンポーネントを検出する方法について説明します。</p>


  <p>これらの分析では、高度な標的型侵入から、より平般的なウォーム、ボットネット、ランサムウェアまで、さまざまな攻撃に共通する動作に焦点を当て、 このような手法は、より具体的な署名ベースの検出を補完するように設計されています。アナリスト駆動型ルールをデプロイする前に、このような動作を特定する機会が提供されます。 これは、対象となる攻撃の場合に特に重要です。このようなアクティビティの検出時間は通常、数か月単位で測定されます。 攻撃者がネットワークにアクセスできる時間が長くなると、最終的なクリーンアップと削除プロセスのコストが高くなります。 同様に、ランサムウェアのルールベースの検出は通常、数日以内に使用できます。しかし、多くの場合、これは多くの組織のブランドや財務上の大きな損害を回避するには遅すぎます。</p>


  <p>これらの分析は、さらに多くの分析と共に、Azure ベースのサーバー Azure Security Center DNS ログの収集を有効にすることで有効になります。 このログ記録には Windows DNS サーバーが必要ですが、検出自体は主にプラットフォームに依存しないので、有効なサーバーを使用するように構成された任意のクライアント オペレーティング システム間で実行できます。</p>


  <h2>一般的な攻撃シナリオ</h2>


  <p>クラウド サーバーにアクセスしようとする悪者は、ローカル管理者パスワードのブルート フォース推測によってログインを試みるスクリプトを開始します。 間違ったログイン試行の回数に制限がない場合、数日間の作業の後、攻撃者は最終的に、 の認識された強力なパスワードを正しく推測します St@1w@rt。</p>


  <p>ログインに成功すると、侵入者はすぐに悪意のあるリモート管理ツールのダウンロードとインストールに進みます。 これにより、ユーザー パスワードの自動盗用、クレジット カードや銀行の詳細の検出、後続のブルート フォース攻撃やサービス拒否攻撃の支援など、便利な機能が提供されます。 実行すると、このツールは、事前に構成されたコマンドおよび制御サーバーに対して HTTP を定期的にビーコンし始め、さらに指示を待っています。</p>


  <p>この種の攻撃は、検出するのは簡単に見える一方で、必ずしも簡単に防止できるとは限ではありません。 たとえば、間違ったログイン試行を制限するのは賢明な予防策のように見えますが、そうすることで、ロックアウトによるサービス拒否の重大なリスクが生じします。 同様に、多数の失敗したログインを検出するのは簡単ですが、正当なユーザー アクティビティと、多くの場合、分散ブルート フォース試行のほぼ継続的なバックグラウンド ノイズを区別するのは必ずしも簡単ではありません。</p>


  <h2>検出の機会</h2>


  <p>分析の多くでは、最初の感染ベクターを特に探しているのではありません。 &rsquo;上記の例はブルート フォース アクティビティから検出された可能性は高く、実際には、正当な管理者デスクトップの悪用やソーシャル エンジニアリングの取り組みの成功に続く場合と同様に、既知のパスワードを使用した 1 つの悪意のあるログインである可能性があります。 したがって、次の手法では、後続の動作、または悪意のあるサービスのダウンロードと実行を検出します。</p>


  <h2>ネットワーク成果物</h2>


  <p>上記のような攻撃には、ネットワーク上で検出の多くの方法が考えられるが、ほとんどすべての攻撃の一貫した機能が DNS の使用である。 使用されるトランスポート プロトコルに関係なく、特定のサーバーにドメイン名で接続される可能性があります。 このホスト名を IP アドレスに解決するには、DNS を使用する必要があります。 そのため、DNS 対話のみを分析することで、特定のネットワークからの送信通信チャネルの便利なビューを取得できます。 基になるプロトコルではなく、DNS に対して分析を実行する場合の追加の利点は、共通ドメインのローカル キャッシュです。 これにより、ネットワーク上での普及が減少し、任意の分析フレームワークのストレージと計算コストの両方が削減されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/33d01555-3060-4c7c-9431-6570d4675930.png"><img alt="image" border="0" height="557" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e29dc021-25dc-4f1b-ae0c-5d98675c4473.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="イメージ" width="602"></a></p>


  <p align="center"><em>ランダム ドメイン分析によって WannaCry ランサムウェアが検出されました。</em></p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c013c9ca-edd4-4088-9965-aa84f3fbc1d4.png"><img alt="image" border="0" height="605" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c34395e9-df1a-4f98-9591-87ce359bf8a4.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="イメージ" width="602"></a></p>


  <p align="center"><em>WannaCry ランサムウェアによって列挙されたハードコードされたドメインの一覧を示すマルウェア レポート。</em></p>


  <h2>ランダム ドメイン</h2>


  <p>悪意のあるソフトウェアは、ランダムに生成されたドメインに向かう傾向があります。 これは、単純な言語の&rsquo;問題に至るまで、多くの理由で、各犠牲者のネイティブ言語にドメインを調整する必要が回避される可能性があります。 このような名前の多数の登録を自動化し、偶発的な再利用や競合の可能性を減らすのにも役立つ。 これはドメイン生成アルゴリズム (DGA) などの手法で強調されますが、上記の WannaCry の例のように、静的ダウンロード サイトやコマンド および制御サーバーで頻繁に使用されます。</p>


  <p>これらのランダムな名前の &ldquo;検出&rdquo; は必ずしも簡単ではありません。 標準テストは、比較的大量のデータでのみ機能する傾向があります。 たとえば、エントロピには、文字セットの最小サイズの数倍か、少なくとも数百バイトが必要です。 一方、ドメイン名の長さは最大 63 文字です。 この問題に対処するために、基本的な言語モデリングを使用して、正当なドメイン名で発生するさまざまな n グラムの確率を計算しました。 また、これらを使用して、特定の名前の文字の非常に可能性の低い組み合わせの発生を検出します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/9fc736d7-26f1-4656-9419-6bb9ccd03b41.png"><img alt="image" border="0" height="632" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4b91b362-2550-4269-9f13-32fb32b40ba6.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="イメージ" width="622"></a></p>


  <p align="center"><em>マルウェア は、ShadowPad のトロイの木馬によるランダムに生成されたドメイン名の使用を詳しく報告します。</em></p>


  <h2>Periodicity</h2>


  <p>前述のように、この攻撃には、コマンドおよびコントロール サーバーの定期的なビーコンが含まれる必要があります。 引数のために、これは&rsquo; 1 時間に 1 つの HTTP 要求と見なします。 この要求を行う場合、HTTP&rsquo; クライアントはまず、ローカル DNS リゾルバーを介してサーバーのドメイン名の解決を試みる必要があります。 このリゾルバーは、このような解決のローカル キャッシュを保持する傾向があります。つまり、すべてのビーコンに DNS 要求が表示される保証はありません。 ただし、これらは 1 時間に複数回表示できます。</p>


  <p>このような定期的なアクティビティを見つけるには、Euclids&rsquo; アルゴリズムのバージョンを使用して、特定の各ドメインの参照間の時間の最も大きな一般的な概数を追跡します。 &rsquo;ドメイン GCD が許可されたエラー (正確な場合は 1 つ) 内に入った後、ドメインの花のフィルターに追加され、それ以上の計算から無視されます。 このエラーより GCD が大きいと仮定すると、現在の GCD またはビーコン期間の推定値と観測数を取得して、この期間の倍数でこの多くの同時参照を観察する確率を計算します。 つまり、一部のドメインに対して 3 つの同時参照がランダムに表示される可能性があります。2 秒の倍数では、すべて 8 の 1/2^3&nbsp; または 1 です。 一方、この例と同様に、1 時間の倍数で最も近い秒に正確に 3 つのランダムな参照が表示される確率は、46,656,000,000 の 1/?3600〗^3&nbsp; または 1 です。 そのため、時間の差分が長くなると、定期的に確認する前に観察する必要がある観測値が少なくなります。</p>


  <h2>まとめ</h2>


  <p>上記のシナリオで示したように、ネットワーク成果物の分析は、エンドポイントでの悪意のあるアクティビティの検出に非常に役立ちます。 理想的な状況は、ネットワーク上のすべてのマシンからのすべてのプロトコルを分析する場合ですが、実際には、収集して処理するにはコストが高すぎます。 1 つのプロトコルを選択すると、悪意のある通信を検出する可能性が最も高く、収集されるデータの量を最小限に抑えた結果、HTTP と DNS の選択が可能になります。 DNS を選択すると、直接 IP 接続を検出する機能が失われる。 実際には、静的 IP アドレスが相対的に不足し、ファイアウォールでこのような接続をブロックする可能性が高く、これらはまれです。 DNS を調べる利点は、比較的小さなデータセット内のすべてのクライアント オペレーティング システムから考えられるすべてのネットワーク プロトコル間の接続を監視する機能です。 このデータの圧縮性は、一般的なドメインのホスト上キャッシュの既定の動作によってさらに支援されます。</p>


  <p align="left">&nbsp;</p>
