### YamlMime:Yaml
ms.openlocfilehash: 26ab294ad1db76826d060e4df0b4fc1c1ae41ae8
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896817"
Slug: elastic-database-transactions-with-azure-sql-database
Title: Azure SQL Database を使用したトランザクションの Elastic Database
Summary: エラスティックデータベーストランザクションを使用して Azure SQL Database で分散トランザクションを実装する方法について説明します。
Content: "<p>現在、Azure SQL Database での<a href=\"https://azure.microsoft.com/documentation/articles/sql-database-elastic-transactions-overview/\">エラスティックデータベーストランザクション</a>のプレビューについてお知らせします。 分散トランザクションは、SQL Database のために要求された機能の中でも一貫してランク付けされています。 トランザクションプロパティを使用して SQL Database 内の複数のデータベースに対して操作を実行できるようになりました。 これにより、Microsoft 分散トランザクションコーディネーター (MSDTC) を使用している場合に、SQL Server で使用しているのと同じ保証が得られます。 エラスティックデータベーストランザクションの保証により、SQL Database 内のさまざまなデータベースに対する変更が、すべてのデータベースで実行されるか、まったく行われないようにします。 これにより、データベース間での状態の一貫性を維持するための、使い慣れた原子性と分離のプロパティが可能になり &nbsp; ます。 &nbsp;たとえば、データベース間で財務トランザクションを処理する場合、または1つのデータベースで在庫を更新して別のデータベースで注文する場合に、このことが重要になります。</p>\n\n<p><a href=\"https://blogs.msdn.com/b/dotnet/archive/2015/10/29/announcing-net-framework-4-6-1-rc.aspx\">.net 4.6.1</a>以降では、現在使用されているものと同じ .net api を使用して、SQL データベースのエラスティックデータベーストランザクションが、MSDTC を使用したオンプレミスでのトランザクションの調整に使用されます。 つまり、最新の .net ライブラリ &ndash; に対して既存の .net アプリケーションを再構築するだけでコードを変更する必要がないため、SQL Database のエラスティックデータベーストランザクションの使用を開始できます。 さらに、エラスティックトランザクションは SQL Database によって直接管理されるため、SQL Database でエラスティックトランザクション用に MSDTC を展開する必要はありません。</p>\n\n<p>このプレビューでは、TransactionScope などの <a href=\"https://msdn.microsoft.com/library/system.transactions.aspx\">システムトランザクション</a> を使用して分散トランザクションをコーディネートする .net アプリケーションに焦点を当てています。 .NET 開発者は、SQL Server で広く採用されているプログラミングパターンを既に構成しています。 ただし、T SQL を使用して分散トランザクションを純粋に調整するためのサーバー側のエクスペリエンスは、このプレビューには含まれていません。 次の図は、SQL Database でのエラスティックデータベーストランザクションのシナリオを示しています。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/405dcb1d-2b4c-4701-b915-7d32095bd8bd.png\"><img alt=\"Elastic Database Transactions with Azure SQL Database\" border=\"0\" height=\"391\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e55467d4-71db-4d58-b815-4608839b7a3b.png\" style=\"border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Azure SQL Database を使用したトランザクションの Elastic Database\" width=\"480\"></a></p>\n\n<p>.net アプリケーションで Azure SQL DB のエラスティックデータベーストランザクションの使用を開始する方法の詳細については、次の段落を参照してください。</p>\n\n<h1>インストール</h1>\n\n<p>このプレビューでは、複数の異なる SQL データベースに格納されているデータに対してアトミックな変更を行うアプリケーションを作成できるようになりました。 プレビューの焦点は、.NET と特に C# を使用したクライアント側の開発エクスペリエンスです。 分散トランザクションを調整するためのサーバー側のエクスペリエンス、または .NET 以外のプログラミング言語のサポートは、このプレビューの範囲を超えています。 今後、このサポートを予定しています。</p>\n\n<p>このプレビューの機能は、.NET ライブラリ System.Data.dll および System.Transactions.dll の更新プログラムによって提供されます。 ライブラリは、原子性を確保するために必要な場合に、2フェーズコミットが使用されるように透過的にします。 これらのライブラリは、.NET 4.6.1 リリース候補の一部としてシステムに自動的にインストールされます。 リリース候補を取得する方法の詳細については、Microsoft .NET ブログの <a href=\"https://blogs.msdn.com/b/dotnet/archive/2015/10/29/announcing-net-framework-4-6-1-rc.aspx\" target=\"_blank\">お知らせ</a> をご覧ください。</p>\n\n<p>リリース候補をインストールする &rsquo; と、システムトランザクション api を使用する既存のアプリケーションを、.net 4.6 用に再構築することができます。 プロジェクトが .NET 4.6 を対象としている場合は、リリース候補から更新された Dll が自動的に使用されます。</p>\n\n<p>SQL Server とは対照的に、SQL Database を使用したエラスティックデータベーストランザクションでは、Microsoft 分散トランザクションコーディネーターは必要ありません。 その代わり、エラスティックトランザクションは SQL Database 内でとによってネイティブに管理されます。 これにより、SQL Database で分散トランザクションを使用するために MSDTC を展開する必要がないため、特にクラウドデプロイでのエクスペリエンスが大幅に簡素化されます。</p>\n\n<h1>アプリケーション開発エクスペリエンス</h1>\n\n<p>次のコードサンプルは、.NET システムトランザクションの使い慣れたプログラミングエクスペリエンスを示しています。 この例では、TransactionScope クラスを使用して、.NET でアンビエントトランザクションを確立しています。 アンビエントトランザクションのスコープ内で開かれたすべてのデータベース接続はトランザクションに参加します。また、複数の異なるデータベースが参加している場合は、アンビエントトランザクションがエラスティックデータベーストランザクションに昇格します。</p>\n\n<p>この例では、コミットを示すためにスコープを完了に設定することにより、トランザクションの結果が制御されます。</p>\n\n<pre class=\"prettyprint\">\nusing (var scope = new TransactionScope())\n{\n using (var conn1 = new SqlConnection(connStrDb1))\n {\n  conn1.Open();\n  SqlCommand cmd1 = conn1.CreateCommand();\n  cmd1.CommandText = string.Format(&quot;insert into T1 values(1)&quot;);\n  cmd1.ExecuteNonQuery();\n }\n \n using (var conn2 = new SqlConnection(connStrDb2))\n {\n  conn2.Open();\n  var cmd2 = conn2.CreateCommand();\n  cmd2.CommandText = string.Format(&quot;insert into T2 values(2)&quot;);\n  cmd2.ExecuteNonQuery();\n }\n \n scope.Complete();\n}\n</pre>\n\n<p>プロジェクト設定が .NET Framework バージョン4.6 を対象としていることを確認します。 これにより、.net リリース候補の新しいライブラリが使用 &ndash; されるようになります。これは、SQL Database のエラスティックトランザクションが機能するために必要です。</p>\n\n<h1>トランザクションの状態の監視</h1>\n\n<p><a href=\"https://msdn.microsoft.com/library/ms174302.aspx\">Sys.dm_tran_active_transactions</a>など<a href=\"https://msdn.microsoft.com/library/ms178621.aspx\">のトランザクションに既存の動的管理ビュー (dmv)</a>を使用して、進行中のエラスティックデータベーストランザクションの状態と進行状況を監視できます。</p>\n\n<p>たとえば、上記のサンプルコードを実行して、スコープにブレークポイントを設定することができます。Complete () を呼び出し、sys.dm_tran_active_transactions DMV に対してクエリを実行します。 参加しているすべてのデータベースで、次のスクリーンショットに示すように、同じ UOW 値を持つエラスティックデータベーストランザクションの参加者トランザクションが表示されます。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ab5f7348-956b-497a-8c25-11191f8b9006.png\"><img alt=\"BlogPostVSand SSMSScreenshot\" border=\"0\" height=\"325\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3ac79452-c769-4163-85e0-323128229e49.png\" style=\"border-image: none; padding-top: 0px; padding-right: 0px; padding-left: 0px; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"ブログ Postvsand SSMSScreenshot ショット\" width=\"610\"></a></p>\n\n<h1>次の手順</h1>\n\n<p><a href=\"https://blogs.msdn.com/b/dotnet/archive/2015/10/29/announcing-net-framework-4-6-1-rc.aspx\">.net 4.6.1 リリース候補</a>をダウンロードし、現在 SQL Database でエラスティックデータベーストランザクションの使用を開始することをお勧めします。</p>\n\n<p>SQL Database と .net 4.6.1 を使用したエラスティックデータベーストランザクションの詳細については、<a href=\"https://azure.microsoft.com/en-us/documentation/articles/sql-database-elastic-transactions-overview/\">エラスティックデータベーストランザクションのドキュメント</a>と、 <a href=\"https://blogs.msdn.com/b/dotnet/archive/2015/10/29/announcing-net-framework-4-6-1-rc.aspx\">.net 4.6.1 リリース候補の発表</a>に関するページを参照してください。</p>"
