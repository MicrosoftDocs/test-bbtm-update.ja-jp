### YamlMime:Yaml
ms.openlocfilehash: 0aab7f1de081a598e25b9519a75f404fbbc4b2dc
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139891698"
Slug: azure-sql-database-geo-restore
Title: Azure SQL Database Geo-Restore
Summary: 'この記事では、Azure SQL Database のビジネス継続性/ディザスターリカバリー (bcdr) 機能について説明し、geo リストアに焦点を当てます。 標準 geo レプリケーションに関する前の記事では、さまざまなビジネス継続性機能がどのようにサービス層にマップされるかについて説明しました。 '
Content: >-
  <strong>[03/03/2015 で更新されました]</strong>


  Basic、Standard、およびプレミアムデータベース層の推定復旧時間 (ERT) と目標復旧時点 (RPO) の向上。


  &nbsp;


  この記事では、Azure SQL Database のビジネス継続性/ディザスターリカバリー (bcdr) 機能について説明し、geo リストアに焦点を当てます。 <a href="https://azure.microsoft.com/blog/2014/09/03/azure-sql-database-standard-geo-replication/">標準 geo レプリケーション</a>に関する前の記事では、さまざまなビジネス継続性機能がどのようにサービス層にマップされるかについて説明しました。 次の表は、簡単なリフレッシャーです。

  <table border="1" cellspacing="0" cellpadding="0">

  <tbody>

  <tr>

  <td valign="top" width="176">

  <p align="center"><b>BCDR オプション</b></p>

  </td>

  <td valign="top" width="118">

  <p align="center"><b>Basic レベル</b></p>

  </td>

  <td valign="top" width="114">

  <p align="center"><b>Standard レベル</b></p>

  </td>

  <td valign="top" width="120">

  <p align="center"><b>Premium レベル</b></p>

  </td>

  </tr>

  <tr>

  <td valign="top" width="176">ポイントインタイム リストア</td>

  <td valign="top" width="118">7 日間以内のあらゆる復元ポイント</td>

  <td valign="top" width="114">14日以内の任意の復元ポイント</td>

  <td valign="top" width="120">35 日間以内のあらゆる復元ポイント</td>

  </tr>

  <tr>

  <td valign="top" width="176">geo リストア</td>

  <td valign="top" width="118">ERT * &lt; 12 時間 RPO † &lt; 1h</td>

  <td valign="top" width="114">ERT * &lt; 12 時間 RPO † &lt; 1h</td>

  <td valign="top" width="120">ERT * &lt; 12 時間 RPO † &lt; 1h</td>

  </tr>

  <tr>

  <td valign="top" width="176">標準ジオ (主要地域) レプリケーション</td>

  <td valign="top" width="118">対象外の情報</td>

  <td valign="top" width="114">ERT * &lt; 30 秒 RPO † &lt; 5s</td>

  <td valign="top" width="120">ERT * &lt; 30 秒 RPO † &lt; 5s</td>

  </tr>

  <tr>

  <td valign="top" width="176">アクティブな地理的レプリケーション</td>

  <td valign="top" width="118">対象外の情報</td>

  <td valign="top" width="114">対象外の情報</td>

  <td valign="top" width="120">ERT * &lt; 30 秒 RPO † &lt; 5s</td>

  </tr>

  </tbody>

  </table>

  * 推定復旧時間 (ERT)-復元/フェールオーバー要求後にデータベースが完全に機能するまでの推定所要時間。

  † 回復ポイントの目標 (RPO) - 回復後にアプリケーションが失う可能性のある最新データの変更量 (時間間隔)。

  <h2>Geo リストアとは</h2>

  geo 復元機能を利用すると、geo 冗長バックアップからデータベースを復元して新しいデータベースを作成できます。 データベースは任意の Azure リージョンの任意のサーバーに作成できます。 ソースとして geo 冗長バックアップが使用されるため、障害によってデータベースにアクセスできない場合でも、それを使用してデータベースを復旧できます。 Geo リストアは、追加費用なしですべてのサービス階層に対して自動的に有効になります。

  <h2>Geo リストアの詳細</h2>

  Geo リストアでは、ポイントインタイムリストアと同じテクノロジを使用しますが、1つの重要な違いがあります。 Geo レプリケートされた blob ストレージ (<a href="https://blogs.msdn.com/b/windowsazurestorage/archive/2013/12/04/introducing-read-access-geo-replicated-storage-ra-grs-for-windows-azure-storage.aspx">RA-GRS</a>) の最新の毎日のバックアップのコピーからデータベースを復元します。 各アクティブ データベースについて、サービスは、週次の完全バックアップ、複数の日次差分バックアップ、および 5 分ごとに保存されるトランザクション ログを含むバックアップ チェーンを保持しています。 これらの BLOB は geo レプリケートされ、これにより、プライマリ リージョンで大規模な障害が発生した後でも日次バックアップを利用できることが保証されます。 図1は、このプロセスを示しています。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/Geo-restore-Figure-1.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Geo リストア (図 1)" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo-restore-Figure-1_thumb.png" alt="Geo-restore (Figure 1)" width="1024" height="575" border="0" /></a>

  <p align="center">図 1.ストレージコンテナーにコピーされた週単位および日単位のバックアップの Geo レプリケーション。</p>

  リージョン内の大規模なインシデントによってデータベースアプリケーションが使用できなくなった場合は、geo リストアを使用して、最新のバックアップから他のリージョンのサーバーにデータベースを復元できます。 バックアップは geo レプリケートされており、バックアップが実行されてから異なる geo の Azure blob に geo レプリケートされるまでの間に遅延が生じることがあります。大規模なインシデントの場合は、最大1時間のデータ損失が発生する可能性があります。つまり、RPO は最大1時間です。 図2に、回復プロセスを示します。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/Geo-restore-Figure-2.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Geo リストア (図 2)" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo-restore-Figure-2_thumb.png" alt="Geo-restore (Figure 2)" width="1024" height="575" border="0" /></a>

  <p align="center">図 2.最後の毎日のバックアップからデータベースを復元します。</p>


  <h2>Geo リストアの使用方法</h2>

  Geo リストアは、影響を受けるサーバーの [バックアップ] タブを使用して、Azure 管理ポータルから呼び出すことができます。 このタブには、そのサーバー上のすべてのデータベースで使用可能なすべてのバックアップの一覧が表示されます。各データベースの最後のバックアップ時刻が表示されます。 復元用のバックアップを選択したら、新しいデータベースの名前を指定し、対象サーバーを指定できます。これは、任意のリージョンに存在する場合があります。 確認が完了すると、復元要求はターゲットリージョンでの処理のためにキューに配置されます。 図3-5 は、これらの手順を示しています。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/Geo-restore-capture-1.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Geo リストアのキャプチャ (1)" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo-restore-capture-1_thumb.png" alt="Geo-restore capture (1)" width="887" height="768" border="0" /></a>

  <p align="center">図 3:回復するデータベースが含まれている、低下しているサーバーを選択します。</p>

  <p align="left"><a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/Geo-restore-capture-3.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Geo リストアのキャプチャ (3)" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo-restore-capture-3_thumb.png" alt="Geo-restore capture (3)" width="887" height="768" border="0" /></a></p>

  <p align="center">図 4:バックアップの利用可能なバックアップの一覧から、回復するデータベースを選択します</p>

  <p align="left"><a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/Geo-restore-capture-4.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Geo リストアキャプチャ (4)" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo-restore-capture-4_thumb.png" alt="Geo-restore capture (4)" width="887" height="768" border="0" /></a></p>

  <p align="center">図 4:データベースを復元するサーバーを指定します</p>

  <p align="left"><a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/Geo-restore-capture-5.png"><img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Geo リストアのキャプチャ (5)" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo-restore-capture-5_thumb.png" alt="Geo-restore capture (5)" width="887" height="768" border="0" /></a></p>

  <p align="center">図 5:復元中のデータベースの状態を監視する</p>

  <p align="left">標準およびアクティブ geo レプリケーションと同様に、geo リストアは、REST API、PowerShell、および Azure 管理ポータルを使用して管理および起動できます。 Azure 管理ポータルは、少数のデータベースの ad hoc geo リストアに適しています。 REST API または PowerShell を使用して、複数のデータベースの復旧をスクリプト化したり、カスタムの管理スクリプトまたはアプリケーションと統合したりできます。 <a href="https://msdn.microsoft.com/en-us/library/azure/dn505719.aspx">Azure SQL Database REST API</a>と Azure SQL Database Recovery PowerShell API の詳細については、こちらを参照してください。</p>

  誤って復元操作を開始し、その操作を取り消す場合は、ターゲットの master データベースに接続して、復元されたデータベースを削除することで実行できます。 復元プロセスが開始されるとすぐに、データベースレコードが表示されます。 そのため、復元が完了するまで待たずに削除できます。 こうすることで、課金への影響を回避できます。

  <h2>復旧時間に影響する要因<del datetime="2014-09-06T00:08"></del></h2>

  復旧時間は、データベースのサイズとデータベースのパフォーマンスレベル、ターゲットリージョンで同時に処理されている復元要求の数など、いくつかの要因によって影響を受けます。 リージョンに長時間にわたって障害が発生した場合は、他のリージョンによって大量の geo リストア要求が処理される可能性があります。 必要に応じて、そのリージョン内の既存のワークロードが悪影響を受けないように、必要に応じて復元操作で使用するリソースを制限します。 多数の要求がある場合、そのリージョンでのデータベースの復旧時間が長くなる可能性があります。


  geo リストアはすべてのサービス階層で利用できますが、RPO と推定復旧時間 (ERT) が最も長い SQL Database で使用できる DR ソリューションの最も基本的なものです。 最大サイズが 2 GB の Basic データベースでは、Geo リストアは、ERT が12時間の妥当な DR ソリューションを提供します。 大規模な standard またはプレミアムデータベースの場合、復旧にかかる時間が大幅に短縮された場合、またはデータ損失の可能性を低減するには、標準またはアクティブ geo レプリケーションの使用を検討する必要があります。 Geo レプリケーションの復旧オプションでは、継続的にレプリケートされるセカンダリへのフェールオーバーを開始する必要があるだけなので、RPO と ERT がはるかに少なくなります。

  <h2>DR ドリル</h2>

  多くの場合、運用データベースが障害から適切に保護されていることを示すために、コンプライアンス要件があります。 Geo リストアはいつでも使用できるため、この復旧オプションに基づく DR プロシージャが有効であることをユーザーに確認するために、定期的な DR ドリルを行うことができます。

  <h2>まとめ</h2>

  Geo リストア、標準 geo レプリケーション、アクティブ geo レプリケーションの組み合わせにより、アプリケーションとビジネスのニーズを満たすビジネス継続性ソリューションを実装するためのさまざまなオプションが提供されます。 前に説明したコストと SLO の違いに加えて、選択するオプションでは、有効にするビジネス継続性シナリオも定義します。 次の表に、これらの相違点を示します。

  <table border="0" width="671" cellspacing="0" cellpadding="2">

  <tbody>

  <tr>

  <td valign="top" width="205"><strong>シナリオ</strong></td>

  <td valign="top" width="161"><strong>geo リストア</strong></td>

  <td valign="top" width="156"><strong>標準 Geo レプリケーション</strong></td>

  <td valign="top" width="147"><strong>アクティブ Geo レプリケーション</strong></td>

  </tr>

  <tr>

  <td valign="top" width="205">地域的災害</td>

  <td valign="top" width="161">はい</td>

  <td valign="top" width="156">はい</td>

  <td valign="top" width="147">はい</td>

  </tr>

  <tr>

  <td valign="top" width="205">DR ドリル</td>

  <td valign="top" width="161">はい</td>

  <td valign="top" width="156">はい</td>

  <td valign="top" width="147">はい</td>

  </tr>

  <tr>

  <td valign="top" width="205">オンライン アプリケーションのアップグレード</td>

  <td valign="top" width="161">いいえ</td>

  <td valign="top" width="156">いいえ</td>

  <td valign="top" width="147">はい</td>

  </tr>

  <tr>

  <td valign="top" width="205">オンライン アプリケーション再配置</td>

  <td valign="top" width="161">いいえ</td>

  <td valign="top" width="156">いいえ</td>

  <td valign="top" width="147">はい</td>

  </tr>

  <tr>

  <td valign="top" width="205">読み取り負荷分散</td>

  <td valign="top" width="161">いいえ</td>

  <td valign="top" width="156">いいえ</td>

  <td valign="top" width="147">はい</td>

  </tr>

  </tbody>

  </table>

  <a><span style="color: #000000">geo リストアを試して、BCDR 戦略に適合する可能性がある場所を確認してください。 </span></a><span style="color: #000000">常にフィードバックに耳を傾けているので、ご意見をお聞かせください。 </span>


  バックアップと復元の詳細についてはAzure SQL Database記事を参照<a href="https://msdn.microsoft.com/en-us/library/azure/jj650016.aspx">してください</a>。
