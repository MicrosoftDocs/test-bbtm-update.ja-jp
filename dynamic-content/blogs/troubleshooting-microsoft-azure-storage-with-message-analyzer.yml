### YamlMime:Yaml
ms.openlocfilehash: f5847bce0f4bf84f803939d965b43f1b7ec994ff
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139904385"
Slug: troubleshooting-microsoft-azure-storage-with-message-analyzer
Title: Message Analyzer を使用した Microsoft Azure Storage のトラブルシューティング
Summary: Microsoft Message Analyzer を使用して Azure Storage アプリケーションの診断を簡略化し、Azure Storage、クライアントアプリケーション、およびネットワークトレースからログをインポートして関連付けることができます。 このブログでは、監視、診断、トラブルシューティングのガイドに基づいて、ストレージベースのアプリケーションのトラブルシューティングに役立つ、豊富なクエリとルールを使用する方法について説明します。
Content: >-
  <h2>概要</h2>

  クラウドストレージアプリケーションの問題の診断とトラブルシューティングは、特に事前に考慮されていない場合には複雑になることがあります。 問題が発生した場合、問題を完全に理解して軽減するために、複数のログファイル (Azure Storage Analytics、Azure Storage クライアントライブラリからのクライアント側のログ、およびネットワークトレース) の解析と分析が必要になることがあります。 これを支援するために、パーサー、色ルール、グラフ、フィルター、ビューレイアウトなど、Microsoft Message Analyzer で Azure Storage 固有の資産のセットをリリースしました。 このブログでは、簡単な概要を説明しますが、実践的なチュートリアルについては<a href="https://azure.microsoft.com/en-us/documentation/articles/storage-e2e-troubleshooting/">、Azure Storage のメトリックとログ、azcopy、Message Analyzer を使用したエンドツーエンドのトラブルシューティング</a>に関する記事をご覧ください。

  <h2>サンプルシナリオ– Storage サービスバージョンのログを検索 Storage</h2>

  このブログの投稿では、お客様が現在使用している REST バージョンを判断したいと考えているシナリオについて説明します。これにより、以前のサービスバージョンのいくつかの計画された<a href="https://azure.microsoft.com/blog/2014/08/04/microsoft-azure-storage-service-version-removal/">Azure Storage サービスの削除</a>に備えて (必要な場合) 準備できるようになります。


  Azure Storage の資産がインストールされ、Azure Storage のログとメトリックが有効になっている Message Analyzer があることを前提としています。詳細については、完全なハンズオンチュートリアルを参照してください。

  <h3>手順 1: azcopy を使用して Azure Storage サーバー側のログをダウンロードする</h3>

  AzCopy は、 <a href="https://azure.microsoft.com/en-us/downloads/">Azure ダウンロード</a> のページからダウンロードできます。 AzCopy の使用方法の詳細については、「 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-use-azcopy/">Microsoft Azure Storage で AzCopy を使用する方法</a>」を参照してください。 例として、次のコマンドは、2015年1月2日に実行された blob 操作のログファイルを C:\Temp\Logs\Server フォルダーにダウンロードします。storageaccountname を実際のストレージアカウントの名前に置き換え、 <strong> &lt; storageaccountkey &gt; </strong>をアカウントアクセスキーに置き換え<strong> &lt; ます。 &gt; </strong>

  <pre class="prettyprint">AzCopy.exe /Source:https://&lt;storageaccountname&gt;.blob.core.windows.net/$logs /Dest:C:\Temp\Logs\Server /Pattern:"blob/2015/01/02" /SourceKey:&lt;storageaccountkey&gt; /S /V</pre>

  <b>注: </b>ログデータが使用可能になるまでに最大で1時間かかることがあります。これは、ストレージサービスがログライターをフラッシュする頻度が原因です。

  <h3>手順 2: サーバー側のログを Message Analyzer にインポートする</h3>

  1.Microsoft Message Analyzer の [<b>ファイル</b>] メニューで、[<b>新しいセッション</b> &gt; <b>ファイル</b> &gt; ] [<b>ファイルの追加</b>] の順にクリックして、サーバー側のログをダウンロードした場所を参照します。 サーバー側のログを選択し、[ <strong>開く </strong>] ボタンをクリックします。


  2. [ <b>セッションの詳細</b> ] パネルで、各サーバー側のログファイルの [ <b>テキストログの構成</b> ] ドロップダウンを <b>azurestoragelog</b> (まだ設定されていない場合) に設定して、Microsoft Message Analyzer がログファイルを正しく解析できるようにし、[ <b>開始</b> ] ボタンをクリックします。

  <h3>手順 3: RequestVersionHeader 列を分析グリッドに追加する</h3>

  Microsoft Message Analyzer で、[<b>列の選択 &gt; ] Azure Storage &gt; [ログ Azure Storage ログエントリ</b>] の下にある [ <strong>requestversionheader</strong> ] を右クリックし、[列として追加] を選択して、分析グリッドに表示されるようにします。

  <h3>手順 4: 以前の REST バージョンを検索する</h3>

  次のセッションフィルターを追加して、削除するようにスケジュールされている Azure Storage サービスバージョンを使用する要求があるかどうかを確認します。

  <pre class="prettyprint">AzureStorageLog.RequestVersionHeader &lt; "2012-02-12"</pre>

  <img style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" title="Microsoft Message Analyzer" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2015-01-25_15h41_10.png" alt="Microsoft Message Analyzer" width="610" height="213" border="0" />


  分析グリッドで各行 (存在する場合) をダブルクリックすると、個々の要求に関する詳細情報を取得できます。 「どうすればいいですか」を読むこともできます。 」 <a href="https://azure.microsoft.com/blog/2014/08/04/microsoft-azure-storage-service-version-removal/">を参照して</a>ください。


  <b>パフォーマンスのヒント:</b> Message Analyzer では、ログファイルがメモリに読み込まれることに注意してください。 大量のログデータがある場合は、メッセージアナライザーで最高のパフォーマンスを得るために、データを読み込む前にセッションフィルターを適用することをお勧めします。

  <h2>まとめ</h2>

  上記のシナリオでは、AzCopy と共に Message Analyzer を使用して、古い REST バージョンをまだ使用しているクライアントを特定する方法を説明しています。 Azure Storage を操作するときは、独自のデバッグと分析に同じツールの組み合わせを使用できます。

  <h2>次の手順</h2>

  ストレージ、ネットワーク、クライアント側のログを関連付け、パフォーマンスの問題をトラブルシューティングするなど、より高度なシナリオについては、 <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-e2e-troubleshooting/#mma-analyze-data">こちら</a> の完全なハンズオンチュートリアルに従ってください。


  詳細については、次のリソースを参照してください。•    <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-e2e-troubleshooting/">Azure Storage のメトリックとログ、azcopy、および Message Analyzer を使用したトラブルシューティング</a>    <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/">Microsoft Azure Storage •監視、診断、およびトラブルシューティング</a>の    <a href="https://azure.microsoft.com/blog/2014/08/04/microsoft-azure-storage-service-version-removal/">Microsoft Azure Storage サービスバージョンの削除</a>
