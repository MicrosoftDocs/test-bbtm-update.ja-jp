### YamlMime:Yaml
ms.openlocfilehash: 9a87f266b1615c7133a844535182743949587e18
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139904145"
Slug: how-xbox-uses-hdinsight-to-drive-analytics-on-petabytes-of-telemetry-data
Title: Azure HDInsight を使用したペタバイト規模のゲームデータでの XBox 分析
Summary: Azure HDInsight は、Hadoop、MapReduce、Hive、llap、Presto、Spark、kafka、R などの最も人気のあるオープンソースフレームワークを使用して、大規模な分析を行うお客様向けの完全に管理されたクラウドサービスです。
Content: >-
  <p><em>このブログ投稿は、Karan Gulati、シニアソフトウェアエンジニア、XBOX および Daniel Hagen、シニアソフトウェアエンジニア、XBOX で共同作成されています。 </em></p>


  <p>Microsoft スタジオは、Halo、Minecraft、Forza Motorsport シリーズを含む、世界中 &rsquo; で最も人気のあるゲームタイトルをいくつか作成します。 Xbox 製品サービスチームは、数千のデータセットと数百のアクティブなパイプラインを管理しています。ファーストパーティスタジオでは、1時間ごとに数百ギガバイトのデータを消費していました。 ゲーム開発者は、時間の経過と共に取得、保持、プレーヤーの進行、一般的な使用状況を測定することで、ゲームの正常性を把握する必要があります。 これにより、データのクリーニング、書式設定、集計、レポートを行う必要があり、ETL (抽出変換の読み込み) として知られている、教科書のビッグデータの問題が発生します。</p>


  <h2>HDInsight-完全に管理された、全範囲のオープンソースのエンタープライズ向け分析サービス</h2>


  <p>Azure HDInsight は、Hadoop などの最も人気のあるオープンソースフレームワークを使用して、大規模な分析を行うお客様向けの完全に管理されたクラウドサービスです。 MapReduce、Hive、llap、Presto、Spark、kafka、および R。 HDInsight を使用すると、batch &amp; ETL、データウェアハウジング、機械学習、IoT、ストリーミングなどの幅広い顧客シナリオを、オープンソースフレームワークを使用して、大規模な大量のデータに対応することができます。</p>


  <h2>HDInsight の主な利点</h2>


  <ul>
   <li>
   <p><strong>クラウドネイティブ:</strong> 運用環境のワークロードに対してエンドツーエンドの SLA を提供するための業界の唯一のサービスです。 Hadoop、Spark、Hive、対話型クエリ、HBase ストーム、kafka、および Microsoft R Server に対応したクラウド最適化クラスター。99.9% の SLA によって支えられています。</p>
   </li>
   <li>
   <p><strong>低コスト:</strong> コスト効率の高い、分離されたコンピューティングとストレージによるワークロードのスケールアップまたはスケールダウン。 料金は使用した分だけになります。 Spark および Interactive クエリユーザーは、ssd の追加コストなしで、対話型のパフォーマンスのために SSD メモリを使用できます。</p>
   </li>
   <li>
   <p><strong>セキュリティ:</strong> 仮想ネットワーク、暗号化、Active Directory での認証、ユーザーとグループの承認、すべてのエンタープライズデータのロールベースのアクセス制御ポリシーを使用して、データ資産を保護します。 HDInsight は、HIPAA、PCI などのさまざまなコンプライアンス基準を満たしています。 </p>
   </li>
  </ul>


  <ul>
   <li>
   <p><strong>グローバル:</strong> 25を超えるリージョンでグローバルに利用できます。 HDInsight は Azure Government クラウドおよび中国でも利用可能であり、主要な地理的領域でのニーズを満たすことができます。</p>
   </li>
   <li>
   <p><strong>生産的:</strong>IntelliJ、 <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-eclipse-tool-plugin">Eclipse</a>、 <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-intellij-tool-plugin"></a>   などの Hadoop および <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-visual-studio-tools-get-started">Visual Studio</a>Spark 向けの豊富な生産性ツールで、拡張性 a、Python、R、Java、.net のサポートを利用できます。 データ科学者は、 <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-jupyter-notebook-kernels">Jupyter</a>   と <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-apache-spark-zeppelin-notebook">Zeppelin</a>という2つの最も人気のあるノートブックを使用することもできます。 HDInsight は、Microsoft R Server との統合を備えた唯一の管理されたクラウド Hadoop ソリューションでもあります。</p>
   </li>
   <li>
   <p><strong>拡張可能:</strong> ワンクリックによるデプロイエクスペリエンスを提供する統合された marketplace を通じて、優れた認定を受けたビッグデータアプリケーションとシームレスに統合します。</p>
   </li>
  </ul>


  <h2>ビッグデータの問題</h2>


  <p>この幅広い用途とさまざまな規模のデータを処理するために、Xbox は Azure HDInsight の汎用性と能力を開花しています。 Azure Blob Storage では、未加工の異種 json データが処理されるため、Hive ジョブはその生データをより高性能でインデックス付きの形式 (最適化された行の列形式) に変換します。 その後、Studio ユーザーは、追加の Hive、Spark、または Azure ML ジョブをパイプラインに追加して、さらにクリーンアップ、フィルター処理、集計を行うことができます。 </p>


  <h2>分離されたコンピューティングと基になるストレージを備えたスケーラブルな HDInsight アーキテクチャ</h2>


  <p>Xbox テレメトリシステムでは、ゲームの起動スタイルに応じて、起動時に大量のデータが急増する可能性があります。 ユーザーが増加していない場合、ビジネスのさまざまな質問に回答するために必要な分析やクエリの種類は、ゲームからゲームやライフサイクル全体で大きく異なる可能性があり、その結果、必要なコンピューティングがシフトされます。 Xbox は、Azure Api を使用して HDInsight クラスターを簡単に作成することで、分析のニーズに応じて新しいクラスターを拡張して作成し、SLA を維持しながらデータを変化させることができます。 </p>


  <p>さまざまな分離レベルを提供しながらスケールアップおよびスケールアウトするシステムが必要な場合は、Azure Storage アカウントの配列と共有 Hive metastore を利用することを選択しました。 外部の Azure SQL データベースを Hive metastore として使用すると、同じメタデータを共有しながら多数のクラスターを作成できるため、多数のクラスターでシームレスなクエリを実行できます。 アクセス許可を制御するために SAS キーを使用して多数の Azure Storage アカウントを利用することで、クラスターレベルでの一貫性とセキュリティをさらに高めることができます。 このクラスターのクラスター化方法を採用すると、スケールアウト機能が大幅に向上します。 このクラスター構成のクラスターでは、Xbox で処理 (ETL) クラスターと読み取り専用のアドホッククラスターが分離されています。 ユーザーは、他のユーザーや処理に影響を与えずに、クエリをテストして、読み取り専用クラスターからデータを読み取ることができます。これにより、ノイズの多い近隣の状況が排除されます。 ユーザーは、基になるデータとメタデータを共有しながら、スケールとその読み取り専用クラスターを使用する方法を制御できます。</p>


  <p>&nbsp;</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e32b2beb-5f9c-4928-9246-b5a1affd6e88.png"><img alt="xboxmetastore" border="0" height="335" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/79668947-3167-45d2-a771-78a2f8ae66fc.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="xboxmetastore" width="751"></a></p>


  <p style="text-align: center;"><em>Azure HDInsight でのさまざまな分析エンジン間での共有データと metastore</em></p>


  <p>高パフォーマンスと機敏性を得るために HDInsight で外部 metastore を利用する際には、次のベストプラクティスを採用しました。</p>


  <ul>
   <li>
   <p>外部 metastore を使用します。 これにより、コンピューティングとメタデータが分離されました。</p>
   </li>
   <li>
   <p>あるバージョンの HDInsight クラスター用に作成された metastore が、別のバージョンの HDInsight クラスターと共有されないことを確認します。 これは、異なるスキーマを持つさまざまな Hive バージョンが原因です。 たとえば、Hive 1.2 と Hive 2.1 クラスターは、同じ metastore を使用しようとしています。</p>
   </li>
   <li>
   <p>回復や DR のニーズに合わせて、カスタム metastore を定期的にバックアップします。</p>
   </li>
   <li>
   <p>Metastore、ストレージアカウント、HDInsight クラスターを同じリージョンに保持します。</p>
   </li>
  </ul>


  <h2>Data flow</h2>


  <p>Xbox デバイスは、数千の異なる Azure Data Factory アクティビティを実行し、最後にデータをユーザーが利用できるようにすることで、HDInsight クラスターでさらに処理するために Event Hub によって使用されるテレメトリデータを生成します。 次の図は、Xbox テレメトリデータに関する情報を示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/eec91347-2ea8-4806-bf2b-a29d9d4e3104.png" style="font-size: 13px;"><img alt="xboxarchitecture" border="0" height="435" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/219a6c6a-93f7-48b9-be01-1c1f8c017aa9.png" style="border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="xboxarchitecture" width="751"></a></p>


  <h3>ジョブの負荷分散</h3>


  <p>私たちのアーキテクチャでは、数千のジョブを処理するために複数のクラスターを使用しています。 さまざまなクラスターにジョブを分散させる独自のカスタムロジックを構築しました。これにより、ジョブの完了時間を最適化するのに役立ちます。 通常は、実行時間の長いジョブと、完了する必要がある対話型の優先順位の高いジョブがあります。 これらのジョブのクラスター容量の負荷を分散するには、Yarn capacity scheduler を使用します。 一般に、優先順位の高いキューは、最大容量が100%、優先順位の低い10-20 キュー (最大容量は 100%) のクラスターの ~ 80-90% に設定します。 このディストリビューションでは、実行時間の長いジョブは、優先度の高い対話型ジョブが表示されるまで、最大クラスター容量を使用できます。 このような状況が発生すると、優先順位の高いジョブでは、クラスターの容量が80-90% になり、処理が速くなります。</p>


  <h2>まとめ</h2>


  <p>Azure HDInsight に基づく Xbox テレメトリ処理パイプラインは、ビッグデータ処理を大規模に解決しようとするあらゆる種類の企業に適用できます。</p>


  <p>詳細については、まで <a href="mailto:AskHDInsight@Microsoft.com" ms.cmpgrp="body" ms.cmpnm="AskHDInsight@Microsoft.com" ms.cmptyp="link" ms.interactiontype="1" ms.pgarea="content" ms.title="" style="box-sizing: inherit; transition: color 0.2s ease-in-out; color: rgb(0, 114, 198); font-family: &quot;Segoe UI Condensed&quot;, &quot;Segoe UI&quot;, &quot;Segoe WP&quot;, Tahoma, Arial, sans-serif; font-size: 15px; font-style: normal; font-weight: 400;">AskHDInsight@Microsoft.com</a> &nbsp; お問い合わせください。</p>
