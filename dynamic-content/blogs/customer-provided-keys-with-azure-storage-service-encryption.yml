### YamlMime:Yaml
ms.openlocfilehash: 992b57567a4e1efd55afce2012005f735720cea6
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893103"
Slug: customer-provided-keys-with-azure-storage-service-encryption
Title: サービス暗号化を使用したAzure Storageキー
Summary: Azure Storage には、保存データを暗号化するためのオプションがいくつか用意されています。 クライアント側の暗号化を使用すると、データをアップロードする前にデータを暗号化Azure Storage。
Content: >-
  <p>Azure Storage には、保存データを暗号化するためのオプションがいくつか用意されています。 クライアント<a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-client-side-encryption" target="_blank">側の暗号化を使用</a>すると、データをアップロードする前にデータを暗号化Azure Storage。 また、Azure Storage で、Microsoft マネージド キーを使用した<a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption" target="_blank"></a>ストレージ サービス暗号化を使用した暗号化操作、または Azure Storage のカスタマー マネージド キーを使用して暗号化操作を管理Azure Key Vault。 現在、任意のキー ストアでホストされているキーを使用して、ストレージ アカウントの詳細な暗号化設定をサポートするために、ストレージ サービスの暗号化が強化されました。 お客様が提供するキー (CPK) を使用すると、データ セキュリティに関する企業、契約上、および規制上のコンプライアンス要件を満たすために、Azure Key Vault 以外のオンプレミスまたはキー ストアにキーを格納および管理できます。</p>


  <p>お客様が指定したキーを使用すると、BLOB API を使用して、ストレージ サービスに読み取りまたは書き込み操作の一環として暗号化キーを渡することができます。 暗号化キーはオブジェクト レベルで定義されているので、ストレージ アカウント内に複数の暗号化キーを設定できます。 顧客が指定したキーを使用して BLOB を作成すると、ストレージ サービスは暗号化キーの SHA-256 ハッシュを BLOB に保持して、将来の要求を検証します。 オブジェクトを取得する場合は、要求の一部と同じ暗号化キーを指定する必要があります。 たとえば、BLOB が CPK を使用して Put BLOB を使用して作成される場合、後続のすべての書き込み操作で同じ暗号化キーを指定する必要があります。 別のキーが指定されている場合、または要求にキーが指定されている場合、操作は 400 Bad Request で失敗します。 暗号化キー自体は要求で提供されます。キーを転送するには、セキュリティで保護された接続を確立する必要があります。 プロセス&rsquo;を次に示します。<br>

  &nbsp;</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/71ad1300-7b49-4b0c-bf4b-ecdccffdedc3.png"><img alt="740 Blog" border="0" height="337" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/aae7d7fe-e286-497d-86bc-aeac8621fdab.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="740 ブログ" width="1024"></a><br>

  <em>図 1 顧客が提供するキー</em></p>


  <h2>作業の開始</h2>


  <p>カスタマー指定キーは、要求に x-ms-encryption-* ヘッダーを追加することで、サポートされている BLOB 操作で使用できます。</p>


  <table border="1" cellpadding="1" cellspacing="0">
   <tbody>
    <tr>
     <td valign="top"><strong>要求ヘッダー</strong></td>
     <td valign="top"><strong>説明</strong></td>
    </tr>
    <tr>
     <td valign="top">x-ms-encryption-key</td>
     <td valign="top">必須。 Base64 でエンコードされた AES-256 暗号化キー値です。</td>
    </tr>
    <tr>
     <td valign="top">x-ms-encryption-key-sha256</td>
     <td valign="top">必須。 暗号化キーの Base64 でエンコードされた SHA256 です。</td>
    </tr>
    <tr>
     <td valign="top">x-ms-encryption-algorithm</td>
     <td valign="top">必須。 指定されたキーを使用してデータを暗号化するときに使用するアルゴリズムを指定します。 AES256 である必要があります。</td>
    </tr>
   </tbody>
  </table>


  <h4>Request</h4>


  <p><code>PUT mycontainer/myblob.txt<br>

  x-ms-version: 2019-02-02<br>

  x-ms-encryption-key: MDEyMzQ1NjcwMTIzNDU2NzAxMjM0NTY3MDEyMzQ1Njc=<br>

  x-ms-encryption-key-sha256: 3QFFFpRA5+XANHqwwbT4yXDmrT/2JaLt/FKHjzhOdoE=<br>

  x-ms-encryption-algorithm: AES256<br>

  Content-Length: &lt;length&gt;<br>

  ...</code></p>


  <h2>キーの管理</h2>


  <p>Azure Storage、お客様が指定した暗号化キーを格納または管理しません。 キーは、BLOB データの暗号化または暗号化解除&rsquo;に使用された後、できるだけ早く安全に破棄されます。 スナップショットが有効になっている BLOB で顧客指定のキーが使用されている場合は、各スナップショットを異なる暗号化キーでプロビジョニングできます。 BLOB 操作で正しいキーを渡すには、スナップショットと関連付けられている暗号化キーを追跡する必要があります。 オブジェクトに関連付けられているキーをローテーションする必要がある場合は、オブジェクトをダウンロードし、新しい暗号化キーを使用してアップロードできます。</p>


  <h2>次の手順</h2>


  <p>この機能は、最新リリースの <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/Versioning-for-the-Azure-Storage-Services?redirectedfrom=MSDN" target="_blank">Storage サービス</a> REST API (バージョン 2019-02-02) を使用して、ストレージ アカウントで利用できます。 .NET クライアント ライブラリと Java クライアント ライブラリを使用することもできます。 お客様が指定したキーに対して追加料金は発生します。</p>


  <p>お客様から提供されたキーの詳細については、ドキュメント ページを <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption" target="_blank">参照してください</a>。 さらに質問がある場合<a href="mailto:azurestoragefeedback@microsoft.com">azurestoragefeedback@microsoft.com</a>、または特定のシナリオについて話し合う場合は、フィードバック フォーラムにメールを送信するか、フィードバック フォーラムにAzure Storageアイデアや提案を<a href="https://feedback.azure.com/forums/217298-storage" target="_blank">投稿してください</a>。</p>
