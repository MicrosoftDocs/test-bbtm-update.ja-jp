### YamlMime:Yaml
ms.openlocfilehash: c3f575570b8c5f163f5ad80ad217167063f6663e
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139910360"
Slug: running-azure-batch-jobs-using-the-azure-cli-no-code-required
Title: Azure CLI を使用した Azure Batch ジョブの実行–コードは必要ありません
Summary: Azure CLI を使用して、バッチジョブをエンドツーエンドで実行できるようになりました。コードは必要ありません。 プール、ジョブ、およびタスクを作成できるようにバッチテンプレートのサポートを追加し、ファイル転送機能を追加する Azure CLI の拡張機能が用意されています。
Content: >-
  <p>Azure Batch 導入された開発者は、アプリケーションまたはアルゴリズムを大規模に実行する必要がある SaaS またはクライアントソリューションを開発者が作成していました。 開発者は batch Api を使用して Batch と統合し、ソリューション内のコンポーネントとして使用します。</p>


  <p>を起動した後、コードを使用せずにバッチを簡単に使用できるようにする機能が追加されているため、Batch を利用できるユーザーを拡張できます。 新しい Azure CLI 機能が追加されたことをお知らせします。これにより、ジョブの定義と実行をエンドツーエンドで実行できるようになります。 ユーザーは、直接またはスクリプトを使用して、プールの作成、データのアップロード、大規模なジョブの実行、および Azure CLI を使用した出力データ &ndash; のダウンロードを行うことができます。コードは必要ありません。</p>


  <h2>Batch テンプレート</h2>


  <p>Batch テンプレートは、Azure CLI の既存の Batch サポートを基に作成されており、JSON ファイルでプール、ジョブ、タスクなどのアイテムを作成するためのプロパティ名と値を指定できます。 Batch テンプレートでは、JSON ファイルで可能なことと比較して、次の機能を使用できます。</p>


  <ul>
      <li>パラメーターを定義できます。 テンプレートを使用するときに、アイテムを作成するためのパラメーター値だけを指定します。アイテムの他のプロパティ値は、テンプレートの本文で指定されています。 Batch と Batch によって実行されるアプリケーションを理解しているユーザーは、プール、ジョブ、およびタスクのプロパティ値を指定して、テンプレートを作成できます。 Batch やアプリケーションに慣れていないユーザーは、定義されたパラメーターの値を指定するだけで済みます。</li>
      <li>ジョブタスクファクトリは、ジョブに関連付けられた1つ以上のタスクを作成し、多くのタスク定義を作成する必要がなくなり、ジョブの送信を大幅に簡素化します。</li>
  </ul>


  <h2>入力ファイルと出力ファイルのアップロードとダウンロード</h2>


  <p>ジョブの入力データ ファイルを指定する必要があり、多くの場合、出力データ ファイルが生成されます。 ストレージアカウントは、既定で各 Batch アカウントに関連付けられています。Azure CLI を使用すると、クライアントとこのストレージアカウントの間でファイルを簡単に転送できるようになりました。コーディングは必要ありません。 また、プールノードとの間で転送するために、ファイルはプールおよびジョブテンプレートによって参照されます。</p>


  <h2>Ffmpeg を使用したビデオファイルのトランスコードの例 &ndash;</h2>


  <p><a href="https://ffmpeg.org/">ffmpeg</a> は、オーディオおよびビデオファイルを処理する一般的なアプリケーションです。 Azure Batch CLI を使用すると、ffmpeg を呼び出して、複数のビデオファイルを並行してトランスコードし、ソースビデオファイルをさまざまな解像度に変換することができます。</p>


  <h3>プールテンプレートを作成する</h3>


  <p>Ffmpeg アプリケーションをインストールし、個々のトランスコードを実行する必要がある VM ノードのプールが必要になります。 Batch と ffmpeg に関する知識を持つユーザーは、プールテンプレートを定義します。 テンプレートは、プールの作成に使用されるときに、プール id とノード数のみを指定する必要があるように記述されています。</p>


  <p>このテンプレートは次を定義します。</p>


  <ul>
      <li>テンプレートを使用してプール id とプールノードの数を作成 &ndash; するときに値を指定する必要がある2つのパラメーター。</li>
      <li>テンプレート本文は、OS、VM サイズ、ffmpeg パッケージ、およびその他のプールのプロパティを指定します。</li>
  </ul>


  <p>プールテンプレートの例を次に示します。</p>


  <pre class="prettyprint">

  {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;parameters&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;nodeCount&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;int&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: { &quot;description&quot;: &quot;The number of pool nodes&quot; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;poolId&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;string&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: { &quot;description&quot;: &quot;The pool id &quot; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;pool&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;Microsoft.Batch/batchAccounts/pools&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;apiVersion&quot;: &quot;2016-12-01&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;properties&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;id&quot;: &quot;[parameters(&#39;poolId&#39;)]&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;virtualMachineConfiguration&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;imageReference&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;publisher&quot;: &quot;Canonical&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;offer&quot;: &quot;UbuntuServer&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;sku&quot;: &quot;16.04.0-LTS&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;version&quot;: &quot;latest&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;nodeAgentSKUId&quot;: &quot;batch.node.ubuntu 16.04&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;vmSize&quot;: &quot;STANDARD_D3_V2&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;targetDedicatedNodes&quot;: &quot;[parameters(&#39;nodeCount&#39;)]&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;enableAutoScale&quot;: false,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;maxTasksPerNode&quot;: 1,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;packageReferences&quot;: [

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;aptPackage&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;id&quot;: &quot;ffmpeg&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]

  } } }</pre>


  <h3>ジョブテンプレートを作成する</h3>


  <p>ビデオファイルをトランスコードするには、1つのビデオファイルにつき1つのタスクでジョブを作成します。 各タスクでは、ノードにコピーされるソースビデオファイル、ターゲットの解像度、出力ファイルの名前と場所、およびその他のタスクのプロパティを指定するパラメーターを使用して、ffmpeg アプリケーションを呼び出す必要があります。</p>


  <p>Batch と ffmpeg に関する知識を持つユーザーは、ジョブテンプレートを定義します。 このテンプレートは、プール id とジョブ id のみを使用する場合に指定する必要があるように記述されています。 わかりやすくするために、ソースファイルが固定の場所にアップロードされることを前提としています。出力ファイルは固定位置に書き込まれ、出力解像度は特定の値に設定されます。</p>


  <pre class="prettyprint">

  {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;parameters&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;poolId&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;string&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;description&quot;: &quot;The pool id which runs the job&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;jobId&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;string&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;description&quot;: &quot;The job id&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;resolution&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;string&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;defaultValue&quot;: &quot;428x240&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;allowedValues&quot;: [

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;428x240&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;854x480&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;metadata&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;description&quot;: &quot;Target video resolution&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;job&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;Microsoft.Batch/batchAccounts/jobs&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;apiVersion&quot;: &quot;2016-12-01&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;properties&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;id&quot;: &quot;[parameters(&#39;jobId&#39;)]&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;constraints&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;maxWallClockTime&quot;: &quot;PT5H&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;maxTaskRetryCount&quot;: 1

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;poolInfo&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;poolId&quot;: &quot;[parameters(&#39;poolId&#39;)]&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;taskFactory&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;type&quot;: &quot;taskPerFile&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;source&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;fileGroup&quot;: &quot;ffmpeg-input&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;repeatTask&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;commandLine&quot;: &quot;ffmpeg -i {fileName} -y -s [parameters(&#39;resolution&#39;)] -strict -2 {fileNameWithoutExtension}_[parameters(&#39;resolution&#39;)].mp4&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;resourceFiles&quot;: [

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;blobSource&quot;: &quot;{url}&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;filePath&quot;: &quot;{fileName}&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;outputFiles&quot;: [

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;filePattern&quot;: &quot;{fileNameWithoutExtension}_[parameters(&#39;resolution&#39;)].mp4&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;destination&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;autoStorage&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;path&quot;: &quot;{fileNameWithoutExtension}_[parameters(&#39;resolution&#39;)].mp4&quot;,

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;fileGroup&quot;: &quot;ffmpeg-output&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;uploadOptions&quot;: {

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;uploadCondition&quot;: &quot;TaskSuccess&quot;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;onAllTasksComplete&quot;: &quot;terminatejob&quot;

  } } }</pre>


  <p>&nbsp;</p>


  <h3>プールテンプレートを使用してプールを作成する</h3>


  <p>トランスコードするファイルを持つユーザーは、最初に、トランスコードを実行するノードを含むプールを作成できます。 スクリプトを記述する場合は、コマンドラインでパラメーター値を渡すことができます。直接呼び出された場合は、ユーザーにパラメーター値の入力が求められます。</p>


  <p><code>C:\BatchCliTemplates&gt;az batch pool create --template pool-ffmpeg.json<br>

  You are using an experimental feature {Pool Template}.<br>

  nodeCount (The number of pool nodes): 20<br>

  poolId (The pool id): MyFfmpegPool </code></p>


  <p>テンプレート &rsquo; のユーザーとして、AZURE VM のサイズ、プールのプロパティ、ffmpeg のインストール方法を理解する必要がありました。</p>


  <h3>ソースファイルをトランスコードにアップロード</h3>


  <p>Azure にトランスコードされるファイルをアップロードする必要があります。 使用するファイルグループの名前を指定しました。これは、Batch アカウントに関連付けられている Azure Storage アカウントに作成されたコンテナーに相当します。</p>


  <p><code>az batch file upload --local-path c:\source_videos\*.mp4 --file-group ffmpeg-input</code></p>


  <h3>ジョブテンプレートを使用してソースファイルをトランスコードするジョブを実行する</h3>


  <p>アップロードされた入力ファイルごとに1つのタスクを含むジョブを作成する必要があります。 スクリプトを記述する場合は、コマンドラインでパラメーター値を渡すことができます。直接呼び出された場合は、ユーザーにパラメーター値の入力が求められます。</p>


  <p><code>az batch job create --template job-ffmpeg.json</code></p>


  <p>このテンプレート &rsquo; のユーザーは、ffmpeg の呼び出し方法を理解し、変換を実行 &rsquo; するための適切なパラメーターを指定し、ジョブとタスクのバッチプロパティを指定する必要がありました。</p>


  <h3>トランスコードされたファイルをダウンロードする</h3>


  <p>トランスコードされた出力ファイルがクライアントで必要な場合は、簡単にダウンロードできます。</p>


  <p><code>az batch file download --file-group ffmpeg-output --local-path c:\output_lowres_videos</code></p>


  <h2>まとめ</h2>


  <p>この例では、ユーザーが ffmpeg を使用してビデオのトランスコードを実行するために Batch プールとジョブテンプレートを作成する方法を示しました。 ユーザーは Batch Api を使用する必要はありません。ffmpeg アプリケーションと Azure Batch についての知識が必要です。 テンプレートを使用するには、エンドユーザーは単に Azure CLI を使用してファイルをトランスコードにアップロードし、出力ファイルをダウンロードして、プールとジョブテンプレートのパラメーター値を指定する必要があります。</p>


  <h2>詳細情報</h2>


  <p>詳細については、次を参照してください。</p>


  <ul>
      <li><a href="https://docs.microsoft.com/azure/batch/batch-cli-templates">Azure Batch CLI のドキュメント</a></li>
      <li><a href="https://github.com/Azure/azure-batch-cli-extensions">Batch 拡張機能の Azure GitHub リポジトリ</a>の詳細なドキュメント、サンプル、およびソースコード。</li>
  </ul>
