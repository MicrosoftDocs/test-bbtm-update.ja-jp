### YamlMime:Yaml
ms.openlocfilehash: a5e07cc38b479b7e785351521b3e937176817771
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892332"
Slug: spotlight-on-sql-database-active-geo-replication
Title: 'アクティブなSQL DatabaseスポットライトGeo-Replication '
Summary: これは、ビジネス継続性とディザスター リカバリーに焦点を当てた短い一連の投稿の最初の記事です。この投稿では、ビジネス継続性のシナリオ全般を見てから、 の使用をスポットライトします。
Content: >-
  これは、ビジネス継続性とディザスター リカバリーに焦点を当てた短い一連の投稿の最初の記事です。この投稿では、一般的なビジネス継続性のシナリオを見てから、アクティブ geo レプリケーションの使用にスポットライトを当て、現在は SQL Database の プレミアム サービス レベルで利用できます。また、アクティブ geo レプリケーションの詳細については、この楽しい情報に基づいた Channel 9 ビデオをご覧ください。このビデオでは、この Channel <a href="https://channel9.msdn.com/Shows/Data-Exposed/SQL-Database-Active-Geo-Replication">9</a> ビデオを参照してください。このビデオでは、その仕組みと、実際のビジネス シナリオへの対処に役立つ方法について説明します。

  <h1>ビジネス継続性 - それは何ですか?</h1>

  ビジネス継続性とは、中断が発生した場合 (特にコンピューティング インフラストラクチャに対して) ビジネスを継続できるメカニズム、ポリシー、および手順を指します。


  データベースの観点からは、発生する可能性のある 4 つの主要な障害シナリオがあります。

  <ol>
   <li><b>ディスク ドライブの障害など、</b> データベース ノードに影響を与えるローカル ハードウェアまたはソフトウェアの障害。</li>
   <li><b>データの破損または削除</b> - 通常は、アプリケーションのバグまたは人的エラーが原因です。このようなエラーは本質的にアプリケーションに固有であり、一般に、インフラストラクチャによって自動的に検出または軽減することはできません。</li>
   <li><b>データセンターの停止</b>。自然災害が原因である可能性があります。このシナリオでは、代替データ センターへのアプリケーションのフェールオーバーを含む何らかのレベルの geo 冗長性が必要です。</li>
   <li><b>アップグレードまたはメンテナンスのエラー</b> – アプリケーションまたはデータベースの計画的なアップグレードまたはメンテナンスの間に予期しない問題が発生したときは、以前のデータベースの状態に迅速にロールバックすることが必要な場合があります。</li>
  </ol>

  <h1>ビジネス継続Azure SQL Databaseを実現する方法</h1>

  Azure SQL Databaseは、応答する前に少なくとも 2 つのレプリカに対して更新プログラムがコミットされ、各データベースの 3 つ以上のレプリカが常に保持されるシステムを使用して、堅牢な高可用性データベース サービスとして一から構築されています。この HA システムは、最初のシナリオであるローカル のハードウェアとソフトウェアの障害に取り合います。


  現在プレビュー段階の新しいサービス レベル Basic、Standard、プレミアム では、上記の残りの 3 つのシナリオに対応する機能を使用して、ビジネス継続性を次のレベルに引き上えます。


  <b>データの破損または削除</b>。<b> </b> Basic、Standard、プレミアム では、データベースを以前の状態に復元できるセルフサービスのポイントインタイム リストア機能がサポートされています。これにより、データの破損や削除を引き起すアプリケーションまたはユーザーのエラーから保護されます。完全バックアップは毎週作成され、差分バックアップは毎日作成され、トランザクション ログは 5 分ごとにバックアップされます。Basic データベースの場合、バックアップは 7 日間保持され、Standard の場合は 14 日間保持され、プレミアム 35 日間保持されます。データベースは、最近削除されたデータベースを含め、保持期間中の任意の時点に復元できます。


  <b>データセンターの停止</b>。<b> </b> Basic、Standard、プレミアム データベースのサービス レベルも、データセンターの長時間の停止から保護され、別のリージョンの別のデータセンターにデータベースを復旧する必要がある場合があります。次の 3 つの geo 冗長性ソリューションが提供されます。

  <ul>
   <li><i>geo リストア</i>*Basic、Standard、プレミアムでは、最後の毎日のバックアップの geo 冗長コピーに復旧できます。[*近日プレビュー予定]</li>
   <li><i>Standard geo レプリケーション</i>*Standard データベースと プレミアム データベースでは、ローカル HA システムが拡張され、ペアリージョンに追加のセカンダリ レプリカが作成および維持されます。これらのセカンダリはオフラインであり、データ センターの中断がない限りアクセスできません。その時点で、アプリケーションをサーバーにフェールオーバーできるようオンラインになります。[*近日プレビュー予定]</li>
   <li><i>アクティブ geo レプリケーションは、</i>プレミアム データベースで使用できます。データ損失のリスクが最も少ない最も豊富なソリューションと、最も迅速な復旧時間を提供します。これは、オンラインで読み取り可能な最大 4 つの geo レプリケートされたセカンダリを備えた標準 geo レプリケーションを拡張します。これは、負荷分散や、世界中の任意の場所でレプリケートされたデータへの待機時間の短いアクセスにも使用できます。アクティブ geo レプリケーションはプレビューで利用できます。</li>
  </ul>

  <b>アップグレードまたはメンテナンス のエラー。 </b> アクティブ geo レプリケーションを使用すると、データベースまたはアプリケーションに更新プログラムまたはメンテナンスを適用する前に固定できる、データベースの継続的にレプリケートされたコピーを作成できます。プロセス中またはプロセス後にエラーが検出された場合は、このコピーにすばやくフォールバックできます。


  また、さまざまなサービス レベルでさまざまなソリューションを使用できる一方で、サービス レベル間でデータベースを簡単にアップグレードまたはダウングレードできる点に注意することが重要です。たとえば、重要なアップグレードを適用する前に、Standard データベースを プレミアムにアップグレードし、アクティブ geo レプリケーションを使用することができます。アップグレードが完了したら、データベースを再度ダウングレードしてコストを削減できます。

  <h1>アクティブ geo レプリケーションの詳細</h1>

  アクティブ geo レプリケーションがビジネス継続性のランドスケープに適合する場所を確認できるので、そのしくみと使用方法について詳しく見てみることができます。

  <!--?xml:namespace prefix = "o" ns = "urn:schemas-microsoft-com:office:office" /-->


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/07/Geo1.png"><img class="alignnone size-medium wp-image-161541" alt="Geo1" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo1-622x369.png" width="622" height="369" /></a>


  図 1. データベースプレミアム、同じリージョンまたは異なるリージョンに最大 4 つの読み取り可能なセカンダリを持つ場合があります。


  アクティブ geo レプリケーションのリレーションシップは、Azure 管理ポータル、PowerShell、または Azure REST API を使用して作成および管理できます。ポータルでは、プライマリまたはセカンダリからレプリケーション関係を管理できます。プライマリから、各セカンダリのレプリケーションの状態を監視できます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/07/Geo2.png"><img class="alignnone size-medium wp-image-161551" alt="Geo2" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo2-566x369.png" width="566" height="369" /></a>


  図 2. Azure 管理ポータルを使用して、最大 4 つの geo セカンダリの状態を作成および監視します。


  最大 4 つの読み取り可能なセカンダリを作成できます。それぞれにプライマリと同じ名前が付きますが、別のサーバー上に位置します。最初に作成されたセカンダリは、プライマリの現在の状態でシード処理されます。各セカンダリが "追い付いた" と、プライマリの継続的なコピーとして保持されます。 セカンダリ データベースは、すべてのデータベースと同様に、通常の HA システムを使用してローカルで保護されます。


  ローカル HA レプリケーション モデルとは異なり、プライマリからセカンダリへの geo レプリケーションは非同期です。プライマリに適用されたトランザクションはにコピーされ、セカンダリに適用されますが、これが発生するのを待機している間、プライマリはブロックされません。変更はバッファー処理され、レプリケーション システムは一時的な接続の問題に対する回復性を持ち、離れた場所にレプリケートする場合は待機時間が長くなる。


  セカンダリに適用されているトランザクションがボトルネックを回避するには、セカンダリにプライマリと同じ以上のパフォーマンス レベルを指定する必要があります。


  セカンダリは読み取り可能なので、独立した読み取り専用ワークロードをサポートできます。この機能を使用して、複数のデータベース間で複雑なクエリ ワークロードを負荷分散したり、世界中の他の部分のアプリケーションに対する待機時間の短いデータ アクセスを提供したりするために使用できます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/07/Geo3.png"><img class="alignnone size-medium wp-image-161561" alt="Geo3" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo3-636x346.png" width="636" height="346" /></a>


  図 3: データセンターの停止がプライマリに影響を与える場合は、レプリケーション関係を終了し、アプリケーションをセカンダリにフェールオーバーできます。


  レプリケーションリレーションシップは手動で管理され、任意の時点でリレーションシップを終了できます。プライマリから終了する場合は、すぐに終了して保留中のトランザクションを失うのか、保留中のすべてのトランザクションを適用した後に終了するか選択できます。


  プライマリに影響を与えるデータセンターの停止が発生した場合でも、フェールオーバーは手動のタスクであり、これがいつ行われるかの完全な制御が可能になります。プライマリ データベースは使用できなくなるので、セカンダリ データベースからリレーションシップを終了します。セカンダリからの終了は常に即時であり、プライマリが使用できなくなった時点でレプリケートされていないトランザクションは失います。失われる可能性があるデータの量は、障害が発生した時点でのプライマリのアクティブな状態と、接続全体でトランザクションのバッファリングが発生した場合の処理によって異なる場合があります。 レプリケーション関係を終了する決定は、データ損失の可能性に関する懸念と、アプリケーションを再びバックアップしたいという希望のバランスを取る必要があります。


  セカンダリ データベースとのリレーションシップを終了すると、通常の読み取り/書き込みデータベースになります。この時点で、データベースへのフル アクセスを持つアプリケーションをフェールオーバーできます。各セカンダリはプライマリと同じ名前を持つ個別のデータベースですが、異なるサーバーでは、更新された接続文字列を使用してアプリケーションを再構成する必要があります。


  フェールオーバー プロセスを管理したら、以前にプライマリとして新しい実稼働データベースでのみ使用していたのと同じパターンの geo レプリケーション リレーションシップを再構築する必要があります。これにより、アプリケーションとビジネス継続性ポリシーに必要な geo 冗長性と負荷分散が確保されます。


  <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/07/Geo4.png"><img class="alignnone size-medium wp-image-161531" alt="Geo4" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Geo4-636x364.png" width="636" height="364" /></a>


  図 4:セカンダリとの元のリレーションシップを終了した後、新しいプライマリを保護し、負荷分散の要件をサポートするために、新しい geo レプリケーション リレーションシップを作成する必要があります。


  アクティブ geo レプリケーションは、さまざまなアプリケーション アーキテクチャ パターンに統合できます。このパターンでは、どのレイヤーとコンポーネントが最も危険にさらされ、どのコンポーネントが地理的に分散される可能性があるのかについて、さまざまな前提を設定できます。このトピック <a href="https://msdn.microsoft.com/en-us/library/azure/dn741328.aspx">の詳細</a> については、この記事を参照してください。

  <h1>まとめ</h1>

  アクティブ geo レプリケーションでは、データセンターの停止からデータベースを保護するための強力な geo 冗長性機能が提供されるだけでなく、他のビジネス継続性シナリオも可能になります。現在、アクティブ geo レプリケーションは、現在、データベースを使用してプレビュープレミアム利用できます。


  アクティブ <a href="https://msdn.microsoft.com/en-us/library/azure/hh852669.aspx">geo レプリケーションを</a>含む SQL Database でのビジネス継続性の<a href="https://msdn.microsoft.com/en-us/library/azure/dn741339.aspx"></a>詳細を確認するか、アクティブ geo レプリケーションがビジネスを保護するのにどのように役立つのかについて、Channel 9 の<a href="https://channel9.msdn.com/Shows/Data-Exposed/SQL-Database-Active-Geo-Replication">「How active</a> geo replication(アクティブ geo レプリケーションがいかに役立つのか)」を見て、数分かかります。


  アクティブ geo レプリケーションまたは他のビジネス継続性機能が使用可能になったら、その機能を試す場合は、新しいサービス レベルのプレビューにサインアップする <a href="https://azure.microsoft.com/en-us/services/preview/">必要があります</a>。 フィードバックを詳しく聞いているので、試して、ご意見をお聞かせください。
