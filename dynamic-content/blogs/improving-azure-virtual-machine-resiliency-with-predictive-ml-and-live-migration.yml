### YamlMime:Yaml
ms.openlocfilehash: 6852fdf2469f6d97e221778a43a10571bd5fef0f
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895918"
Slug: improving-azure-virtual-machine-resiliency-with-predictive-ml-and-live-migration
Title: 予測およびライブ マイグレーションによる Azure Virtual Machine MLの向上
Summary: Azure でワークロードを確実に実行できるよう、取り組み中です。 信頼性の最適化に大きく投資している領域の 1 つは、機械学習とライブ マイグレーションの組み合わせを使用して、潜在的な障害を予測し、事前に軽減する方法です。
Content: >-
  <p><em>この投稿は、Microsoft Azure チームの Catherine Burke、Niko Pambombos、Yingnong Dang、Omar Bur、Alistair Speirs によって共同執筆されました。</em></p>


  <p>Azure&rsquo; でワークロードを確実に実行できるよう、取り組みしました。 信頼性の最適化&rsquo;に多大な投資を行う領域の 1 つは、機械学習とライブ マイグレーションの組み合わせを使用して、潜在的な障害を予測し、事前に軽減する方法です。</p>


  <p>2018 年の初めから、Azure では、ハードウェア障害などのさまざまな障害シナリオや、ラックのメンテナンスやソフトウェア/BIOS の更新などの通常のフリート操作に応じて、ライブ マイグレーションを使用しています。 ライブ マイグレーションを初めから使用して障害を適切に処理することで、障害が可用性に与える影響を 50% 削減できます。</p>


  <p>ライブ マイグレーションでさらにエンベロープを押し進めるには、良好な予測シグナルに基づいて、これらの機能の事前使用を確認する必要があるというわかっていました。 ディープ フリート テレメトリを使用して、機械学習 (ML) ベースの障害予測を有効にし、ディスク障害、IO 待機時間、CPU 頻度の異常など、いくつかのハードウェア 障害の場合に対する自動ライブ マイグレーションに関連付けしました。</p>


  <p>Microsoft Research (MSR) と提携し、発生する前に高い精度でML予測する新しいモデルを構築しました。 その結果、ワークロードが&rsquo;障害の&ldquo;&rdquo;兆候を示す前に、リスクの高いマシンからワークロードをライブ マイグレーションできます。 つまり、Azure で実行されている VM は、基になるハードウェアよりも信頼性が高い可能性があります。</p>


  <p>VM の観点から見ると、ライブ マイグレーションは最小限の影響を与える必要があります。実際、VM のライブ マイグレーションに関する問題を報告した顧客は誰もいます。 VM の状態とすべてのネットワーク接続は、ライブ マイグレーション中に保持されます。 ライブ マイグレーションの最終フェーズでは、VM は数秒間一時停止され、新しいホストに移動されます。 一部のまれなパフォーマンスが重要なワークロードでは、VM の一時停止に至る数分でわずかな低下に気付く場合があります。</p>


  <h2>ハードウェア障害の予測</h2>


  <p>最初は、ハードウェア障害の上位のMLディスク障害の予測に関するモデルの開発に重点を置いていました。 Azure と同じ大きな環境でのディスク障害の予測は複雑であり、成功するには複数の課題を克服する必要があります。 ディスク予測モデルでは、次の点を考慮する必要があります。</p>


  <ul>
      <li><strong>さまざまな正常性シグナル:</strong> たとえば、ゲスト VM のパフォーマンス低下、ホスト オペレーティング システムの動作、ディスク テレメトリなどです。</li>
      <li><strong>さまざまなお客様のワークロード:</strong> ワークロードが異なると、ディスク障害の症状が異なります。 ディスクを集中的に使用するワークロードでは、初期の症状が観察された直後にディスク障害が発生する可能性があります。一方、ディスクを集中的に消費するワークロードが比較的少ないノードでは、数週間または数か月間、これが表示されない場合があります。</li>
      <li><strong>さまざまなディスク製造元:</strong> ディスクの動作と障害パターンは、製造元やモデル間で異なります。</li>
      <li><strong>不均衡な障害率:</strong> 一般に、ディスク障害の兆候を示すノードは 10,000 ノード中 1 つのみです。 従来の機械学習アプローチでは、このような不均衡はうまく処理されない。</li>
  </ul>


  <p>これらの課題に対処するには、シグナルを収集する方法の包括的なアプローチと、偽陽性に耐えるほど柔軟なアプローチを設計する必要がありました。</p>


  <p>まず、システム レベルとディスク レベルの両方でテレメトリを使用します。 システム レベルのイベントには、ホスト IO パフォーマンス カウンターとシステム イベントが含まれます。 ディスク レベルの信号では、S.M.A.R.T データ (標準のディスク テレメトリ データ形式) が利用されます。 異種シグナルから学習するために、包括的な特徴エンジニアリング アプローチを利用します。</p>


  <p>次に、分類の問題ではなく、問題を順位付け問題として扱います。 ディスク障害の確率をランク付けした後、最適化モデルを使用して、障害が発生する可能性が最も高い上位 N ディスクを特定します (N は、推定最適コスト/利益のトレードオフによって決定されます)。</p>


  <p>3 つ目は、シグナルの異種性とその相関関係を考慮するために、ランク付けアプローチをカスタマイズする必要があります。そのため、高度なモデルのトレーニングと検証のアプローチは使用できなくなります。</p>


  <p>次に示すのは、2018 年 10 月 30 日の実際の例です。ディスク障害予測は、実際のお客様のワークロードを保護するのに役立ちます。</p>


  <ul>
      <li>01:59:26 に、ディスクに障害が発生する可能性が高いと予測しました。 このエラーは、ノードで実行していた 5 つの VM に影響を与える可能性があります。</li>
      <li>02:10:38 に、ライブ マイグレーションを使用して、これらの 5 つの VM をノードから移行し始めました。 ブラックアウト時間の範囲は 0.1 から 1.6 秒でした。</li>
      <li>詳細な診断のために、ノードは実稼働から削除されました。</li>
      <li>06:20:34 に、ノードはディスク ストレス テストに失敗し、修復のために送信されました。</li>
  </ul>


  <p>革新的なアプリケーションの使用の詳細についてはMLディスク障害予測とノード障害予測に<a href="https://www.microsoft.com/en-us/research/publication/improving-service-availability-cloud-systems-predicting-disk-error/" target="_blank"></a>関する論文<a href="https://www.microsoft.com/en-us/research/publication/predicting-node-failure-in-cloud-service-systems/" target="_blank">を参照してください</a>。</p>


  <h2>ライブ マイグレーションの背後での動作</h2>


  <p>大きなレベルでは、ライブ マイグレーションは、移行前、ブラウンアウト、ブラックアウトの 3 つの主要なフェーズで構成されます。 移行前フェーズでは、ライブ マイグレーション オーケストレーターによって最適な移行先ノードが選択され、VM 構成がエクスポートされ、承認が設定されます。 このフェーズ中、VM はソース ノード上で実行されたままで、可用性やパフォーマンスに影響はありません。 次に、メモリとディスクの状態がソース ノードから宛先ノードに転送される、ブラウンアウト フェーズです。 このフェーズでは、VM はまだ実行されますが、追加の作業が行われるので、パフォーマンスが軽微に低下する可能性があります。</p>


  <p>ブラウンアウトの長さは、VM のサイズ (特にメモリとディスク) と、メモリが変化する速度によって異なります。 通常、最も一般的な &ndash; VM サイズの場合、ブラウンアウトの範囲は 1 分から 30 分です。 ライブ マイグレーションの最後のフェーズは、ブラックアウト フェーズです。 ブラウンアウト フェーズが終了すると、VM はソース ノードと宛先ノードの両方で中断状態になります。</p>


  <p>Azure ライブ マイグレーション エージェントは、移行先 VM を開始する前に、追加の Azure 固有の状態情報を転送します。 ブラックアウトの長さは、VM の一時停止後に転送される残りの VM 状態の量によって異なります。 上の例と同様に、ブラックアウトは通常、1 桁以下の低い 1 桁の秒以下の範囲です。</p>


  <h2>制限事項</h2>


  <p>これらのプラットフォームの実績に対して大きな思いを持っていますが、さらに多くのことを行う必要があるのは常にわかっています。 ライブ マイグレーションを使用するシナリオを徐々に増やし、その技術的な機能を拡張しています。 ライブ マイグレーションでは、次のシナリオはまだサポートされていません。</p>


  <ul>
      <li>ハードウェアの使用停止</li>
      <li>Specialized Compute (ハイ <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-hpc" target="_blank">パフォーマンス</a> コンピューティング、<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-gpu" target="_blank">GPU 最適化 VM</a>、メモリ最適化 VM、Storage最適化<a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-memory" target="_blank"></a>された <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-storage" target="_blank">VM を含む</a>)</li>
      <li><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/sizes-previous-gen" target="_blank">レガシ A シリーズ VM</a></li>
      <li><a href="https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-choose-me" target="_blank">Cloud Services によって使用される VM</a></li>
  </ul>


  <p>VM の可用性は、&rsquo; Azure プラットフォームでのお客様の成功にとって重要であり、機械学習とライブ マイグレーションは、この顧客の約束に対する Azure&rsquo; のコミットメントにとって極めて重要です。 ライブ マイグレーションを使用してプラットフォームの更新を透過的に実行し、さまざまなハードウェアやソフトウェアの障害から復旧します。 機械学習は、ライブ マイグレーションの有効性を高める上で重要です。 ライブ マイグレーションには技術的な制限がある一方で、継続的に改善を優先しています。</p>


  <p>私たちの目標は、基になるプラットフォームの問題と運用のために VM が中断されるのを確実に回避することでした。 今後の投稿では、Azure で実行されているアプリケーションの可用性を最大化できる回復力のある基盤のさらなる改善を共有します。&nbsp;</p>
