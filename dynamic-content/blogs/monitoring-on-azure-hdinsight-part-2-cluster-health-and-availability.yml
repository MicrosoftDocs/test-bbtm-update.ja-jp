### YamlMime:Yaml
ms.openlocfilehash: 8953299350c473c53b9a8b57ade646760cb7e93d
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890353"
Slug: monitoring-on-azure-hdinsight-part-2-cluster-health-and-availability
Title: 'Azure HDInsight の監視 (パート 2): クラスターの正常性と可用性'
Summary: '高可用性サービスとして、Azure HDInsightは、クラスターの可用性を気にすることなく、ワークロードに集中して時間を費やしてみることができます。 '
Content: >-
  <p><em>これは、Azure HDInsight での監視に関する 4 部構成のシリーズの 2 番目のブログ記事です。&quot;<a href="https://azure.microsoft.com/en-in/blog/monitoring-on-hdinsight-part-1-an-overview/">第 1 部</a>Azure HDInsight監視: &quot; 概要では、クラスターの正常性と可用性、リソースの使用率とパフォーマンス、ジョブの状態とログの 3 つの主な監視カテゴリについて説明します。このブログでは、クラスターの正常性と可用性に関する最初のトピックについて詳しくは、以下をご覧ください。</em></p>


  <hr>

  <p>高可用性サービスとして、Azure HDInsightは、クラスターの可用性を気にすることなく、ワークロードに集中して時間を費やしてみることができます。 これを実現するために、HDInsight クラスターには、2 つのヘッド ノード、2 つのゲートウェイ ノード、および 3 つの ZooKeeper ノードが備え付けられているので、クラスターに単一障害点が発生し "ない" ことを確認します。 それでも、Azure HDInsight&rsquo; には、クラスター ノードの状態と、そのノードで実行されるコンポーネントを包括的に監視するための複数の方法が用意されています。 HDInsight クラスターには、正常性情報を一目で確認できる Apache Ambari と、メトリックとログのクエリと構成可能なアラートを可能にする Azure Monitor ログ統合の両方が含まれます。</p>


  <h2>Apache Ambari&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>


  <p>Apache Ambari は、すべての HDInsight クラスターに含まれており、使いやすい Web UI とアプリケーションを使用してクラスターの管理と監視をREST API。 現在、Ambari は、1 つの HDInsight クラスターの正常性と可用性を詳細に監視するための最適な方法です。</p>


  <h3>ダッシュボード</h3>


  <p>Ambari ダッシュボードには、HDInsight クラスターの正常性の概要を簡単に示す、一部のメトリックを表示するウィジェットが&rsquo;含まれています。 これらのウィジェットには、ライブ DataNodes (ワーカー ノード)、JournalNodes (ZooKeeper ノード)、NameNode (ヘッド ノード) アップタイムなどのメトリックと、Spark および Hadoop クラスターの YARN ResourceManager アップタイムなどの特定のクラスターの種類に固有のメトリックが表示されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/15bf1078-8b0b-41e0-8648-3c5e6929d4d3.png"><img alt="ambari_dashboard" border="0" height="817" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e6c3e495-9551-4ff8-9cd2-a4d995b6561b.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ambari_dashboard" width="1174"></a></p>


  <p align="center"><em>すべてのクラスターに含まれる Ambari ダッシュボードAzure HDInsightされます。</em></p>


  <h3>ホスト 個々 &ndash; のノードの状態を表示する</h3>


  <p>[ホスト] タブでは、さらにドリルダウンし、クラスター内の個々のノードの状態情報を表示できます。 これにより、現在のノードに対してアクティブなアラートが発生するかどうか、およびノードで実行されている個々のコンポーネントの状態/可用性を示すビューが提供されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/104d195d-7a42-4bd6-a736-3e95b7921e2d.png"><img alt="ambari_hosts" border="0" height="884" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/055dd39f-382d-49f6-b759-fdbeac56086d.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ambari_hosts" width="1160"></a></p>


  <p align="center"><em>[Ambari ホスト] ビューには、クラスター内の個々のノードの詳細な状態情報が表示されます。</em></p>


  <h3>Ambari のアラート</h3>


  <p>Ambari には、特定のイベントの通知を提供できる構成可能なアラートもいくつか用意されています。 現在アクティブなアラートの数は、アラートの数を含む赤いバッジで Ambari の左上隅に表示されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a4edd111-73b7-408f-aba0-adcf93ba139b.png"><img alt="ambari_alerts" border="0" height="76" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a9c37a47-391d-4712-b229-59f53ebd6254.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ambari_alerts" width="618"></a></p>


  <p>Ambari では、次に示すように、可用性に関連する多数の定義済みのアラートを提供しています。</p>


  <table border="1" cellpadding="0" cellspacing="0">
   <tbody>
    <tr>
     <td style="width: 312px;">
     <p><strong>アラート名</strong></p>
     </td>
     <td style="width: 312px;">
     <p><strong>説明</strong></p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>DataNode ヘルスの概要</p>
     </td>
     <td style="width: 312px;">
     <p>異常な DataNode がある場合に、このサービス レベルのアラートがトリガーされます。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>NameNode の高可用性のヘルス</p>
     </td>
     <td style="width: 312px;">
     <p>アクティブな NameNode またはスタンバイの NameNode が実行されていない場合に、このサービス レベルのアラートがトリガーされます。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>利用可能な JournalNode の割合</p>
     </td>
     <td style="width: 312px;">
     <p>クラスター内でダウンしている JournalNode の数が、設定された重大しきい値を超えている場合は、このアラートがトリガーされます。 これにより、JournalNode プロセス チェックの結果が集計されます。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>利用可能な DataNode の割合</p>
     </td>
     <td style="width: 312px;">
     <p>クラスター内でダウンしている DataNode の数が、設定された重大しきい値を超えている場合は、このアラートがトリガーされます。 これにより、DataNode プロセス チェックの結果が集計されます。</p>
     </td>
    </tr>
   </tbody>
  </table>


  <p>クラスターの可用性の監視に役立つ Ambari &ldquo; アラートの完全な一覧については、<a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-high-availability-linux?toc=%2Fen-us%2Fazure%2Fhdinsight%2Fkafka%2FTOC.json&amp;bc=%2Fen-us%2Fazure%2Fbread%2Ftoc.json#ambari-web-ui" target="_blank">HDInsight での Apache Hadoop</a> クラスターの可用性と信頼性に関するドキュメントを参照してください。&rdquo;</p>


  <p>各アラートの詳細ビューには、アラートの説明、警告または重大なアラートをトリガーする特定の条件またはしきい値、および条件のチェック間隔が表示されます。 しきい値とチェック間隔は、個々のアラートに対して構成できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/49bf8623-5e1d-475f-bdbf-baaa8a868f7f.png"><img alt="ambari_alerts_detail" border="0" height="863" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1c633c8d-e1b8-47d6-9e96-4f9949c7a39d.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ambari_alerts_detail" width="1185"></a></p>


  <p align="center"><em>Ambari の詳細アラート ビューには、アラートの説明と、アラートが発生するチェック間隔としきい値が表示されます。</em></p>


  <h3>電子メール通知</h3>


  <p>Ambari では、電子メール通知の構成もサポートされています。 Ambari 電子メール通知は、多くの HDInsight クラスターを管理するときにアラートを監視するための優れた方法です。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d6d9c3af-d7df-476d-b968-4f2d687403f1.png"><img alt="ambari_email" border="0" height="314" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/177ecf69-f5a9-4ed7-8285-256d98ead353.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="ambari_email" width="1677"></a></p>


  <p align="center"><em>Ambari の電子メール通知を構成すると、クラスターのアラートを通知する便利な方法になります。</em></p>


  <h2>Azure Monitor ログの統合</h2>


  <p>Azure Monitorログを使用すると、HDInsight クラスターなどの複数のリソースによって生成されたデータを 1 か所で収集して集計し、統合された監視エクスペリエンスを実現できます。</p>


  <p>前提条件として、収集されたデータを格納するための Log Analytics ワークスペースが必要になります。 まだ作成していない場合は、Log Analytics ワークスペースの作成手順 <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/learn/quick-create-workspace" target="_blank">に従ってください</a>。</p>


  <p>その後、Spark/Hadoop クラスターの YARN ResourceManager 情報、ブローカー トピック、Kafka クラスターのコントローラー メトリックなど、多くのワークロード固有のメトリックを Log Analytics に送信する HDInsight クラスターを簡単に構成できます。 同じ Log Analytics ワークスペースにメトリックを送信する複数の HDInsight クラスターを構成して、すべてのクラスターを 1 か所で監視することもできます。 HDInsight クラスターを監視 Azure Monitorするために Azure Monitor ログを使用する方法に関するドキュメントを参照して、HDInsight クラスターでログの統合を有効にする方法を <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-oms-log-analytics-tutorial#enable-azure-monitor-logs-by-using-the-portal">参照してください</a>。</p>


  <h3>ログ ブレードでメトリック テーブルにクエリを実行する</h3>


  <p>Log Analytics 統合が有効になると、数分かかる場合があります。ログ/メトリック テーブルのクエリを開始できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c80a24a9-aa1c-4302-8bb7-3e570ce2b531.png"><img alt="la_logs" border="0" height="745" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d3ba7c52-d139-4ee9-9f4f-71e1a3096a0d.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="la_logs" width="1425"></a></p>


  <p align="center"><em>Log Analytics ワークスペースの [ログ] ブレードを使用すると、多数のクラスターで収集されたメトリックとログに対してクエリを実行できます。</em></p>


  <p>Log Analytics ワークスペースのログ ブレードの [コンピューターの可用性] タブには、可用性に関連するサンプル クエリの数が一覧表示されます。次に例を示します。</p>


  <table border="1" cellpadding="0" cellspacing="0">
   <tbody>
    <tr>
     <td style="width: 312px;">
     <p><strong>クエリ名</strong></p>
     </td>
     <td style="width: 312px;">
     <p><strong>説明</strong></p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>今日のコンピューターの可用性</p>
     </td>
     <td style="width: 312px;">
     <p>ログを送信するコンピューターの数を 1 時間ごとにグラフ化します。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>ハートビードの一覧表示</p>
     </td>
     <td style="width: 312px;">
     <p>最後の 1 時間のすべてのコンピューターハートビートを一覧表示します。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>各コンピューターの最新のハートビート</p>
     </td>
     <td style="width: 312px;">
     <p>各コンピューターによって送信された最後のハートビートを表示します。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>利用できないコンピューター</p>
     </td>
     <td style="width: 312px;">
     <p>過去 5 時間以内にハートビート&#39;しなかった既知のコンピューターを一覧表示します。</p>
     </td>
    </tr>
    <tr>
     <td style="width: 312px;">
     <p>可用性率</p>
     </td>
     <td style="width: 312px;">
     <p>接続されている各コンピューターの可用性率を計算します。</p>
     </td>
    </tr>
   </tbody>
  </table>


  <h3>Azure Monitor アラート</h3>


  <p>メトリックの値またはクエリの結果が特定の条件に合った場合にトリガーする Azure Monitor アラートを設定することも可能です。</p>


  <p>一部のしきい値以下の値を持つレコードを返すクエリ、またはクエリによって返される結果の数を条件にできます。 たとえば、&rsquo;1 時間に 1 つ以上のノードがハートビートを送信していない場合 (つまり、使用できないと推定される) 場合に電子メールを送信するアラートを作成できます。 アラートを発生するために満たす必要がある複数の条件を作成できます。</p>


  <p>電子メール、SMS、プッシュ、音声、Azure 関数、LogicApp、Webhook、ITSM、Automation Runbook など、アラートが発生した場合にトリガーできるアクションには、いくつかの種類があります。 1 つのアラートに対して複数のアクションを設定できます。 これらのさまざまな種類のアクションの&ldquo;詳細については、「アクション グループの作成と管理」のドキュメントを参照<a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/action-groups#action-specific-information" target="_blank">Azure portal</a>。&rdquo;</p>


  <p>最後に、名前に加えてアラートの重大度を指定できます。 重大度を指定する機能は、複数のアラートを作成するときに使用できる強力なツールです。 たとえば、1 つのヘッド ノードが使用できなくなった場合に警告 (Sev 1) アラートを生成するアラートと、両方のヘッド ノードがダウンする可能性が低い場合に重大 (Sev 0) アラートを発生する別のアラートを作成できます。 アラートは、後で表示するときに重大度別にグループ化できます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e862a1e4-6411-4954-a95a-27b7e3cb7ce9.png"><img alt="la_alerts" border="0" height="1558" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fe4c692d-a584-4481-b17a-adc3f06b68a7.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="la_alerts" width="1426"></a></p>


  <p align="center"><em>Azure Monitorアラートは、特定のイベントのアラートを受信するための非常にカスタマイズ可能な方法です。</em></p>


  <h2>次のステップ</h2>


  <p>高可用性を目的として設計された HDInsights&rsquo; 冗長アーキテクチャは、単一の障害がクラスターの機能に影響を与える可能性を意味しますが、HDInsight では、潜在的な可用性の問題について常に通知され、早い段階で軽減できます。 Azure Monitor ログ統合を使用した Apache Ambari と Azure Log Analytics 統合を使用した Apache Ambari の間で、Azure HDInight では、クラスターを詳細に監視するか、多数のクラスターを一目で監視する両方の包括的なソリューションを提供します。 詳細については、 &ldquo;<a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-cluster-availability" target="_blank">ドキュメント「How to Monitor Cluster Availability With Ambari and Azure Monitor Logs(Ambari</a> を使用してクラスターの可用性を監視する方法)」の具体的な例を参照してください。&rdquo;</p>


  <h2>今すぐ HDInsight を試す</h2>


  <p>HDInsight での監視を完全に活用して、お客様が HDInsight を使用して何を構築Azure HDInsight。 <a href="https://azure.microsoft.com/en-us/blog/get-up-to-speed-with-azure-hdinsight-the-comprehensive-guide/" target="_blank">この開発者ガイドを読み</a>、<a href="https://docs.microsoft.com/en-us/azure/hdinsight/hadoop/apache-hadoop-linux-tutorial-get-started" target="_blank"></a>クイック スタート ガイドに従って、これらのパイプラインとアーキテクチャを Azure HDInsight に実装する方法について学習してください。 Twitter <a href="https://twitter.com/search?q=%23AzureHDInsight&amp;src=typd" target="_blank">#AzureHDInsight</a> と でフォロー Azure HDInsight最新情報と機能を最新の情報に更新してください <a href="https://twitter.com/search?q=%40AzureHDInsight&amp;src=typd" target="_blank">@AzureHDInsight</a>。 質問とフィードバックについては、 にお問い合わせください <a>AskHDInsight@microsoft.com</a>。</p>


  <h2>HDInsight について</h2>


  <p>Azure HDInsightは、Apache Hadoop、Spark、Kafka などの一般的なオープン ソース フレームワークを簡単に実行できる、オープンソース分析用の簡単でコスト効率の高いエンタープライズ レベルのサービスです。 このサービスは、36 のパブリック リージョンと、Azure Governmentクラウドで使用できます。 Azure HDInsightさまざまなセクターでミッション クリティカルなアプリケーションを提供し、ETL、ストリーミング、対話型クエリなどの幅広い用途を可能にしています。</p>
