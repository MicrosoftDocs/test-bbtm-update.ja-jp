### YamlMime:Yaml
ms.openlocfilehash: 0cbd9ed750158e8925804c6b92d85fad60103852
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139895853"
Slug: large-scale-analysis-of-dns-query-logs-reveals-botnets-in-the-cloud
Title: Large-Scale DNS クエリ ログの分析により、クラウド内のボットネットが表示される
Summary: データ セキュリティプロフェッショナルとサイバー犯罪者の間の競争は急速に続きます。 攻撃者は、これまで以上に、既知のマルウェアをデプロイすることで、悪意のある目的でコンピューティング リソースを悪用しています。
Content: >-
  <p><em>この投稿は、Azure Security のシニア セキュリティ プログラム マネージャーである Tomer Teller 氏によって共同執筆されました。</em></p>


  <p>データ セキュリティプロフェッショナルとサイバー犯罪者の間の競争は急速に続きます。 攻撃者はこれまで以上に、クラウドで実行されている仮想マシンにマルウェア (&ldquo;&rdquo;ボットと呼ばれる) をデプロイすることで、悪意のある目的でコンピューティング リソースを悪用しています。 保守的な見積もりでも、少なくとも 10,000 台のマシンに 1 台が既知の Botnet の一部である可能性があります。</p>


  <p>クラウド内の VM をより適切に保護するために、<a href="https://azure.microsoft.com/en-us/services/security-center/">Azure Security Center</a> (ASC) は、DNS クエリ ログの分析に基づいて、高精度の Botnet 検出用の新しい監視対象 Machine Learning モデルを適用します。 このモデルは、95% の精度と 43% のリコールを実現し、マルウェア対策企業から報告される前にボットネットを検出できます。</p>


  <h2>Botnet とそれらの CnC サーバー間の通信パターン</h2>


  <p>ボットは、コマンド アンド コントロール (CnC) サーバーまたはサーバーを使用して、攻撃者 (Botmaster) によって制御されます。 このネットワークの一部であるボットは、Botnets (またはBots) と呼ばれています。 次の図に、一般的な Bot network (Botnet) 構造を示します。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/620679ef-d83d-40e7-af42-2a3c55007488.jpg"><img alt="The Structure" border="0" height="304" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ea4043de-6ef0-4ad9-8756-11d17b8e5b78.jpg" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="構造体" width="539"></a></p>


  <p>従来、CnC サーバーには静的 IP アドレスが割り当てられていないので、非常に簡単にダウンまたはブラックリストに登録できます。 検出を回避するために、Botmasters は、より複雑なボット/CnC 通信パターンを作成することで応答しました。</p>


  <p>たとえば、攻撃者は、ドメイン名を使用して IP アドレスを頻繁に変更する CnC サーバーを検索する Fast-Flux (Mehta、2014) などの方法を開発しました。 さらに、ドメイン <a href="https://en.wikipedia.org/wiki/Domain_generation_algorithm">生成</a> アルゴリズム (DGA) はマルウェアのさまざまなファミリでも使用され、Conficker はおそらく最も悪名高い例です。 DGA パターンは、ボットが CnC サーバーへの接続ポイントとして使用できる多数のドメイン名を定期的に生成することで機能します。</p>


  <p>最近では、ソーシャル ネットワークや他のユーザーが生成したコンテンツ サイトが、CnC サーバーとの直接リンクを確立することなく情報を渡すボットマスターによって悪用されています。 そのため、セキュリティプロフェッショナルは、これらの複雑な通信パターンを検出するために、単純なルールベースのアプローチに依存しなくなりました。</p>


  <h2>クラウド内の Botnet を検出する機会</h2>


  <p>サイバーセキュリティ ドメインにおける機械学習のより一般的なアプリケーションの 1 つは、異常検出です。 その考え方は、侵害されたマシンが異常な動作を示すという考え方です。 この前提は通常は正しいのに対し、その逆はめったに当てはめったにありません。 そのため、このような手法では精度が低く、誤ったアラームが多数発生します。</p>


  <p>Microsoft などのクラウド プロバイダーは、大規模な機械学習を複数のデータ ソースに適用し、すべての VM ログのビューを組み合わせて適用することで、Botnet アクティビティをはるかに正確に検出する独自の機会を持っています。 各マシンのデータを分離して分析する他のほとんどのシステムとは異なり、このアプローチでは、Botnets に一般的なパターンを効果的に明らかにできます。</p>


  <h2>データの収集</h2>


  <p>Azure VM から DNS クエリと応答データを収集します。 ログには 1 日あたり約 50 TB のデータが含まれており、クエリ名、クエリされたドメイン ネーム サーバー、DNS 応答、その他の DNS ログ情報などの情報が含まれます。</p>


  <p>DNS クエリと応答データに加えて、Microsoft は脅威インテリジェンス (TI) の自動マシン読み取り可能フィードも使用します。 フィードには、Botnet の一部である可能性が高いデバイスの IP アドレスと、既知の CnC サーバーの IP アドレスとドメインに関する情報が含まれています。</p>


  <p>最適な結果を得る目的で、Botnet 検出を 2 クラスの教師あり学習の問題としてモデル化します。 つまり、VM (特定の日付) が、その VM の DNS クエリ ログに基づいて Botnet&rsquo; の一部として分類されます。 VM インスタンスには、次の条件に基づいて、Botnet に参加している可能性があるというラベルが付けされます。</p>


  <ol>
   <li>VM の IP アドレスは、同じ日の TI Botnet フィードに表示されます。</li>
   <li>VM は、CnC に属することが知られているドメインで DNS クエリを発行しました。</li>
   <li>VM は、発行されたクエリに対して DNS 応答を受信し、結果としてマップされた IP は CnC の既知の IP アドレスです。</li>
  </ol>


  <h2>特徴抽出</h2>


  <p>VM インスタンスは特定の日の VM を表し、その日の TI フィードに基づいて、ボットネットの可能な参加者としてラベル付けされます。 この問題では、特徴抽出は困難です。特定の VM によってアクセスされるドメインの数は非常に多く、可能なドメインの総数は膨大です。 そのため、ドメイン領域は大きく、比較的高密度です。</p>


  <p>さらに、モデルは継続的に使用されるので、トレーニング中にドメインのクエリが見えなくても、Botnet を識別する必要があります。 CnC サーバーとの通信パターンに基づいて、次の表に示す分析情報を取得する必要があります。</p>


  <table border="1" cellpadding="2" cellspacing="0" width="1452">
   <tbody>
    <tr>
     <td valign="top" width="499"><strong>名前 </strong></td>
     <td valign="top" width="951"><strong>説明</strong></td>
    </tr>
    <tr>
     <td valign="top" width="499">まれなドメイン</td>
     <td valign="top" width="951">CnC サーバーのドメイン名は、正当なユーザーから要求されるのがめったにないので、まれです</td>
    </tr>
    <tr>
     <td valign="top" width="499">若いドメイン</td>
     <td valign="top" width="951">ドメイン生成アルゴリズム (DGA) を使用すると、CnC サーバーは頻繁に新しいドメイン名を取得するため、最近登録される傾向があります。 ドメイン名を登録日にマップするために、大規模な毎日更新されたデータ フィードを使用します</td>
    </tr>
    <tr>
     <td valign="top" width="499">Botnets に対するドメインの特異性</td>
     <td valign="top" width="951">同じ CnC サーバーによって制御されるボットネットは、互いに類似性がまだ異なる DNS クエリを発行します</td>
    </tr>
    <tr>
     <td valign="top" width="499">存在しないドメイン応答</td>
     <td valign="top" width="951">
     <p>DGA を使用すると、Botnets は、その時間の CnC サーバーの実際のドメインを見つける前に、多くの既存ではないドメインに対してクエリを実行します</p>
     </td>
    </tr>
   </tbody>
  </table>


  <p>各インスタンスの特徴を効率的に生成するには、データセットに対して 2 つのパスを適用します。 最初のパスでは、特定の日にドメインを次にマップする評価テーブル (RT) を生成します。</p>


  <ul>
   <li>まれなスコア</li>
   <li>若さスコア</li>
   <li>Botnet idiosyncratic スコア</li>
  </ul>


  <p>2 番目のパスでは、クエリを実行したドメインの評価スコアに基づいて、各インスタンスの特徴を計算します。 RT は次のように計算されます。</p>


  <p align="left"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4d1d04d1-5ce5-4cea-b974-71881783a5e8.png"><img alt="Screenshot_12" border="0" height="159" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d97d6a28-db3a-4d34-b304-7c186f4c9f6f.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="Screenshot_12" width="454"></a></p>


  <p>特定の日に VM の機能を生成するために、VM によって照会された存在しないドメインと存在するドメインのセットである <sub>Dnxand&nbsp;</sub> <sub>Dx </sub>を作成します。 特徴ベクトルを生成するには、<sub>Dnx</sub>&nbsp; と<sub>Dx</sub> の各ドメインの評価テーブルの対応する値を個別に合計します。</p>


  <p>同様に、クエリが実行されるネーム サーバー (つまり、最終的に DNS クエリを解決した DNS サーバー) に対して同じことを行います。 後者の機能は、悪意のあるゾーン以外のまれなサブドメインがアクセスされる正当なシナリオ (Yahoo.com のまれなサブドメインなど) を特定するのに役立ちます。 分類には、既定のパラメーター Apache Spark&rsquo;Gradient-Boostedツリーを使用しました。</p>


  <h2>試験的評価</h2>


  <p>Microsoft TI フィードを使用して、毎日の Azure VM インスタンスのラベルを生成します。 ただし、これらのラベルは完全ではありません。ボットネットは、まだかなり長い間検出されないままです。 そのため、フィードに基づいて生成したラベルは包括的ではありません。 これは、フィードに基づいて抽出できるラベルと完全に一致しないのが目標であるからといって、評価設定が標準の分類問題とは異なっています。 これにより、日次フィードで既に使用できる情報が重複する可能性があります。 代わりに、侵害された VM が TI フィードに表示される前に、侵害<em>された VM を見つけるのが目標です<strong></strong></em>。</p>


  <p>これを念頭に置いて、2016 年 6 月初めから 1 週間分のデータでモデルをトレーニングしました。 モデルでは、&ldquo;&rdquo;6 月後半からインスタンスを分類し、1 週間 (7 月) の時間を見越して TI フィードから生成されたラベルに基づいて評価の真相を生み出します。 モデルの精度を次の混同行列で報告します。<br>

  <a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e92c72e3-68b9-4703-bfe1-62be83987359.png"><img alt="Screenshot_13" border="0" height="62" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/47452d30-f782-47e8-800c-608f5ffea65b.png" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" title="Screenshot_13" width="410"></a></p>


  <p>このマトリックスから、モデルによってテスト セットから 432 (411+21) のインスタンスが Botnets として分類されたことを学習します。 そのうち、最終的に 95% (411) がインターフロー フィード (1 週間以内) に表示されます。そのため、モデルは 95% の精度と 43% のリコールを達成します。 5% の明らかな FPs は、フィードにまだ表示されていない Botnet である可能性があるため、さらに調査する必要があります。</p>


  <h2>まとめ</h2>


  <p>DNS ログに基づく Botnet 検出ML新しい監視モード モデルを示します。 マルウェア対策ベンダーによって提供される脅威インテリジェンス フィードに基づいて、監視対象モデルのラベルを生成します。 モデルは、TI フィードの一部になる前に、ボットネットの一部である VM を高い精度で識別できると示しています。 この新しい Botnet 検出機能により、Azure VM がマルウェアに感染するリスクが軽減されます。</p>
