### YamlMime:Yaml
ms.openlocfilehash: b0a3e9f417fab8f6d0209bec5c36205a23db396e
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892021"
Slug: swap-space-in-windows-azure-virtual-machines-running-pre-built-linux-images-part-1
Title: ビルド済みの Linux イメージを実行している Windows Azure Virtual Machines のスワップ領域-パート1
Summary: この記事は、Azure CAT チームから Piyush Ranjan (MSFT) によって執筆されました。  インフラストラクチャサービス (Virtual Machines と Virtual Network) の最近の一般提供を Windows Azure,...
Content: '<p>この記事は、Azure CAT チームから Piyush Ranjan (MSFT) によって執筆されました。</p>  <p>Azure Windows のインフラストラクチャサービス (Virtual Machines と Virtual Network) の最近の一般提供により、クラウドの経済性、スケール、およびスピードを活用するために、多くのエンタープライズワークロードがパブリッククラウドに移行しています。 &rsquo;最近、このようなエンタープライズワークロードの大規模なデータをクラウドに参加させることにしました。 ここでは、共有するヒントとベストプラクティスについて説明します。</p>  <p>このプロジェクトでは、あらかじめ構築された Linux イメージを使用して Windows Azure にマルチノード Hadoop クラスターをデプロイする必要がありました。 Windows Azure イメージギャラリーから centos 6.3 イメージを使用して、中規模の仮想マシン (VM) をプロビジョニングし、1つのノードコア Hadoop のデプロイに進んでいました。 テストをわずかに開始したときに、VM がフリーズしたり応答しなくなったりすることを除いて、すべて問題なく動作しました。</p>  <p>これには、すべての CPU コアと 3.5 GB のメモリが搭載された後、中規模の VM &ndash; のリソースを使用して実行する必要があることを推測するのは困難です。 ただし、VM 全体が応答しなくなったり、接続の切断を開始したりすることは想定されていませんでした。 友人や同僚との間でこの問題について説明した後、VM にスワップがないと判断されました (つまり、Windows でページファイルと呼ばれるもの)。 そのため、メモリの負荷が増加したときに、仮想メモリシステムがディスクにスワップできませんでした。</p>  <p>Linux シェルプロンプトから free &rdquo; コマンドを実行 &ldquo; して、システムがメモリをどのように処理しているかを確認できます。特に、cat/proc/swaps &rdquo; を使用 &ldquo; して、スワップ領域 &ndash; の構成量と使用量を確認できます。 下のスクリーンショットを参照してください。</p>  <p><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5633.swap1.png" alt="" border="0"></p>  <p>スワップ領域がまったく構成されていない場合は Windows Azure Virtual Machines &ldquo; にプロビジョニングされた Linux VM &rsquo; の既定のケースと同様に、cat/proc/swaps &rdquo; は何も返しません。同様 &ldquo; に、free &rdquo; コマンドではスワップ中のアクティビティは表示されません。</p>  <p>興味深い質問は、Linux ライブラリイメージを使用して VM をプロビジョニングしない (つまり、Windows Azure イメージギャラリーから) スワップ領域を自動的に構成する理由 &rsquo; です。 ここでは、ユーザーがスワップのサイズと場所を決定し、プロビジョニング後に実行する必要があると考えています。 ただし、プロセスがクラッシュを開始するまで、または VM がフリーズするまでスワップが構成されていなくても、VM が引き続き使用される可能性があります。</p>  <p>ただし、スワップ領域を取得するために必要な作業がすべてわかったら、リソースディスクでファイルベースのスワップを構成するための単純な一連の手順に従います。Azure Windows の中規模の仮想マシンには、/mnt/resource &rdquo; としてマウントされた 135 GB のリソースディスクが付属して &ldquo; います。 次に示すのは、VM でファイルベースのスワップ領域を構成する手順のチュートリアルです。</p>  <ul>  <li>&ldquo;Fallocate &rdquo; コマンドを使用して、適切なサイズのスワップファイル (たとえば、リソースディスクに 5 gb) を割り当てます。 構文は次のとおりです: fallocate-l 5g/mnt/resource/swap5g &rdquo; 場所 &ldquo; swap5g &rdquo; はファイルの名前です。 &ldquo;</li>  <li>Chmod &rdquo; コマンドを使用して &ldquo; ファイルのアクセス許可を変更し、ルートユーザーのみがスワップファイルの読み取り/書き込みアクセス許可を持つようにします。 構文は、chmod 600/mnt/resource/swap5g です。 &ldquo;&rdquo;</li>  <li>&ldquo;Mkswap &rdquo; コマンドを使用して、ファイルをスワップ領域として設定します。 構文は次のとおりです: &ldquo; mkswap/mnt/resource/swap5g&rdquo;</li>  <li>Swapon &rdquo; コマンドを使用して &ldquo; スワップファイルの使用を有効にします。 構文は次のとおりです: &ldquo; swapon/mnt/resource/swap5g&rdquo;</li>  <li>スワップはすぐ &ldquo; に使用できる状態になり、cat/proc/swaps &rdquo; コマンドで確認する必要があります。 Azure で VM がリサイクルされた場合でもスワップの設定が保持されるように、/etc/fstab &rdquo; ファイルに &ldquo; エントリを追加します。 構文は次のとおりです: echo &ldquo; /mnt/resource/swap5g &nbsp; &nbsp; none &nbsp; swap &nbsp; sw &nbsp; 0 0 &rdquo; &gt; &gt; /etc/fstab</li>  </ul>  <p>上記のコマンドのトランスクリプトを VM で実行します。</p>  <p><img src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8176.Screen-Shot-2013_2D00_07_2D00_29-at-11.04.10-AM.png" alt="" border="0"></p>  <p><strong>確認</strong>: 問題のトラブルシューティングと解決のために、同僚 Amit Srivastava に感謝します。</p>'
