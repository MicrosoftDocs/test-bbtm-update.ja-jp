### YamlMime:Yaml
ms.openlocfilehash: 45f55a0cf55e335fd2152f13fb458df1de28c0c0
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139890351"
Slug: monitoring-on-azure-hdinsight-part-4-workload-metrics-and-logs
Title: '第 4 部Azure HDInsight監視: ワークロードのメトリックとログ'
Summary: Azure HDInsight クラスターで実行されているワークロードを監視し、デバッグに役立つ関連ログを表示する方法について説明します。
Content: >-
  <p><em>この記事は、4 部構成</em>の「監視」シリーズの 4 番目のブログAzure HDInsight。<a href="https://azure.microsoft.com/en-in/blog/monitoring-on-hdinsight-part-1-an-overview/">第 1 部Azure HDInsightの監視: 概要</a>&nbsp;<em>では、クラスターの正常性と可用性、</em>リソースの使用率とパフォーマンス、ジョブの状態とログの 3 つの主要な監視カテゴリについて説明します。<a href="https://azure.microsoft.com/en-us/blog/monitoring-on-azure-hdinsight-part-2-cluster-health-and-availability/">パート 2</a><em> は、クラスターの正常性と可用性の監視という最初のトピックを中心にしています。 </em><a href="https://azure.microsoft.com/blog/monitoring-on-azure-hdinsight-part-3-performance-and-resource-utilization/">パート 3 では</a><em>、パフォーマンスとリソース使用率の監視について説明しました。このブログでは、これらのトピックの 3 つ目であるワークロード メトリックとログについて、さらに詳しい説明を行っています。</em></p>


  <hr>

  <p>Azure HDInsight クラスターが正常で最適に実行されている通常の操作中は、クラスターで実行されているワークロードの監視と、デバッグに役立つ関連ログの表示に注意を集中する可能性があります。 Azure HDInsightには、クラスター ワークロードの監視に使用できる 2 つのツールが用意されています。Apache Ambari とログの統合Azure Monitorです。 Apache Ambari は、すべての Azure HDInsight クラスターに含まれており、クラスターの監視と構成変更の実行に使用できる使いやすい Web ユーザー インターフェイスを提供します。 Azure Monitor、HDInsight クラスターなどの複数のリソースから 1 つの Log Analytics ワークスペースにメトリックとログAzure Monitor収集します。 Log Analytics Azure Monitorでは、カスタム アラートの構成に使用できる構造化されたクエリ可能なテーブルとしてメトリックとログが表示されます。 Azure Monitorログは、ワークロードを監視し、ログと対話するための優れた全体的なエクスペリエンスを提供します (特に、複数のクラスターがある場合)。</p>


  <h2>Azure Monitor ログ</h2>


  <p>Azure Monitorログを使用すると、HDInsight クラスターなどの複数のリソースによって生成されたデータを 1 か所で収集して集計し、統合された監視エクスペリエンスを実現できます。 前提条件として、収集されたデータを格納するために Log Analytics ワークスペースが必要です。 まだ作成していない場合は、次の手順に従って、 <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/learn/quick-create-workspace" target="_blank">Log Analytics</a> ワークスペースにAzure Monitor作成できます。 その後、 <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-oms-log-analytics-tutorial#enable-azure-monitor-logs-by-using-the-portal" target="_blank">HDInsight クラスターを</a>簡単に構成して、Log Analytics にログとメトリックのホストAzure Monitor送信できます。</p>


  <h3>HDInsight 監視ソリューション</h3>


  <p>Azure HDInsightは、クラスターで実行されているワークロードを監視するために使用できるソリューションの<a href="https://docs.microsoft.com/azure/azure-monitor/insights/solutions"></a>形式で、事前に作成された監視ダッシュボードを提供します。 Apache Spark、Hadoop、Apache Kafka、ライブ long and process (LLAP)、Apache HBase、および Apache Storm のソリューションは、Azure Marketplace で <a href="https://azuremarketplace.microsoft.com/en-us/marketplace/">使用できます</a>。 監視ソリューションをインストールする <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-oms-log-analytics-tutorial#install-hdinsight-cluster-management-solutions" target="_blank">方法については、ドキュメントを参照してください</a>。 これらのソリューションはワークロード&nbsp; 固有であり、中央処理装置 (CPU) 時間、使用可能な YARN メモリ、特定の種類の複数のクラスター間での論理ディスク書き込みなど、メトリックを監視できます。 グラフを選択すると、ログ ビューに表示される、グラフの生成に使用されるクエリが表示されます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3ebe8f35-be02-4d1c-919e-9c016f04092b.png"><img alt="An example of the job graph showing stages 0 through 3 for a spark job." border="0" height="545" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/698f4f9c-7cc5-466b-a175-8ba9af2c9f85.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="" width="1024"></a></p>


  <p align="center">&nbsp;</p>


  <p>HDInsight Spark 監視ソリューションは、1 つのウィンドウで複数のクラスターのワークロード固有のメトリックを監視できる、シンプルな事前作成済みのダッシュボードを提供します。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b97e277c-19cb-4011-b88b-850e7246ee9e.png"><img alt="The pre-made dashboard for Kafka we offer as part of HDInsight for monitoring Kafka clusters." border="0" height="536" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c365e33c-f425-41c5-a5b0-9aae5fc7ca0c.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="" width="1024"></a></p>


  <p>HDInsight Kafka 監視ソリューションを使用すると、1 つのウィンドウですべての Kafka クラスターを監視できます。</p>


  <h3>ログ ブレードを使用してクエリを実行する</h3>


  <p>Log Analytics ワークスペースのログ ビューを使用して、メトリックとテーブルに直接クエリを実行することもできます。</p>


  <p>HDInsight クラスターでは、log_resourcemanager_CL、<em>log_spark_CL</em>、<em>log_kafkaserver_CL</em>、<em>log_jupyter_CL</em>、log_regionserver_CL、log_hmaster_CL など、いくつかのワークロード固有のログ テーブル<em>が</em>出力<em>されます</em>。 <em></em></p>


  <p>メトリック側では、クラスターは、metrics_sparkapps_CL、metrics_resourcemanager_queue_root_CL、metrics_kafka_CL、metrics_hmaster_CL <em></em>など、いくつかのメトリック テーブル<em></em><em>を出力します</em>。 詳細については、HDInsight クラスターを監視するクエリ ログに <a href="https://docs.microsoft.com/azure/hdinsight/hdinsight-hadoop-oms-log-analytics-use-queries">Azure Monitorドキュメントを参照してください</a>。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b435c958-427b-480f-86b5-25e2bf3e884f.png"><img alt="The log blade in a Log Analytics workspace used to query metrics and logs tables." border="0" height="619" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f8477e40-29d2-481d-9c3d-0620283b3eb2.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="" width="1024"></a></p>


  <p align="left">Log Analytics ワークスペースの [ログ] ブレードを使用すると、多数のクラスターで収集されたメトリックとログに対してクエリを実行できます。</p>


  <h3>Azure Monitor アラート</h3>


  <p>メトリックの値または <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-metric" target="_blank">クエリAzure Monitorが</a> 特定の条件を満たした場合にトリガーされるアラートを設定することもできます。 特定のしきい値より大きい値または小さい値を持つレコードを返すクエリ、またはクエリによって返される結果の数を条件にできます。 たとえば、Spark ジョブが失敗した場合、または Kafka ディスクの使用量が 90% を超えた場合に電子メールを送信するアラートを作成できます。</p>


  <p>電子メール、SMS、プッシュ通知、音声、Azure 関数、Azure LogicApp、Webhook、IT サービスマネジメント (ITSM)、Automation Runbook など、アラートが発生した場合にトリガーできるアクションには、いくつかの種類があります。 1 つのアラートに対して複数のアクションを設定し、これらのさまざまな種類のアクションに関する詳細を確認するには、 <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/action-groups#action-specific-information" target="_blank"><em>Azure Portal</em></a> でのアクション グループの作成と管理に関するドキュメントを参照してください。</p>


  <p>最後に、名前に加えてアラートの重大度を指定できます。 重大度を指定する機能は、複数のアラートを作成するときに使用できる強力なツールです。 たとえば、1 つのヘッド ノードが使用できなくなった場合に Sev 1 警告アラートを生成するアラートを作成し、両方のヘッド ノードがダウンする可能性が低い場合に Sev 0 重大アラートを発生する別のアラートを作成できます。 アラートは、後で表示するときに重大度別にグループ化できます。</p>


  <h2>Apache Ambari</h2>


  <p>Apache Ambari ダッシュボードには、クラスター上のワークロードを監視するために、いくつかの異なるビューへのリンクが表示されます。</p>


  <h3>ResourceManager ユーザー インターフェイス</h3>


  <p>ResourceManager ユーザー インターフェイスには、YARN ベースのクラスターでジョブを監視するビューがいくつか備わっています。 ここでは、完了または実行中のアプリの概要とそのリソース使用量、キュー別のスケジュールされたジョブのビュー、ジョブの実行履歴の一覧、それぞれの状態など、複数のビューを表示できます。 個々のアプリケーション ID をクリックすると、そのジョブの詳細を表示できます。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/d1b195f2-ba32-4152-9531-2a363c6c6bd7.png"><img alt="The Applications tab in YARN UI, which shows a list of application execution history for a cluster." border="0" height="722" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ebae713d-7de3-4320-8435-f9c2279be148.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="" width="1024"></a></p>


  <h3>Spark History Server</h3>


  <p>Apache <a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#get-access-to-apache-spark-history-server">Spark History Server には、</a>完了した Spark ジョブの詳細情報が表示され、監視とデバッグが容易<a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-spark-job-debugging">になります</a>。&nbsp;上部の従来のタブ (ジョブ、ステージ、Executors など) に加えて、<a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#diagnosis-tab-in-apache-spark-history-server"></a>追加の <a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#data-tab-in-spark-history-server">data</a><a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#data-tab-in-spark-history-server"></a>、<a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#graph-tab-in-apache-spark-history-server">graph</a>、および <a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#graph-tab-in-apache-spark-history-server"></a><a href="https://docs.microsoft.com/azure/hdinsight/spark/apache-azure-spark-history-server#diagnosis-tab-in-apache-spark-history-server">diagnostic</a> タブが表示され、さらにデバッグに役立ちます。</p>


  <p align="center"><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0abe8faf-caa1-4c6e-8b40-aeeecea4dfa4.png"><img alt="The pre-made dashboard for Spark we offer as part of HDInsight for monitoring Spark clusters." border="0" height="337" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/17c8e9d7-c7c9-4a67-881e-5c1130e86615.png" style="border: 0px currentcolor; border-image: none; display: inline; background-image: none;" title="" width="1024"></a></p>


  <h3>クラスター ログ</h3>


  <p>YARN ログ ファイルは HDInsight クラスターで使用できます。また、Apache Ambari の <a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-log-management#yarn-resourcemanager-ui">ResourceManager</a> ログ リンクを使用してアクセスできます。 クラスター ログの詳細については、HDInsight クラスターのログ <a href="https://docs.microsoft.com/azure/hdinsight/hdinsight-log-management"><em>の管理に関するドキュメントを参照してください</em></a><em>。</em></p>


  <h2>次の手順</h2>


  <p>このシリーズの&rsquo;他のブログを読んでいない場合は、以下で確認できます。</p>


  <ul>
   <li><a href="https://azure.microsoft.com/blog/monitoring-on-hdinsight-part-1-an-overview/" target="_blank">Azure HDInsight の監視 (パート 1): 概要</a></li>
   <li><a href="https://azure.microsoft.com/blog/monitoring-on-azure-hdinsight-part-2-cluster-health-and-availability/" target="_blank">Azure HDInsight の監視 (パート 2): クラスターの正常性と可用性</a></li>
   <li><a href="https://azure.microsoft.com/blog/monitoring-on-azure-hdinsight-part-3-performance-and-resource-utilization/">第 3 部Azure HDInsight監視: パフォーマンスとリソース使用率</a></li>
  </ul>


  <h2>概要Azure HDInsight</h2>


  <p>Azure HDInsightは、Apache Hadoop、Spark、Kafka などの一般的なオープン ソース フレームワークを簡単に実行できる、オープンソース分析用の簡単でコスト効率の高いエンタープライズ レベルのサービスです。 このサービスは、36 のリージョンと、Azure Governmentクラウドで利用できます。 Azure HDInsight、さまざまなセクターでミッション クリティカルなアプリケーションをサポートし、抽出、変換、読み込み (ETL)、ストリーミング、対話型クエリなど、幅広い用途を利用できます。</p>
