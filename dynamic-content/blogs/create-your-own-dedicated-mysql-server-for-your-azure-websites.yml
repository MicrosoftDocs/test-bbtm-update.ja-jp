### YamlMime:Yaml
ms.openlocfilehash: d39ee8ec5ee1716b0dfce8db6bd721bcb8d9a452
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139904884"
Slug: create-your-own-dedicated-mysql-server-for-your-azure-websites
Title: 'Azure Web サイト用の独自の専用 MySQL サーバーを作成する '
Summary: 'LAMP または WAMP アプリケーションで作業し、Azure でホストする場合、Azure Web サイトは、Azure でアプリケーションをホストするための最速かつ最も信頼性の高い方法です。 '
Content: "LAMP または WAMP アプリケーションで作業している場合、それを Azure でホストする場合、Azure Web サイトは、Azure でアプリケーションをホストするための最速かつ最も信頼性の高い方法です。 Azure Websites では PHP スタックがサポートされ、MySQL サーバーに対して次の 2 つの優れたオプションが提供されます。\n<ol>\n <li>Azure Store から ClearDB MySQL サービスを使用する</li>\n <li>Azure 仮想マシンを使用して独自の MySQL サーバーを設定する</li>\n</ol>\nAzure で実行されている MySQL サーバー仮想マシンを使用するシナリオが 2 つ考えられます。\n<ul>\n <li>MySQL の構成に関する特別な要件と、ストアの ClearDB サービス プランがニーズを満たしていない</li>\n <li>開発/テスト目的で MySQL サーバーを使用し、複数の開発/ステージング サイトに再利用する</li>\n</ul>\nMySQL サーバーをスピンアップする最も簡単な方法は、Azure 仮想マシンを使用する方法です。 これにより、柔軟なリソースが必要な場合に、独自のスケーラブルなコンピューティング インフラストラクチャを柔軟に作成できます。 Azure 管理ポータルを使用すると、わずか数分で、Windows ディストリビューションと Linux ディストリビューションの両方に対して新しい Azure 仮想マシンを簡単に作成できます。 この記事では、次の操作を実行する方法について説明します。\n<ul>\n <li>Azure VM 上に MySQL サーバーをWindowsする</li>\n <li>Linux Azure VM 上に MySQL サーバーを作成する</li>\n <li>MySQL サーバーに接続できる Azure Web サイトを作成する</li>\n</ul>\n&nbsp;\n<h2>Azure VM で MySQL サーバー Windows作成する</h2>\n<ol>\n <li>Azure アカウントを <a href=\"https://manage.windowsazure.com/\">使用管理ポータル</a> Azure にログインします。</li>\n <li>次の管理ポータルページの左下にある [+ 新規] をクリックし、[仮想マシン <b></b>] をクリックして <b></b>、[ <b>Quick Create]をクリックします。</b></li>\n <li>[仮想 <b>マシンの構成] ページで</b> 、次の情報を指定します。\n<ul>\n <li>windowsmyslsrv  <b>などの</b>仮想マシン <em>名を指定します</em></li>\n <li>新しい <b>ユーザー名 (</b><em>azureuser など) を指定する</em></li>\n <li>[新しい <b>パスワード] ボックス</b> に、「 <a href=\"https://msdn.microsoft.com/en-us/library/ms161962.aspx\">astrong password」と入力します</a>。</li>\n <li>[ <b>パスワードの確認] ボックス</b> に、パスワードを再入力します。</li>\n <li>ドロップダウン リストから <b>適切な</b>  [サイズ] を選択します。</li>\n <li>[ <b>Region/Affinity Group/Virtual Network</b> ] ボックスで、この仮想イメージがホストされるリージョンを選択します。<img class=\"alignnone size-full wp-image-180021\" alt=\"Create Windows Virtual Machine\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/img1.png\" width=\"1452\" height=\"658\" /></li>\n</ul>\n</li>\n</ol>\nこれで、Windows Server 2012 VM が作成されます。Windows VM <a title=\"に MySQL をインストールするには、この記事「Windows Azure VM に MySQL をインストールする」Azure VM\" href=\"https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-mysql-windows-server-2008r2/\" target=\"_blank\"> に MySQL をインストールするWindows確認してください</a>。 この記事では、Windows Server 2008 R2 について説明しますが、Azure 仮想マシンの Windows Server VM にも同じプロセスが適用されます。\n<h2>リモート アクセスの有効化</h2>\nMySQL サーバーでは、既定では \"root\" ユーザーへのリモート アクセスは許可されません。 これを有効にするには、ルート用の新しい HOST を作成し、root がどこからでもログインできる必要があります。\n<pre class=\"prettyprint\">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'root'@'%'\n&gt; IDENTIFIED BY 'password' WITH GRANT OPTION;\nmysql&gt; FLUSH PRIVILEGES;\nmysql&gt; exit</pre>\nMySQL サーバーが構成されたので、Azure VM のデータベース ホストWindowsが windowsmysqlsrv.cloudapp.net:3306<em>。</em>\n\nこの記事「Azure Web <a title=\" \" href=\"https://azure.microsoft.com/en-us/documentation/articles/web-sites-php-create-web-sites/\"> </a>サイトで PHP Web サイトを作成する方法」の説明に従って単純な PHP アプリケーションを作成する方法新しく作成した MySQL サーバーに Web サイトが接続できるのかテストするために MySQL サーバー VM 上のデータベースに接続しようとする <strong>index.php</strong> ファイルを使用して PHP Web サイトを作成する方法:\n<pre class=\"prettyprint\">&lt;?php\n// Create connection : Update the hostname , DB username , DB password \n//, database name. \n\n$con=mysqli_connect(\"windowsmysqlsrv.cloudapp.net:3306\",\"root\",\"root\",\n\"databasename\");\n\n// Check connection\nif (mysqli_connect_errno()) {\n    echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n}\nelse\n{\n    echo \"Connection with MySQL database was successful\";\n}\n?&gt;</pre>\n<strong>メモ：</strong> \"アクセスが拒否されました\" や \"Host 'xxx.xx.xxx.xxx' is not allowed to connect to this MySQL server\" のようなエラー メッセージが表示される場合は 、次の情報を確認します。\n<ul>\n <li>受信接続と送信接続の両方に対してポート 3306 のファイアウォールが開いている</li>\n <li>MySQL サーバーは、接続に使用しているユーザーのリモート接続を許可するように構成されています。 &lt;emmysql.host&gt;&lt;/em&gt; テーブルを確認して、ユーザーがホスト列の '%' ワイルドカードに関連付けられているか確認して、リモート IP を許可します。</li>\n</ul>\n<h2>Linux Azure VM 上に MySQL サーバーを作成する</h2>\n<ol>\n <li>Azure アカウントを <a href=\"https://manage.windowsazure.com/\">使用管理ポータル</a> Azure にログインします。</li>\n <li>Web ページ管理ポータル左下にある [+ 新規] をクリックし、[仮想マシン] を <b></b>クリックして、[ギャラリー <b></b>から] を <b>クリックします</b>。<img class=\"alignnone size-full wp-image-164231\" alt=\"Capture11\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture11.png\" width=\"1162\" height=\"500\" /></li>\n <li>[<b>プラットフォーム イメージ] から Ubuntu 仮想</b>マシン イメージを選択し、ページの右下にある次の矢印をクリックします。 <b></b><img class=\"alignnone size-full wp-image-164181\" alt=\"Capture2\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture2.png\" width=\"1013\" height=\"634\" /></li>\n <li>[仮想 <b>マシンの構成] ページで</b> 、次の情報を指定します。\n<ul>\n <li><em>linuxmysqlsrv などの仮想マシン名を指定します</em> <b></b></li>\n <li>仮想マシンには SSH キーまたはユーザー名/パスワード認証を使用できます。 このチュートリアルでは、ユーザー名/パスワードメソッドを使用します。 Sudoers  <b>リスト ファイルに</b>追加される <em>azureuser</em> などの新しいユーザー名を指定します。</li>\n <li>[新しい <b>パスワード] ボックス</b> に、「 <a href=\"https://msdn.microsoft.com/en-us/library/ms161962.aspx\">astrong password」と入力します</a>。</li>\n <li>[ <b>パスワードの確認] ボックス</b> に、パスワードを再入力します。</li>\n <li>ドロップダウン リストから <b>適切な</b>  [サイズ] を選択します。</li>\n <li>矢印をクリックして次へ進みます。<img class=\"alignnone size-full wp-image-164171\" alt=\"Capture3\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture3.png\" width=\"1013\" height=\"632\" /></li>\n</ul>\n</li>\n <li>[仮想 <b>マシン モード] ページで</b> 、次の情報を指定します。</li>\n</ol>\n<ul>\n <li>[ <b>Standalone 仮想マシン] を選択します</b>。</li>\n <li>[DNS  <b>名] ボックスに</b> 、有効な DNS アドレスを入力します。 たとえば、 <em>linuxmysqlsrv</em></li>\n <li>[ <b>Region/Affinity Group/Virtual Network</b> ] ボックスで、この仮想イメージがホストされるリージョンを選択します。次の矢印をクリックして続行します。<img class=\"alignnone size-full wp-image-164161\" alt=\"Capture4\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture4.png\" width=\"1264\" height=\"809\" /></li>\n</ul>\n<ol start=\"6\">\n <li>Azure によって仮想マシンの準備が行われるまで待ちます。</li>\n</ol>\n&nbsp;\n\n仮想マシンを作成したら、リモート接続するためにエンドポイントを構成する必要があります。 既定では、Azure インストーラーは、マシンに接続できるよう、パブリック ポート 22 に SSH エンドポイントを作成します。\n<h2>仮想マシンへの接続</h2>\n仮想マシンがプロビジョニングされ、エンドポイントが構成されている場合は、SSH (Linux) または PuttyPuTTY </a>\" href=\"https://www.putty.org/\" target=\"_blank\">(Windows) <a title=\"を使用して接続できます。\n\n<span style=\"font-size: 1.5em;\">SSH を使用した接続</span>\n\nLinux コンピューターを使用している場合は、SSH を使用して VM に接続します。 コマンド プロンプトで、次を実行します。\n<div>\n<pre class=\"prettyprint\"> ssh newuser@testlinuxvm.cloudapp.net -o ServerAliveInterval=180</pre>\n</div>\n仮想マシンへのアクセスを求めるメッセージが表示されたら、マシン ユーザーのパスワードを入力します。\n<h2>PuTTY を使用した接続</h2>\nコンピューターでコンピューターをWindows場合は、PuTTY を使用して VM に接続します。 PuTTY は、PuTTY ダウンロード ページからダウンロードできます。\n<ol>\n <li>ファイルをダウンロード <b>putty.exe</b> コンピューター上のディレクトリに保存します。 コマンド プロンプトを開き、そのフォルダーに移動して、 を実行<b>putty.exe</b>。</li>\n <li>[ホスト<em>名] linuxmysqlsrv.cloudapp.net</em> <b></b>  \"<em>22\"</em> を [ポート] に入力 <b>します</b>。</li>\n</ol>\n<img alt=\"Capture8\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/Capture8.png\" width=\"468\" height=\"450\" />\n<h2>仮想マシンを更新する</h2>\n仮想マシンに接続したら、必要に応じてシステムの更新プログラムと修正プログラムをインストールできます。 次を実行します。\n<pre class=\"prettyprint\"> sudo apt-get update</pre>\n<h2>Ubuntu に MySQL Server 5 をインストールする</h2>\nUbuntu への MySQL 5 Server のインストールは、迅速かつ簡単なプロセスです。 もっと難しくなるはずのように感じるでしょう。\n\nターミナル ウィンドウを開き、次のコマンドを使用します。\n<pre class=\"prettyprint\">sudo apt-get install mysql-server</pre>\nMySQL クライアントも必要なので、ターミナル ウィンドウで次のコマンドを実行します。\n<pre class=\"prettyprint\">sudo apt-get install mysql-client</pre>\nこれにより MySQL サーバーがインストールされ、サーバーの状態が確認され、次のコマンドが実行されます。\n<pre class=\"prettyprint\">sudo service mysql status</pre>\n<h2>SSH 接続を使用して MySQL に接続Tunnel</h2>\nSecure Shell (SSH) は、ローカル コンピューターとリモート コンピューターの間にセキュリティで保護されたチャネルを作成するために使用されます。 SSH は一般的に安全なターミナル アクセスとファイル転送に使用しますが、通常は暗号化されていない他のネットワーク接続を転送するために、コンピューター間にセキュリティで保護されたトンネルを作成するためにも使用できます。 SSH トンネルは、内部ネットワーク リソースへの外部アクセスを許可する場合にも役立ちます。 SSH によってローカル ポートが開き、そのポート経由のすべての通信がサーバーで実行されている MySQL にシームレスに転送されます。MySQL サーバーがローカル システムで実行されているような外観にします。\n\nUbuntu VM に SSH トンネルを作成するには、-L でコマンド ライン SSH コマンドを実行して、ローカル ポート転送を有効にします。\n<ul>\n <li>ポート 3306 を開くポートは既定では開かれません。そのため、リモート クライアントが MySQL サーバーに接続できるよう、最初にこのポートを開く必要があります。 次のコマンドを実行して TCP ポート 3306 を開きます</li>\n</ul>\n<pre class=\"prettyprint\">iptables -A INPUT -i eth0 -p tcp -m tcp --dport 3306 -j ACCEPT</pre>\n次に、次のコマンドを実行して、ポート 3306 が開いているか確認します。\n<pre class=\"prettyprint\">sudo netstat -anltp|grep :3306</pre>\n<ul>\n <li>ポート 3307 の SSH トンネルを作成する</li>\n</ul>\n<pre class=\"prettyprint\">sudo ssh -fNg -L 3307:127.0.0.1:3306 azurevmuser@servername</pre>\n<ul>\n <li>Azure 管理ポータルの VM のダッシュボードで、ポート 3307 のエンドポイントを作成します。 詳細については、「仮想マシンに <a title=\"エンドポイントを設定\" href=\"https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-set-up-endpoints/\">する方法仮想マシンにエンドポイントを追加する方法」を参照してください </a> 。これで、データベース ホスト<em> 名が linuxmysqlsrv.cloudapp.net:3307</em></li>\n</ul>\n<img class=\"alignnone size-full wp-image-180311\" alt=\"img3\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/img3.png\" width=\"1442\" height=\"944\" />\n\nリモート システムから MySQL への直接アクセスを有効にできます。これは MySQL サーバーに接続するための推奨されるソリューションでは<b></b>ないので、MySQL への直接アクセスを許可すると、攻撃者によってサーバーが侵害されるリスクが高いので、このチュートリアルでは説明しません。 既定では、MySQL ではセキュリティで保護された接続は使用されません。そのため、MySQL での SSL に関するページを参照してください。\n<h2>MySQL サーバーに接続できる PHP Web サイトを作成する</h2>\nAzure 管理ポータル で Web サイトを作成する場合は、クイック作成、データベースでの作成、ギャラリーからの 3 つのオプションがあります。 以下の手順では、[簡易作成] オプションについて説明します。 その他の 2 つのオプションの詳細については、「Azure Web サイトで PHP-MySQL を作成し、Git を使用してデプロイする」および「Azure のギャラリーから WordPress Web サイトを作成する」を参照してください。 ここでは、単純なサイトを作成し、データベース に接続するための単純な PHP スクリプトを追加する方法について説明します。\n\nこの <strong></strong>記事の説明に従って Azure Web サイト <a title=\"に単純な PHP アプリケーションを作成する Azure Web\" href=\"https://azure.microsoft.com/en-us/documentation/articles/web-sites-php-create-web-sites/\"> </a>   サイトで PHP Web サイトを作成する方法新しく作成した MySQL サーバー Linux VM 上のデータベースへの接続を試みる PHP Web サイトを作成する方法。\n<pre class=\"prettyprint\">&lt;?php\n// Create connection : Update the hostname , username , password \n//, database name. \n//Linux VM would be  linuxmysqlsrv.cloudapp.net:3307\n$con=mysqli_connect(\"linuxmysqlsrv.cloudapp.net:3307\",\"username\",\"password\",\n\"databasename\");\n\n// Check connection\nif (mysqli_connect_errno()) {\n    echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\n}\nelse\n{\n    echo \"Connection with MySQL database was successful\";\n}\n?&gt;</pre>\n&nbsp;\n<h2>まとめ</h2>\nAzure Websites で MySQL を使用する利点を得られるのは、DB サービスまたは Azure Virtual machines のクリアです。 データベースの要件を理解し、ニーズに合った最適なソリューションを選択します。"
