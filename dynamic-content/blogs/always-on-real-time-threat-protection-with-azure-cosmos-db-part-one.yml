### YamlMime:Yaml
ms.openlocfilehash: 617d07bdcc1d04f1fa2558d7713de69d63e92a16
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139903785"
Slug: always-on-real-time-threat-protection-with-azure-cosmos-db-part-one
Title: Azure Cosmos DB を使用した常時オンのリアルタイム脅威保護-パート1
Summary: advanced Threat Protection は、お客様のオンプレミスの Azure Active Directory 信号を使用して、高度な脅威、侵害された id、および悪意のある insider アクションを識別、検出、調査するクラウドベースのセキュリティサービスです。 Microsoft Azure します。
Content: >-
  <p><em>この2部構成のブログ記事は、実際のニーズを満たすために組織がどのように Azure Cosmos DB を使用しているか、およびそれに加えた違い &rsquo; について説明するシリーズの一部です。第1部では、Microsoft Azure Advanced Threat Protection チームが、Azure Cosmos DB を採用して再利用する方法 &rsquo; について説明します。<a href="https://azure.microsoft.com/en-us/blog/always-on-real-time-threat-protection-with-azure-cosmos-db-part-two/" target="_blank">第 2</a> &rsquo; 部では、チーム &rsquo; の取り組みによって得られる結果を確認します。</em></p>


  <h2>リアルタイムのセキュリティソリューションからクラウドスケールへの変換</h2>


  <p>高度な脅威保護はクラウドベースのセキュリティサービスで、オンプレミスの Azure Active Directory 信号を使用 &rsquo; して、高度な脅威、侵害された id、および悪意のある insider アクションを識別、検出、調査します。 Microsoft Azure 2018で開始された Microsoft Advanced Threat Analytics は、オンプレミスソリューションから Azure への進化を表します。 どちらのサービスも、次の2つの主要なコンポーネントで構成されています。</p>


  <ol>
   <li>エージェント (センサー)。組織 &rsquo; の各ドメインコントローラーにインストールされます。 センサーは、ドメインコントローラーによって生成された Windows イベントトレーシング (ETW) イベントと共に、ユーザーからドメインコントローラーに送信されたトラフィックを検査し、その情報を一元的なバックエンドに送信します。</li>
   <li>すべてのセンサーからの情報を集計し、組織 &rsquo; のユーザーとコンピューターの動作を学習し、悪意のあるアクティビティを示す異常を探す、一元化されたバックエンド (センター)。</li>
  </ol>


  <p>Advanced Threat Analytics &rsquo; center は、オンプレミスの MongoDB インスタンスをメインデータベース &mdash; として使用していますが、現在のところ、オンプレミスのインストールでも使用しています。 ただし、クラウド内の管理されたサービスである Azure Advanced Threat Protection センターを開発する場合、Microsoft では、より高いパフォーマンスと拡張性を必要としていました。 &ldquo;Azure Advanced Threat Protection のバックエンドは、大幅に拡張する必要があり、週単位でアップグレードする必要があります。また、継続的に進化する高度な検出アルゴリズム &mdash; を実行できます。基本的には、Azure が提供するすべてのパワーとインテリジェンス、 &rdquo; Yaron Hagai について、Microsoft の Advanced Threat Analytics のプリンシパルグループエンジニアリングマネージャーについて説明します。</p>


  <p>Azure Advanced Threat Protection に最適なデータベースを検索して、そのエンティティを格納し、各組織 &rsquo; のユーザーとコンピューター &mdash; Hagai &rsquo; s チームに関するすべてのセンサーからリアルタイムで学習したデータをプロファイル &mdash; すると、次の重要な要件がマップされます。</p>


  <ul>
   <li><strong>柔軟で、顧客ごとのスケーラビリティ:</strong> Azure Advanced Threat Protection を導入する各組織は、数百のセンサーをインストールでき、1秒あたり数万のイベントが生成される可能性があります。 各組織 &rsquo; のベースラインを学習し、その異常検出アルゴリズムをリアルタイムで適用するには、効率的かつコスト効率の高い方法でスケールできるデータベースが必要 Azure Advanced Threat Protection ます。</li>
   <li><strong>移行の容易さ:</strong> Azure Advanced Threat Protection データモデルは、検出ロジックの変更をサポートするために絶えず進化しています。 Hagai &rsquo; のチーム &rsquo; は、サービス &rsquo; のコードとそれを変化するデータモデルとの下位互換性を常に維持することを心配する必要がありませんでした。このようなデータベースを使用するには、ほぼすべての新しい更新プログラム Azure Advanced Threat Protection をデプロイした直後に、迅速かつ簡単なデータ移行をサポートできるデータベースが必要でした。</li>
   <li><strong>Geo レプリケーション:</strong> すべての Azure サービスと同様に、高度な脅威保護では、データセンターの障害が発生した場合など、重大なディザスターリカバリーとビジネス継続性のニーズに対応 &rsquo; する必要があります。 Geo レプリケーションを使用することにより、ユーザー &rsquo; のデータをプライマリデータセンターからバックアップデータセンターにレプリケートできます。また、プライマリデータセンターで障害が発生した場合に、Azure Advanced Threat Protection ワークロードをバックアップデータセンターに切り替えることができます。</li>
  </ul>


  <h2>クラウド内の管理されたスケーラブルなスキーマレスデータベース</h2>


  <p>チームは、Azure Advanced Threat Protection のバックエンドデータベースとして Azure Cosmos DB を選択しました。 &ldquo;Azure では、唯一の管理された &rdquo; スケーラブルなスキーマレスデータベースであるため、Azure Cosmos DB は Hagai です。 &ldquo;成長する顧客ベースをサポートするために必要なスケーラビリティと、その成長がバックエンドサービスにもたらす負荷が提供されています。 また、各組織とそのコンピューターおよびユーザーに格納するデータの観点から必要な柔軟性も提供されています。 また、新しい検出を継続的に追加し、既存の検出を変更するために必要な柔軟性が提供されています。そのため、Azure Cosmos DB コンテナーに格納されているデータを絶えず変更する機能が必要になります。&rdquo;</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/df089b93-20cf-4e7a-91c5-86db20701215.png"><img alt="Azure Advanced Threat Protection diagram" border="0" height="468" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/26f5efba-060f-47c9-9308-2f436924f276.png" style="border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;" title="Azure Advanced Threat Protection ダイアグラム" width="776"></a></p>


  <h3>コンテナーとパーティション分割</h3>


  <p><a href="https://www.azurecosmosdb.com/" target="_blank">Azure Cosmos DB</a>がサポートしている多くの api のうち、開発チームは、SQL api と MongoDB 用の Azure Cosmos DB api の両方を Azure Advanced Threat Protection に検討しています。 最終的には、SQL API を選択しました。これにより、グローバルリージョンでのマルチホーム機能をサポートする、Microsoft が作成した豊富なクライアント SDK にアクセスできるようになり、待機時間が短くなるように直接接続モードが実現しました。 開発者は、テナントまたは顧客ごとに1つの Azure Cosmos DB データベースを割り当てることを選択しました。 各データベースには5つのコンテナーがあり、それぞれが1つのパーティションで開始されます。 &ldquo;これにより、Azure Advanced Threat Protection &rdquo; の使用を停止した場合に、顧客のデータを簡単に削除できます。 Hagai について説明します。 &ldquo;さらに重要なのは、オンプレミスのセンサーによって生成されるスループットに基づいて、各顧客 &rsquo; のコンテナーを個別にスケーリングできることです。&rdquo;</p>


  <p>顧客ごとの一連のコンテナーのうち、2つは通常、複数のパーティションに拡張されます。</p>


  <ul>
   <li><em>UniqueEntity</em>。 Active Directory から同期された、組織内のコンピューターとユーザーに関するすべてのメタデータが含まれます。</li>
   <li><em>UniqueEntityProfile</em>には、UniqueEntity コンテナー内の各エンティティの動作のベースラインが含まれています。検出ロジックは、侵害されたユーザーまたはコンピューター、または悪意のある insider を暗示する動作の異常を識別するために使用されます。</li>
  </ul>


  <p>&ldquo;どちらのコンテナーにも、 <a href="https://docs.microsoft.com/en-ca/azure/cosmos-db/request-units" target="_blank">1 秒あたりの要求ユニット数 (RU/秒)</a> の消費量が非常に高い読み取り/書き込みスループットがあり、 &rdquo; Hagai について説明しています。 &ldquo;Azure Cosmos DB では、コンテナーの拡大に合わせてシームレスにストレージをスケールアウトします。また、大規模な顧客の中には、コンテナーあたりのサイズがテラバイトに拡張されています。これは、vm 上の MongoDB では実現できませんでした。&rdquo;</p>


  <p>各顧客の他の3つのコンテナーには、通常、1000未満のドキュメントが含まれており、1つのパーティションを超えて拡張されることはありません。 これには次のようなものがあります。</p>


  <ul>
   <li><em>Systemprofile</em>。テナントについて学習し、動作に基づく検出に適用されたデータを格納します。</li>
   <li><em>Systementity</em>。テナントに関する構成情報とデータが含まれています。</li>
   <li><em>アラート</em>。 Azure Advanced Threat Protection によって生成および更新されたアラートが含まれます。</li>
  </ul>


  <h3>移行</h3>


  <p>Azure Advanced Threat Protection 検出ロジックは絶えず進化し、改善されるため、各顧客 &rsquo; の UniqueEntityProfile コンテナーに動作データが格納されます。 古くなったスキーマとの下位互換性の必要性を回避するために、Azure Advanced Threat Protection は2つの移行メカニズムを保持しています。これは、データモデルに対する変更を含むサービスへの各アップグレードで実行されます。</p>


  <ul>
   <li><strong>オンザフライ:</strong>Azure Advanced Threat Protection が Azure Cosmos DB からドキュメントを読み取ると、そのバージョンフィールドがチェックされます。 バージョンが古くなっている場合、Azure Advanced Threat Protection は、開発者の Hagai &rsquo; s チームによって記述された明示的な変換ロジックを使用して、ドキュメントを現在のバージョンに移行します。</li>
   <li><strong>Batch:</strong> アップグレードが正常に完了すると、Azure Advanced Threat Protection は、スケジュールされたタスクを起動して、すべての顧客のすべてのドキュメントを最新バージョンに移行します。ただし、既に実行中のメカニズムによって移行されているものは除きます。</li>
  </ul>


  <p>これらの2つの移行メカニズムにより、サービスがアップグレードされ、データアクセス層コードが変更された後に、古いドキュメントを解析することによってエラーが発生することがなくなります。 明示的な移行コードだけでなく、後続のバージョンでは常に削除される、下位互換性コードは必要ありません。</p>


  <h3>エラスティックスケーリングと自動バックアップ</h3>


  <p>読み取り/書き込みスループットが非常に高いコンテナーは、c ontainer にプロビジョニングされ <a href="https://docs.microsoft.com/en-ca/azure/cosmos-db/set-throughput" target="_blank">た RU/秒の制限</a>に近づいたときに、レートが制限されることがよくあります。 サービス &rsquo; のノードの1つでは、各ノードが仮想マシンであり、コンテナーに対して操作を実行しようとし、429の<a href="https://docs.microsoft.com/en-us/rest/api/cosmos-db/http-status-codes-for-cosmosdb" target="_blank"> &ldquo; 要求 &rdquo; レート制限の例外</a>を取得します。これは、Azure Service Fabric リモート処理を使用して、スループットを向上させるために、一元化されたエラスティックスケーリングサービスを介して要求を送信します。 集中管理されたサービスは、複数のノードからのこのような要求を集計して、短時間のスループットの増加を回避します。これは、複数のノードに影響を与えるスループットの1つのバーストが原因で発生する可能性があるためです。 全体的な RU/秒のコストを最小限に抑えるために、同様の定期的なスケールダウンプロセスでは、お客様 &rsquo; の業務時間外など、必要に応じてプロビジョニングされたスループットを削減できます。</p>


  <p>Azure Advanced Threat Protection は、 <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/online-backup-and-restore" target="_blank">Azure Cosmos DB の自動バックアップ機能</a>を活用して、各コンテナーを保護します。 バックアップは、Azure Blob ストレージ内に存在し、geo 冗長ストレージ (GRS) を使用して別のリージョンにレプリケートされます。 また Azure Advanced Threat Protection は、顧客構成データを別のリージョンにレプリケートします。これにより、障害が発生した場合の迅速な回復が可能になります。 &ldquo;これは主にセンサー構成データ &mdash; を保護するために行います。これにより、元のデータベースが失われた場合に、IT 管理者が数百のセンサーを再構成する必要がなくなり、 &rdquo; Hagai について説明します。</p>


  <p>Azure Advanced Threat Protection 最近、完全な geo レプリケーションのオンボードが開始しました。 &ldquo;私たち &rsquo; は、geo レプリケーションと複数リージョンの書き込みを有効にし、他のリージョンへの実稼働データのシームレスで簡単なレプリケーションを実現しました (Hagai) &rdquo; 。 &ldquo;これにより、サービスの可用性の向上と保証が可能になり、サービスの配信が簡素化され、独自の高可用性メカニズムを維持する必要があります。&rdquo;</p>


  <p>Azure Cosmos DB の Azure Advanced Threat Protection チーム &rsquo; の実装の結果について説明した「<a href="https://azure.microsoft.com/en-us/blog/always-on-real-time-threat-protection-with-azure-cosmos-db-part-two/" target="_blank">パート 2</a>」に進みます。</p>
