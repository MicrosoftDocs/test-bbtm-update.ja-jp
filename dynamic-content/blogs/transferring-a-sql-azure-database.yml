### YamlMime:Yaml
ms.openlocfilehash: 4ea42b508e9ff9ff0d5c68ca8797e064f68050c6
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139896997"
Slug: transferring-a-sql-azure-database
Title: データベースのSQL Azure転送
Summary: '[この記事は、チームによってSQL Azureされました。]CREATE DATABASE を実行する宛先ユーザーの名前は、同じ名前である必要があります。そのため、元のブログ投稿は書き込SQL...'
Content: "<p>[この記事は、チームによってSQL Azureされました。]</p><p align=\"center\"><font color=\"#ff0000\">CREATE DATABASE を実行する宛先ユーザーは、ソース データベースの SQL Azure ポータル管理者名とまったく同じ名前である必要があります。つまり、SQL Azure ポータルの管理者名とパスワードを知っているデータベースからのみコピーできる必要があります。別のブログ記事で、2 つの異なるパーティ間でSQL Azureデータベースを転送する方法に関するこのトピックを見直します。</font></p> <div style=\"text-decoration: line-through\">   <p>Imagine独立系ソフトウェア ベンダー (ISV) であり、Windows Azure アプリケーションの購入者を持ち、スターター データベースのコピーを顧客に転送する必要がある場合。 ただし、ポータルから管理ログインとパスワードを指定SQL Azureはありません。 または、テスト チームが実稼働データベースをサービス アカウントにコピーできる必要がある場合があります。 別の SQL Azure サーバー上の別のサービス アカウントにデータベースをコピーするには、データベースを転送する権限を持つ共通ユーザーを作成します。 このブログ記事では、そのユーザーを作成して転送を完了する方法について説明します。</p>    <h2>[同期元サーバー]</h2>    <p>SQL Azure Portal からソース サーバー管理者としてソース サーバーの master データベースに接続すると、このステートメントを実行して、ソース サーバーにログインを作成します。</p>    <pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> LOGIN copylogin <span class=\"kwrd\">WITH</span> password=<span class=\"str\">'1231!#ASDF!a'</span>;</pre>          <p>次に、ソース データベースに接続するために接続を変更し、次のステートメントを実行します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> <span class=\"kwrd\">USER</span> copyuser <span class=\"kwrd\">FROM</span> LOGIN copylogin;</pre>          <p>ソース データベースからコピーするには、ユーザーがアクセス許可を持っている必要db_owner<b></b>があります。 ソース データベースへの接続中にこれらのアクセス許可を付与するには、次のコマンドを実行します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">EXEC</span> sp_addrolemember <span class=\"str\">'db_owner'</span>, <span class=\"str\">'copyuser'</span>;</pre>          <h4>[同期先サーバー]</h4>      <p>ISV がマシンに新しいアカウントを確立したので、転送先サーバーで同じアカウントを確立できるよう、ログイン、パスワード、データ センターを購入者に伝える必要があります。 コピー先サーバーは、ソース サーバーと同じデータ センターにある必要があります。 ログインとパスワードが同じ場合にのみ、データベースのコピーが機能します。 購入者が行う必要がある操作を次に示します。</p>      <p>SQL Azure Portal から管理者として転送先サーバーの master データベースに接続した場合は、このステートメントを実行して、宛先サーバーにログインを作成します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> LOGIN copylogin <span class=\"kwrd\">WITH</span> password=<span class=\"str\">'1231!#ASDF!a'</span>;</pre>          <p>次に、次のステートメントを実行して、master データベースに接続している間にユーザーを作成します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> <span class=\"kwrd\">USER</span> copyuser <span class=\"kwrd\">FROM</span> LOGIN copylogin;</pre>          <p>次に、宛先サーバー <b>に対する dbmanager</b> アクセス許可をユーザーに付与します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">EXEC</span> sp_addrolemember <span class=\"str\">'dbmanager'</span>, <span class=\"str\">'copyuser'</span>;</pre>          <p>これで <b>、データベースを</b> このサーバーにコピーする copyuser が設定されます。</p>      <h4>コピーの実行</h4>      <p>コピーを実行するために、購入者は、コピー先サーバーの master データベースに <b>copylogin</b> としてログインSQL Azure。 次に、購入者は次のステートメントを実行します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">CREATE</span> <span class=\"kwrd\">DATABASE</span> [AdventureWorksLTAZ2008R2] <span class=\"kwrd\">AS</span> COPY <span class=\"kwrd\">OF</span> [srcServer].[AdventureWorksLTAZ2008R2]</pre>          <p>データベース名とソース サーバーが正しく入力されている。 その後、購入者は次のようなクエリを実行して <b>sys.dm_database_copies監視できます</b> 。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">SELECT</span> * <span class=\"kwrd\">FROM</span> sys.dm_database_copies</pre>          <h4>クリーンアップ</h4>      <p>データベースのコピーが完了したら、購入者はデータベースをセキュリティで保護するために <b>、データベースから copyuser</b> ユーザーを削除する必要があります。 これは、ISV がログイン/パスワードを知っているという理由で行われます。 ユーザーを削除するには、ポータルから管理者ログインを使用して、コピー先データベースでこの接続SQL Azureします。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">DROP</span> <span class=\"kwrd\">USER</span> copyuser</pre>          <p>次に、管理者ログインを使用して宛先サーバーの master データベースに接続し、次のコマンドを実行します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">DROP</span> LOGIN copylogin</pre>          <p>ISV は、購入者が適切なコピーを持っている場合に、ソース サーバー上のデータベースを削除できます。 ISV コンピューターをセキュリティで保護するために、ISV はソース サーバー上の master データベースに接続し、次のステートメントを実行します。</p>      <pre class=\"csharpcode\"><span class=\"kwrd\">DROP</span> LOGIN copylogin</pre>          <h2>ソース データベースの保護</h2>      <p>上記の戦略には 1 つの欠陥があります。あなたは、データベースに対するアクセス許可を <b>db_ownerを購入者</b> に付与しました。 この問題は、データベースを削除したり、データベースをコピーする代わりに他の問題を引き起こしたりする可能性があるという問題です。 代わりに、元のデータベースのコピーをサーバーに作成し、 <b>copylogin</b> login <b>db_owner</b> に元のデータベースのコピーに対するアクセス許可を付与する方が良いです。 これにより元のデータが保護され、購入者がコピーに損害を与える場合でも、元のデータは引き続き保持されます。</p>  </div>    <h2>まとめ</h2>    <p>質問、懸念事項、コメントはありますか? 以下に投稿すると、対処を試みることができます。</p>"
