### YamlMime:Yaml
ms.openlocfilehash: 7779b5a85bce9d7a54c7d2f6a176d059f44fa40b
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139892055"
Slug: sub-clipping-and-live-archive-extraction-with-media-encoder-standard
Title: Media Encoder Standard を使用した Sub-Clipping とライブアーカイブの抽出
Summary: フレーム正確なハイライトの生成、MP4 ファイルへのアーカイブ、Media Encoder Standard の使用など、ライブストリームに対する編集操作を実行します。
Content: >-
  <p>ライブストリーミングを行っているすべてのお客様は、イベントの発生中または実行後にライブストリームを編集できるようにするように求められています。 サブクリップの作成と、その後の配信のためにイベント全体の ISO MP4 アーカイブを作成するように求められます。</p>


  <p>現在、このような編集操作をライブストリームで実行するために Media Encoder Standard を使用できるようになりました。 このブログ投稿では、Azure Media Services Explorer (amse) を使用してこれを簡単に実現する方法について説明します。</p>


  <h1>作業の開始</h1>


  <p>作業を開始するには、次の手順に従います。</p>


  <ol>
   <li>最新 (3.28 またはそれ以降) の<a href="https://aka.ms/amse">Azure Media Services エクスプローラー</a> (amse) ツールをインストールします。</li>
   <li>Azure Media Service アカウントを使用してチャネルを作成し、ライブイベントに関連付けられたプログラムを作成します。 ヒントについては、 <a href="https://azure.microsoft.com/en-us/documentation/articles/media-services-manage-live-encoder-enabled-channels/#channels-programs" target="_blank">ライブストリーミングの概要</a> に関するトピックをご覧ください。</li>
   <li>レンダリングされた <a href="https://azure.microsoft.com/en-us/blog/dynamic-manifests-and-rendered-sub-clips/" target="_blank">サブクリップ</a> の概念を理解します。</li>
  </ol>


  <p>また、ツールと機能について理解を深めるために、中程度の期間 (数十分から数時間) のプログラムから始めることをお勧めします。</p>


  <h1>上位ビットレートのアーカイブ</h1>


  <p>これは最も簡単なシナリオで、最大ビットレートのビデオと最高ビットレートのオーディオを取得し、フルプログラムに対して単一ビットレートの ISO MP4 ファイルを生成します。 手順は次のとおりです。</p>


  <ol>
   <li>AMSE を起動します。</li>
   <li>[アセット] タブで、プログラムを表す資産を参照します。</li>
   <li>その資産を選択し、Alt + R キーを押します。</li>
   <li>[ &ldquo; ライブストリーム/アーカイブサブクリップ &rdquo; ] ダイアログがポップアップ表示されます。</li>
   <li>既定のオプション &ldquo; [アーカイブの上位ビットレート &rdquo; ] を選択し、[サブクリップのヒット &ldquo; ] を選択します。&rdquo;</li>
   <li>amse は、適切な構成を使用して Media Encoder Standard するためのエンコードタスクを送信します。</li>
  </ol>


  <p><img alt="Archive Top Bitrate" border="0" height="795" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/57cbf94d-4024-42f7-83c6-e15a3ccd8478.png" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; display: block; padding-right: 0px; border-image: none" title="上位ビットレートのアーカイブ" width="917"></p>


  <p>AMSE で [ジョブ] タブにアクセスし、送信されたジョブを選択してダブルクリックすると、[ジョブ情報] ウィンドウが開きます。 [タスク] タブにアクセスし、[構成] を選択して、このエンコードタスクの XML 構成を確認します。</p>


  <h1><img alt="Task Configuration XML for Archiving Top Bitrate" border="0" height="593" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3cee48a9-f08c-4796-90db-58b5cff579de.png" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; display: block; padding-right: 0px; border-image: none" title="上位ビットレートをアーカイブするためのタスク構成 XML" width="786"></h1>


  <p>VideoStream と AudioStream 要素が特別な値で &ldquo; ある topbitrate レート &rdquo; に設定されていることに注意してください。これは、処理する最高品質のビデオとオーディオをエンコーダーに対して選択するように指示します。 Encoding セクションでは、エンコーダーにソースビデオとオーディオ (CopyVideo 要素と Copyvideo 要素) をコピーするように指示されます。 その結果、エンコーダーはビデオとオーディオのすべてのフラグメントを読み取り、オーディオビデオインターリーブ ISO MP4 ファイルに再パッケージ化するだけです。</p>


  <p>ジョブが完了すると、出力には ISO MP4 ファイルが含まれます。</p>


  <h1>GOP/フラグメント境界での上位ビットレートのトリミング</h1>


  <p>このシナリオは、前の例を拡張したものです。ここでは、最高ビットレートのビデオと最高ビットレートのオーディオの一部を取得し、選択したサブクリップに対し &nbsp; て単一ビットレートの ISO MP4 ファイルを生成します。 <a href="https://azure.microsoft.com/en-us/blog/dynamic-manifests-and-rendered-sub-clips/" target="_blank">前に説明</a>したように、編集のイン/アウトポイントが GOP またはフラグメントの境界と共にアップする場合は、アーカイブされたフラグメントをオーディオビデオインターリーブ ISO MP4 ファイルに再パッケージ化するだけで Media Encoder Standard 必要があります。 手順は次のとおりです。</p>


  <ol>
   <li>AMSE を起動します。</li>
   <li>[アセット] タブで、プログラムを表す資産を参照します。</li>
   <li>その資産を選択し、Alt + R キーを押します。</li>
   <li>[ &ldquo; ライブストリーム/アーカイブサブクリップ &rdquo; ] ダイアログがポップアップ表示されます。</li>
   <li>既定のオプションで &ldquo; ある [上位ビットレート &rdquo; をアーカイブする] を選択し、[ライブアーカイブ/ストリームのトリミング (GOP 精度) &rdquo; ] チェック &ldquo; ボックスをオンにします。 アセットの再生は既定で選択されているため、AMSE は Azure Media Player を使用してウィンドウ内のライブストリームを再生します。</li>
   <li>再生コントロールを使用して、関心のある部分のおおよその開始/終了を特定します。</li>
   <li>次に、[開始 &rdquo; 時刻] と &ldquo; [終了時刻 &rdquo; ] の &ldquo; スライダーをタイムライン上の位置に移動します。これにより、開始時刻が目的のクリップの開始位置または終了時刻になり、終了時刻が目的のクリップの末尾または末尾になります。 開始時間と終了時間の値は、フラグメントの継続時間単位でインクリメントされることに注意してください。 次のスクリーンショットでは、関心のある最初のフレームはビデオに2分24秒から始まりますが、サブクリップタスクの開始時刻は 2min 23.10 秒に設定されています。</li>
   <li>必要に応じてスライダーを調整したら、[サブクリップ &rdquo; ] &ldquo; をクリックして、エンコードタスクを開始します。 ジョブが完了すると、出力資産には、サブクリップに対応する ISO MP4 ファイルが含まれます。</li>
  </ol>


  <p><img alt="Sub-Clip Top Bitrate" border="0" height="795" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/ec8c6c16-22b5-4cb3-9388-708b4be6e768.png" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; display: block; padding-right: 0px; border-image: none" title="Sub-Clip トップビットレート" width="917"></p>


  <p>AMSE の [ジョブ情報] ページを開いてタスク構成 XML を確認すると、AMSE によって StartTime 属性と Duration 属性が Source 要素に追加されていることが確認できます。</p>


  <p>Source StartTime = &quot; p16682dt17h23m 39.0666668 s &quot; Duration = &quot; pt 25.758 s &quot; .</p>


  <p>AMSE は、サブクリップのイン/アウトポイントを適切な値に変換します。 詳細に関する詳細情報が必要な場合は、AMSE のソースコードを参照してください。</p>


  <ol><!--EndFragment-->

  </ol>


  <h1>すべてのビットレートをアーカイブする</h1>


  <p>これは、最初のセクションの拡張機能です。このセクションでは、入力したライブアセットに存在するすべてのビデオビットレートとすべてのオーディオビットレートを、要求時資産に含めることができます。 このオプションは、ほとんど必要ありません。すべてのニーズに対応するために、元の資産で十分です。 この機能は、完全を期すために実装されています。</p>


  <p>[ライブストリーム/アーカイブサブクリップ &rdquo; ] ダイアログボックスで、エンコードタスクを送信する前に [すべての &ldquo; ビットレート &rdquo; をアーカイブする] オプションを選択 &ldquo; できます。 タスク構成 XML を表示すると、videostream と audiostream 要素が特別な値 &ldquo; * &rdquo; に設定され、エンコーダーがすべてのビットレートを処理するように指示されます。</p>


  <p>タスクが完了すると、出力には一連の ISO MP4 ファイルが含まれます。 ライブストリームの各ビデオビットレートは、すべての MP4 ファイルを生成するために、すべてのオーディオビットレートとインターリーブされます。 出力資産には、いわゆるマニフェストファイル (*) も含まれます。ISM) を使用して動的パッケージングを行う場合。</p>


  <h1>GOP/フラグメントの境界でライブアセットをトリミングする</h1>


  <p>このシナリオは2番目のシナリオの拡張であり、ライブストリームの一部を抽出し、ストリーミング可能な新しいオンデマンド資産を作成します。 <a href="https://azure.microsoft.com/en-us/blog/dynamic-manifests-and-rendered-sub-clips/" target="_blank">既に説明</a>したように、この方法の利点は、サブクリップが切り取ったストリームから独立したライフサイクルを持つことができ、独自のセキュリティプロパティを持つことができることです。 たとえば、完全なイベントはアクセスが制御されている場合がありますが、サブクリップはクリアされている可能性があります。</p>


  <p>これを実行する手順は簡単です。 [archive All ビットレート &rdquo; ] \ (すべてアーカイブする \) オプションを選択 &ldquo; し、[ライブアーカイブ/ストリーム (GOP の正確) &rdquo; をトリミングする] チェック &ldquo; ボックスをオンにして、2番目のセクションの説明に従って開始時刻と終了時刻のコントロールをアクティブにします。 前のシナリオと同様に、タスクが完了すると、出力資産にはマニフェスト (*) と共に一連の ISO MP4 ファイルが含まれます。ISM) ファイル。</p>


  <h1>レンダリングされた Frame-Accurate Sub-Clips</h1>


  <p>上記のすべてのシナリオでは、サブクリッピング操作のイン/アウトポイントは、GOP またはフラグメントの境界に制限されていました。 代わりに、ライブストリームの一部を正確にフレーム単位で編集する必要がある場合は、いわゆる表示 Sub-Clip 機能を使用します。 ここで、エンコーダーは上位ビットレートストリームを取得し、指定されたビットレートと解像度に再エンコード ( &ldquo; レンダリング &rdquo; ) します。</p>


  <p>この機能を使用するには、 &ldquo; 前に説明したように [ライブストリーム/アーカイブサブクリップ &rdquo; ] ダイアログを表示し、[上位ビットレート &rdquo; を再エンコードする] オプションを選択 &ldquo; します。 [ライブアーカイブ/ストリーム (GOP 精度) &rdquo; をトリミングする] チェック &ldquo; ボックスをオンにして、開始時刻と終了時刻のコントロールをアクティブにします。 当然ながら、フレームの正確な操作を実行するため、開始時刻と終了時刻を自由に編集できます。</p>


  <p><strong>注:</strong> AMSE のバージョン2.38 リリースの時点で、ライブストリームフレームフレームを使用してインおよび out ポイントを指定することはできません。 この操作をサポートする他のツールに取り組んでいます。 このようなツールが必要な場合は、にご連絡ください。 <a href="mailto:amslived@microsoft.com">amslived@microsoft.com</a></p>


  <p><img alt="Rendered Sub-Clip Selection" border="0" height="795" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c0036cf5-f5b0-44b0-9bd4-ea272ff1a7f6.png" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; display: block; padding-right: 0px; border-image: none" title="表示 Sub-Clip 選択" width="917"></p>


  <p>これ &ldquo; で、[サブクリップ &hellip; &rdquo; ] ボタンをクリックすると、[通常の Media Encoder Standard] ダイアログボックスが開き、エンコード設定を指定できます。 例として H264 マルチビットレート 720p &rdquo; プリセットを選択 &ldquo; し、必要に応じて値を更新できます。 プリセットの詳細については、microsoft の <a href="https://go.microsoft.com/fwlink/?linkid=618336&amp;clcid=0x409" target="_blank">ドキュメント</a>を参照してください。</p>


  <p><img alt="Encode Options for Rendered Sub-Clip" border="0" height="593" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/fb2aaf65-9c17-4886-be93-8aa6c916ede8.png" style="background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin: 0px auto; display: block; padding-right: 0px; border-image: none" title="レンダリングされた Sub-Clip のエンコードオプション" width="786"></p>


  <p>前のシナリオと同様に、タスクが完了すると、出力資産にはマニフェスト (*) と共に一連の ISO MP4 ファイルが含まれます。ISM) ファイル。</p>


  <h1>の既知の問題</h1>


  <p>この機能に関する既知の問題の一部を次に示します。</p>


  <ol>
   <li>Media Encoder Standard は、ライブストリームが &lsquo; クリーンであることを前提としています。 &rsquo;つまり、すべてのフラグメントが受信され、アーカイブされています。 ネットワークの停止などが原因で一部のフラグメントが削除された場合、エンコーダーはギャップを処理する適切なジョブを実行しません。 出力ビデオでは、ビデオやオーディオの位置がずれている場合があります。</li>
   <li>現在のリリースでは、特定のオーディオトラックを選択することはできません。 たとえば、複数の言語オーディオトラックを持つライブストリームでを送信する場合、すべてのサブクリップのタスクは、すべてのオーディオトラックの処理を終了します。</li>
   <li>タスクが送信されてから、Media Encoder Standard がこのタスクの処理を実際に開始するまでの間に遅延が発生することに注意してください。 このラグは変数です。 ライブ &rsquo; アセットで &lsquo; この機能を使用している場合は、エンコーダーが作業 &ndash; を行っているときに、タイムスタンプが DVR ウィンドウから落下するときに、タイムスタンプ &lsquo; が有効 &rsquo; である必要があります。</li>
  </ol>
