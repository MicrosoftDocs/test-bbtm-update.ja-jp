### YamlMime:Yaml
ms.openlocfilehash: 049064b849ba62d4432e919dbc9f8624cd1574ec
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139904703"
Slug: leverage-azure-security-center-to-detect-when-compromised-linux-machines-attack
Title: 'Azure Security Center を活用して、侵害された Linux マシンの攻撃を検出する '
Summary: 攻撃者がコンピューターを侵害すると、通常は目標が考慮されます。 攻撃者によっては、対象となるコンピューターに存在する情報を探している場合や、対象となるネットワーク上の他のコンピューターへのアクセスを探している場合があります。 それ以外の場合、攻撃者はコンピューター自体の処理能力を使用したり、他の攻撃のための起動ポイントとしてコンピューターを使用したりすることを計画しています。
Content: "<p>攻撃者がコンピューターを侵害すると、通常は目標が考慮されます。 攻撃者によっては、 &rsquo; 対象となるコンピューターにある情報を探している場合や、 &rsquo; 対象ネットワーク上の他のコンピューターへのアクセスを探している場合があります。 それ以外の場合、攻撃者はコンピューター自体の処理能力を使用したり、他の攻撃のための起動ポイントとしてコンピューターを使用したりすることを計画しています。 Microsoft Azure の Linux 仮想マシン (VM) では、多くの場合、攻撃者が cryptocompare マイニングソフトウェアをインストールして実行していることがよくあります。 このブログ投稿では、攻撃者が侵害されたコンピューターを他の攻撃のための起動ポイントとして使用する場合に焦点を当てています。</p>\n\n<p><a href=\"https://azure.microsoft.com/en-us/services/security-center/\" target=\"_blank\">Azure Security Center</a> (ASC) は、Linux の複数の <a href=\"https://github.com/Microsoft/OMS-Agent-for-Linux#supported-linux-operating-systems\" target=\"_blank\">ディストリビューション</a> で実行されるエージェントを利用します。 Auditd が有効になっている場合は、プロセス作成イベントを含むログが収集されます。 これらは検出パイプラインを通じて実行され、悪意のある、疑わしいアクティビティを探します。 アラートは、ASC ポータルを通じて表示されます。</p>\n\n<p>Microsoft Threat 知能センターでは、高度なハイブリッド Linux honeypot サービスを含む新しい脅威を特定するために、さまざまな方法を使用しています。 Honeypot はおとりシステムであり、攻撃を受けるように設定されています。</p>\n\n<p>この投稿では、honeypot に対する攻撃が、お客様のコンピューター内の Ip から行われた最近のインスタンスについて説明します。 いずれの場合も、侵害された顧客 Vm の悪意のある動作により、Azure Security Center によってアラートが生成されました。 これらの攻撃を分析することで、攻撃者 &rsquo; の行動に対する洞察を得ることができます。 これにより、さらなる検出開発が実現し、より多くの攻撃行動を顧客に提供し、エンドツーエンドの攻撃をより完全に確認できるようになりました。</p>\n\n<h2>最初の侵入</h2>\n\n<p>次の図は、攻撃のセットアップを示しています。 この分析によって、既定のパスワードを持つ Apache Cassandra アカウントが、最初に Azure VM を侵害するために使用されたことがわかります。 アクセスが得られると、攻撃は honeypot (1) とその他のターゲット (2) にアプローチします。 攻撃者がこの VM にログインするために使用した2つの IP アドレス (3、4) を確認しました。そのうちの1つは、honeypot (5) を攻撃したものです。 もう1つのそこは、攻撃者が同じ最初の2つのオクテットを共有し、ルーマニアに解決した2つの Ip アドレスです。 この事実については後で説明します。</p>\n\n<p><br>\n<a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/a0e205ec-c338-4eda-ac43-f0920cc89d01.png\"><img alt=\"Connections\" border=\"0\" height=\"306\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/78e80717-6ba1-4802-b386-ef437fd36bb7.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"数\" width=\"607\"></a></p>\n\n<h2>侵入の内訳</h2>\n\n<p>お客様の仮想マシンに対してよく見られる攻撃の1つは、ブルートフォース攻撃またはパスワードスプレー攻撃です。これに <a href=\"https://azure.microsoft.com/en-us/blog/how-azure-security-center-helps-detect-attacks-against-your-linux-machines/\" target=\"_blank\">より</a> 、暗号化コインマイニングマルウェアのインストールが迅速に実行されます。 この場合、悪意のあるユーザーが少し異なる操作を行っていました。</p>\n\n<h3>ホスト列挙型</h3>\n\n<p>最初のセキュリティ侵害の後、攻撃者は、いくつかの列挙をホストし、テストスクリプトを高速化する、ドメイン nasapaul.com から perl ベースのホスト列挙スクリプトを取得します。 この動作は、既知の悪意のあるソース &rdquo; アラートからの検出されたファイルのダウンロードに &ldquo; よって Azure Security Center ます。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/31b58859-fddd-43fe-bf18-40f28dea0437.png\"><img alt=\"Download Source\" border=\"0\" height=\"408\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/beaec564-af69-4e4d-a8ac-54c41e2669f8.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"ダウンロード元\" width=\"512\"></a></p>\n\n<p>このスクリプトは、<strong> /proc/cpuinfo</strong> ファイル内の特定の情報を検索して、攻撃者がどの種類のマシンを使用しているかを理解できるようにします。 次のテキストボックスで実行されているコマンドがいくつか表示されます。 同じスクリプトが、nasapaul.com が提供するサービスである速度テストも実行します。</p>\n\n<pre>\nCPU=$(grep &ndash;m 1 &ldquo;model name&rdquo; /proc/cpuinfo | cut &ndash;d: &ndash;f2 | sed-e &lsquo;s/^ */ /&rsquo; |sed &ndash;e &lsquo;s/$/ / &lsquo;)\n\nCPUS=$ (grep &ndash;c ^processor /proc/cpuinfo)\n\nSTEP=$ (grep &ndash;m 1 &ldquo;stepping&rdquo; /proc/cpuinfo | cut &ndash;d: &ndash;f2 | sed &ndash;e &lsquo;s/^ */ / &lsquo; | sed &ndash;e &lsquo;s/$/ / &lsquo;) \n\nBOGO=$ (grep &ndash;m 1 &ldquo;stepping&rdquo; /proc/cpuinfo | cut &ndash;d: &ndash;f2 | sed &ndash;e &lsquo;s/^ */ / &lsquo; | sed &ndash;e &lsquo;s/$/ / &lsquo;)\n\nOS=$ (lsb_release &ndash;si)\n\nram=$ (free &ndash;m | grep &ndash;oP &lsquo;\\d+&rsquo; | head &ndash;n 1)\n\nVER=$ (uname &ndash;a)\n\nuptime=$ (&lt;/proc/uptime)\n\nuptime=$ {uptime%%. *} bold=$ (tput bold)\n\nzile=$ ( ( uptime%60 ( )\n\nsecunde=$ ( ( uptime%60 ) )\n\nminute=$ ( ( uptime/60%60 ) )\n\nore=$ ( ( uptime/60/60%24 ) )\n\nvid=$ (lspci | grep VGA |cut -f5- -d &lsquo; &lsquo;)\n\nDISK=$ (df &ndash;h --total | grep total |awk &lsquo; {printf &ldquo;&rdquo; $2 &ldquo;B\\n\\n&rdquo; } &lsquo; )</pre>\n\n<h2>最初の悪用</h2>\n\n<p>このセッションは終了しましたが、攻撃者が新しいセッションを開始し、セキュリティで保護された FTP サーバーへの接続を作成して、いくつかのファイルを取り出しました。 次に、実行するファイルを変更しました。</p>\n\n<pre>\nchmod +x 1 cyberinfo cybernetikrandom go h4e petarda port pscan2 screen speedtestvps.py sshd</pre>\n\n<p>この一連のファイルは、既知のハッキンググループのツールキットです。 攻撃者は、[ &rdquo; ファイル] を使用 &ldquo; して、2つの異なるクラス B IP 範囲に対して pscan2 &rdquo; と &ldquo; sshd &rdquo; を実行 &ldquo; します。 つまり、65000アドレスを超えてスキャンを実行したことになります。 また、h4e &rdquo; は、サービス拒否攻撃で使用される perl スクリプトであることを調査したツール &ldquo; を使用しました。 テキストファイル &ldquo; のポート &rdquo; には、スキャンの結果が保持されます。通常は、リッスンしていた ip や、開いていたポートなどがあります。 &rsquo;これらのコマンドが正常に完了したかどうかは明らかではありませんが、2時間後に攻撃者がそれらをすべて削除し、別のキットを取り出しました。</p>\n\n<h2>パスワード スプレー</h2>\n\n<p>今回は、攻撃者が Wget を使用して、公開された web サイトからツールキットを取得します。 以前と同様に、ツールを取得し、すべてを実行するために変更しました。</p>\n\n<pre>\nchmod +x a all classes co gasite.txt hu pass range scan.log ssh2 x\n\n/bin/bash ./a ##.49\n./ssh2 1500 -b ##.49 pass 22 &quot;uname -a &amp; lscpu&quot;\n/bin/bash ./a ###.66\n./ssh2 1500 -b ###.66 pass 22 &quot;uname -a &amp; lscpu&quot;\nnano gasite.txt</pre>\n\n<p>その後、同じ単純なパターンがクラス B の複数の範囲に対して繰り返されます。 ファイル &ldquo; a &rdquo; は、クラス B 範囲の最初の2つのオクテットを入力として受け取り、次に ssh2 &rdquo; を呼び出し &ldquo; ます。 &ldquo;ssh2 &rdquo; は、多数のスレッド、範囲、パスワードファイル ( &ldquo; この例では、35000のユーザー/パスワードの組み合わせを含むパス &rdquo; )、ポート番号、実行する最初のコマンドを入力します。 出力を収集gasite.txt&rdquo; ファイル &ldquo; 。</p>\n\n<p>後で、classes フォルダーで &ldquo; 使用されるファイル &ldquo; co &rdquo; および &ldquo; range &rdquo; が表示されます。 &rdquo; &ldquo;Classes &rdquo; フォルダーには、26個のクラウドとホスティング企業の IP 範囲が含まれています。 Microsoft は、他のすべての主要なプロバイダーと共に提供されています。 ファイル &ldquo; の co &rdquo; と &ldquo; range &rdquo; は、最初の2つのオクテットを完全な IP に拡張するだけです。</p>\n\n<p>攻撃者 &rsquo; は、files &ldquo; all &rdquo; 、 &ldquo; hu &rdquo; 、または &ldquo; x &rdquo; を実行しようとしていませんが、ip 範囲を構成する必要があります。特に、ip の4つのオクテットを完全に入力する必要があります。 Ssh2 &rdquo; の &ldquo; 実行可能ファイルで使用される可能性があります。</p>\n\n<p>ツールキットの分析には、いくつかの労力がかかっていました。 出力ファイル名 &ldquo;gasite.txt&rdquo; はfound.txt&rdquo; &ldquo; に &ldquo; 変換され、SSH2 &rdquo; ファイルは、upx を使用してパックまたは難読化されたカスタムルーマニア版の ssh スキャナーです。 アンパックされると、ルーマニア語の文字列が使用されます (下図を参照)。 Red team によるその他の調査では、元の ssh2 ソースコードを追跡し、攻撃者または同じ実行可能ファイルを使用する他のユーザーがコードに関するヘルプを表示していました。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/98eaf4ef-3eb7-458c-aa3b-db90ef1cd5f6.png\"><img alt=\"strings\" border=\"0\" height=\"526\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/4c9d4fe4-6e36-4375-a976-f95a4748fb43.png\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"strings\" width=\"512\"></a></p>\n\n<h2>結果: Azure Security Center での強化された行動分析</h2>\n\n<p>侵入を調査している間に、新しい分析に含めたり、既存の分析を改善したりするために、多数の一意の Ttp を引き出すことができました。 パスワードスプレーの検出の向上や、攻撃者のホスト列挙のカバレッジの向上などが明らかになりました。 また、既存の分析が期待どおりに発生したことを検証することもできました。 目標 &rsquo; は、同じ侵入に対して複数の冗長なアラートを表示することではなく、攻撃者 &rsquo; の行動の完全な範囲を把握できるようにするためのものではありません。 また、この攻撃の背後にあるアクターが、その手法のいくつかの側面を変更する可能性があることにも同意します。 攻撃のライフサイクル全体にわたる検出範囲が大きいほど、攻撃者の手法が変更されることになります。 また、この攻撃者が使用する特定の手法は、他の攻撃 &rsquo; 者によって使用されることもあります。</p>\n\n<h2>推奨アクション</h2>\n\n<p><strong>Azure Security Center で定期的にアラートを確認</strong>します。 お客様は、この侵入に対して複数の Azure Security Center アラートを受け取りました。悪意のあるアクティビティはすぐに停止し、再び表示されることはありません。 Azure Security Center は、 <a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-managing-and-responding-alerts\" target=\"_blank\">セキュリティアラート</a>の1か所ですべてのアラートを統合します。 これにより、アラートの重要度を簡単に確認でき、応答の優先順位を決めることができます。 各アラートには、インシデントの詳細な説明と、問題を修復するための手順が表示されます。 詳細な調査のために、調査パス &rdquo; のアラート &ldquo; を確認して、攻撃に関係するすべてのエンティティを視覚的かつ視覚的に確認することができます。</p>\n\n<p><strong>パスワードは定期的に変更して</strong>ください。 アクティビティに対して Azure Security Center 警告が発生しても、適切なパスワードの検疫によって侵入を防ぐことができます。 攻撃ツールキットのユーザー名とパスワードの組み合わせの多くは、ソフトウェアを最初にインストールしたときに作成される既定値です。 これらの既定のパスワードを変更するか、 <a href=\"https://techcommunity.microsoft.com/t5/Azure-Active-Directory-Identity/Announcing-password-less-login-identity-governance-and-more-for/ba-p/262472\" target=\"_blank\">パスワード</a>を使用しないようにすると、パスワードを使用できなくなります。</p>\n\n<h2>最後に</h2>\n\n<p>私たちのチームは、サイバーセキュリティの問題の両方に対応しています。 マイクロソフトでは、パブリックと内部の両方のセキュリティ研究を通じて、検出を継続的に改善し、改良しています。 また、外部の脅威をキー入力として監視して、マイクロソフトとその顧客の両方に向けた攻撃に対して検出範囲が最も重要であることを確認することもできます。 Azure に Linux マシンがある場合は、Azure Security Center を使用して監視し、他のユーザーをターゲットにできないようにすることを検討してください。</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/e6dd6687-444e-4c2a-b95b-be4682ed5d37.jpg\"><img alt=\"Slide1\" border=\"0\" height=\"90\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2981dffe-95cb-4ad6-add2-2b713179edfe.jpg\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Slide1\" width=\"881\"></a></p>\n\n<p>実行できる操作に加えて、Microsoft では、Azure プラットフォームを保護するために、いくつかの物理的なインフラストラクチャと運用制御が用意されています。 マイクロソフトでは3500のサイバーセキュリティ専門家を超えており、セキュリティの脅威に対する保護、検出、対応を、当社のインフラストラクチャとサービス24/7、365日にわたって行うことができました。 これらのチームの1つは Microsoft の脅威インテリジェンスセンターです。 Microsoft のチームの詳細と、Azure の悪意のあるアクティビティから保護する方法については、Microsoft の最新の機能に関する <a href=\"https://www.youtube.com/watch?v=n58eHSLoU9w\" target=\"_blank\">ビデオをご覧</a>ください。</p>\n\n<h2>その他のリソース</h2>\n\n<ul>\n <li>Honeypot とその使用方法の詳細については、Ross Bevington &rsquo; s BlueHat talk &ldquo; をご覧ください。この<a href=\"https://www.youtube.com/watch?v=abamlxFHElw\" target=\"_blank\">マトリックスでは、詐欺-BlueHat 2018</a> &rdquo; を使用して Linux を保護しています。</li>\n <li><a href=\"https://github.com/Microsoft/OMS-Agent-for-Linux\" target=\"_blank\">OMS エージェント for Linux</a>を使用すると、Linux サーバー、Docker コンテナー、Nagios、Zabbix、System Center などの監視ツールから、オペレーションデータ (Syslog、パフォーマンス、アラート、インベントリ) の豊富なリアルタイム分析を行うことができます。</li>\n <li><a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities\" target=\"_blank\">Azure Security Center とその &rsquo; 高度な検出機能</a>について説明します。</li>\n <li><a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-managing-and-responding-alerts\" target=\"_blank\">Azure Security Center でセキュリティアラートの管理と対応を</a>開始する方法について説明します。</li>\n <li><a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-recommendations\" target=\"_blank\">Azure Security Center でセキュリティに関する推奨事項を管理</a>する方法と、Azure リソースを保護する方法について説明します。</li>\n <li><a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-monitoring\" target=\"_blank\">Azure Security Center でのセキュリティ正常性の監視</a>の詳細と、Azure リソースの正常性を監視する方法について説明します。</li>\n <li>Azure Security Center を <a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-partner-solutions\" target=\"_blank\">使用したパートナー ソリューションの監視について学習します</a>。</li>\n <li>サービス <a href=\"https://docs.microsoft.com/en-us/azure/security-center/security-center-faq\" target=\"_blank\">Azure Security Centerよく寄</a> せられる質問については、FAQ を参照してください。</li>\n <li><a href=\"https://blogs.msdn.com/b/azuresecurity/\" target=\"_blank\">最新の Azure Security ブログのニュースと</a>情報を取得します。</li>\n</ul>"
