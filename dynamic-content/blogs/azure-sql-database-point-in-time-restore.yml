### YamlMime:Yaml
ms.openlocfilehash: f513c9732f369117ae474184f0d77fc9c95c7448
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139889934"
Slug: azure-sql-database-point-in-time-restore
Title: Azure SQL Databaseポイントインタイム リストア
Summary: 'ビジネス継続性に関するこのシリーズの最後の投稿では、Basic、Standard、および プレミアム データベースで使用できるセルフサービス機能であるポイントインタイム リストアについて説明します。 '
Content: >-
  <h5><strong>[2017 年 3 月 3 日に更新] </strong>このトピックの更新されたコンテンツについては、次の記事をご覧ください。ドキュメント サイトSQL Database<a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-automated-backups">バックアップ</a>について説明します。</h5>


  <p><strong>[2016 年 1 月 22 日に更新]</strong>データベース&nbsp;層の Basic、Standard、および プレミアムの推定復旧時間 (ERT) と目標復旧時点 (RPO) の改善。 &nbsp;ビジネス継続性に&rsquo;関するシリーズのこの最後の投稿では、Basic、Standard<i></i>、および プレミアム データベースで使用できるセルフサービス機能であるポイントインタイム リストアについて説明します。 前の投稿では、ポイントAzure SQL Database復元を含むビジネス継続性モデルの詳細について説明しました。 このモデルの概要を次の表に示します。 このモデル内のポイントインタイム リストアは、偶発的なデータの破損または削除後に、最近のバックアップからデータベースを復旧するように設計されています。</p>


  <table border="1" cellpadding="0" cellspacing="0">
   <tbody>
    <tr>
     <td valign="top" width="176">
     <p align="center"><b>BCDR オプション</b></p>
     </td>
     <td valign="top" width="118">
     <p align="center"><b>Basic レベル</b></p>
     </td>
     <td valign="top" width="114">
     <p align="center"><b>Standard レベル</b></p>
     </td>
     <td valign="top" width="120">
     <p align="center"><b>Premium レベル</b></p>
     </td>
    </tr>
    <tr>
     <td valign="top" width="176">ポイントインタイム リストア</td>
     <td valign="top" width="118">7 日間以内のあらゆる復元ポイント</td>
     <td valign="top" width="114">35 日間以内のあらゆる復元ポイント</td>
     <td valign="top" width="120">35 日間以内のあらゆる復元ポイント</td>
    </tr>
    <tr>
     <td valign="top" width="176">geo リストア</td>
     <td valign="top" width="118">ERT* &lt; 12h RPO&dagger; &lt; 1h</td>
     <td valign="top" width="114">ERT*&nbsp;&lt; 12h RPO&dagger; &lt; 1h</td>
     <td valign="top" width="120">ERT*&nbsp;&lt; 12h RPO&dagger; &lt; 1h</td>
    </tr>
    <tr>
     <td valign="top" width="176">標準ジオ (主要地域) レプリケーション</td>
     <td valign="top" width="118">対象外の情報</td>
     <td valign="top" width="114">ERT*&nbsp;&lt; 30s RPO&dagger; &lt; 5s</td>
     <td valign="top" width="120">ERT*&nbsp;&lt; 30s RPO&dagger; &lt; 5s</td>
    </tr>
    <tr>
     <td valign="top" width="176">アクティブな地理的レプリケーション</td>
     <td valign="top" width="118">対象外の情報</td>
     <td valign="top" width="114">対象外の情報</td>
     <td valign="top" width="120">ERT*&nbsp;&lt; 30s RPO&dagger; &lt; 5s</td>
    </tr>
   </tbody>
  </table>


  <p>* 推定復旧時間 (ERT) - 復元/フェールオーバー要求後にデータベースが完全に機能する推定期間。 &dagger; 目標復旧時点 (RPO) - 復旧後にアプリケーションが失われる可能性がある最新のデータ変更の量 (時間間隔)。</p>


  <h2>ポイントインタイム リストアとは</h2>


  <p>このAzure SQL Databaseは、自動バックアップ システムを使用してすべてのデータベースを保護します。 これらのバックアップは、Basic の場合は 7 日間、Standard の場合は 35 日間、プレミアム。 ポイントインタイム リストアはセルフサービス機能です。お客様は、Basic、Standard、または プレミアム データベースをこれらのバックアップからリテンション期間中の任意の時点に復元できます。 ポイントインタイム リストアでは、常に新しいデータベースが作成されます。 データベースバックアップは自動的に作成され、オプトインする必要はありません。追加料金は発生します。 復元機能を使用する場合にのみ、追加コストが発生します。 復元によって作成された新しいデータベースは、通常のデータベース レートで課金されます。 自動化されたバックアップ システムとポイントインタイム リストアを組み合わせて使用すると、データベースを偶発的な破損や削除から保護する、コストがかからない管理不要の方法が提供されます。 &nbsp;</p>


  <h2>自動バックアップについて</h2>


  <p>すべての Basic、Standard、プレミアムデータベースは、自動バックアップによって保護されます。 完全バックアップは毎週作成され、差分バックアップは毎日、ログ バックアップは 5 分ごとに実行されます。 初回の完全バックアップは、データベースの作成直後にスケジュールされます。 通常、これは 30 分以内に完了しますが、時間がかかる場合があります。 データベースが大きく&ldquo;&rdquo;なった場合 (たとえば、大規模なデータベースからデータベースをコピーまたは復元した結果として作成された場合)、最初の完全バックアップの完了に時間がかかる場合があります。 最初の完全バックアップの後、それ以降のすべてのバックアップは自動的にスケジュールされ、バックグラウンドで自動的に管理されます。 完全バックアップと差分バックアップの正確なタイミングは、全体的な負荷のバランスを取るシステムによって決まります。 バックアップ ファイルは、ディザスター リカバリーのためにバックアップの可用性を確保するために、読み取りアクセス (RA-GRS)&rsquo; を持つ geo 冗長ストレージ アカウントに格納されます。 データベースを復元すると、必要なバックアップ ファイルが同じデータ センターに取得され、適用されます。 <a href="https://azure.microsoft.com/blog/2014/09/13/azure-sql-database-geo-restore/">geo リストアが呼び</a>出されると、バックアップの geo 冗長コピーが取得され、最後の投稿の説明に従って適用されます。 &nbsp;</p>


  <h2>ライブ データベースを特定の時点に復元する</h2>


  <p>Azure 管理ポータル&rsquo;を使用すると、ライブ Basic、Standard、または プレミアム データベースを保持期間中の任意の時点に復元する簡単な操作が可能です。 データベースの一覧でデータベースを選択するか、データベース ダッシュボードで開き、復元オプションを選択します。 <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/19/RestoreLiveDB1.png"><img alt="RestoreLiveDB1" border="0" height="509" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/RestoreLiveDB1_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;" title="RestoreLiveDB1 新" width="604"></a>&nbsp;しいデータベース名の入力を求め、保持期間中に復元ポイントを選択するスライダー コントロールを提供します。 または、日付と時刻を最も近い分まで手動で入力することもできます。 アクションを確認すると、データベースが復元されます。 <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/19/RestoreSettings.png"><img alt="RestoreSettings" border="0" height="404" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/RestoreSettings_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;" title="RestoreSettings" width="604"></a> &nbsp;</p>


  <p>データベースの復元に要する時間は、データベースのサイズ、選択したタイム ポイント、選択したポイントで状態を再構築するために再生する必要があるアクティビティの量など、多くの要因によって異なります。 非常に大規模なデータベースやアクティブなデータベースの復元には数時間かかる場合があります。 データベースを復元すると、常に元のデータベースと同じサーバーに新しいデータベースが作成されます。そのため、復元されたデータベースには新しい名前を付けなければならない。 データベースは、既定のパフォーマンス レベルで復元ポイントで適用されたサービス レベルを使用して復元されます。 復元によって新しいデータベースが作成され、復元されたデータベースのサービス レベルとパフォーマンス レベルがライブ データベースの現在の状態と異なる可能性を念頭に置いて、サーバーに十分な <a href="https://msdn.microsoft.com/en-us/library/azure/ee336245.aspx#DTUs">DTU</a> クォータが確保されている必要があります。 復元が完了すると、復元されたデータベースは、通常の完全にアクセス可能なオンライン データベースになり、サービス レベルとパフォーマンス レベルに基づいて通常料金が発生します。 復旧の目的でデータベースを復元する場合、復元されたデータベースを元のデータベースの代わりとして扱うか、データを取得し、元のデータベースを更新するために使用することができます。 復元されたデータベースが元のデータベースの代わりとして意図されている場合は、パフォーマンス レベルやサービス レベルが適切か確認し、必要に応じてデータベースをスケーリングする必要があります。 T-SQL の ALTER DATABASE コマンドを使用して、元のデータベース名を変更し、復元したデータベースに元の名前を付けます。 復元されたデータベースからデータを取得する場合は、必要なデータ復旧スクリプトを個別に記述して実行する必要があります。 復元操作が完了するまでに時間がかかる可能性がありますが、データベース一覧全体でデータベースが表示されるようになります。 復元中にデータベースを削除すると、操作は取り消され、料金はかかりません。 <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/19/RestoreMonitoring.png"><img alt="RestoreMonitoring" border="0" height="509" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/RestoreMonitoring_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;" title="RestoreMonitoring" width="604"></a> &nbsp;</p>


  <h2>最近削除されたデータベースの復元</h2>


  <p>Basic、Standard、または プレミアム データベースを削除した場合、最終バックアップは通常の保有期間保持され、データベースを削除された時点に復元できます。 Azure 管理ポータルで削除されたデータベースを復元するには、[削除されたデータベース] タブを開き、適切なデータベース エントリを見つける必要があります。 <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/19/RestoreDroppedDB1.png"><img alt="RestoreDroppedDB1" border="0" height="593" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/RestoreDroppedDB1_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;" title="RestoreDroppedDB1" width="604"></a> &nbsp; 同じデータベース名を複数回再利用した場合は、正しいデータベースを確実に復元するために、各データベースの削除時間に注意する必要があります。 <a href="https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/09/19/RestoreDroppedDB2.png"><img alt="RestoreDroppedDB2" border="0" height="447" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/RestoreDroppedDB2_thumb.png" style="border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;" title="RestoreDroppedDB2" width="604"></a> 以前と同様に、新しいデータベースの名前を指定する必要がありますが、この場合、復元ポイントはデータベースの削除時刻に固定されます。 以前と同様に、削除されたデータベースを復元する場合は、元のデータベースを含むサーバーにのみ復元できます。 サーバーを削除する場合は、サーバーが削除された後に、そのサーバー上に以前に置いたデータベースを復元できないので、この問題に気を付けしてください。 &nbsp;</p>


  <h2>バックアップ/復元とコピー/エクスポート/インポート</h2>


  <p>ポイントインタイム リストアは、偶発的なデータ損失や破損から Basic、Standard、プレミアムデータベースを復旧するために推奨されるアプローチです。 ポイントインタイム リストアでは、コピーおよびエクスポート/自動エクスポートに基づいてコストの高い回避策を使用して、Web および Business データベースで必要なバックアップを作成する必要がなされません。 この改善だけでは、新しいサービス レベルの 1 つへのアップグレードが正当化される可能性があります。 バックアップと復元はコストが低くなります (過剰なバックアップを行う場合を超<a href="https://msdn.microsoft.com/en-us/library/azure/jj650016.aspx#&quot;backup storage&quot;"></a>える場合を限り、データベース コピーに対して課金は発生しないのに対し、トランザクション整合性エクスポートと BACPAC ファイルの保存に必要なデータベース コピーに対して課金されます)、管理者はゼロ (バックアップは自動ですが、エクスポートを自分で管理またはスケジュールする必要があります)、より優れた RPO (コピー/ で実用的な場合よりも細かい (1 分) 細分性で特定の時点に復元できます)エクスポート/インポート)&nbsp; と復旧時間の向上 (通常、バックアップからの復元はインポートよりもはるかに高速です。スキーマの作成、インデックスの無効化、データの読み込み、各テーブルのインデックスの個別の有効化を行う手順が含まれます)。 保有期間を超えて長期的なアーカイブを行う場合は、引き続きコピーとエクスポートが推奨されるソリューションです。 &nbsp;</p>


  <h2>API を使用したデータベースの復元</h2>


  <p>Azure 管理ポータル を使用する以外に、<a href="https://msdn.microsoft.com/en-us/library/dn720218.aspx">Start-AzureSqlDatabaseRestore</a> コマンドレットと SQL Database management API Create <a href="https://msdn.microsoft.com/en-us/library/azure/dn509571.aspx">Database Restore Request</a> を使用して PowerShell を使用してデータベースを復元することもできます。 &nbsp;</p>


  <h2>まとめ</h2>


  <p>自動バックアップとセルフサービスのポイントインタイム リストアにより、データベースが偶発的なデータの破損や削除から保護されます。 このゼロコストのゼロ管理ソリューションは、すべての Basic、Standard、および プレミアム データベースで使用できます。 短期間の復元のニーズがある場合、バックアップと復元には、代替のコピー/エクスポート/インポート ソリューションよりも大きな利点があります。 ビジネス継続性戦略の一環としてポイントインタイム リストアを使用し、長期的なアーカイブまたはデータ移行の目的で必要に応じてエクスポートのみを使用してください。</p>
