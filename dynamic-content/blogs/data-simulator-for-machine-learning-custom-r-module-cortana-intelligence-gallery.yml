### YamlMime:Yaml
ms.openlocfilehash: cdd53af05c3b0d00538c1e2698c1b568e3030819
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139893996"
Slug: data-simulator-for-machine-learning-custom-r-module-cortana-intelligence-gallery
Title: Machine Learning 用のデータシミュレーター
Summary: Cortana Intelligence Gallery で使用可能な Azure Machine Learning Studio でのバイナリ分類のデータシミュレーション用のカスタム R モジュール
Content: >-
  <p>新しい機械学習アルゴリズムを使用するすべてのデータサイエンス実験では、さまざまなシナリオにわたるテストが必要です。 シミュレートされたデータを使用すると、実際のデータでは実現できない、制御された体系的な方法でこれを行うことができます。</p>


  <p><a href="https://studio.azureml.net/">Azure Machine Learning (AML) Studio</a>でデータシミュレーションを実装して再利用するための便利な方法は、<a href="https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-custom-r-modules">カスタム R モジュール</a>を使用することです。 カスタム r モジュールは、ドラッグアンドドロップモジュール内にパッケージをパッケージ化することの利便性を兼ね備えています。カスタムコードは、ユーザーが機能パラメーターを追加および削除できる柔軟性を備えており、必要に応じて AML Studio GUI にモジュール入力として表示されます。 カスタム R モジュールは、ネイティブ AML Studio モジュールと同じ動作をします。 その入力と出力は、他のモジュールに接続するか、手動で設定することができます。また、基になる R コードで許可されている場合は、AML 実験内で任意のスキーマのデータを処理できます。 追加の利点として、ソースを明らかにせずにコードをデプロイする便利な方法が用意されています。これは、IP を区別するシナリオに便利な場合があります。 <a href="https://gallery.cortanaintelligence.com/">Cortana Intelligence Gallery</a>に発行することで、従来のソフトウェア展開プロセスを気にせずに、どのようなアルゴリズム機能にも簡単に公開できます。</p>


  <h2>データシミュレーター</h2>


  <p>ここでは、<em>バイナリ分類</em>用のデータシミュレーターの<a href="https://gallery.cortanaintelligence.com/Experiment/Data-Simulator-For-Machine-Learning-1">AML Studio カスタム R モジュール</a><a href="https://gallery.cortanaintelligence.com/Experiment/Data-Simulator-For-Machine-Learning-1">実装</a>について説明します。 現在のバージョンは単純であり、Cortana Intelligence Gallery item ページ内に完全なコードを持つことができます。 これにより、ラベル関連の列および関連性のない列の両方を含むカスタム <em>特徴の次元</em> データセットを生成できます。 関連する特徴は、ラベル列と univariately 相関関係があります。 相関の方向 (つまり、正または負の相関係数) は、 <strong>correlationdirectionality</strong> パラメーターによって制御されます。 すべての機能は、別個の <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/Uniform.html">runif</a> 呼び出しを使用して生成されます。 将来的には、モジュールの機能をさらに拡張して、ユーザーが R で省略記号/3 ドット引数機能を追加して公開することによって他のディストリビューションを選択できるようにすることができます。最後のモジュールパラメーター (seedValue) を使用して、結果の再現性を制御できます。 図1は AML Studio で公開されているすべてのモジュールパラメーターを示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3aea8c2b-6c57-4832-a3bb-d36df0f23303.png"><img alt="image" border="0" height="618" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f6d808b9-1451-48f6-be8b-499f35f338ea.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="絵" width="757"></a>&nbsp;</p>


  <p>図 1. AML 実験の Data シミュレーターカスタム R モジュール。 100万サンプルがシミュレートされており、1000無関係で、10個のラベルに関連する列があります。 データのバランスは、20個のサンプルだけが FALSE &rdquo; クラスで &ldquo; あるため、非常に均衡が取れています。 noiseAmplitude &rdquo; プロパティの2つの値 (03 および 5) の long 配列値は、 &ldquo; 関連するすべての列に再利用されます。 同様に、4つの値 (1、-1、0、3.5) &ldquo; のラベル機能の関連付け &rdquo; プロパティは、ラベル列を持つ相関の方向 (つまり、正または負) を制御するために、10個の関連するすべての列に再利用されます。</p>


  <p>図2に示すように、モジュールの出力 (右クリックしてから &ldquo; 視覚化 &rdquo; ) を視覚化することで、データの基本的なプロパティを確認できます。 これには、データマトリックスのサイズと、範囲や欠損値などの uniバリエーションの統計が含まれます。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7e290b74-5680-452a-9917-1ad0237475f9.png"><img alt="image" border="0" height="518" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0272bf75-abe5-42ba-8864-9477baa92b1c.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="絵" width="768"></a>&nbsp;</p>


  <p>図 2. シミュレートされたデータの視覚化。 データには100万行と1011列があります (10 の関連、および1000の関連性のない特徴列とラベル)。 ラベル列 (右グラフ) のヒストグラムは、このシミュレーションで選択された大きなクラスの不均衡を示します。</p>


  <h2>シミュレートされたデータの uniの特徴の重要度分析</h2>


  <p><strong>注: シミュレートされたデータに対して選択されたサイズによっては、生成に時間がかかる場合があります。例: 1e6 行 x 2000 特徴列 (2001 total columns) データセットの場合は1時間。ただし、新しいモジュールは、データが生成された後でも実験に追加できます。また、次に示すように、キャッシュされたデータは、再シミュレートせずに処理できます。</strong></p>


  <p>複数の特徴の重要度分析 (FIA) は、Pearsonian の相関関係や相互情報 (MI) などのメトリックを使用して、各特徴列とラベル値の類似性を測定します。 MI は、データの依存関係の方向に依存しない優れたプロパティを持つため、Pearsonian の相関関係より汎用的です。これは、すべての中間値に対して1つのクラスのラベルを持つ特徴 (たとえば &ldquo; 、TRUE &rdquo; ) がある機能です。また &ldquo; &rdquo; 、Pearsonian 相関関係がゼロに近い場合でも、大きな mi 値を持ちます。</p>


  <p>特徴によって、複数の依存関係をキャプチャすることはありませんが、特徴と分類ターゲット (ラベル) の関係を簡単に理解することができます。 AML Studio で uniバリエーションを実行する簡単な方法は、既存の AML モジュールを使用して、類似性の計算の<a href="https://msdn.microsoft.com/library/azure/818b356b-045c-412b-aa12-94a1d2dad90f">特徴選択</a>と、結果の連結に<a href="https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5">R スクリプト</a>モジュールを実行することです。 これを行うには、次に示すように、AML Studio モジュールをいくつか追加して、 <a href="https://gallery.cortanaintelligence.com/Experiment/Data-Simulator-For-Machine-Learning-1">ci ギャラリー</a>ページでデプロイされた既定の実験を拡張します。</p>


  <p>まず、2番目 <a name="_Hlk477354361"></a> の<a name="_Hlk477355766">フィルターに基づく特徴選択 modul</a>e を追加し、その &ldquo; 特徴のスコアリング方法 &rdquo; のプロパティの [相互情報] 値を選択します。 [特徴のスコアリング方法 &rdquo; ] プロパティを [ピアソン相関] に設定した元のフィルターに基づく特徴選択モジュールは、変更されて &ldquo; いないままにする必要があります。 フィルターに基づく特徴選択モジュールの場合、[必要な機能 &rdquo; の数] プロパティの設定 &ldquo; は関係ありません。 ここでは、すべてのデータ列に対して計算された類似性メトリックを使用します。これは、各フィルターに基づく特徴選択モジュールの2番目 (右) の出力に接続することによって使用できます。 両方のモジュールの "ターゲット列 &rdquo; " プロパティは &ldquo; 、データのラベル列名をポイントする必要があります。 図3は、2番目のフィルターに基づく特徴選択モジュールに対して選択された設定を示しています。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/28f6ca81-a75b-429a-a713-87891dcb7b31.png"><img alt="clip_image006[4]" border="0" height="459" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/104f8d71-913c-4496-9332-0bf5b33ecfb9.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="clip_image006 [4]" width="754"></a></p>


  <p>図 3: 相互情報の計算用に追加された、フィルターに基づく機能の選択 AML Studio モジュールのプロパティ設定。 モジュールの右側の出力に接続することによって、すべてのデータ列 (特徴とラベル) に対して MI 値が取得されます。</p>


  <p>実験に追加された次の2つの <a href="https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5">R スクリプトの実行</a> モジュールは、結果の連結に使用されます。 これらのスクリプトを以下に示します。</p>


  <p>最初のモジュール (別の列の順序で rbind):</p>


  <pre>
    dataset1 &lt;- maml.mapInputPort(1) # class: data.frame
    dataset2 &lt;- maml.mapInputPort(2) # class: data.frame

    dataset2 &lt;- dataset2[,colnames(dataset1)]
    data.set = rbind(dataset1, dataset2)

    maml.mapOutputPort(&quot;data.set&quot;)
  </pre>


  <p>2番目のモジュール (行名の追加):</p>


  <pre>
    dataset &lt;- maml.mapInputPort(1) # class: data.frame

    myRowNames &lt;- c(&quot;PearsCorrel&quot;, &quot;MI&quot;)
    data.set &lt;- cbind(myRowNames, dataset)
    names(data.set)[1] &lt;- c(&quot;Algorithms&quot;)

    maml.mapOutputPort(&quot;data.set&quot;)
  </pre>


  <p>最後のモジュールである [ <a href="https://msdn.microsoft.com/library/azure/faa6ba63-383c-4086-ba58-7abf26b85814">csv に変換</a>] は実験に追加され、必要に応じて、結果を便利な形式 (CSV) でダウンロードできます。 結果ファイルはプレーンテキストで表示され、任意のテキストエディターまたは Excel で開くことができます (図 4)。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/dfbe48d2-4bf2-4207-a0ce-3b6a7e6525d5.jpg"><img alt="clip_image008" border="0" height="254" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/cfad3e14-e5c8-47b7-8523-3406ada8a7b0.jpg" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="clip_image008" width="744"></a></p>


  <p>図 4: Excel で視覚化されたダウンロード結果ファイル。</p>


  <h2>シミュレートされたデータのプロパティ</h2>


  <p>関連する列の結果を図5に示します。 MI と Pearsonian の相関関係は異なるスケールにありますが、両方の類似性メトリックが適切に関連付けられています。 また、図1で説明されているカスタム R モジュールの noiseAmplitude &rdquo; プロパティと同期して &ldquo; います。 2つの noiseAmplitude 値 (03 および 5) は、10個の関連するすべての列に再利用されます。これにより、関連する特徴1、3、5、7、および9は、低いノイズ振幅に対するラベルと非常に高い相関関係があります。</p>


  <p><a href="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f42b3a6b-4973-4c70-9644-36fe2ed9e6df.png"><img alt="clip_image010" border="0" height="459" src="https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/cea2b502-be2a-426b-af11-afc5e05f1db5.png" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" title="clip_image010" width="759"></a></p>


  <p>図 5: 以前にシミュレートされた10個の関連機能の結果を表示します。 MI (左軸) と Pearsonian の相関関係 (右軸) は異なるスケールにありますが、両方の類似性メトリックが適切に関連付けられています。</p>


  <p>必要に応じて、1000の無関係な特徴列については、MI と Pearsonian の両方の相関関係の最小値、最大値、および平均の統計が 1e-2 未満です (表1を参照)。</p>


  <table border="0" cellpadding="0" cellspacing="0">
   <tbody>
    <tr>
     <td valign="bottom" width="64">&nbsp;</td>
     <td valign="bottom" width="127">
     <p>PearsCorrel</p>
     </td>
     <td valign="bottom" width="127">
     <p>MI</p>
     </td>
    </tr>
    <tr>
     <td valign="bottom" width="64">
     <p>分</p>
     </td>
     <td valign="bottom" width="127">
     <p>9.48 e-07</p>
     </td>
     <td valign="bottom" width="127">
     <p>3.23 e-07</p>
     </td>
    </tr>
    <tr>
     <td valign="bottom" width="64">
     <p>最大</p>
     </td>
     <td valign="bottom" width="127">
     <p>3.93 e-03</p>
     </td>
     <td valign="bottom" width="127">
     <p>8.31 e-06</p>
     </td>
    </tr>
    <tr>
     <td valign="bottom" width="64">
     <p>average</p>
     </td>
     <td valign="bottom" width="127">
     <p>7.67 e-04</p>
     </td>
     <td valign="bottom" width="127">
     <p>3.02 e-06</p>
     </td>
    </tr>
    <tr>
     <td valign="bottom" width="64">
     <p>stdev</p>
     </td>
     <td valign="bottom" width="127">
     <p>5.84 e-04</p>
     </td>
     <td valign="bottom" width="127">
     <p>1.27 e-06</p>
     </td>
    </tr>
   </tbody>
  </table>


  <p>表 1 上記でシミュレートされている、関連性のない1000列の類似性メトリックの統計。</p>


  <p>この結果は、サンプルサイズ (シミュレートされた行の数) に大きく依存します。 ここで使用されている1e3 の行サイズが非常に小さい場合は、シミュレートされたデータの確率論的の性質により、関連性のない列の最大値と平均 MI と Pearsonian の相関関係の値が大きくなることがあります。</p>


  <h2>まとめ</h2>


  <p>データシミュレーションは ML アルゴリズムを理解するための重要なツールです。 ここに示されているカスタム R モジュールは<a href="https://gallery.cortanaintelligence.com/">Cortana Intelligence Gallery</a>で<a href="https://gallery.cortanaintelligence.com/Experiment/Data-Simulator-For-Machine-Learning-1">使用</a>でき、その結果をフィルターに<a href="https://msdn.microsoft.com/library/azure/818b356b-045c-412b-aa12-94a1d2dad90f">基づく機能の選択</a>に AML モジュールを使用して分析でき<i>ます。</i> アルゴリズムの将来の拡張には、回帰データと複数の依存関係が含まれている必要があります。</p>
