### YamlMime:Yaml
ms.openlocfilehash: 96e3419fceaa7d716dc128022e51fdbdb076714d
ms.sourcegitcommit: d03bdc7fe5447adb6530886aab848b75fe8fa8ee
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/11/2022
ms.locfileid: "139908967"
Slug: how-to-tell-if-you-are-out-of-room
Title: 空き領域が不足しているかどうかを確認する方法
Summary: '[この記事は SQL Azure チームによって提供されました。]SQL Azure データベースのサイズは制限されています。その理由の1つは、データが次の範囲を超えた場合に、驚かされる請求書を送信したくないこと &rsquo; です。'
Content: "<p>[この記事は SQL Azure チームによって提供されました。]</p><p>SQL Azure データベースのサイズは制限されています。その理由の1つは、データが期待よりも大きくなる場合に、驚くほどの請求書を送信したくないこと &rsquo; です。 データベースの上限をいつでも増減できます (最大50ギガバイト)。ただし、これは自動的には行われません。 この記事では、SQL Azure データベースのサイズの変更、現在の上限の照会、現在のサイズの確認、サイズエラーの検出など、さまざまなテクニックとヒントについて説明します。</p>  <p>開始する前に、データベースの上限に基づいて課金されることはありませんが、データベースの各エディションの範囲に基づいて、データベースが実際に保持しているデータに対して課金されます。 Web edition では、これらの範囲は0-1 ギガバイト、1-5 ギガバイトです。 Business edition の場合、これらの範囲は0-10 ギガバイト、10-20 ギガバイト、20-30 ギガバイト、30-40 ギガバイト、および 40-50 Gb です。</p>  <h2>現在の上限</h2>  <p>次の SQL transact-sql クエリを使用して、SQL Azure データベースの現在の cap に対してクエリを実行できます。</p>  <pre class=\"csharpcode\"><span class=\"kwrd\">SELECT</span> DATABASEPROPERTYEX (<span class=\"str\">'AdventureWorksLTAZ2008R2'</span> , <span class=\"str\">'MaxSizeInBytes'</span> )</pre>  <p>    </p>  <p>当然ながら、プロパティは<b>maxsizeinbytes</b>という名前が付けられているので、SQL Azure<a href=\"https://en.wikipedia.org/wiki/Gigabyte\">ギガ</a>バイトは10億バイトではなく1073741824バイトであると信じています。 注意すべき点として、データベース引数は現在のデータベースと同じである必要があります。それ以外の場合、結果は NULL になります。</p>  <h2>現在のサイズ</h2>  <p>次のクエリを使用して、データベースの現在のサイズに対してクエリを実行できます。</p>  <pre class=\"csharpcode\"><span class=\"kwrd\">SELECT</span> <span class=\"kwrd\">SUM</span>(reserved_page_count) * 8192  <span class=\"kwrd\">FROM</span>    sys.dm_db_partition_stats</pre>  <p>    </p>  <p>このクエリの結果もバイト単位で返されます。このクエリを使用して、上記のクエリから取得した現在の上限と比較できます。 ポップクイズ: 現在のサイズが現在の制限よりも大きくなるのはいつですか。 回答: しないでください。 制限を超えるデータを更新または挿入しようとすると SQL エラーが発生します。</p>  <h2>サイズエラーの検出</h2>  <p>SQL Azure データベースの領域が不足していると、エラー40544が表示されます。エラーメッセージは、データベースがサイズクォータに達したことを示し &ldquo; ます<i>。データのパーティション分割または削除、インデックスの削除、または使用可能な解決方法についてのドキュメントを参照してください。</i>&ldquo;</p>  <p>SQL Server Management Studio 次のようになります。&nbsp;</p>  <p style=\"color: red\">メッセージ40544、レベル20、状態5、行1 <br>データベースのサイズ クォータに達しました。 データをパーティション分割するか、データを削除するか、インデックスを削除してください。その他の解決方法についてはドキュメントを参照してください。 コード: 524289</p>  <p>C# コードでこのエラーをトラップする場合は、次のようにします。</p>  <pre class=\"csharpcode\"><span class=\"kwrd\">try</span>  {      <span class=\"rem\">// ...</span>  }  <span class=\"kwrd\">catch</span> (SqlException sqlException)  {      <span class=\"kwrd\">switch</span> (sqlException.Number)      {          <span class=\"rem\">// The database has reached its size quota. Partition or delete data,</span>          <span class=\"rem\">// drop indexes, or consult the documentation for possible resolutions. </span>          <span class=\"kwrd\">case</span> 40544:              <span class=\"kwrd\">break</span>;      }  }</pre>  <p>    </p>  <h2>データベースの上限の自動引き上げ</h2>  <p>&rsquo;データベースが現在の上限を超えたときにキャップを上げるのはすばらしいでしょうか。 SQL Azure は、データベースの上限に基づいてではなく、使用しているデータに対してのみ課金されるため、このような自動拡張はほとんど実行されません。 たとえば、0.8 掛け Gb のデータがあり、キャップが 5 Gb の場合、0-1 ギガバイトの範囲のみが課金されます。 データベースのサイズが 1 Gb を超えると、エラーは発生しません。ただし、その日から1-5 ギガバイトの範囲に対して課金されます。 基本的に、これは自動拡張であり、データベースの自動拡張が許可される最大値を指定し、使用している範囲に対してのみ課金されます。 現在の範囲を超えた場合、次の範囲に対して自動的に課金されます。エラーは発生しません。</p>  <p>この自動拡張に関する注意点として、SQL Azure 現時点では、web edition と business edition の間を移動 &rdquo; でき &ldquo; ないことが挙げられます。 1、5、10、20、30、40、および 50 Gb のデータベースキャップを使用できます。 1 ~ 5 gb のデータベースは WEB edition に含まれており、より大きなデータベースキャップを取得するために、BUSINESS edition に変更する必要があります。 これは、データベースのサイズが大きくなったときに、その増加を追跡し、transact-sql SQL (次のセクションのコードを参照) を実行してエディションを変更する必要があることを意味します。</p>  <h3>エディションの変更をコーディングする</h3>  <p>SQL Server エラー番号40544で例外がキャッチされたときに、データベースの上限またはエディションが自動的に増加するように、C# のコードデータレイヤーを少し記述することを検討しています。 これは Windows Azure web ロールに追加する必要があるため、データベースの拡張が続行される可能性があります。</p>  <p>ただし、この概念には同時実行の問題があります。 &rsquo;web サイトが1秒間に何千もの接続を取得し、データベースがいっぱいになったとき、Windows Azure サーバーの3つまたは4つのスレッドがエラー40544を受け取りました。 これらのスレッドはすべて、データベースサイズの増加を試みます。データベースのサイズが大きくなることはありません。 このソリューションでは、概念をトランザクションにラップして、一度に1つのスレッドだけがデータベースのサイズを大きくし、処理を続行するスレッドが何も実行しないようにすることができます。 ただし、SQL Azure の ALTER DATABASE ステートメント (データベースサイズを増やすステートメント) は、単独でバッチで実行する必要があり、トランザクションによってラップすることはできません。</p>  <p>40544エラーを処理するための洗練されたソリューションを検討いる、データベースのエディションを自動的に増やしています。これについては、ブログをご覧ください。 アイデアがある場合は、以下のコメントに投稿してください。</p>  <h2>データベースサイズの変更</h2>  <p>Cap を自動的に変更することは &rsquo; できますが、一部の Transact SQL を使用することもできます。 ここでは、データベース上限の変更について詳しく説明しました。 データベースエディションを変更するには、次のように ALTER DATABASE 構文を使用します。</p>  <pre class=\"csharpcode\"><span class=\"kwrd\">ALTER</span> <span class=\"kwrd\">DATABASE</span> AdventureWorksLTAZ2008R2 <span class=\"kwrd\">MODIFY</span> (EDITION=<span class=\"str\">'BUSINESS'</span>, MAXSIZE=10GB)</pre>  <p>    </p>  <p>データベースの上限サイズを設定し、サイズを変更できます。 興味深いことに、データベースのサイズを縮小しようとすると、そのオプションのデータが多すぎると、次のエラーが表示されます。</p>  <p style=\"color: red\">メッセージ60003、レベル16、状態1、行1 <br>結果として得られる累積データベースサイズがデータベースの sku 制限を超える可能性があるため、操作に失敗しました</p>  <h2>まとめ</h2>  <p>質問、懸念事項、コメントがありますか。 これらを下に投稿してください。</p>"
